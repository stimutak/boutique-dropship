{"version":3,"names":["mongoose","require","bcrypt","userSchema","Schema","email","type","String","required","unique","lowercase","trim","password","minlength","firstName","lastName","phone","addresses","enum","street","city","state","zipCode","country","default","isDefault","Boolean","isActive","isAdmin","lastLogin","Date","passwordResetToken","passwordResetExpiry","preferences","newsletter","notifications","emailPreferences","orderConfirmations","paymentReceipts","orderUpdates","promotionalEmails","welcomeEmails","cart","items","product","Types","ObjectId","ref","quantity","Number","min","max","price","addedAt","now","updatedAt","timestamps","index","pre","next","isModified","hash","methods","comparePassword","candidatePassword","compare","getDefaultShippingAddress","find","addr","getDefaultBillingAddress","addAddress","addressData","forEach","push","save","updateAddress","addressId","updateData","address","id","_id","toString","Object","assign","removeAddress","pull","updateEmailPreferences","wantsEmail","emailType","toPublicJSON","createdAt","module","exports","model"],"sources":["User.js"],"sourcesContent":["const mongoose = require('mongoose');\nconst bcrypt = require('bcryptjs');\n\nconst userSchema = new mongoose.Schema({\n  email: {\n    type: String,\n    required: true,\n    unique: true,\n    lowercase: true,\n    trim: true\n  },\n  password: {\n    type: String,\n    required: true,\n    minlength: 6\n  },\n  firstName: {\n    type: String,\n    required: true,\n    trim: true\n  },\n  lastName: {\n    type: String,\n    required: true,\n    trim: true\n  },\n  phone: {\n    type: String,\n    trim: true\n  },\n  addresses: [{\n    type: {\n      type: String,\n      enum: ['shipping', 'billing'],\n      required: true\n    },\n    firstName: { type: String, required: true },\n    lastName: { type: String, required: true },\n    street: { type: String, required: true },\n    city: { type: String, required: true },\n    state: { type: String, required: true },\n    zipCode: { type: String, required: true },\n    country: { type: String, required: true, default: 'US' },\n    phone: String,\n    isDefault: { type: Boolean, default: false }\n  }],\n  isActive: {\n    type: Boolean,\n    default: true\n  },\n  isAdmin: {\n    type: Boolean,\n    default: false\n  },\n  lastLogin: Date,\n  passwordResetToken: String,\n  passwordResetExpiry: Date,\n  preferences: {\n    newsletter: { type: Boolean, default: false },\n    notifications: { type: Boolean, default: true },\n    emailPreferences: {\n      orderConfirmations: { type: Boolean, default: true },\n      paymentReceipts: { type: Boolean, default: true },\n      orderUpdates: { type: Boolean, default: true },\n      promotionalEmails: { type: Boolean, default: false },\n      welcomeEmails: { type: Boolean, default: true }\n    }\n  },\n  cart: {\n    items: [{\n      product: {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Product',\n        required: true\n      },\n      quantity: {\n        type: Number,\n        required: true,\n        min: 1,\n        max: 99\n      },\n      price: {\n        type: Number,\n        required: true\n      },\n      addedAt: {\n        type: Date,\n        default: Date.now\n      }\n    }],\n    updatedAt: {\n      type: Date,\n      default: Date.now\n    }\n  }\n}, {\n  timestamps: true\n});\n\n// Indexes for performance\nuserSchema.index({ email: 1 });\nuserSchema.index({ isActive: 1 });\nuserSchema.index({ lastLogin: -1 });\n\n// Pre-save middleware\nuserSchema.pre('save', async function(next) {\n  if (!this.isModified('password')) return next();\n  this.password = await bcrypt.hash(this.password, 12);\n  next();\n});\n\n// Authentication method\nuserSchema.methods.comparePassword = async function(candidatePassword) {\n  return bcrypt.compare(candidatePassword, this.password);\n};\n\n// Method to get default shipping address\nuserSchema.methods.getDefaultShippingAddress = function() {\n  return this.addresses.find(addr => addr.type === 'shipping' && addr.isDefault) ||\n         this.addresses.find(addr => addr.type === 'shipping');\n};\n\n// Method to get default billing address\nuserSchema.methods.getDefaultBillingAddress = function() {\n  return this.addresses.find(addr => addr.type === 'billing' && addr.isDefault) ||\n         this.addresses.find(addr => addr.type === 'billing') ||\n         this.getDefaultShippingAddress(); // Fallback to shipping if no billing\n};\n\n// Method to add or update address\nuserSchema.methods.addAddress = function(addressData) {\n  // If this is set as default, unset other defaults of the same type\n  if (addressData.isDefault) {\n    this.addresses.forEach(addr => {\n      if (addr.type === addressData.type) {\n        addr.isDefault = false;\n      }\n    });\n  }\n  \n  this.addresses.push(addressData);\n  return this.save();\n};\n\n// Method to update address\nuserSchema.methods.updateAddress = function(addressId, updateData) {\n  const address = this.addresses.id(addressId);\n  if (!address) return null;\n  \n  // If setting as default, unset other defaults of the same type\n  if (updateData.isDefault) {\n    this.addresses.forEach(addr => {\n      if (addr.type === address.type && addr._id.toString() !== addressId) {\n        addr.isDefault = false;\n      }\n    });\n  }\n  \n  Object.assign(address, updateData);\n  return this.save();\n};\n\n// Method to remove address\nuserSchema.methods.removeAddress = function(addressId) {\n  this.addresses.pull(addressId);\n  return this.save();\n};\n\n// Method to update email preferences\nuserSchema.methods.updateEmailPreferences = function(preferences) {\n  Object.assign(this.preferences.emailPreferences, preferences);\n  return this.save();\n};\n\n// Method to check if user wants specific email type\nuserSchema.methods.wantsEmail = function(emailType) {\n  if (!this.preferences.notifications) return false;\n  return this.preferences.emailPreferences[emailType] !== false;\n};\n\n// Method to get public user data (excludes sensitive info)\nuserSchema.methods.toPublicJSON = function() {\n  return {\n    _id: this._id,\n    email: this.email,\n    firstName: this.firstName,\n    lastName: this.lastName,\n    phone: this.phone,\n    addresses: this.addresses,\n    preferences: this.preferences,\n    createdAt: this.createdAt,\n    updatedAt: this.updatedAt\n  };\n};\n\nmodule.exports = mongoose.model('User', userSchema);"],"mappings":"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","ignoreList":[]}
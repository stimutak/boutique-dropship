bc91e57f361a92cd99f08e701afdf5f8
const Cart = require('../models/Cart');
const User = require('../models/User');
const Product = require('../models/Product');
const EventEmitter = require('events');
class CartService extends EventEmitter {
  constructor() {
    super();
    this.connectionPool = new Map(); // Simple connection tracking
  }

  // Event-driven cart synchronization
  async notifyCartUpdate(sessionId, userId, cartData) {
    const eventData = {
      sessionId,
      userId,
      cart: cartData,
      timestamp: new Date()
    };

    // Emit event for real-time synchronization across browser tabs
    this.emit('cartUpdated', eventData);
    return eventData;
  }

  // Optimized cart retrieval with caching consideration
  async getCartWithPerformanceOptimization(req) {
    const startTime = Date.now();
    try {
      const result = await this.getOrCreateCart(req);
      const endTime = Date.now();
      const duration = endTime - startTime;

      // Log performance (should be under 100ms target)
      if (duration > 100) {
        console.warn(`Cart retrieval took ${duration}ms - exceeds 100ms target`);
      }
      return result;
    } catch (error) {
      console.error('Cart performance optimization error:', error);
      throw error;
    }
  }

  // Enhanced cart retrieval with connection pooling awareness
  async getOrCreateCart(req) {
    if (req.user) {
      // For authenticated users, use user's cart with optimistic loading
      const user = await User.findById(req.user._id).lean();
      if (!user.cart) {
        // Create cart optimistically
        const updatedUser = await User.findByIdAndUpdate(req.user._id, {
          $set: {
            'cart.items': [],
            'cart.updatedAt': new Date()
          }
        }, {
          new: true,
          lean: true
        });
        return {
          type: 'user',
          cart: updatedUser.cart,
          user: updatedUser
        };
      }
      return {
        type: 'user',
        cart: user.cart,
        user
      };
    } else {
      // For guests, use session-based cart with database storage
      const sessionId = req.sessionID || `guest_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

      // Use findOneAndUpdate for atomic operation
      let cart = await Cart.findOneAndUpdate({
        sessionId
      }, {
        $setOnInsert: {
          sessionId,
          items: []
        },
        $set: {
          lastAccessed: new Date()
        }
      }, {
        new: true,
        upsert: true,
        lean: true
      });
      return {
        type: 'guest',
        cart,
        sessionId
      };
    }
  }

  // Enhanced cart merging with conflict resolution
  async mergeCartsWithConflictResolution(userId, guestCartItems, sessionId) {
    const startTime = Date.now();
    try {
      const user = await User.findById(userId);
      if (!user.cart) {
        user.cart = {
          items: [],
          updatedAt: new Date()
        };
      }
      let mergedItems = 0;
      const conflicts = [];

      // Process guest cart items with conflict detection
      if (guestCartItems && Array.isArray(guestCartItems)) {
        for (const guestItem of guestCartItems) {
          const result = await this.mergeCartItem(user, guestItem, conflicts);
          if (result.merged) mergedItems++;
        }
      }

      // Process session-based cart
      if (sessionId) {
        const guestCart = await Cart.findOne({
          sessionId
        });
        if (guestCart && guestCart.items.length > 0) {
          for (const guestItem of guestCart.items) {
            const result = await this.mergeCartItem(user, guestItem, conflicts);
            if (result.merged) mergedItems++;
          }

          // Clean up guest cart
          await Cart.deleteOne({
            sessionId
          });
        }
      }
      user.cart.updatedAt = new Date();
      await user.save();
      const endTime = Date.now();
      const duration = endTime - startTime;

      // Emit cart update event
      await this.notifyCartUpdate(sessionId, userId, user.cart);
      return {
        mergedItems,
        conflicts,
        duration,
        success: true
      };
    } catch (error) {
      console.error('Cart merge error:', error);
      throw error;
    }
  }

  // Helper method to merge individual cart items
  async mergeCartItem(user, guestItem, conflicts = []) {
    try {
      const productId = guestItem.productId || guestItem.product;
      const quantity = guestItem.quantity || 1;

      // Validate product
      const product = await Product.findById(productId).lean();
      if (!product || !product.isActive) {
        return {
          merged: false,
          reason: 'invalid_product'
        };
      }

      // Check for existing item
      const existingItemIndex = user.cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (existingItemIndex >= 0) {
        const currentQuantity = user.cart.items[existingItemIndex].quantity;
        const newQuantity = currentQuantity + quantity;

        // Check for quantity conflicts
        if (newQuantity > 99) {
          conflicts.push({
            productId,
            type: 'quantity_limit',
            current: currentQuantity,
            attempted: quantity,
            resolved: 99
          });
          user.cart.items[existingItemIndex].quantity = 99;
        } else {
          user.cart.items[existingItemIndex].quantity = newQuantity;
        }
        user.cart.items[existingItemIndex].addedAt = new Date();
      } else {
        // Add new item
        user.cart.items.push({
          product: productId,
          quantity: Math.min(quantity, 99),
          price: product.price,
          addedAt: new Date()
        });
      }
      return {
        merged: true
      };
    } catch (error) {
      console.error('Error merging cart item:', error);
      return {
        merged: false,
        reason: 'merge_error',
        error: error.message
      };
    }
  }

  // Optimistic cart update with rollback capability
  async updateCartOptimistically(req, operation, data) {
    const startTime = Date.now();
    let rollbackData = null;
    try {
      const {
        type,
        cart,
        user
      } = await this.getOrCreateCart(req);

      // Store rollback data
      if (type === 'user') {
        rollbackData = JSON.parse(JSON.stringify(user.cart));
      } else {
        rollbackData = JSON.parse(JSON.stringify(cart));
      }

      // Perform operation
      let result;
      switch (operation) {
        case 'add':
          result = await this.addItemOptimistically(type, cart, user, data);
          break;
        case 'update':
          result = await this.updateItemOptimistically(type, cart, user, data);
          break;
        case 'remove':
          result = await this.removeItemOptimistically(type, cart, user, data);
          break;
        default:
          throw new Error(`Unknown operation: ${operation}`);
      }
      const endTime = Date.now();
      const duration = endTime - startTime;

      // Performance monitoring
      if (duration > 200) {
        console.warn(`Cart ${operation} took ${duration}ms - exceeds 200ms target`);
      }

      // Emit update event
      const sessionId = type === 'guest' ? cart.sessionId : null;
      const userId = type === 'user' ? user._id : null;
      await this.notifyCartUpdate(sessionId, userId, result.cart);
      return {
        ...result,
        duration,
        performance: duration <= 200 ? 'good' : 'needs_optimization'
      };
    } catch (error) {
      console.error(`Cart ${operation} error:`, error);

      // Implement rollback if needed
      if (rollbackData) {
        console.log('Rolling back cart changes...');
        // Rollback implementation would go here
      }
      throw error;
    }
  }

  // Optimistic add item operation
  async addItemOptimistically(type, cart, user, {
    productId,
    quantity
  }) {
    const product = await Product.findById(productId).lean();
    if (!product || !product.isActive) {
      throw new Error('Product not found or inactive');
    }
    if (type === 'user') {
      const existingItemIndex = user.cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (existingItemIndex >= 0) {
        const newQuantity = user.cart.items[existingItemIndex].quantity + quantity;
        if (newQuantity > 99) {
          user.cart.items[existingItemIndex].quantity = 99;
        } else {
          user.cart.items[existingItemIndex].quantity = newQuantity;
        }
        user.cart.items[existingItemIndex].addedAt = new Date();
      } else {
        user.cart.items.push({
          product: productId,
          quantity,
          price: product.price,
          addedAt: new Date()
        });
      }
      user.cart.updatedAt = new Date();
      await user.save();
      return {
        cart: user.cart
      };
    } else {
      // Check if cart has addItem method, otherwise manually add
      if (cart.addItem && typeof cart.addItem === 'function') {
        cart.addItem(productId, quantity, product.price);
      } else {
        // Manually add to cart items
        const existingItemIndex = cart.items.findIndex(item => item.product.toString() === productId.toString());
        if (existingItemIndex >= 0) {
          const newQuantity = cart.items[existingItemIndex].quantity + quantity;
          if (newQuantity > 99) {
            cart.items[existingItemIndex].quantity = 99;
          } else {
            cart.items[existingItemIndex].quantity = newQuantity;
          }
          cart.items[existingItemIndex].addedAt = new Date();
        } else {
          cart.items.push({
            product: productId,
            quantity,
            price: product.price,
            addedAt: new Date()
          });
        }
        cart.updatedAt = new Date();
      }

      // Use findByIdAndUpdate instead of save() for lean objects
      const updatedCart = await Cart.findByIdAndUpdate(cart._id, {
        items: cart.items,
        updatedAt: cart.updatedAt
      }, {
        new: true,
        lean: true
      });
      return {
        cart: updatedCart
      };
    }
  }

  // Optimistic update item operation
  async updateItemOptimistically(type, cart, user, {
    productId,
    quantity
  }) {
    if (type === 'user') {
      const itemIndex = user.cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (itemIndex >= 0) {
        if (quantity === 0) {
          user.cart.items.splice(itemIndex, 1);
        } else {
          user.cart.items[itemIndex].quantity = quantity;
          user.cart.items[itemIndex].addedAt = new Date();
        }
        user.cart.updatedAt = new Date();
        await user.save();
      }
      return {
        cart: user.cart
      };
    } else {
      // Check if cart has updateItem method, otherwise manually update
      if (cart.updateItem && typeof cart.updateItem === 'function') {
        cart.updateItem(productId, quantity);
      } else {
        // Manually update cart items
        const itemIndex = cart.items.findIndex(item => item.product.toString() === productId.toString());
        if (itemIndex >= 0) {
          if (quantity === 0) {
            cart.items.splice(itemIndex, 1);
          } else {
            cart.items[itemIndex].quantity = quantity;
            cart.items[itemIndex].addedAt = new Date();
          }
          cart.updatedAt = new Date();
        }
      }

      // Use findByIdAndUpdate instead of save() for lean objects
      const updatedCart = await Cart.findByIdAndUpdate(cart._id, {
        items: cart.items,
        updatedAt: cart.updatedAt
      }, {
        new: true,
        lean: true
      });
      return {
        cart: updatedCart
      };
    }
  }

  // Optimistic remove item operation
  async removeItemOptimistically(type, cart, user, {
    productId
  }) {
    if (type === 'user') {
      const itemIndex = user.cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (itemIndex >= 0) {
        user.cart.items.splice(itemIndex, 1);
        user.cart.updatedAt = new Date();
        await user.save();
      }
      return {
        cart: user.cart
      };
    } else {
      // Check if cart has removeItem method, otherwise manually remove
      if (cart.removeItem && typeof cart.removeItem === 'function') {
        cart.removeItem(productId);
      } else {
        // Manually remove from cart items
        const itemIndex = cart.items.findIndex(item => item.product.toString() === productId.toString());
        if (itemIndex >= 0) {
          cart.items.splice(itemIndex, 1);
          cart.updatedAt = new Date();
        }
      }

      // Use findByIdAndUpdate instead of save() for lean objects
      const updatedCart = await Cart.findByIdAndUpdate(cart._id, {
        items: cart.items,
        updatedAt: cart.updatedAt
      }, {
        new: true,
        lean: true
      });
      return {
        cart: updatedCart
      };
    }
  }

  // Cleanup expired guest carts (for scheduled maintenance)
  async cleanupExpiredCarts() {
    try {
      const result = await Cart.deleteMany({
        expiresAt: {
          $lt: new Date()
        }
      });
      console.log(`Cleaned up ${result.deletedCount} expired guest carts`);
      return result.deletedCount;
    } catch (error) {
      console.error('Error cleaning up expired carts:', error);
      throw error;
    }
  }
}

// Export singleton instance
const cartService = new CartService();
module.exports = cartService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDYXJ0IiwicmVxdWlyZSIsIlVzZXIiLCJQcm9kdWN0IiwiRXZlbnRFbWl0dGVyIiwiQ2FydFNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImNvbm5lY3Rpb25Qb29sIiwiTWFwIiwibm90aWZ5Q2FydFVwZGF0ZSIsInNlc3Npb25JZCIsInVzZXJJZCIsImNhcnREYXRhIiwiZXZlbnREYXRhIiwiY2FydCIsInRpbWVzdGFtcCIsIkRhdGUiLCJlbWl0IiwiZ2V0Q2FydFdpdGhQZXJmb3JtYW5jZU9wdGltaXphdGlvbiIsInJlcSIsInN0YXJ0VGltZSIsIm5vdyIsInJlc3VsdCIsImdldE9yQ3JlYXRlQ2FydCIsImVuZFRpbWUiLCJkdXJhdGlvbiIsImNvbnNvbGUiLCJ3YXJuIiwiZXJyb3IiLCJ1c2VyIiwiZmluZEJ5SWQiLCJfaWQiLCJsZWFuIiwidXBkYXRlZFVzZXIiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRzZXQiLCJuZXciLCJ0eXBlIiwic2Vzc2lvbklEIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwiZmluZE9uZUFuZFVwZGF0ZSIsIiRzZXRPbkluc2VydCIsIml0ZW1zIiwibGFzdEFjY2Vzc2VkIiwidXBzZXJ0IiwibWVyZ2VDYXJ0c1dpdGhDb25mbGljdFJlc29sdXRpb24iLCJndWVzdENhcnRJdGVtcyIsInVwZGF0ZWRBdCIsIm1lcmdlZEl0ZW1zIiwiY29uZmxpY3RzIiwiQXJyYXkiLCJpc0FycmF5IiwiZ3Vlc3RJdGVtIiwibWVyZ2VDYXJ0SXRlbSIsIm1lcmdlZCIsImd1ZXN0Q2FydCIsImZpbmRPbmUiLCJsZW5ndGgiLCJkZWxldGVPbmUiLCJzYXZlIiwic3VjY2VzcyIsInByb2R1Y3RJZCIsInByb2R1Y3QiLCJxdWFudGl0eSIsImlzQWN0aXZlIiwicmVhc29uIiwiZXhpc3RpbmdJdGVtSW5kZXgiLCJmaW5kSW5kZXgiLCJpdGVtIiwiY3VycmVudFF1YW50aXR5IiwibmV3UXVhbnRpdHkiLCJwdXNoIiwiY3VycmVudCIsImF0dGVtcHRlZCIsInJlc29sdmVkIiwiYWRkZWRBdCIsIm1pbiIsInByaWNlIiwibWVzc2FnZSIsInVwZGF0ZUNhcnRPcHRpbWlzdGljYWxseSIsIm9wZXJhdGlvbiIsImRhdGEiLCJyb2xsYmFja0RhdGEiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJhZGRJdGVtT3B0aW1pc3RpY2FsbHkiLCJ1cGRhdGVJdGVtT3B0aW1pc3RpY2FsbHkiLCJyZW1vdmVJdGVtT3B0aW1pc3RpY2FsbHkiLCJFcnJvciIsInBlcmZvcm1hbmNlIiwibG9nIiwiYWRkSXRlbSIsInVwZGF0ZWRDYXJ0IiwiaXRlbUluZGV4Iiwic3BsaWNlIiwidXBkYXRlSXRlbSIsInJlbW92ZUl0ZW0iLCJjbGVhbnVwRXhwaXJlZENhcnRzIiwiZGVsZXRlTWFueSIsImV4cGlyZXNBdCIsIiRsdCIsImRlbGV0ZWRDb3VudCIsImNhcnRTZXJ2aWNlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImNhcnRTZXJ2aWNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IENhcnQgPSByZXF1aXJlKCcuLi9tb2RlbHMvQ2FydCcpO1xuY29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7XG5jb25zdCBQcm9kdWN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL1Byb2R1Y3QnKTtcbmNvbnN0IEV2ZW50RW1pdHRlciA9IHJlcXVpcmUoJ2V2ZW50cycpO1xuXG5jbGFzcyBDYXJ0U2VydmljZSBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5jb25uZWN0aW9uUG9vbCA9IG5ldyBNYXAoKTsgLy8gU2ltcGxlIGNvbm5lY3Rpb24gdHJhY2tpbmdcbiAgfVxuXG4gIC8vIEV2ZW50LWRyaXZlbiBjYXJ0IHN5bmNocm9uaXphdGlvblxuICBhc3luYyBub3RpZnlDYXJ0VXBkYXRlKHNlc3Npb25JZCwgdXNlcklkLCBjYXJ0RGF0YSkge1xuICAgIGNvbnN0IGV2ZW50RGF0YSA9IHtcbiAgICAgIHNlc3Npb25JZCxcbiAgICAgIHVzZXJJZCxcbiAgICAgIGNhcnQ6IGNhcnREYXRhLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgfTtcblxuICAgIC8vIEVtaXQgZXZlbnQgZm9yIHJlYWwtdGltZSBzeW5jaHJvbml6YXRpb24gYWNyb3NzIGJyb3dzZXIgdGFic1xuICAgIHRoaXMuZW1pdCgnY2FydFVwZGF0ZWQnLCBldmVudERhdGEpO1xuICAgIFxuICAgIHJldHVybiBldmVudERhdGE7XG4gIH1cblxuICAvLyBPcHRpbWl6ZWQgY2FydCByZXRyaWV2YWwgd2l0aCBjYWNoaW5nIGNvbnNpZGVyYXRpb25cbiAgYXN5bmMgZ2V0Q2FydFdpdGhQZXJmb3JtYW5jZU9wdGltaXphdGlvbihyZXEpIHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmdldE9yQ3JlYXRlQ2FydChyZXEpO1xuICAgICAgXG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcbiAgICAgIFxuICAgICAgLy8gTG9nIHBlcmZvcm1hbmNlIChzaG91bGQgYmUgdW5kZXIgMTAwbXMgdGFyZ2V0KVxuICAgICAgaWYgKGR1cmF0aW9uID4gMTAwKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgQ2FydCByZXRyaWV2YWwgdG9vayAke2R1cmF0aW9ufW1zIC0gZXhjZWVkcyAxMDBtcyB0YXJnZXRgKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FydCBwZXJmb3JtYW5jZSBvcHRpbWl6YXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gRW5oYW5jZWQgY2FydCByZXRyaWV2YWwgd2l0aCBjb25uZWN0aW9uIHBvb2xpbmcgYXdhcmVuZXNzXG4gIGFzeW5jIGdldE9yQ3JlYXRlQ2FydChyZXEpIHtcbiAgICBpZiAocmVxLnVzZXIpIHtcbiAgICAgIC8vIEZvciBhdXRoZW50aWNhdGVkIHVzZXJzLCB1c2UgdXNlcidzIGNhcnQgd2l0aCBvcHRpbWlzdGljIGxvYWRpbmdcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHJlcS51c2VyLl9pZCkubGVhbigpO1xuICAgICAgaWYgKCF1c2VyLmNhcnQpIHtcbiAgICAgICAgLy8gQ3JlYXRlIGNhcnQgb3B0aW1pc3RpY2FsbHlcbiAgICAgICAgY29uc3QgdXBkYXRlZFVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKFxuICAgICAgICAgIHJlcS51c2VyLl9pZCxcbiAgICAgICAgICB7IFxuICAgICAgICAgICAgJHNldDogeyBcbiAgICAgICAgICAgICAgJ2NhcnQuaXRlbXMnOiBbXSwgXG4gICAgICAgICAgICAgICdjYXJ0LnVwZGF0ZWRBdCc6IG5ldyBEYXRlKCkgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IG5ldzogdHJ1ZSwgbGVhbjogdHJ1ZSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHR5cGU6ICd1c2VyJywgY2FydDogdXBkYXRlZFVzZXIuY2FydCwgdXNlcjogdXBkYXRlZFVzZXIgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHR5cGU6ICd1c2VyJywgY2FydDogdXNlci5jYXJ0LCB1c2VyIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZvciBndWVzdHMsIHVzZSBzZXNzaW9uLWJhc2VkIGNhcnQgd2l0aCBkYXRhYmFzZSBzdG9yYWdlXG4gICAgICBjb25zdCBzZXNzaW9uSWQgPSByZXEuc2Vzc2lvbklEIHx8IGBndWVzdF8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XG4gICAgICBcbiAgICAgIC8vIFVzZSBmaW5kT25lQW5kVXBkYXRlIGZvciBhdG9taWMgb3BlcmF0aW9uXG4gICAgICBsZXQgY2FydCA9IGF3YWl0IENhcnQuZmluZE9uZUFuZFVwZGF0ZShcbiAgICAgICAgeyBzZXNzaW9uSWQgfSxcbiAgICAgICAgeyBcbiAgICAgICAgICAkc2V0T25JbnNlcnQ6IHsgc2Vzc2lvbklkLCBpdGVtczogW10gfSxcbiAgICAgICAgICAkc2V0OiB7IGxhc3RBY2Nlc3NlZDogbmV3IERhdGUoKSB9XG4gICAgICAgIH0sXG4gICAgICAgIHsgXG4gICAgICAgICAgbmV3OiB0cnVlLCBcbiAgICAgICAgICB1cHNlcnQ6IHRydWUsXG4gICAgICAgICAgbGVhbjogdHJ1ZVxuICAgICAgICB9XG4gICAgICApO1xuICAgICAgXG4gICAgICByZXR1cm4geyB0eXBlOiAnZ3Vlc3QnLCBjYXJ0LCBzZXNzaW9uSWQgfTtcbiAgICB9XG4gIH1cblxuICAvLyBFbmhhbmNlZCBjYXJ0IG1lcmdpbmcgd2l0aCBjb25mbGljdCByZXNvbHV0aW9uXG4gIGFzeW5jIG1lcmdlQ2FydHNXaXRoQ29uZmxpY3RSZXNvbHV0aW9uKHVzZXJJZCwgZ3Vlc3RDYXJ0SXRlbXMsIHNlc3Npb25JZCkge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXJJZCk7XG4gICAgICBpZiAoIXVzZXIuY2FydCkge1xuICAgICAgICB1c2VyLmNhcnQgPSB7IGl0ZW1zOiBbXSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH07XG4gICAgICB9XG5cbiAgICAgIGxldCBtZXJnZWRJdGVtcyA9IDA7XG4gICAgICBjb25zdCBjb25mbGljdHMgPSBbXTtcblxuICAgICAgLy8gUHJvY2VzcyBndWVzdCBjYXJ0IGl0ZW1zIHdpdGggY29uZmxpY3QgZGV0ZWN0aW9uXG4gICAgICBpZiAoZ3Vlc3RDYXJ0SXRlbXMgJiYgQXJyYXkuaXNBcnJheShndWVzdENhcnRJdGVtcykpIHtcbiAgICAgICAgZm9yIChjb25zdCBndWVzdEl0ZW0gb2YgZ3Vlc3RDYXJ0SXRlbXMpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLm1lcmdlQ2FydEl0ZW0odXNlciwgZ3Vlc3RJdGVtLCBjb25mbGljdHMpO1xuICAgICAgICAgIGlmIChyZXN1bHQubWVyZ2VkKSBtZXJnZWRJdGVtcysrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFByb2Nlc3Mgc2Vzc2lvbi1iYXNlZCBjYXJ0XG4gICAgICBpZiAoc2Vzc2lvbklkKSB7XG4gICAgICAgIGNvbnN0IGd1ZXN0Q2FydCA9IGF3YWl0IENhcnQuZmluZE9uZSh7IHNlc3Npb25JZCB9KTtcbiAgICAgICAgaWYgKGd1ZXN0Q2FydCAmJiBndWVzdENhcnQuaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZvciAoY29uc3QgZ3Vlc3RJdGVtIG9mIGd1ZXN0Q2FydC5pdGVtcykge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5tZXJnZUNhcnRJdGVtKHVzZXIsIGd1ZXN0SXRlbSwgY29uZmxpY3RzKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQubWVyZ2VkKSBtZXJnZWRJdGVtcysrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDbGVhbiB1cCBndWVzdCBjYXJ0XG4gICAgICAgICAgYXdhaXQgQ2FydC5kZWxldGVPbmUoeyBzZXNzaW9uSWQgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdXNlci5jYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICBhd2FpdCB1c2VyLnNhdmUoKTtcblxuICAgICAgY29uc3QgZW5kVGltZSA9IERhdGUubm93KCk7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IGVuZFRpbWUgLSBzdGFydFRpbWU7XG5cbiAgICAgIC8vIEVtaXQgY2FydCB1cGRhdGUgZXZlbnRcbiAgICAgIGF3YWl0IHRoaXMubm90aWZ5Q2FydFVwZGF0ZShzZXNzaW9uSWQsIHVzZXJJZCwgdXNlci5jYXJ0KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWVyZ2VkSXRlbXMsXG4gICAgICAgIGNvbmZsaWN0cyxcbiAgICAgICAgZHVyYXRpb24sXG4gICAgICAgIHN1Y2Nlc3M6IHRydWVcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignQ2FydCBtZXJnZSBlcnJvcjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kIHRvIG1lcmdlIGluZGl2aWR1YWwgY2FydCBpdGVtc1xuICBhc3luYyBtZXJnZUNhcnRJdGVtKHVzZXIsIGd1ZXN0SXRlbSwgY29uZmxpY3RzID0gW10pIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcHJvZHVjdElkID0gZ3Vlc3RJdGVtLnByb2R1Y3RJZCB8fCBndWVzdEl0ZW0ucHJvZHVjdDtcbiAgICAgIGNvbnN0IHF1YW50aXR5ID0gZ3Vlc3RJdGVtLnF1YW50aXR5IHx8IDE7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHByb2R1Y3RcbiAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKHByb2R1Y3RJZCkubGVhbigpO1xuICAgICAgaWYgKCFwcm9kdWN0IHx8ICFwcm9kdWN0LmlzQWN0aXZlKSB7XG4gICAgICAgIHJldHVybiB7IG1lcmdlZDogZmFsc2UsIHJlYXNvbjogJ2ludmFsaWRfcHJvZHVjdCcgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIGl0ZW1cbiAgICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdXNlci5jYXJ0Lml0ZW1zLmZpbmRJbmRleChpdGVtID0+IFxuICAgICAgICBpdGVtLnByb2R1Y3QudG9TdHJpbmcoKSA9PT0gcHJvZHVjdElkLnRvU3RyaW5nKClcbiAgICAgICk7XG5cbiAgICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRRdWFudGl0eSA9IHVzZXIuY2FydC5pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0ucXVhbnRpdHk7XG4gICAgICAgIGNvbnN0IG5ld1F1YW50aXR5ID0gY3VycmVudFF1YW50aXR5ICsgcXVhbnRpdHk7XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBmb3IgcXVhbnRpdHkgY29uZmxpY3RzXG4gICAgICAgIGlmIChuZXdRdWFudGl0eSA+IDk5KSB7XG4gICAgICAgICAgY29uZmxpY3RzLnB1c2goe1xuICAgICAgICAgICAgcHJvZHVjdElkLFxuICAgICAgICAgICAgdHlwZTogJ3F1YW50aXR5X2xpbWl0JyxcbiAgICAgICAgICAgIGN1cnJlbnQ6IGN1cnJlbnRRdWFudGl0eSxcbiAgICAgICAgICAgIGF0dGVtcHRlZDogcXVhbnRpdHksXG4gICAgICAgICAgICByZXNvbHZlZDogOTlcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB1c2VyLmNhcnQuaXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLnF1YW50aXR5ID0gOTk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdXNlci5jYXJ0Lml0ZW1zW2V4aXN0aW5nSXRlbUluZGV4XS5xdWFudGl0eSA9IG5ld1F1YW50aXR5O1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB1c2VyLmNhcnQuaXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLmFkZGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQWRkIG5ldyBpdGVtXG4gICAgICAgIHVzZXIuY2FydC5pdGVtcy5wdXNoKHtcbiAgICAgICAgICBwcm9kdWN0OiBwcm9kdWN0SWQsXG4gICAgICAgICAgcXVhbnRpdHk6IE1hdGgubWluKHF1YW50aXR5LCA5OSksXG4gICAgICAgICAgcHJpY2U6IHByb2R1Y3QucHJpY2UsXG4gICAgICAgICAgYWRkZWRBdDogbmV3IERhdGUoKVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgbWVyZ2VkOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1lcmdpbmcgY2FydCBpdGVtOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IG1lcmdlZDogZmFsc2UsIHJlYXNvbjogJ21lcmdlX2Vycm9yJywgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgICB9XG4gIH1cblxuICAvLyBPcHRpbWlzdGljIGNhcnQgdXBkYXRlIHdpdGggcm9sbGJhY2sgY2FwYWJpbGl0eVxuICBhc3luYyB1cGRhdGVDYXJ0T3B0aW1pc3RpY2FsbHkocmVxLCBvcGVyYXRpb24sIGRhdGEpIHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGxldCByb2xsYmFja0RhdGEgPSBudWxsO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHR5cGUsIGNhcnQsIHVzZXIgfSA9IGF3YWl0IHRoaXMuZ2V0T3JDcmVhdGVDYXJ0KHJlcSk7XG4gICAgICBcbiAgICAgIC8vIFN0b3JlIHJvbGxiYWNrIGRhdGFcbiAgICAgIGlmICh0eXBlID09PSAndXNlcicpIHtcbiAgICAgICAgcm9sbGJhY2tEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh1c2VyLmNhcnQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJvbGxiYWNrRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY2FydCkpO1xuICAgICAgfVxuXG4gICAgICAvLyBQZXJmb3JtIG9wZXJhdGlvblxuICAgICAgbGV0IHJlc3VsdDtcbiAgICAgIHN3aXRjaCAob3BlcmF0aW9uKSB7XG4gICAgICAgIGNhc2UgJ2FkZCc6XG4gICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5hZGRJdGVtT3B0aW1pc3RpY2FsbHkodHlwZSwgY2FydCwgdXNlciwgZGF0YSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3VwZGF0ZSc6XG4gICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy51cGRhdGVJdGVtT3B0aW1pc3RpY2FsbHkodHlwZSwgY2FydCwgdXNlciwgZGF0YSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3JlbW92ZSc6XG4gICAgICAgICAgcmVzdWx0ID0gYXdhaXQgdGhpcy5yZW1vdmVJdGVtT3B0aW1pc3RpY2FsbHkodHlwZSwgY2FydCwgdXNlciwgZGF0YSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIG9wZXJhdGlvbjogJHtvcGVyYXRpb259YCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuXG4gICAgICAvLyBQZXJmb3JtYW5jZSBtb25pdG9yaW5nXG4gICAgICBpZiAoZHVyYXRpb24gPiAyMDApIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBDYXJ0ICR7b3BlcmF0aW9ufSB0b29rICR7ZHVyYXRpb259bXMgLSBleGNlZWRzIDIwMG1zIHRhcmdldGApO1xuICAgICAgfVxuXG4gICAgICAvLyBFbWl0IHVwZGF0ZSBldmVudFxuICAgICAgY29uc3Qgc2Vzc2lvbklkID0gdHlwZSA9PT0gJ2d1ZXN0JyA/IGNhcnQuc2Vzc2lvbklkIDogbnVsbDtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHR5cGUgPT09ICd1c2VyJyA/IHVzZXIuX2lkIDogbnVsbDtcbiAgICAgIGF3YWl0IHRoaXMubm90aWZ5Q2FydFVwZGF0ZShzZXNzaW9uSWQsIHVzZXJJZCwgcmVzdWx0LmNhcnQpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgIGR1cmF0aW9uLFxuICAgICAgICBwZXJmb3JtYW5jZTogZHVyYXRpb24gPD0gMjAwID8gJ2dvb2QnIDogJ25lZWRzX29wdGltaXphdGlvbidcbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgQ2FydCAke29wZXJhdGlvbn0gZXJyb3I6YCwgZXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBJbXBsZW1lbnQgcm9sbGJhY2sgaWYgbmVlZGVkXG4gICAgICBpZiAocm9sbGJhY2tEYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdSb2xsaW5nIGJhY2sgY2FydCBjaGFuZ2VzLi4uJyk7XG4gICAgICAgIC8vIFJvbGxiYWNrIGltcGxlbWVudGF0aW9uIHdvdWxkIGdvIGhlcmVcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLy8gT3B0aW1pc3RpYyBhZGQgaXRlbSBvcGVyYXRpb25cbiAgYXN5bmMgYWRkSXRlbU9wdGltaXN0aWNhbGx5KHR5cGUsIGNhcnQsIHVzZXIsIHsgcHJvZHVjdElkLCBxdWFudGl0eSB9KSB7XG4gICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuZmluZEJ5SWQocHJvZHVjdElkKS5sZWFuKCk7XG4gICAgaWYgKCFwcm9kdWN0IHx8ICFwcm9kdWN0LmlzQWN0aXZlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Byb2R1Y3Qgbm90IGZvdW5kIG9yIGluYWN0aXZlJyk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGUgPT09ICd1c2VyJykge1xuICAgICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSB1c2VyLmNhcnQuaXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gXG4gICAgICAgIGl0ZW0ucHJvZHVjdC50b1N0cmluZygpID09PSBwcm9kdWN0SWQudG9TdHJpbmcoKVxuICAgICAgKTtcblxuICAgICAgaWYgKGV4aXN0aW5nSXRlbUluZGV4ID49IDApIHtcbiAgICAgICAgY29uc3QgbmV3UXVhbnRpdHkgPSB1c2VyLmNhcnQuaXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLnF1YW50aXR5ICsgcXVhbnRpdHk7XG4gICAgICAgIGlmIChuZXdRdWFudGl0eSA+IDk5KSB7XG4gICAgICAgICAgdXNlci5jYXJ0Lml0ZW1zW2V4aXN0aW5nSXRlbUluZGV4XS5xdWFudGl0eSA9IDk5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHVzZXIuY2FydC5pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0ucXVhbnRpdHkgPSBuZXdRdWFudGl0eTtcbiAgICAgICAgfVxuICAgICAgICB1c2VyLmNhcnQuaXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLmFkZGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXNlci5jYXJ0Lml0ZW1zLnB1c2goe1xuICAgICAgICAgIHByb2R1Y3Q6IHByb2R1Y3RJZCxcbiAgICAgICAgICBxdWFudGl0eSxcbiAgICAgICAgICBwcmljZTogcHJvZHVjdC5wcmljZSxcbiAgICAgICAgICBhZGRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICB1c2VyLmNhcnQudXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcbiAgICAgIGF3YWl0IHVzZXIuc2F2ZSgpO1xuICAgICAgcmV0dXJuIHsgY2FydDogdXNlci5jYXJ0IH07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENoZWNrIGlmIGNhcnQgaGFzIGFkZEl0ZW0gbWV0aG9kLCBvdGhlcndpc2UgbWFudWFsbHkgYWRkXG4gICAgICBpZiAoY2FydC5hZGRJdGVtICYmIHR5cGVvZiBjYXJ0LmFkZEl0ZW0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY2FydC5hZGRJdGVtKHByb2R1Y3RJZCwgcXVhbnRpdHksIHByb2R1Y3QucHJpY2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTWFudWFsbHkgYWRkIHRvIGNhcnQgaXRlbXNcbiAgICAgICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSBjYXJ0Lml0ZW1zLmZpbmRJbmRleChpdGVtID0+IFxuICAgICAgICAgIGl0ZW0ucHJvZHVjdC50b1N0cmluZygpID09PSBwcm9kdWN0SWQudG9TdHJpbmcoKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgICAgY29uc3QgbmV3UXVhbnRpdHkgPSBjYXJ0Lml0ZW1zW2V4aXN0aW5nSXRlbUluZGV4XS5xdWFudGl0eSArIHF1YW50aXR5O1xuICAgICAgICAgIGlmIChuZXdRdWFudGl0eSA+IDk5KSB7XG4gICAgICAgICAgICBjYXJ0Lml0ZW1zW2V4aXN0aW5nSXRlbUluZGV4XS5xdWFudGl0eSA9IDk5O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYXJ0Lml0ZW1zW2V4aXN0aW5nSXRlbUluZGV4XS5xdWFudGl0eSA9IG5ld1F1YW50aXR5O1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXJ0Lml0ZW1zW2V4aXN0aW5nSXRlbUluZGV4XS5hZGRlZEF0ID0gbmV3IERhdGUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYXJ0Lml0ZW1zLnB1c2goe1xuICAgICAgICAgICAgcHJvZHVjdDogcHJvZHVjdElkLFxuICAgICAgICAgICAgcXVhbnRpdHksXG4gICAgICAgICAgICBwcmljZTogcHJvZHVjdC5wcmljZSxcbiAgICAgICAgICAgIGFkZGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFVzZSBmaW5kQnlJZEFuZFVwZGF0ZSBpbnN0ZWFkIG9mIHNhdmUoKSBmb3IgbGVhbiBvYmplY3RzXG4gICAgICBjb25zdCB1cGRhdGVkQ2FydCA9IGF3YWl0IENhcnQuZmluZEJ5SWRBbmRVcGRhdGUoXG4gICAgICAgIGNhcnQuX2lkLFxuICAgICAgICB7IGl0ZW1zOiBjYXJ0Lml0ZW1zLCB1cGRhdGVkQXQ6IGNhcnQudXBkYXRlZEF0IH0sXG4gICAgICAgIHsgbmV3OiB0cnVlLCBsZWFuOiB0cnVlIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4geyBjYXJ0OiB1cGRhdGVkQ2FydCB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIE9wdGltaXN0aWMgdXBkYXRlIGl0ZW0gb3BlcmF0aW9uXG4gIGFzeW5jIHVwZGF0ZUl0ZW1PcHRpbWlzdGljYWxseSh0eXBlLCBjYXJ0LCB1c2VyLCB7IHByb2R1Y3RJZCwgcXVhbnRpdHkgfSkge1xuICAgIGlmICh0eXBlID09PSAndXNlcicpIHtcbiAgICAgIGNvbnN0IGl0ZW1JbmRleCA9IHVzZXIuY2FydC5pdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBcbiAgICAgICAgaXRlbS5wcm9kdWN0LnRvU3RyaW5nKCkgPT09IHByb2R1Y3RJZC50b1N0cmluZygpXG4gICAgICApO1xuXG4gICAgICBpZiAoaXRlbUluZGV4ID49IDApIHtcbiAgICAgICAgaWYgKHF1YW50aXR5ID09PSAwKSB7XG4gICAgICAgICAgdXNlci5jYXJ0Lml0ZW1zLnNwbGljZShpdGVtSW5kZXgsIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHVzZXIuY2FydC5pdGVtc1tpdGVtSW5kZXhdLnF1YW50aXR5ID0gcXVhbnRpdHk7XG4gICAgICAgICAgdXNlci5jYXJ0Lml0ZW1zW2l0ZW1JbmRleF0uYWRkZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdXNlci5jYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGF3YWl0IHVzZXIuc2F2ZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHsgY2FydDogdXNlci5jYXJ0IH07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENoZWNrIGlmIGNhcnQgaGFzIHVwZGF0ZUl0ZW0gbWV0aG9kLCBvdGhlcndpc2UgbWFudWFsbHkgdXBkYXRlXG4gICAgICBpZiAoY2FydC51cGRhdGVJdGVtICYmIHR5cGVvZiBjYXJ0LnVwZGF0ZUl0ZW0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY2FydC51cGRhdGVJdGVtKHByb2R1Y3RJZCwgcXVhbnRpdHkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTWFudWFsbHkgdXBkYXRlIGNhcnQgaXRlbXNcbiAgICAgICAgY29uc3QgaXRlbUluZGV4ID0gY2FydC5pdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBcbiAgICAgICAgICBpdGVtLnByb2R1Y3QudG9TdHJpbmcoKSA9PT0gcHJvZHVjdElkLnRvU3RyaW5nKClcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoaXRlbUluZGV4ID49IDApIHtcbiAgICAgICAgICBpZiAocXVhbnRpdHkgPT09IDApIHtcbiAgICAgICAgICAgIGNhcnQuaXRlbXMuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhcnQuaXRlbXNbaXRlbUluZGV4XS5xdWFudGl0eSA9IHF1YW50aXR5O1xuICAgICAgICAgICAgY2FydC5pdGVtc1tpdGVtSW5kZXhdLmFkZGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVXNlIGZpbmRCeUlkQW5kVXBkYXRlIGluc3RlYWQgb2Ygc2F2ZSgpIGZvciBsZWFuIG9iamVjdHNcbiAgICAgIGNvbnN0IHVwZGF0ZWRDYXJ0ID0gYXdhaXQgQ2FydC5maW5kQnlJZEFuZFVwZGF0ZShcbiAgICAgICAgY2FydC5faWQsXG4gICAgICAgIHsgaXRlbXM6IGNhcnQuaXRlbXMsIHVwZGF0ZWRBdDogY2FydC51cGRhdGVkQXQgfSxcbiAgICAgICAgeyBuZXc6IHRydWUsIGxlYW46IHRydWUgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiB7IGNhcnQ6IHVwZGF0ZWRDYXJ0IH07XG4gICAgfVxuICB9XG5cbiAgLy8gT3B0aW1pc3RpYyByZW1vdmUgaXRlbSBvcGVyYXRpb25cbiAgYXN5bmMgcmVtb3ZlSXRlbU9wdGltaXN0aWNhbGx5KHR5cGUsIGNhcnQsIHVzZXIsIHsgcHJvZHVjdElkIH0pIHtcbiAgICBpZiAodHlwZSA9PT0gJ3VzZXInKSB7XG4gICAgICBjb25zdCBpdGVtSW5kZXggPSB1c2VyLmNhcnQuaXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gXG4gICAgICAgIGl0ZW0ucHJvZHVjdC50b1N0cmluZygpID09PSBwcm9kdWN0SWQudG9TdHJpbmcoKVxuICAgICAgKTtcblxuICAgICAgaWYgKGl0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgIHVzZXIuY2FydC5pdGVtcy5zcGxpY2UoaXRlbUluZGV4LCAxKTtcbiAgICAgICAgdXNlci5jYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGF3YWl0IHVzZXIuc2F2ZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHsgY2FydDogdXNlci5jYXJ0IH07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENoZWNrIGlmIGNhcnQgaGFzIHJlbW92ZUl0ZW0gbWV0aG9kLCBvdGhlcndpc2UgbWFudWFsbHkgcmVtb3ZlXG4gICAgICBpZiAoY2FydC5yZW1vdmVJdGVtICYmIHR5cGVvZiBjYXJ0LnJlbW92ZUl0ZW0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY2FydC5yZW1vdmVJdGVtKHByb2R1Y3RJZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBNYW51YWxseSByZW1vdmUgZnJvbSBjYXJ0IGl0ZW1zXG4gICAgICAgIGNvbnN0IGl0ZW1JbmRleCA9IGNhcnQuaXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gXG4gICAgICAgICAgaXRlbS5wcm9kdWN0LnRvU3RyaW5nKCkgPT09IHByb2R1Y3RJZC50b1N0cmluZygpXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKGl0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgICAgY2FydC5pdGVtcy5zcGxpY2UoaXRlbUluZGV4LCAxKTtcbiAgICAgICAgICBjYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVXNlIGZpbmRCeUlkQW5kVXBkYXRlIGluc3RlYWQgb2Ygc2F2ZSgpIGZvciBsZWFuIG9iamVjdHNcbiAgICAgIGNvbnN0IHVwZGF0ZWRDYXJ0ID0gYXdhaXQgQ2FydC5maW5kQnlJZEFuZFVwZGF0ZShcbiAgICAgICAgY2FydC5faWQsXG4gICAgICAgIHsgaXRlbXM6IGNhcnQuaXRlbXMsIHVwZGF0ZWRBdDogY2FydC51cGRhdGVkQXQgfSxcbiAgICAgICAgeyBuZXc6IHRydWUsIGxlYW46IHRydWUgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiB7IGNhcnQ6IHVwZGF0ZWRDYXJ0IH07XG4gICAgfVxuICB9XG5cbiAgLy8gQ2xlYW51cCBleHBpcmVkIGd1ZXN0IGNhcnRzIChmb3Igc2NoZWR1bGVkIG1haW50ZW5hbmNlKVxuICBhc3luYyBjbGVhbnVwRXhwaXJlZENhcnRzKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBDYXJ0LmRlbGV0ZU1hbnkoe1xuICAgICAgICBleHBpcmVzQXQ6IHsgJGx0OiBuZXcgRGF0ZSgpIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgQ2xlYW5lZCB1cCAke3Jlc3VsdC5kZWxldGVkQ291bnR9IGV4cGlyZWQgZ3Vlc3QgY2FydHNgKTtcbiAgICAgIHJldHVybiByZXN1bHQuZGVsZXRlZENvdW50O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjbGVhbmluZyB1cCBleHBpcmVkIGNhcnRzOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxufVxuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXG5jb25zdCBjYXJ0U2VydmljZSA9IG5ldyBDYXJ0U2Vy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
{"version":3,"names":["jwt","require","User","authenticateToken","req","res","next","authHeader","headers","token","split","user","decoded","verify","process","env","JWT_SECRET","findById","userId","select","isActive","error","requireAuth","status","json","success","code","message","name","console","requireAdmin","isAdmin","module","exports"],"sources":["auth.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\nconst User = require('../models/User');\n\n// Middleware to authenticate JWT tokens\nconst authenticateToken = async (req, res, next) => {\n  try {\n    const authHeader = req.headers['authorization'];\n    const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN\n    \n    if (!token) {\n      req.user = null;\n      return next(); // Continue without authentication for optional auth routes\n    }\n    \n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n    const user = await User.findById(decoded.userId).select('-password');\n    \n    if (!user || !user.isActive) {\n      req.user = null;\n      return next();\n    }\n    \n    req.user = user;\n    next();\n  } catch (error) {\n    req.user = null;\n    next(); // Continue without authentication for optional auth routes\n  }\n};\n\n// Middleware to require authentication\nconst requireAuth = async (req, res, next) => {\n  try {\n    const authHeader = req.headers['authorization'];\n    const token = authHeader && authHeader.split(' ')[1];\n    \n    if (!token) {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'NO_TOKEN',\n          message: 'Access token is required'\n        }\n      });\n    }\n    \n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n    const user = await User.findById(decoded.userId).select('-password');\n    \n    if (!user || !user.isActive) {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'INVALID_TOKEN',\n          message: 'Invalid or expired token'\n        }\n      });\n    }\n    \n    req.user = user;\n    next();\n  } catch (error) {\n    if (error.name === 'JsonWebTokenError') {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'INVALID_TOKEN',\n          message: 'Invalid token format'\n        }\n      });\n    }\n    \n    if (error.name === 'TokenExpiredError') {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'TOKEN_EXPIRED',\n          message: 'Token has expired'\n        }\n      });\n    }\n    \n    console.error('Authentication error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'AUTH_ERROR',\n        message: 'Authentication failed'\n      }\n    });\n  }\n};\n\n// Middleware to require admin role\nconst requireAdmin = async (req, res, next) => {\n  try {\n    const authHeader = req.headers['authorization'];\n    const token = authHeader && authHeader.split(' ')[1];\n    \n    if (!token) {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'NO_TOKEN',\n          message: 'Access token is required'\n        }\n      });\n    }\n    \n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n    const user = await User.findById(decoded.userId).select('-password');\n    \n    if (!user || !user.isActive) {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'INVALID_TOKEN',\n          message: 'Invalid or expired token'\n        }\n      });\n    }\n    \n    // Check if user has admin role\n    if (!user.isAdmin) {\n      return res.status(403).json({\n        success: false,\n        error: {\n          code: 'INSUFFICIENT_PERMISSIONS',\n          message: 'Admin access required'\n        }\n      });\n    }\n    \n    req.user = user;\n    next();\n  } catch (error) {\n    if (error.name === 'JsonWebTokenError') {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'INVALID_TOKEN',\n          message: 'Invalid token format'\n        }\n      });\n    }\n    \n    if (error.name === 'TokenExpiredError') {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'TOKEN_EXPIRED',\n          message: 'Token has expired'\n        }\n      });\n    }\n    \n    console.error('Admin auth error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'AUTH_ERROR',\n        message: 'Authorization failed'\n      }\n    });\n  }\n};\n\nmodule.exports = {\n  authenticateToken,\n  requireAuth,\n  requireAdmin\n};"],"mappings":"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","ignoreList":[]}
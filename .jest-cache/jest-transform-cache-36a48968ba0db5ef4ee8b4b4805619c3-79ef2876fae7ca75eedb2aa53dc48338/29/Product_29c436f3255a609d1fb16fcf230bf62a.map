{"version":3,"names":["mongoose","require","productSchema","Schema","name","type","String","required","trim","index","slug","unique","lowercase","description","shortDescription","maxlength","price","Number","min","compareAtPrice","baseCurrency","default","enum","prices","USD","EUR","CNY","JPY","SAR","GBP","CAD","images","url","alt","isPrimary","Boolean","category","tags","properties","chakra","element","zodiac","healing","origin","size","weight","wholesaler","email","productCode","cost","minOrderQty","seo","title","keywords","isActive","isFeatured","crossSiteIntegration","enabled","referenceKey","relatedContent","timestamps","createdAt","methods","toPublicJSON","product","toObject","statics","findPublic","query","find","select","getCrossSiteData","_id","pre","next","module","exports","model"],"sources":["Product.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst productSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: true,\n    trim: true,\n    index: true\n  },\n  slug: {\n    type: String,\n    required: true,\n    unique: true,\n    lowercase: true\n  },\n  description: {\n    type: String,\n    required: true\n  },\n  shortDescription: {\n    type: String,\n    required: true,\n    maxlength: 200\n  },\n  price: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  compareAtPrice: {\n    type: Number,\n    min: 0\n  },\n  // Multi-currency support\n  baseCurrency: {\n    type: String,\n    default: 'USD',\n    enum: ['USD', 'EUR', 'CNY', 'JPY', 'SAR', 'GBP', 'CAD']\n  },\n  prices: {\n    USD: { type: Number },\n    EUR: { type: Number },\n    CNY: { type: Number },\n    JPY: { type: Number },\n    SAR: { type: Number },\n    GBP: { type: Number },\n    CAD: { type: Number }\n  },\n  images: [{\n    url: { type: String, required: true },\n    alt: { type: String, required: true },\n    isPrimary: { type: Boolean, default: false }\n  }],\n  category: {\n    type: String,\n    required: true,\n    enum: ['crystals', 'herbs', 'oils', 'supplements', 'books', 'accessories', 'other']\n  },\n  tags: [String],\n  properties: {\n    chakra: [String],\n    element: [String],\n    zodiac: [String],\n    healing: [String],\n    origin: String,\n    size: String,\n    weight: String\n  },\n  wholesaler: {\n    name: { type: String, required: true },\n    email: { type: String, required: true },\n    productCode: { type: String, required: true },\n    cost: { type: Number, required: true },\n    minOrderQty: { type: Number, default: 1 }\n  },\n  seo: {\n    title: String,\n    description: String,\n    keywords: [String]\n  },\n  isActive: {\n    type: Boolean,\n    default: true\n  },\n  isFeatured: {\n    type: Boolean,\n    default: false\n  },\n  crossSiteIntegration: {\n    enabled: { type: Boolean, default: true },\n    referenceKey: String, // For linking from sister sites\n    relatedContent: [String] // URLs or content IDs from sister sites\n  }\n}, {\n  timestamps: true\n});\n\n// Indexes for performance\nproductSchema.index({ name: 'text', description: 'text', tags: 'text' });\nproductSchema.index({ category: 1, isActive: 1 });\nproductSchema.index({ slug: 1 });\nproductSchema.index({ 'crossSiteIntegration.referenceKey': 1 });\nproductSchema.index({ tags: 1 });\nproductSchema.index({ isFeatured: 1, isActive: 1 });\nproductSchema.index({ price: 1, isActive: 1 });\nproductSchema.index({ 'properties.chakra': 1, isActive: 1 });\nproductSchema.index({ createdAt: -1, isActive: 1 });\n\n// Method to get public product data (excludes wholesaler info)\nproductSchema.methods.toPublicJSON = function() {\n  const product = this.toObject();\n  delete product.wholesaler;\n  return product;\n};\n\n// Static method to get products for public API\nproductSchema.statics.findPublic = function(query = {}) {\n  return this.find({ ...query, isActive: true }).select('-wholesaler');\n};\n\n// Method to get cross-site integration data\nproductSchema.methods.getCrossSiteData = function() {\n  return {\n    _id: this._id,\n    name: this.name,\n    slug: this.slug,\n    shortDescription: this.shortDescription,\n    price: this.price,\n    compareAtPrice: this.compareAtPrice,\n    images: this.images,\n    category: this.category,\n    properties: this.properties,\n    seo: this.seo,\n    crossSiteIntegration: this.crossSiteIntegration\n  };\n};\n\n// Validation for cross-site integration\nproductSchema.pre('save', function(next) {\n  if (this.crossSiteIntegration.enabled && !this.crossSiteIntegration.referenceKey) {\n    this.crossSiteIntegration.referenceKey = this.slug;\n  }\n  \n  // Ensure USD price is always set from base price\n  if (!this.prices) {\n    this.prices = {};\n  }\n  this.prices.USD = this.price;\n  \n  next();\n});\n\nmodule.exports = mongoose.model('Product', productSchema);"],"mappings":"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","ignoreList":[]}
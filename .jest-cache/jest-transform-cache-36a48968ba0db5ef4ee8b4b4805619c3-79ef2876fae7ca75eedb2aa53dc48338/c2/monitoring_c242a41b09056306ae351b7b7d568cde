b83e79b8cd056abfafc61ce78a732349
const express = require('express');
const mongoose = require('mongoose');
const {
  logger
} = require('../utils/logger');
const {
  getCircuitBreakerStatus
} = require('../utils/errorRecovery');
const {
  requireAdmin
} = require('../middleware/auth');
const router = express.Router();

// Basic health check
router.get('/health', (req, res) => {
  const healthCheck = {
    status: 'OK',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    environment: process.env.NODE_ENV || 'development'
  };
  res.json(healthCheck);
});

// Detailed system status (admin only)
router.get('/status', requireAdmin, async (req, res) => {
  try {
    const status = {
      timestamp: new Date().toISOString(),
      environment: process.env.NODE_ENV || 'development',
      uptime: process.uptime(),
      memory: process.memoryUsage(),
      database: await getDatabaseStatus(),
      circuitBreakers: getCircuitBreakerStatus(),
      services: await getServicesStatus()
    };
    logger.info('System status requested', {
      requestedBy: req.user.email,
      timestamp: status.timestamp
    });
    res.json({
      success: true,
      data: status
    });
  } catch (error) {
    logger.error('Error getting system status:', {
      error: error.message,
      requestedBy: req.user.email
    });
    res.status(500).json({
      success: false,
      error: {
        code: 'STATUS_ERROR',
        message: 'Unable to retrieve system status'
      }
    });
  }
});

// Database health check
async function getDatabaseStatus() {
  try {
    const dbState = mongoose.connection.readyState;
    const states = {
      0: 'disconnected',
      1: 'connected',
      2: 'connecting',
      3: 'disconnecting'
    };
    const status = {
      state: states[dbState],
      host: mongoose.connection.host,
      port: mongoose.connection.port,
      name: mongoose.connection.name
    };

    // Test database connectivity
    if (dbState === 1) {
      await mongoose.connection.db.admin().ping();
      status.ping = 'success';
    }
    return status;
  } catch (error) {
    return {
      state: 'error',
      error: error.message
    };
  }
}

// Services health check
async function getServicesStatus() {
  const services = {};

  // Check payment service (Mollie)
  try {
    // In a real implementation, you might ping Mollie's API
    services.payment = {
      status: 'available',
      provider: 'mollie'
    };
  } catch (error) {
    services.payment = {
      status: 'unavailable',
      error: error.message
    };
  }

  // Check email service
  try {
    // In a real implementation, you might test SMTP connection
    services.email = {
      status: 'available',
      provider: 'nodemailer'
    };
  } catch (error) {
    services.email = {
      status: 'unavailable',
      error: error.message
    };
  }
  return services;
}

// Metrics endpoint (admin only)
router.get('/metrics', requireAdmin, async (req, res) => {
  try {
    const metrics = {
      timestamp: new Date().toISOString(),
      system: {
        uptime: process.uptime(),
        memory: process.memoryUsage(),
        cpu: process.cpuUsage()
      },
      database: {
        connections: mongoose.connection.readyState,
        collections: await getCollectionStats()
      },
      errors: await getErrorMetrics()
    };
    res.json({
      success: true,
      data: metrics
    });
  } catch (error) {
    logger.error('Error getting metrics:', {
      error: error.message,
      requestedBy: req.user.email
    });
    res.status(500).json({
      success: false,
      error: {
        code: 'METRICS_ERROR',
        message: 'Unable to retrieve metrics'
      }
    });
  }
});

// Get collection statistics
async function getCollectionStats() {
  try {
    const collections = await mongoose.connection.db.listCollections().toArray();
    const stats = {};
    for (const collection of collections) {
      try {
        const collectionStats = await mongoose.connection.db.collection(collection.name).stats();
        stats[collection.name] = {
          count: collectionStats.count,
          size: collectionStats.size,
          avgObjSize: collectionStats.avgObjSize
        };
      } catch (error) {
        stats[collection.name] = {
          error: error.message
        };
      }
    }
    return stats;
  } catch (error) {
    return {
      error: error.message
    };
  }
}

// Get error metrics (simplified - in production you'd use proper metrics storage)
async function getErrorMetrics() {
  // This is a simplified implementation
  // In production, you'd use proper metrics collection like Prometheus
  return {
    note: 'Error metrics would be collected from logs or metrics store',
    last24Hours: {
      total: 0,
      byType: {},
      byEndpoint: {}
    }
  };
}

// Logs endpoint (admin only) - recent logs
router.get('/logs', requireAdmin, (req, res) => {
  try {
    const {
      level = 'info',
      limit = 100
    } = req.query;

    // In a real implementation, you'd read from log files or log aggregation service
    res.json({
      success: true,
      data: {
        message: 'Log retrieval endpoint - would return recent logs',
        level,
        limit,
        note: 'In production, this would read from log files or log aggregation service'
      }
    });
  } catch (error) {
    logger.error('Error retrieving logs:', {
      error: error.message,
      requestedBy: req.user.email
    });
    res.status(500).json({
      success: false,
      error: {
        code: 'LOGS_ERROR',
        message: 'Unable to retrieve logs'
      }
    });
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsIm1vbmdvb3NlIiwibG9nZ2VyIiwiZ2V0Q2lyY3VpdEJyZWFrZXJTdGF0dXMiLCJyZXF1aXJlQWRtaW4iLCJyb3V0ZXIiLCJSb3V0ZXIiLCJnZXQiLCJyZXEiLCJyZXMiLCJoZWFsdGhDaGVjayIsInN0YXR1cyIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInVwdGltZSIsInByb2Nlc3MiLCJlbnZpcm9ubWVudCIsImVudiIsIk5PREVfRU5WIiwianNvbiIsIm1lbW9yeSIsIm1lbW9yeVVzYWdlIiwiZGF0YWJhc2UiLCJnZXREYXRhYmFzZVN0YXR1cyIsImNpcmN1aXRCcmVha2VycyIsInNlcnZpY2VzIiwiZ2V0U2VydmljZXNTdGF0dXMiLCJpbmZvIiwicmVxdWVzdGVkQnkiLCJ1c2VyIiwiZW1haWwiLCJzdWNjZXNzIiwiZGF0YSIsImVycm9yIiwibWVzc2FnZSIsImNvZGUiLCJkYlN0YXRlIiwiY29ubmVjdGlvbiIsInJlYWR5U3RhdGUiLCJzdGF0ZXMiLCJzdGF0ZSIsImhvc3QiLCJwb3J0IiwibmFtZSIsImRiIiwiYWRtaW4iLCJwaW5nIiwicGF5bWVudCIsInByb3ZpZGVyIiwibWV0cmljcyIsInN5c3RlbSIsImNwdSIsImNwdVVzYWdlIiwiY29ubmVjdGlvbnMiLCJjb2xsZWN0aW9ucyIsImdldENvbGxlY3Rpb25TdGF0cyIsImVycm9ycyIsImdldEVycm9yTWV0cmljcyIsImxpc3RDb2xsZWN0aW9ucyIsInRvQXJyYXkiLCJzdGF0cyIsImNvbGxlY3Rpb24iLCJjb2xsZWN0aW9uU3RhdHMiLCJjb3VudCIsInNpemUiLCJhdmdPYmpTaXplIiwibm90ZSIsImxhc3QyNEhvdXJzIiwidG90YWwiLCJieVR5cGUiLCJieUVuZHBvaW50IiwibGV2ZWwiLCJsaW1pdCIsInF1ZXJ5IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIm1vbml0b3JpbmcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcbmNvbnN0IHsgbG9nZ2VyIH0gPSByZXF1aXJlKCcuLi91dGlscy9sb2dnZXInKTtcbmNvbnN0IHsgZ2V0Q2lyY3VpdEJyZWFrZXJTdGF0dXMgfSA9IHJlcXVpcmUoJy4uL3V0aWxzL2Vycm9yUmVjb3ZlcnknKTtcbmNvbnN0IHsgcmVxdWlyZUFkbWluIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcblxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxuLy8gQmFzaWMgaGVhbHRoIGNoZWNrXG5yb3V0ZXIuZ2V0KCcvaGVhbHRoJywgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IGhlYWx0aENoZWNrID0ge1xuICAgIHN0YXR1czogJ09LJyxcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB1cHRpbWU6IHByb2Nlc3MudXB0aW1lKCksXG4gICAgZW52aXJvbm1lbnQ6IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdkZXZlbG9wbWVudCdcbiAgfTtcblxuICByZXMuanNvbihoZWFsdGhDaGVjayk7XG59KTtcblxuLy8gRGV0YWlsZWQgc3lzdGVtIHN0YXR1cyAoYWRtaW4gb25seSlcbnJvdXRlci5nZXQoJy9zdGF0dXMnLCByZXF1aXJlQWRtaW4sIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN0YXR1cyA9IHtcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgZW52aXJvbm1lbnQ6IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdkZXZlbG9wbWVudCcsXG4gICAgICB1cHRpbWU6IHByb2Nlc3MudXB0aW1lKCksXG4gICAgICBtZW1vcnk6IHByb2Nlc3MubWVtb3J5VXNhZ2UoKSxcbiAgICAgIGRhdGFiYXNlOiBhd2FpdCBnZXREYXRhYmFzZVN0YXR1cygpLFxuICAgICAgY2lyY3VpdEJyZWFrZXJzOiBnZXRDaXJjdWl0QnJlYWtlclN0YXR1cygpLFxuICAgICAgc2VydmljZXM6IGF3YWl0IGdldFNlcnZpY2VzU3RhdHVzKClcbiAgICB9O1xuXG4gICAgbG9nZ2VyLmluZm8oJ1N5c3RlbSBzdGF0dXMgcmVxdWVzdGVkJywge1xuICAgICAgcmVxdWVzdGVkQnk6IHJlcS51c2VyLmVtYWlsLFxuICAgICAgdGltZXN0YW1wOiBzdGF0dXMudGltZXN0YW1wXG4gICAgfSk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogc3RhdHVzXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHN5c3RlbSBzdGF0dXM6Jywge1xuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICByZXF1ZXN0ZWRCeTogcmVxLnVzZXIuZW1haWxcbiAgICB9KTtcblxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ1NUQVRVU19FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6ICdVbmFibGUgdG8gcmV0cmlldmUgc3lzdGVtIHN0YXR1cydcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIERhdGFiYXNlIGhlYWx0aCBjaGVja1xuYXN5bmMgZnVuY3Rpb24gZ2V0RGF0YWJhc2VTdGF0dXMoKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGJTdGF0ZSA9IG1vbmdvb3NlLmNvbm5lY3Rpb24ucmVhZHlTdGF0ZTtcbiAgICBjb25zdCBzdGF0ZXMgPSB7XG4gICAgICAwOiAnZGlzY29ubmVjdGVkJyxcbiAgICAgIDE6ICdjb25uZWN0ZWQnLFxuICAgICAgMjogJ2Nvbm5lY3RpbmcnLFxuICAgICAgMzogJ2Rpc2Nvbm5lY3RpbmcnXG4gICAgfTtcblxuICAgIGNvbnN0IHN0YXR1cyA9IHtcbiAgICAgIHN0YXRlOiBzdGF0ZXNbZGJTdGF0ZV0sXG4gICAgICBob3N0OiBtb25nb29zZS5jb25uZWN0aW9uLmhvc3QsXG4gICAgICBwb3J0OiBtb25nb29zZS5jb25uZWN0aW9uLnBvcnQsXG4gICAgICBuYW1lOiBtb25nb29zZS5jb25uZWN0aW9uLm5hbWVcbiAgICB9O1xuXG4gICAgLy8gVGVzdCBkYXRhYmFzZSBjb25uZWN0aXZpdHlcbiAgICBpZiAoZGJTdGF0ZSA9PT0gMSkge1xuICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdGlvbi5kYi5hZG1pbigpLnBpbmcoKTtcbiAgICAgIHN0YXR1cy5waW5nID0gJ3N1Y2Nlc3MnO1xuICAgIH1cblxuICAgIHJldHVybiBzdGF0dXM7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXRlOiAnZXJyb3InLFxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICB9O1xuICB9XG59XG5cbi8vIFNlcnZpY2VzIGhlYWx0aCBjaGVja1xuYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmljZXNTdGF0dXMoKSB7XG4gIGNvbnN0IHNlcnZpY2VzID0ge307XG5cbiAgLy8gQ2hlY2sgcGF5bWVudCBzZXJ2aWNlIChNb2xsaWUpXG4gIHRyeSB7XG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB5b3UgbWlnaHQgcGluZyBNb2xsaWUncyBBUElcbiAgICBzZXJ2aWNlcy5wYXltZW50ID0ge1xuICAgICAgc3RhdHVzOiAnYXZhaWxhYmxlJyxcbiAgICAgIHByb3ZpZGVyOiAnbW9sbGllJ1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgc2VydmljZXMucGF5bWVudCA9IHtcbiAgICAgIHN0YXR1czogJ3VuYXZhaWxhYmxlJyxcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlXG4gICAgfTtcbiAgfVxuXG4gIC8vIENoZWNrIGVtYWlsIHNlcnZpY2VcbiAgdHJ5IHtcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSBtaWdodCB0ZXN0IFNNVFAgY29ubmVjdGlvblxuICAgIHNlcnZpY2VzLmVtYWlsID0ge1xuICAgICAgc3RhdHVzOiAnYXZhaWxhYmxlJyxcbiAgICAgIHByb3ZpZGVyOiAnbm9kZW1haWxlcidcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHNlcnZpY2VzLmVtYWlsID0ge1xuICAgICAgc3RhdHVzOiAndW5hdmFpbGFibGUnLFxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHNlcnZpY2VzO1xufVxuXG4vLyBNZXRyaWNzIGVuZHBvaW50IChhZG1pbiBvbmx5KVxucm91dGVyLmdldCgnL21ldHJpY3MnLCByZXF1aXJlQWRtaW4sIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG1ldHJpY3MgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHN5c3RlbToge1xuICAgICAgICB1cHRpbWU6IHByb2Nlc3MudXB0aW1lKCksXG4gICAgICAgIG1lbW9yeTogcHJvY2Vzcy5tZW1vcnlVc2FnZSgpLFxuICAgICAgICBjcHU6IHByb2Nlc3MuY3B1VXNhZ2UoKVxuICAgICAgfSxcbiAgICAgIGRhdGFiYXNlOiB7XG4gICAgICAgIGNvbm5lY3Rpb25zOiBtb25nb29zZS5jb25uZWN0aW9uLnJlYWR5U3RhdGUsXG4gICAgICAgIGNvbGxlY3Rpb25zOiBhd2FpdCBnZXRDb2xsZWN0aW9uU3RhdHMoKVxuICAgICAgfSxcbiAgICAgIGVycm9yczogYXdhaXQgZ2V0RXJyb3JNZXRyaWNzKClcbiAgICB9O1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IG1ldHJpY3NcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGdldHRpbmcgbWV0cmljczonLCB7XG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgIHJlcXVlc3RlZEJ5OiByZXEudXNlci5lbWFpbFxuICAgIH0pO1xuXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnTUVUUklDU19FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6ICdVbmFibGUgdG8gcmV0cmlldmUgbWV0cmljcydcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIEdldCBjb2xsZWN0aW9uIHN0YXRpc3RpY3NcbmFzeW5jIGZ1bmN0aW9uIGdldENvbGxlY3Rpb25TdGF0cygpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb2xsZWN0aW9ucyA9IGF3YWl0IG1vbmdvb3NlLmNvbm5lY3Rpb24uZGIubGlzdENvbGxlY3Rpb25zKCkudG9BcnJheSgpO1xuICAgIGNvbnN0IHN0YXRzID0ge307XG5cbiAgICBmb3IgKGNvbnN0IGNvbGxlY3Rpb24gb2YgY29sbGVjdGlvbnMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbGxlY3Rpb25TdGF0cyA9IGF3YWl0IG1vbmdvb3NlLmNvbm5lY3Rpb24uZGIuY29sbGVjdGlvbihjb2xsZWN0aW9uLm5hbWUpLnN0YXRzKCk7XG4gICAgICAgIHN0YXRzW2NvbGxlY3Rpb24ubmFtZV0gPSB7XG4gICAgICAgICAgY291bnQ6IGNvbGxlY3Rpb25TdGF0cy5jb3VudCxcbiAgICAgICAgICBzaXplOiBjb2xsZWN0aW9uU3RhdHMuc2l6ZSxcbiAgICAgICAgICBhdmdPYmpTaXplOiBjb2xsZWN0aW9uU3RhdHMuYXZnT2JqU2l6ZVxuICAgICAgICB9O1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgc3RhdHNbY29sbGVjdGlvbi5uYW1lXSA9IHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3RhdHM7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgfVxufVxuXG4vLyBHZXQgZXJyb3IgbWV0cmljcyAoc2ltcGxpZmllZCAtIGluIHByb2R1Y3Rpb24geW91J2QgdXNlIHByb3BlciBtZXRyaWNzIHN0b3JhZ2UpXG5hc3luYyBmdW5jdGlvbiBnZXRFcnJvck1ldHJpY3MoKSB7XG4gIC8vIFRoaXMgaXMgYSBzaW1wbGlmaWVkIGltcGxlbWVudGF0aW9uXG4gIC8vIEluIHByb2R1Y3Rpb24sIHlvdSdkIHVzZSBwcm9wZXIgbWV0cmljcyBjb2xsZWN0aW9uIGxpa2UgUHJvbWV0aGV1c1xuICByZXR1cm4ge1xuICAgIG5vdGU6ICdFcnJvciBtZXRyaWNzIHdvdWxkIGJlIGNvbGxlY3RlZCBmcm9tIGxvZ3Mgb3IgbWV0cmljcyBzdG9yZScsXG4gICAgbGFzdDI0SG91cnM6IHtcbiAgICAgIHRvdGFsOiAwLFxuICAgICAgYnlUeXBlOiB7fSxcbiAgICAgIGJ5RW5kcG9pbnQ6IHt9XG4gICAgfVxuICB9O1xufVxuXG4vLyBMb2dzIGVuZHBvaW50IChhZG1pbiBvbmx5KSAtIHJlY2VudCBsb2dzXG5yb3V0ZXIuZ2V0KCcvbG9ncycsIHJlcXVpcmVBZG1pbiwgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBsZXZlbCA9ICdpbmZvJywgbGltaXQgPSAxMDAgfSA9IHJlcS5xdWVyeTtcbiAgICBcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSdkIHJlYWQgZnJvbSBsb2cgZmlsZXMgb3IgbG9nIGFnZ3JlZ2F0aW9uIHNlcnZpY2VcbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YToge1xuICAgICAgICBtZXNzYWdlOiAnTG9nIHJldHJpZXZhbCBlbmRwb2ludCAtIHdvdWxkIHJldHVybiByZWNlbnQgbG9ncycsXG4gICAgICAgIGxldmVsLFxuICAgICAgICBsaW1pdCxcbiAgICAgICAgbm90ZTogJ0luIHByb2R1Y3Rpb24sIHRoaXMgd291bGQgcmVhZCBmcm9tIGxvZyBmaWxlcyBvciBsb2cgYWdncmVnYXRpb24gc2VydmljZSdcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIHJldHJpZXZpbmcgbG9nczonLCB7XG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgIHJlcXVlc3RlZEJ5OiByZXEudXNlci5lbWFpbFxuICAgIH0pO1xuXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnTE9HU19FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6ICdVbmFibGUgdG8gcmV0cmlldmUgbG9ncydcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUNwQyxNQUFNO0VBQUVFO0FBQU8sQ0FBQyxHQUFHRixPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDN0MsTUFBTTtFQUFFRztBQUF3QixDQUFDLEdBQUdILE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQztBQUNyRSxNQUFNO0VBQUVJO0FBQWEsQ0FBQyxHQUFHSixPQUFPLENBQUMsb0JBQW9CLENBQUM7QUFFdEQsTUFBTUssTUFBTSxHQUFHTixPQUFPLENBQUNPLE1BQU0sQ0FBQyxDQUFDOztBQUUvQjtBQUNBRCxNQUFNLENBQUNFLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDbEMsTUFBTUMsV0FBVyxHQUFHO0lBQ2xCQyxNQUFNLEVBQUUsSUFBSTtJQUNaQyxTQUFTLEVBQUUsSUFBSUMs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
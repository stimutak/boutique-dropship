d24e5636adec28e145061e3dad093252
/**
 * Standardized error handling utilities for the Holistic Boutique API
 * Following CLAUDE.md constraints:
 * - Keep it simple - no event emitters or complex patterns
 * - Support internationalization for all error messages
 * - Use existing patterns from the codebase
 */

// Standard error codes used across the application
const ErrorCodes = {
  // Common errors
  VALIDATION_ERROR: 'VALIDATION_ERROR',
  NOT_FOUND: 'NOT_FOUND',
  UNAUTHORIZED: 'UNAUTHORIZED',
  FORBIDDEN: 'FORBIDDEN',
  INTERNAL_ERROR: 'INTERNAL_ERROR',
  BAD_REQUEST: 'BAD_REQUEST',
  // Authentication errors
  INVALID_CREDENTIALS: 'INVALID_CREDENTIALS',
  USER_EXISTS: 'USER_EXISTS',
  USER_NOT_FOUND: 'USER_NOT_FOUND',
  TOKEN_INVALID: 'TOKEN_INVALID',
  TOKEN_EXPIRED: 'TOKEN_EXPIRED',
  AUTHENTICATION_REQUIRED: 'AUTHENTICATION_REQUIRED',
  REGISTRATION_ERROR: 'REGISTRATION_ERROR',
  // Product errors
  PRODUCT_NOT_FOUND: 'PRODUCT_NOT_FOUND',
  INVALID_PRODUCT_ID: 'INVALID_PRODUCT_ID',
  PRODUCTS_FETCH_ERROR: 'PRODUCTS_FETCH_ERROR',
  PRODUCT_CREATION_ERROR: 'PRODUCT_CREATION_ERROR',
  PRODUCT_UPDATE_ERROR: 'PRODUCT_UPDATE_ERROR',
  PRODUCT_DELETE_ERROR: 'PRODUCT_DELETE_ERROR',
  SEARCH_ERROR: 'SEARCH_ERROR',
  CATEGORIES_ERROR: 'CATEGORIES_ERROR',
  FILTERS_ERROR: 'FILTERS_ERROR',
  RECOMMENDATIONS_ERROR: 'RECOMMENDATIONS_ERROR',
  MISSING_QUERY: 'MISSING_QUERY',
  // Cart errors
  CART_ADD_ERROR: 'CART_ADD_ERROR',
  CART_UPDATE_ERROR: 'CART_UPDATE_ERROR',
  CART_REMOVE_ERROR: 'CART_REMOVE_ERROR',
  CART_CLEAR_ERROR: 'CART_CLEAR_ERROR',
  CART_MERGE_ERROR: 'CART_MERGE_ERROR',
  CART_FETCH_ERROR: 'CART_FETCH_ERROR',
  ITEM_NOT_FOUND: 'ITEM_NOT_FOUND',
  MAX_QUANTITY_EXCEEDED: 'MAX_QUANTITY_EXCEEDED',
  INVALID_QUANTITY: 'INVALID_QUANTITY',
  MISSING_PRODUCT_ID: 'MISSING_PRODUCT_ID',
  // Order errors
  ORDER_NOT_FOUND: 'ORDER_NOT_FOUND',
  ORDER_CREATE_ERROR: 'ORDER_CREATE_ERROR',
  ORDER_UPDATE_ERROR: 'ORDER_UPDATE_ERROR',
  ORDER_CANCEL_ERROR: 'ORDER_CANCEL_ERROR',
  INVALID_ORDER_STATUS: 'INVALID_ORDER_STATUS',
  EMPTY_CART: 'EMPTY_CART',
  // Payment errors
  PAYMENT_FAILED: 'PAYMENT_FAILED',
  PAYMENT_METHOD_INVALID: 'PAYMENT_METHOD_INVALID',
  INSUFFICIENT_FUNDS: 'INSUFFICIENT_FUNDS',
  PAYMENT_REQUIRED: 'PAYMENT_REQUIRED',
  PAYMENT_CREATE_ERROR: 'PAYMENT_CREATE_ERROR',
  PAYMENT_STATUS_ERROR: 'PAYMENT_STATUS_ERROR',
  // Integration errors
  MOLLIE_ERROR: 'MOLLIE_ERROR',
  WHOLESALER_ERROR: 'WHOLESALER_ERROR',
  EMAIL_ERROR: 'EMAIL_ERROR'
};

/**
 * Format error response in standardized format
 * @param {string} code - Error code from ErrorCodes
 * @param {string} message - Default error message (used if i18n key not found)
 * @param {string} field - Optional field name for validation errors
 * @param {object} additionalData - Additional data to include in error
 * @param {function} i18n - Optional i18n function for translation
 * @returns {object} Formatted error response
 */
function formatError(code, message, field = null, additionalData = null, i18n = null) {
  const error = {
    code,
    message
  };

  // Try to use i18n if available
  if (i18n && typeof i18n === 'function') {
    const translatedMessage = i18n(`errors.${code}`);
    // Only use translated message if it's not the key itself
    if (translatedMessage && translatedMessage !== `errors.${code}`) {
      error.message = translatedMessage;
    }
  }
  if (field) {
    error.field = field;
  }
  if (additionalData) {
    Object.assign(error, additionalData);
  }
  return {
    success: false,
    error
  };
}

/**
 * Create validation error from express-validator result
 * @param {object} validationResult - Express validator result object
 * @returns {object} Formatted validation error
 */
function createValidationError(validationResult) {
  const errors = validationResult.array();
  return {
    success: false,
    error: {
      code: ErrorCodes.VALIDATION_ERROR,
      message: 'Invalid input data',
      details: errors.map(err => ({
        field: err.param,
        message: err.msg,
        location: err.location
      }))
    }
  };
}

/**
 * Express middleware to add error response helpers
 * Adds methods to res object for consistent error responses
 */
function errorResponse(req, res, next) {
  // Get i18n function if available (will be added when we implement backend i18n)
  const i18n = req.i18n || null;

  /**
   * Send standardized error response
   * @param {number} statusCode - HTTP status code
   * @param {string} errorCode - Error code from ErrorCodes
   * @param {string} message - Error message
   * @param {string} field - Optional field name
   * @param {object} additionalData - Additional error data
   */
  res.error = function (statusCode, errorCode, message, field = null, additionalData = null) {
    const errorData = formatError(errorCode, message, field, additionalData, i18n);
    return this.status(statusCode).json(errorData);
  };

  /**
   * Send validation error response
   * @param {object} validationErrors - Express validator errors
   */
  res.validationError = function (validationErrors) {
    const errorData = createValidationError(validationErrors);
    return this.status(400).json(errorData);
  };
  next();
}

/**
 * Special handler for webhook endpoints that need plain text responses
 * @param {object} res - Express response object
 * @param {number} statusCode - HTTP status code
 * @param {string} message - Error message
 */
function webhookError(res, statusCode, message) {
  return res.status(statusCode).send(message);
}
module.exports = {
  ErrorCodes,
  formatError,
  createValidationError,
  errorResponse,
  webhookError
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFcnJvckNvZGVzIiwiVkFMSURBVElPTl9FUlJPUiIsIk5PVF9GT1VORCIsIlVOQVVUSE9SSVpFRCIsIkZPUkJJRERFTiIsIklOVEVSTkFMX0VSUk9SIiwiQkFEX1JFUVVFU1QiLCJJTlZBTElEX0NSRURFTlRJQUxTIiwiVVNFUl9FWElTVFMiLCJVU0VSX05PVF9GT1VORCIsIlRPS0VOX0lOVkFMSUQiLCJUT0tFTl9FWFBJUkVEIiwiQVVUSEVOVElDQVRJT05fUkVRVUlSRUQiLCJSRUdJU1RSQVRJT05fRVJST1IiLCJQUk9EVUNUX05PVF9GT1VORCIsIklOVkFMSURfUFJPRFVDVF9JRCIsIlBST0RVQ1RTX0ZFVENIX0VSUk9SIiwiUFJPRFVDVF9DUkVBVElPTl9FUlJPUiIsIlBST0RVQ1RfVVBEQVRFX0VSUk9SIiwiUFJPRFVDVF9ERUxFVEVfRVJST1IiLCJTRUFSQ0hfRVJST1IiLCJDQVRFR09SSUVTX0VSUk9SIiwiRklMVEVSU19FUlJPUiIsIlJFQ09NTUVOREFUSU9OU19FUlJPUiIsIk1JU1NJTkdfUVVFUlkiLCJDQVJUX0FERF9FUlJPUiIsIkNBUlRfVVBEQVRFX0VSUk9SIiwiQ0FSVF9SRU1PVkVfRVJST1IiLCJDQVJUX0NMRUFSX0VSUk9SIiwiQ0FSVF9NRVJHRV9FUlJPUiIsIkNBUlRfRkVUQ0hfRVJST1IiLCJJVEVNX05PVF9GT1VORCIsIk1BWF9RVUFOVElUWV9FWENFRURFRCIsIklOVkFMSURfUVVBTlRJVFkiLCJNSVNTSU5HX1BST0RVQ1RfSUQiLCJPUkRFUl9OT1RfRk9VTkQiLCJPUkRFUl9DUkVBVEVfRVJST1IiLCJPUkRFUl9VUERBVEVfRVJST1IiLCJPUkRFUl9DQU5DRUxfRVJST1IiLCJJTlZBTElEX09SREVSX1NUQVRVUyIsIkVNUFRZX0NBUlQiLCJQQVlNRU5UX0ZBSUxFRCIsIlBBWU1FTlRfTUVUSE9EX0lOVkFMSUQiLCJJTlNVRkZJQ0lFTlRfRlVORFMiLCJQQVlNRU5UX1JFUVVJUkVEIiwiUEFZTUVOVF9DUkVBVEVfRVJST1IiLCJQQVlNRU5UX1NUQVRVU19FUlJPUiIsIk1PTExJRV9FUlJPUiIsIldIT0xFU0FMRVJfRVJST1IiLCJFTUFJTF9FUlJPUiIsImZvcm1hdEVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJmaWVsZCIsImFkZGl0aW9uYWxEYXRhIiwiaTE4biIsImVycm9yIiwidHJhbnNsYXRlZE1lc3NhZ2UiLCJPYmplY3QiLCJhc3NpZ24iLCJzdWNjZXNzIiwiY3JlYXRlVmFsaWRhdGlvbkVycm9yIiwidmFsaWRhdGlvblJlc3VsdCIsImVycm9ycyIsImFycmF5IiwiZGV0YWlscyIsIm1hcCIsImVyciIsInBhcmFtIiwibXNnIiwibG9jYXRpb24iLCJlcnJvclJlc3BvbnNlIiwicmVxIiwicmVzIiwibmV4dCIsInN0YXR1c0NvZGUiLCJlcnJvckNvZGUiLCJlcnJvckRhdGEiLCJzdGF0dXMiLCJqc29uIiwidmFsaWRhdGlvbkVycm9yIiwidmFsaWRhdGlvbkVycm9ycyIsIndlYmhvb2tFcnJvciIsInNlbmQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiZXJyb3JIYW5kbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RhbmRhcmRpemVkIGVycm9yIGhhbmRsaW5nIHV0aWxpdGllcyBmb3IgdGhlIEhvbGlzdGljIEJvdXRpcXVlIEFQSVxuICogRm9sbG93aW5nIENMQVVERS5tZCBjb25zdHJhaW50czpcbiAqIC0gS2VlcCBpdCBzaW1wbGUgLSBubyBldmVudCBlbWl0dGVycyBvciBjb21wbGV4IHBhdHRlcm5zXG4gKiAtIFN1cHBvcnQgaW50ZXJuYXRpb25hbGl6YXRpb24gZm9yIGFsbCBlcnJvciBtZXNzYWdlc1xuICogLSBVc2UgZXhpc3RpbmcgcGF0dGVybnMgZnJvbSB0aGUgY29kZWJhc2VcbiAqL1xuXG4vLyBTdGFuZGFyZCBlcnJvciBjb2RlcyB1c2VkIGFjcm9zcyB0aGUgYXBwbGljYXRpb25cbmNvbnN0IEVycm9yQ29kZXMgPSB7XG4gIC8vIENvbW1vbiBlcnJvcnNcbiAgVkFMSURBVElPTl9FUlJPUjogJ1ZBTElEQVRJT05fRVJST1InLFxuICBOT1RfRk9VTkQ6ICdOT1RfRk9VTkQnLFxuICBVTkFVVEhPUklaRUQ6ICdVTkFVVEhPUklaRUQnLFxuICBGT1JCSURERU46ICdGT1JCSURERU4nLFxuICBJTlRFUk5BTF9FUlJPUjogJ0lOVEVSTkFMX0VSUk9SJyxcbiAgQkFEX1JFUVVFU1Q6ICdCQURfUkVRVUVTVCcsXG4gIFxuICAvLyBBdXRoZW50aWNhdGlvbiBlcnJvcnNcbiAgSU5WQUxJRF9DUkVERU5USUFMUzogJ0lOVkFMSURfQ1JFREVOVElBTFMnLFxuICBVU0VSX0VYSVNUUzogJ1VTRVJfRVhJU1RTJyxcbiAgVVNFUl9OT1RfRk9VTkQ6ICdVU0VSX05PVF9GT1VORCcsXG4gIFRPS0VOX0lOVkFMSUQ6ICdUT0tFTl9JTlZBTElEJyxcbiAgVE9LRU5fRVhQSVJFRDogJ1RPS0VOX0VYUElSRUQnLFxuICBBVVRIRU5USUNBVElPTl9SRVFVSVJFRDogJ0FVVEhFTlRJQ0FUSU9OX1JFUVVJUkVEJyxcbiAgUkVHSVNUUkFUSU9OX0VSUk9SOiAnUkVHSVNUUkFUSU9OX0VSUk9SJyxcbiAgXG4gIC8vIFByb2R1Y3QgZXJyb3JzXG4gIFBST0RVQ1RfTk9UX0ZPVU5EOiAnUFJPRFVDVF9OT1RfRk9VTkQnLFxuICBJTlZBTElEX1BST0RVQ1RfSUQ6ICdJTlZBTElEX1BST0RVQ1RfSUQnLFxuICBQUk9EVUNUU19GRVRDSF9FUlJPUjogJ1BST0RVQ1RTX0ZFVENIX0VSUk9SJyxcbiAgUFJPRFVDVF9DUkVBVElPTl9FUlJPUjogJ1BST0RVQ1RfQ1JFQVRJT05fRVJST1InLFxuICBQUk9EVUNUX1VQREFURV9FUlJPUjogJ1BST0RVQ1RfVVBEQVRFX0VSUk9SJyxcbiAgUFJPRFVDVF9ERUxFVEVfRVJST1I6ICdQUk9EVUNUX0RFTEVURV9FUlJPUicsXG4gIFNFQVJDSF9FUlJPUjogJ1NFQVJDSF9FUlJPUicsXG4gIENBVEVHT1JJRVNfRVJST1I6ICdDQVRFR09SSUVTX0VSUk9SJyxcbiAgRklMVEVSU19FUlJPUjogJ0ZJTFRFUlNfRVJST1InLFxuICBSRUNPTU1FTkRBVElPTlNfRVJST1I6ICdSRUNPTU1FTkRBVElPTlNfRVJST1InLFxuICBNSVNTSU5HX1FVRVJZOiAnTUlTU0lOR19RVUVSWScsXG4gIFxuICAvLyBDYXJ0IGVycm9yc1xuICBDQVJUX0FERF9FUlJPUjogJ0NBUlRfQUREX0VSUk9SJyxcbiAgQ0FSVF9VUERBVEVfRVJST1I6ICdDQVJUX1VQREFURV9FUlJPUicsXG4gIENBUlRfUkVNT1ZFX0VSUk9SOiAnQ0FSVF9SRU1PVkVfRVJST1InLFxuICBDQVJUX0NMRUFSX0VSUk9SOiAnQ0FSVF9DTEVBUl9FUlJPUicsXG4gIENBUlRfTUVSR0VfRVJST1I6ICdDQVJUX01FUkdFX0VSUk9SJyxcbiAgQ0FSVF9GRVRDSF9FUlJPUjogJ0NBUlRfRkVUQ0hfRVJST1InLFxuICBJVEVNX05PVF9GT1VORDogJ0lURU1fTk9UX0ZPVU5EJyxcbiAgTUFYX1FVQU5USVRZX0VYQ0VFREVEOiAnTUFYX1FVQU5USVRZX0VYQ0VFREVEJyxcbiAgSU5WQUxJRF9RVUFOVElUWTogJ0lOVkFMSURfUVVBTlRJVFknLFxuICBNSVNTSU5HX1BST0RVQ1RfSUQ6ICdNSVNTSU5HX1BST0RVQ1RfSUQnLFxuICBcbiAgLy8gT3JkZXIgZXJyb3JzXG4gIE9SREVSX05PVF9GT1VORDogJ09SREVSX05PVF9GT1VORCcsXG4gIE9SREVSX0NSRUFURV9FUlJPUjogJ09SREVSX0NSRUFURV9FUlJPUicsXG4gIE9SREVSX1VQREFURV9FUlJPUjogJ09SREVSX1VQREFURV9FUlJPUicsXG4gIE9SREVSX0NBTkNFTF9FUlJPUjogJ09SREVSX0NBTkNFTF9FUlJPUicsXG4gIElOVkFMSURfT1JERVJfU1RBVFVTOiAnSU5WQUxJRF9PUkRFUl9TVEFUVVMnLFxuICBFTVBUWV9DQVJUOiAnRU1QVFlfQ0FSVCcsXG4gIFxuICAvLyBQYXltZW50IGVycm9yc1xuICBQQVlNRU5UX0ZBSUxFRDogJ1BBWU1FTlRfRkFJTEVEJyxcbiAgUEFZTUVOVF9NRVRIT0RfSU5WQUxJRDogJ1BBWU1FTlRfTUVUSE9EX0lOVkFMSUQnLFxuICBJTlNVRkZJQ0lFTlRfRlVORFM6ICdJTlNVRkZJQ0lFTlRfRlVORFMnLFxuICBQQVlNRU5UX1JFUVVJUkVEOiAnUEFZTUVOVF9SRVFVSVJFRCcsXG4gIFBBWU1FTlRfQ1JFQVRFX0VSUk9SOiAnUEFZTUVOVF9DUkVBVEVfRVJST1InLFxuICBQQVlNRU5UX1NUQVRVU19FUlJPUjogJ1BBWU1FTlRfU1RBVFVTX0VSUk9SJyxcbiAgXG4gIC8vIEludGVncmF0aW9uIGVycm9yc1xuICBNT0xMSUVfRVJST1I6ICdNT0xMSUVfRVJST1InLFxuICBXSE9MRVNBTEVSX0VSUk9SOiAnV0hPTEVTQUxFUl9FUlJPUicsXG4gIEVNQUlMX0VSUk9SOiAnRU1BSUxfRVJST1InXG59O1xuXG4vKipcbiAqIEZvcm1hdCBlcnJvciByZXNwb25zZSBpbiBzdGFuZGFyZGl6ZWQgZm9ybWF0XG4gKiBAcGFyYW0ge3N0cmluZ30gY29kZSAtIEVycm9yIGNvZGUgZnJvbSBFcnJvckNvZGVzXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIERlZmF1bHQgZXJyb3IgbWVzc2FnZSAodXNlZCBpZiBpMThuIGtleSBub3QgZm91bmQpXG4gKiBAcGFyYW0ge3N0cmluZ30gZmllbGQgLSBPcHRpb25hbCBmaWVsZCBuYW1lIGZvciB2YWxpZGF0aW9uIGVycm9yc1xuICogQHBhcmFtIHtvYmplY3R9IGFkZGl0aW9uYWxEYXRhIC0gQWRkaXRpb25hbCBkYXRhIHRvIGluY2x1ZGUgaW4gZXJyb3JcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IGkxOG4gLSBPcHRpb25hbCBpMThuIGZ1bmN0aW9uIGZvciB0cmFuc2xhdGlvblxuICogQHJldHVybnMge29iamVjdH0gRm9ybWF0dGVkIGVycm9yIHJlc3BvbnNlXG4gKi9cbmZ1bmN0aW9uIGZvcm1hdEVycm9yKGNvZGUsIG1lc3NhZ2UsIGZpZWxkID0gbnVsbCwgYWRkaXRpb25hbERhdGEgPSBudWxsLCBpMThuID0gbnVsbCkge1xuICBjb25zdCBlcnJvciA9IHtcbiAgICBjb2RlLFxuICAgIG1lc3NhZ2VcbiAgfTtcblxuICAvLyBUcnkgdG8gdXNlIGkxOG4gaWYgYXZhaWxhYmxlXG4gIGlmIChpMThuICYmIHR5cGVvZiBpMThuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY29uc3QgdHJhbnNsYXRlZE1lc3NhZ2UgPSBpMThuKGBlcnJvcnMuJHtjb2RlfWApO1xuICAgIC8vIE9ubHkgdXNlIHRyYW5zbGF0ZWQgbWVzc2FnZSBpZiBpdCdzIG5vdCB0aGUga2V5IGl0c2VsZlxuICAgIGlmICh0cmFuc2xhdGVkTWVzc2FnZSAmJiB0cmFuc2xhdGVkTWVzc2FnZSAhPT0gYGVycm9ycy4ke2NvZGV9YCkge1xuICAgICAgZXJyb3IubWVzc2FnZSA9IHRyYW5zbGF0ZWRNZXNzYWdlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChmaWVsZCkge1xuICAgIGVycm9yLmZpZWxkID0gZmllbGQ7XG4gIH1cblxuICBpZiAoYWRkaXRpb25hbERhdGEpIHtcbiAgICBPYmplY3QuYXNzaWduKGVycm9yLCBhZGRpdGlvbmFsRGF0YSk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgIGVycm9yXG4gIH07XG59XG5cbi8qKlxuICogQ3JlYXRlIHZhbGlkYXRpb24gZXJyb3IgZnJvbSBleHByZXNzLXZhbGlkYXRvciByZXN1bHRcbiAqIEBwYXJhbSB7b2JqZWN0fSB2YWxpZGF0aW9uUmVzdWx0IC0gRXhwcmVzcyB2YWxpZGF0b3IgcmVzdWx0IG9iamVjdFxuICogQHJldHVybnMge29iamVjdH0gRm9ybWF0dGVkIHZhbGlkYXRpb24gZXJyb3JcbiAqL1xuZnVuY3Rpb24gY3JlYXRlVmFsaWRhdGlvbkVycm9yKHZhbGlkYXRpb25SZXN1bHQpIHtcbiAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdC5hcnJheSgpO1xuICBcbiAgcmV0dXJuIHtcbiAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICBlcnJvcjoge1xuICAgICAgY29kZTogRXJyb3JDb2Rlcy5WQUxJREFUSU9OX0VSUk9SLFxuICAgICAgbWVzc2FnZTogJ0ludmFsaWQgaW5wdXQgZGF0YScsXG4gICAgICBkZXRhaWxzOiBlcnJvcnMubWFwKGVyciA9PiAoe1xuICAgICAgICBmaWVsZDogZXJyLnBhcmFtLFxuICAgICAgICBtZXNzYWdlOiBlcnIubXNnLFxuICAgICAgICBsb2NhdGlvbjogZXJyLmxvY2F0aW9uXG4gICAgICB9KSlcbiAgICB9XG4gIH07XG59XG5cbi8qKlxuICogRXhwcmVzcyBtaWRkbGV3YXJlIHRvIGFkZCBlcnJvciByZXNwb25zZSBoZWxwZXJzXG4gKiBBZGRzIG1ldGhvZHMgdG8gcmVzIG9iamVjdCBmb3IgY29uc2lzdGVudCBlcnJvciByZXNwb25zZXNcbiAqL1xuZnVuY3Rpb24gZXJyb3JSZXNwb25zZShyZXEsIHJlcywgbmV4dCkge1xuICAvLyBHZXQgaTE4biBmdW5jdGlvbiBpZiBhdmFpbGFibGUgKHdpbGwgYmUgYWRkZWQgd2hlbiB3ZSBpbXBsZW1lbnQgYmFja2VuZCBpMThuKVxuICBjb25zdCBpMThuID0gcmVxLmkxOG4gfHwgbnVsbDtcblxuICAvKipcbiAgICogU2VuZCBzdGFuZGFyZGl6ZWQgZXJyb3IgcmVzcG9uc2VcbiAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXR1c0NvZGUgLSBIVFRQIHN0YXR1cyBjb2RlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlcnJvckNvZGUgLSBFcnJvciBjb2RlIGZyb20gRXJyb3JDb2Rlc1xuICAgKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIEVycm9yIG1lc3NhZ2VcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZpZWxkIC0gT3B0aW9uYWwgZmllbGQgbmFtZVxuICAgKiBAcGFyYW0ge29iamVjdH0gYWRkaXRpb25hbERhdGEgLSBBZGRpdGlvbmFsIGVycm9yIGRhdGFcbiAgICovXG4gIHJlcy5lcnJvciA9IGZ1bmN0aW9uKHN0YXR1c0NvZGUsIGVycm9yQ29kZSwgbWVzc2FnZSwgZmllbGQgPSBudWxsLCBhZGRpdGlvbmFsRGF0YSA9IG51bGwpIHtcbiAgICBjb25zdCBlcnJvckRhdGEgPSBmb3JtYXRFcnJvcihlcnJvckNvZGUsIG1lc3NhZ2UsIGZpZWxkLCBhZGRpdGlvbmFsRGF0YSwgaTE4bik7XG4gICAgcmV0dXJuIHRoaXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24oZXJyb3JEYXRhKTtcbiAgfTtcblxuICAvKipcbiAgICogU2VuZCB2YWxpZGF0aW9uIGVycm9yIHJlc3BvbnNlXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB2YWxpZGF0aW9uRXJyb3JzIC0gRXhwcmVzcyB2YWxpZGF0b3IgZXJyb3JzXG4gICAqL1xuICByZXMudmFsaWRhdGlvbkVycm9yID0gZnVuY3Rpb24odmFsaWRhdGlvbkVycm9ycykge1xuICAgIGNvbnN0IGVycm9yRGF0YSA9IGNyZWF0ZVZhbGlkYXRpb25FcnJvcih2YWxpZGF0aW9uRXJyb3JzKTtcbiAgICByZXR1cm4gdGhpcy5zdGF0dXMoNDAwKS5qc29uKGVycm9yRGF0YSk7XG4gIH07XG5cbiAgbmV4dCgpO1xufVxuXG4vKipcbiAqIFNwZWNpYWwgaGFuZGxlciBmb3Igd2ViaG9vayBlbmRwb2ludHMgdGhhdCBuZWVkIHBsYWluIHRleHQgcmVzcG9uc2VzXG4gKiBAcGFyYW0ge29iamVjdH0gcmVzIC0gRXhwcmVzcyByZXNwb25zZSBvYmplY3RcbiAqIEBwYXJhbSB7bnVtYmVyfSBzdGF0dXNDb2RlIC0gSFRUUCBzdGF0dXMgY29kZVxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBFcnJvciBtZXNzYWdlXG4gKi9cbmZ1bmN0aW9uIHdlYmhvb2tFcnJvcihyZXMsIHN0YXR1c0NvZGUsIG1lc3NhZ2UpIHtcbiAgcmV0dXJuIHJlcy5zdGF0dXMoc3RhdHVzQ29kZSkuc2VuZChtZXNzYWdlKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIEVycm9yQ29kZXMsXG4gIGZvcm1hdEVycm9yLFxuICBjcmVhdGVWYWxpZGF0aW9uRXJyb3IsXG4gIGVy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
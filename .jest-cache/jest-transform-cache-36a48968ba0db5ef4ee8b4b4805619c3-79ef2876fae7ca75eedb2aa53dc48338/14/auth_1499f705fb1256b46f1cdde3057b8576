017014d3b1d09ca7005a13295f4c14db
const jwt = require('jsonwebtoken');
const User = require('../models/User');

// Middleware to authenticate JWT tokens
const authenticateToken = async (req, res, next) => {
  try {
    // Check for token in cookie first (more secure), then fall back to header
    const cookieToken = req.cookies?.token;
    const authHeader = req.headers['authorization'];
    const headerToken = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN

    // Prefer cookie token over header token for security
    const token = cookieToken || headerToken;
    if (!token) {
      req.user = null;
      return next(); // Continue without authentication for optional auth routes
    }
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    const user = await User.findById(decoded.userId).select('-password');
    if (!user || !user.isActive) {
      req.user = null;
      return next();
    }
    req.user = user;
    next();
  } catch (error) {
    // Log the error for debugging but don't expose details to client
    console.error('JWT verification error:', error.message);
    req.user = null;
    next(); // Continue without authentication for optional auth routes
  }
};

// Middleware to require authentication
const requireAuth = async (req, res, next) => {
  try {
    // Check for token in cookie first (more secure), then fall back to header
    const cookieToken = req.cookies?.token;
    const authHeader = req.headers['authorization'];
    const headerToken = authHeader && authHeader.split(' ')[1];

    // Prefer cookie token over header token for security
    const token = cookieToken || headerToken;
    if (!token) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'NO_TOKEN',
          message: 'Access token is required'
        }
      });
    }
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    const user = await User.findById(decoded.userId).select('-password');
    if (!user || !user.isActive) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'INVALID_TOKEN',
          message: 'Invalid or expired token'
        }
      });
    }
    req.user = user;
    next();
  } catch (error) {
    if (error.name === 'JsonWebTokenError') {
      return res.status(401).json({
        success: false,
        error: {
          code: 'INVALID_TOKEN',
          message: 'Invalid token format'
        }
      });
    }
    if (error.name === 'TokenExpiredError') {
      return res.status(401).json({
        success: false,
        error: {
          code: 'TOKEN_EXPIRED',
          message: 'Token has expired'
        }
      });
    }
    console.error('Authentication error:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'AUTH_ERROR',
        message: 'Authentication failed'
      }
    });
  }
};

// Middleware to require admin role
const requireAdmin = async (req, res, next) => {
  try {
    const authHeader = req.headers['authorization'];
    const token = authHeader && authHeader.split(' ')[1];
    if (!token) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'NO_TOKEN',
          message: 'Access token is required'
        }
      });
    }
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    const user = await User.findById(decoded.userId).select('-password');
    if (!user || !user.isActive) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'INVALID_TOKEN',
          message: 'Invalid or expired token'
        }
      });
    }

    // Check if user has admin role
    if (!user.isAdmin) {
      return res.status(403).json({
        success: false,
        error: {
          code: 'INSUFFICIENT_PERMISSIONS',
          message: 'Admin access required'
        }
      });
    }
    req.user = user;
    next();
  } catch (error) {
    if (error.name === 'JsonWebTokenError') {
      return res.status(401).json({
        success: false,
        error: {
          code: 'INVALID_TOKEN',
          message: 'Invalid token format'
        }
      });
    }
    if (error.name === 'TokenExpiredError') {
      return res.status(401).json({
        success: false,
        error: {
          code: 'TOKEN_EXPIRED',
          message: 'Token has expired'
        }
      });
    }
    console.error('Admin auth error:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'AUTH_ERROR',
        message: 'Authorization failed'
      }
    });
  }
};
module.exports = {
  authenticateToken,
  requireAuth,
  requireAdmin
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwiVXNlciIsImF1dGhlbnRpY2F0ZVRva2VuIiwicmVxIiwicmVzIiwibmV4dCIsImNvb2tpZVRva2VuIiwiY29va2llcyIsInRva2VuIiwiYXV0aEhlYWRlciIsImhlYWRlcnMiLCJoZWFkZXJUb2tlbiIsInNwbGl0IiwidXNlciIsImRlY29kZWQiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImZpbmRCeUlkIiwidXNlcklkIiwic2VsZWN0IiwiaXNBY3RpdmUiLCJlcnJvciIsImNvbnNvbGUiLCJtZXNzYWdlIiwicmVxdWlyZUF1dGgiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsImNvZGUiLCJuYW1lIiwicmVxdWlyZUFkbWluIiwiaXNBZG1pbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJhdXRoLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpO1xuY29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7XG5cbi8vIE1pZGRsZXdhcmUgdG8gYXV0aGVudGljYXRlIEpXVCB0b2tlbnNcbmNvbnN0IGF1dGhlbnRpY2F0ZVRva2VuID0gYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gQ2hlY2sgZm9yIHRva2VuIGluIGNvb2tpZSBmaXJzdCAobW9yZSBzZWN1cmUpLCB0aGVuIGZhbGwgYmFjayB0byBoZWFkZXJcbiAgICBjb25zdCBjb29raWVUb2tlbiA9IHJlcS5jb29raWVzPy50b2tlbjtcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnNbJ2F1dGhvcml6YXRpb24nXTtcbiAgICBjb25zdCBoZWFkZXJUb2tlbiA9IGF1dGhIZWFkZXIgJiYgYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdOyAvLyBCZWFyZXIgVE9LRU5cbiAgICBcbiAgICAvLyBQcmVmZXIgY29va2llIHRva2VuIG92ZXIgaGVhZGVyIHRva2VuIGZvciBzZWN1cml0eVxuICAgIGNvbnN0IHRva2VuID0gY29va2llVG9rZW4gfHwgaGVhZGVyVG9rZW47XG4gICAgXG4gICAgaWYgKCF0b2tlbikge1xuICAgICAgcmVxLnVzZXIgPSBudWxsO1xuICAgICAgcmV0dXJuIG5leHQoKTsgLy8gQ29udGludWUgd2l0aG91dCBhdXRoZW50aWNhdGlvbiBmb3Igb3B0aW9uYWwgYXV0aCByb3V0ZXNcbiAgICB9XG4gICAgXG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKGRlY29kZWQudXNlcklkKS5zZWxlY3QoJy1wYXNzd29yZCcpO1xuICAgIFxuICAgIGlmICghdXNlciB8fCAhdXNlci5pc0FjdGl2ZSkge1xuICAgICAgcmVxLnVzZXIgPSBudWxsO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9XG4gICAgXG4gICAgcmVxLnVzZXIgPSB1c2VyO1xuICAgIG5leHQoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBMb2cgdGhlIGVycm9yIGZvciBkZWJ1Z2dpbmcgYnV0IGRvbid0IGV4cG9zZSBkZXRhaWxzIHRvIGNsaWVudFxuICAgIGNvbnNvbGUuZXJyb3IoJ0pXVCB2ZXJpZmljYXRpb24gZXJyb3I6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgcmVxLnVzZXIgPSBudWxsO1xuICAgIG5leHQoKTsgLy8gQ29udGludWUgd2l0aG91dCBhdXRoZW50aWNhdGlvbiBmb3Igb3B0aW9uYWwgYXV0aCByb3V0ZXNcbiAgfVxufTtcblxuLy8gTWlkZGxld2FyZSB0byByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXG5jb25zdCByZXF1aXJlQXV0aCA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIC8vIENoZWNrIGZvciB0b2tlbiBpbiBjb29raWUgZmlyc3QgKG1vcmUgc2VjdXJlKSwgdGhlbiBmYWxsIGJhY2sgdG8gaGVhZGVyXG4gICAgY29uc3QgY29va2llVG9rZW4gPSByZXEuY29va2llcz8udG9rZW47XG4gICAgY29uc3QgYXV0aEhlYWRlciA9IHJlcS5oZWFkZXJzWydhdXRob3JpemF0aW9uJ107XG4gICAgY29uc3QgaGVhZGVyVG9rZW4gPSBhdXRoSGVhZGVyICYmIGF1dGhIZWFkZXIuc3BsaXQoJyAnKVsxXTtcbiAgICBcbiAgICAvLyBQcmVmZXIgY29va2llIHRva2VuIG92ZXIgaGVhZGVyIHRva2VuIGZvciBzZWN1cml0eVxuICAgIGNvbnN0IHRva2VuID0gY29va2llVG9rZW4gfHwgaGVhZGVyVG9rZW47XG4gICAgXG4gICAgaWYgKCF0b2tlbikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ05PX1RPS0VOJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIHRva2VuIGlzIHJlcXVpcmVkJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKGRlY29kZWQudXNlcklkKS5zZWxlY3QoJy1wYXNzd29yZCcpO1xuICAgIFxuICAgIGlmICghdXNlciB8fCAhdXNlci5pc0FjdGl2ZSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfVE9LRU4nLFxuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIG9yIGV4cGlyZWQgdG9rZW4nXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICByZXEudXNlciA9IHVzZXI7XG4gICAgbmV4dCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGlmIChlcnJvci5uYW1lID09PSAnSnNvbldlYlRva2VuRXJyb3InKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9UT0tFTicsXG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgdG9rZW4gZm9ybWF0J1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdUb2tlbkV4cGlyZWRFcnJvcicpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdUT0tFTl9FWFBJUkVEJyxcbiAgICAgICAgICBtZXNzYWdlOiAnVG9rZW4gaGFzIGV4cGlyZWQnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmVycm9yKCdBdXRoZW50aWNhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnQVVUSF9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiBmYWlsZWQnXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07XG5cbi8vIE1pZGRsZXdhcmUgdG8gcmVxdWlyZSBhZG1pbiByb2xlXG5jb25zdCByZXF1aXJlQWRtaW4gPSBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhdXRoSGVhZGVyID0gcmVxLmhlYWRlcnNbJ2F1dGhvcml6YXRpb24nXTtcbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIgJiYgYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdO1xuICAgIFxuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdOT19UT0tFTicsXG4gICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyB0b2tlbiBpcyByZXF1aXJlZCdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUKTtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChkZWNvZGVkLnVzZXJJZCkuc2VsZWN0KCctcGFzc3dvcmQnKTtcbiAgICBcbiAgICBpZiAoIXVzZXIgfHwgIXVzZXIuaXNBY3RpdmUpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1RPS0VOJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBvciBleHBpcmVkIHRva2VuJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgYWRtaW4gcm9sZVxuICAgIGlmICghdXNlci5pc0FkbWluKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQWRtaW4gYWNjZXNzIHJlcXVpcmVkJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmVxLnVzZXIgPSB1c2VyO1xuICAgIG5leHQoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ0pzb25XZWJUb2tlbkVycm9yJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfVE9LRU4nLFxuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHRva2VuIGZvcm1hdCdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGlmIChlcnJvci5uYW1lID09PSAnVG9rZW5FeHBpcmVkRXJyb3InKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVE9LRU5fRVhQSVJFRCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1Rva2VuIGhhcyBleHBpcmVkJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5lcnJvcignQWRtaW4gYXV0aCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnQVVUSF9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6ICdBdXRob3JpemF0aW9uIGZhaWxlZCdcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGF1dGhlbnRpY2F0ZVRva2VuLFxuICByZXF1aXJlQXV0aCxcbiAgcmVxdWlyZUFkbWluXG59OyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsY0FB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
{"version":3,"names":["express","require","router","Router","Product","User","Cart","authenticateToken","cartService","getOrCreateCart","req","user","findById","_id","cart","items","updatedAt","Date","save","type","sessionId","sessionID","now","Math","random","toString","substr","findOne","get","res","getCartWithPerformanceOptimization","populatedCart","Promise","all","map","item","product","select","isActive","toPublicJSON","quantity","price","subtotal","error","console","validCartItems","filter","itemCount","reduce","total","json","success","data","round","isEmpty","length","status","code","message","post","productId","body","Number","isInteger","result","updateCartOptimistically","updatedCartData","prod","performance","duration","details","process","env","NODE_ENV","undefined","put","itemIndex","findIndex","splice","addedAt","updateItem","delete","params","removeItem","clearCart","guestCartItems","mergeResult","mergeCartsWithConflictResolution","mergedItems","merge","conflicts","module","exports"],"sources":["cart.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst Product = require('../models/Product');\nconst User = require('../models/User');\nconst Cart = require('../models/Cart');\nconst { authenticateToken } = require('../middleware/auth');\nconst cartService = require('../services/cartService');\n\n// Helper function to get or create cart\nconst getOrCreateCart = async (req) => {\n  if (req.user) {\n    // For authenticated users, use user's cart\n    const user = await User.findById(req.user._id);\n    if (!user.cart) {\n      user.cart = { items: [], updatedAt: new Date() };\n      await user.save();\n    }\n    return { type: 'user', cart: user.cart, user };\n  } else {\n    // For guests, use session-based cart with database storage\n    // Generate a more reliable session identifier\n    const sessionId = req.sessionID || `guest_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    let cart = await Cart.findOne({ sessionId });\n    \n    if (!cart) {\n      cart = new Cart({ sessionId, items: [] });\n      await cart.save();\n    }\n    \n    return { type: 'guest', cart, sessionId };\n  }\n};\n\n// Get cart contents with performance optimization\nrouter.get('/', authenticateToken, async (req, res) => {\n  try {\n    const { type, cart, user } = await cartService.getCartWithPerformanceOptimization(req);\n    \n    // Populate product details for cart items\n    const populatedCart = await Promise.all(\n      cart.items.map(async (item) => {\n        try {\n          const product = await Product.findById(item.product).select('-wholesaler');\n          if (!product || !product.isActive) {\n            return null; // Filter out inactive products\n          }\n          \n          return {\n            _id: item.product,\n            product: product.toPublicJSON(),\n            quantity: item.quantity,\n            price: item.price,\n            subtotal: item.price * item.quantity\n          };\n        } catch (error) {\n          console.error('Error populating cart item:', error);\n          return null;\n        }\n      })\n    );\n\n    // Filter out null items (inactive products)\n    const validCartItems = populatedCart.filter(item => item !== null);\n    \n    // Calculate totals\n    const itemCount = validCartItems.reduce((total, item) => total + item.quantity, 0);\n    const subtotal = validCartItems.reduce((total, item) => total + item.subtotal, 0);\n    \n    res.json({\n      success: true,\n      data: {\n        cart: {\n          items: validCartItems,\n          itemCount,\n          subtotal: Math.round(subtotal * 100) / 100,\n          total: Math.round(subtotal * 100) / 100,\n          isEmpty: validCartItems.length === 0\n        }\n      }\n    });\n\n  } catch (error) {\n    console.error('Error fetching cart:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'CART_FETCH_ERROR',\n        message: 'Failed to fetch cart'\n      }\n    });\n  }\n});\n\n// Add item to cart with optimistic updates\nrouter.post('/add', authenticateToken, async (req, res) => {\n  try {\n    const { productId, quantity = 1 } = req.body;\n\n    // Validation\n    if (!productId) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Product ID is required'\n        }\n      });\n    }\n\n    if (!Number.isInteger(quantity) || quantity < 1 || quantity > 99) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Quantity must be between 1 and 99'\n        }\n      });\n    }\n\n    // Use optimistic cart service\n    const result = await cartService.updateCartOptimistically(req, 'add', {\n      productId,\n      quantity\n    });\n\n    // Return updated cart with performance metrics\n    const updatedCartData = await cartService.getCartWithPerformanceOptimization(req);\n    const populatedCart = await Promise.all(\n      updatedCartData.cart.items.map(async (item) => {\n        const prod = await Product.findById(item.product).select('-wholesaler');\n        return {\n          _id: item.product,\n          product: prod.toPublicJSON(),\n          quantity: item.quantity,\n          price: item.price,\n          subtotal: item.price * item.quantity\n        };\n      })\n    );\n\n    const itemCount = populatedCart.reduce((total, item) => total + item.quantity, 0);\n    const subtotal = populatedCart.reduce((total, item) => total + item.subtotal, 0);\n\n    res.json({\n      success: true,\n      message: 'Item added to cart',\n      data: {\n        cart: {\n          items: populatedCart,\n          itemCount,\n          subtotal: Math.round(subtotal * 100) / 100,\n          total: Math.round(subtotal * 100) / 100\n        },\n        performance: {\n          duration: result.duration,\n          status: result.performance\n        }\n      }\n    });\n\n  } catch (error) {\n    console.error('Error adding to cart:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'CART_ADD_ERROR',\n        message: 'Failed to add item to cart',\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined\n      }\n    });\n  }\n});\n\n// Update cart item quantity\nrouter.put('/update', authenticateToken, async (req, res) => {\n  try {\n    const { productId, quantity } = req.body;\n\n    // Validation\n    if (!productId) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Product ID is required'\n        }\n      });\n    }\n\n    if (!Number.isInteger(quantity) || quantity < 0 || quantity > 99) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Quantity must be between 0 and 99'\n        }\n      });\n    }\n\n    const { type, cart, user } = await getOrCreateCart(req);\n\n    if (type === 'user') {\n      // Update user's cart\n      const itemIndex = user.cart.items.findIndex(item => \n        item.product.toString() === productId.toString()\n      );\n\n      if (itemIndex >= 0) {\n        if (quantity === 0) {\n          user.cart.items.splice(itemIndex, 1);\n        } else {\n          user.cart.items[itemIndex].quantity = quantity;\n          user.cart.items[itemIndex].addedAt = new Date();\n        }\n        user.cart.updatedAt = new Date();\n        await user.save();\n      }\n    } else {\n      // Update guest cart\n      cart.updateItem(productId, quantity);\n      await cart.save();\n    }\n\n    // Return updated cart\n    const updatedCartData = await getOrCreateCart(req);\n    const populatedCart = await Promise.all(\n      updatedCartData.cart.items.map(async (item) => {\n        const product = await Product.findById(item.product).select('-wholesaler');\n        if (!product || !product.isActive) return null;\n        \n        return {\n          _id: item.product,\n          product: product.toPublicJSON(),\n          quantity: item.quantity,\n          price: item.price,\n          subtotal: item.price * item.quantity\n        };\n      })\n    );\n\n    const validCartItems = populatedCart.filter(item => item !== null);\n    const itemCount = validCartItems.reduce((total, item) => total + item.quantity, 0);\n    const subtotal = validCartItems.reduce((total, item) => total + item.subtotal, 0);\n\n    res.json({\n      success: true,\n      message: 'Cart updated successfully',\n      data: {\n        cart: {\n          items: validCartItems,\n          itemCount,\n          subtotal: Math.round(subtotal * 100) / 100,\n          total: Math.round(subtotal * 100) / 100\n        }\n      }\n    });\n\n  } catch (error) {\n    console.error('Error updating cart:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'CART_UPDATE_ERROR',\n        message: 'Failed to update cart'\n      }\n    });\n  }\n});\n\n// Remove item from cart\nrouter.delete('/remove/:productId', authenticateToken, async (req, res) => {\n  try {\n    const { productId } = req.params;\n\n    if (!productId) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Product ID is required'\n        }\n      });\n    }\n\n    const { type, cart, user } = await getOrCreateCart(req);\n\n    if (type === 'user') {\n      // Remove from user's cart\n      const itemIndex = user.cart.items.findIndex(item => \n        item.product.toString() === productId.toString()\n      );\n\n      if (itemIndex >= 0) {\n        user.cart.items.splice(itemIndex, 1);\n        user.cart.updatedAt = new Date();\n        await user.save();\n      }\n    } else {\n      // Remove from guest cart\n      cart.removeItem(productId);\n      await cart.save();\n    }\n\n    // Return updated cart\n    const updatedCartData = await getOrCreateCart(req);\n    const populatedCart = await Promise.all(\n      updatedCartData.cart.items.map(async (item) => {\n        const product = await Product.findById(item.product).select('-wholesaler');\n        if (!product || !product.isActive) return null;\n        \n        return {\n          _id: item.product,\n          product: product.toPublicJSON(),\n          quantity: item.quantity,\n          price: item.price,\n          subtotal: item.price * item.quantity\n        };\n      })\n    );\n\n    const validCartItems = populatedCart.filter(item => item !== null);\n    const itemCount = validCartItems.reduce((total, item) => total + item.quantity, 0);\n    const subtotal = validCartItems.reduce((total, item) => total + item.subtotal, 0);\n\n    res.json({\n      success: true,\n      message: 'Item removed from cart',\n      data: {\n        cart: {\n          items: validCartItems,\n          itemCount,\n          subtotal: Math.round(subtotal * 100) / 100,\n          total: Math.round(subtotal * 100) / 100\n        }\n      }\n    });\n\n  } catch (error) {\n    console.error('Error removing from cart:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'CART_REMOVE_ERROR',\n        message: 'Failed to remove item from cart'\n      }\n    });\n  }\n});\n\n// Clear cart\nrouter.delete('/clear', authenticateToken, async (req, res) => {\n  try {\n    const { type, cart, user } = await getOrCreateCart(req);\n\n    if (type === 'user') {\n      // Clear user's cart\n      user.cart.items = [];\n      user.cart.updatedAt = new Date();\n      await user.save();\n    } else {\n      // Clear guest cart\n      cart.clearCart();\n      await cart.save();\n    }\n\n    res.json({\n      success: true,\n      message: 'Cart cleared successfully',\n      data: {\n        cart: {\n          items: [],\n          itemCount: 0,\n          subtotal: 0,\n          total: 0,\n          isEmpty: true\n        }\n      }\n    });\n\n  } catch (error) {\n    console.error('Error clearing cart:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'CART_CLEAR_ERROR',\n        message: 'Failed to clear cart'\n      }\n    });\n  }\n});\n\n// Merge guest cart with user cart with conflict resolution\nrouter.post('/merge', authenticateToken, async (req, res) => {\n  try {\n    if (!req.user) {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'AUTHENTICATION_REQUIRED',\n          message: 'User must be authenticated to merge cart'\n        }\n      });\n    }\n\n    const { guestCartItems, sessionId } = req.body;\n    \n    // Use enhanced cart service for merging with conflict resolution\n    const mergeResult = await cartService.mergeCartsWithConflictResolution(\n      req.user._id,\n      guestCartItems,\n      sessionId\n    );\n\n    // Get updated cart data\n    const updatedCartData = await cartService.getCartWithPerformanceOptimization(req);\n    \n    // Return updated user cart\n    const populatedCart = await Promise.all(\n      updatedCartData.cart.items.map(async (item) => {\n        try {\n          const product = await Product.findById(item.product).select('-wholesaler');\n          if (!product || !product.isActive) {\n            return null; // Filter out inactive products\n          }\n          \n          return {\n            _id: item.product,\n            product: product.toPublicJSON(),\n            quantity: item.quantity,\n            price: item.price,\n            subtotal: item.price * item.quantity\n          };\n        } catch (error) {\n          console.error('Error populating cart item:', error);\n          return null;\n        }\n      })\n    );\n\n    // Filter out null items (inactive products)\n    const validCartItems = populatedCart.filter(item => item !== null);\n    const itemCount = validCartItems.reduce((total, item) => total + item.quantity, 0);\n    const subtotal = validCartItems.reduce((total, item) => total + item.subtotal, 0);\n\n    res.json({\n      success: true,\n      message: `Successfully merged ${mergeResult.mergedItems} items into your cart`,\n      data: {\n        cart: {\n          items: validCartItems,\n          itemCount,\n          subtotal: Math.round(subtotal * 100) / 100,\n          total: Math.round(subtotal * 100) / 100,\n          isEmpty: validCartItems.length === 0\n        },\n        merge: {\n          mergedItems: mergeResult.mergedItems,\n          conflicts: mergeResult.conflicts,\n          duration: mergeResult.duration\n        }\n      }\n    });\n\n  } catch (error) {\n    console.error('Error merging guest cart:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'CART_MERGE_ERROR',\n        message: 'Failed to merge guest cart',\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined\n      }\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}
{"version":3,"names":["ErrorCodes","VALIDATION_ERROR","NOT_FOUND","UNAUTHORIZED","FORBIDDEN","INTERNAL_ERROR","BAD_REQUEST","INVALID_CREDENTIALS","USER_EXISTS","USER_NOT_FOUND","TOKEN_INVALID","TOKEN_EXPIRED","AUTHENTICATION_REQUIRED","REGISTRATION_ERROR","PRODUCT_NOT_FOUND","INVALID_PRODUCT_ID","PRODUCTS_FETCH_ERROR","PRODUCT_CREATION_ERROR","PRODUCT_UPDATE_ERROR","PRODUCT_DELETE_ERROR","SEARCH_ERROR","CATEGORIES_ERROR","FILTERS_ERROR","RECOMMENDATIONS_ERROR","MISSING_QUERY","CART_ADD_ERROR","CART_UPDATE_ERROR","CART_REMOVE_ERROR","CART_CLEAR_ERROR","CART_MERGE_ERROR","CART_FETCH_ERROR","ITEM_NOT_FOUND","MAX_QUANTITY_EXCEEDED","INVALID_QUANTITY","MISSING_PRODUCT_ID","ORDER_NOT_FOUND","ORDER_CREATE_ERROR","ORDER_UPDATE_ERROR","ORDER_CANCEL_ERROR","INVALID_ORDER_STATUS","EMPTY_CART","PAYMENT_FAILED","PAYMENT_METHOD_INVALID","INSUFFICIENT_FUNDS","PAYMENT_REQUIRED","PAYMENT_CREATE_ERROR","PAYMENT_STATUS_ERROR","MOLLIE_ERROR","WHOLESALER_ERROR","EMAIL_ERROR","formatError","code","message","field","additionalData","i18n","error","translatedMessage","Object","assign","success","createValidationError","validationResult","errors","array","details","map","err","param","msg","location","errorResponse","req","res","next","statusCode","errorCode","errorData","status","json","validationError","validationErrors","webhookError","send","module","exports"],"sources":["errorHandler.js"],"sourcesContent":["/**\n * Standardized error handling utilities for the Holistic Boutique API\n * Following CLAUDE.md constraints:\n * - Keep it simple - no event emitters or complex patterns\n * - Support internationalization for all error messages\n * - Use existing patterns from the codebase\n */\n\n// Standard error codes used across the application\nconst ErrorCodes = {\n  // Common errors\n  VALIDATION_ERROR: 'VALIDATION_ERROR',\n  NOT_FOUND: 'NOT_FOUND',\n  UNAUTHORIZED: 'UNAUTHORIZED',\n  FORBIDDEN: 'FORBIDDEN',\n  INTERNAL_ERROR: 'INTERNAL_ERROR',\n  BAD_REQUEST: 'BAD_REQUEST',\n  \n  // Authentication errors\n  INVALID_CREDENTIALS: 'INVALID_CREDENTIALS',\n  USER_EXISTS: 'USER_EXISTS',\n  USER_NOT_FOUND: 'USER_NOT_FOUND',\n  TOKEN_INVALID: 'TOKEN_INVALID',\n  TOKEN_EXPIRED: 'TOKEN_EXPIRED',\n  AUTHENTICATION_REQUIRED: 'AUTHENTICATION_REQUIRED',\n  REGISTRATION_ERROR: 'REGISTRATION_ERROR',\n  \n  // Product errors\n  PRODUCT_NOT_FOUND: 'PRODUCT_NOT_FOUND',\n  INVALID_PRODUCT_ID: 'INVALID_PRODUCT_ID',\n  PRODUCTS_FETCH_ERROR: 'PRODUCTS_FETCH_ERROR',\n  PRODUCT_CREATION_ERROR: 'PRODUCT_CREATION_ERROR',\n  PRODUCT_UPDATE_ERROR: 'PRODUCT_UPDATE_ERROR',\n  PRODUCT_DELETE_ERROR: 'PRODUCT_DELETE_ERROR',\n  SEARCH_ERROR: 'SEARCH_ERROR',\n  CATEGORIES_ERROR: 'CATEGORIES_ERROR',\n  FILTERS_ERROR: 'FILTERS_ERROR',\n  RECOMMENDATIONS_ERROR: 'RECOMMENDATIONS_ERROR',\n  MISSING_QUERY: 'MISSING_QUERY',\n  \n  // Cart errors\n  CART_ADD_ERROR: 'CART_ADD_ERROR',\n  CART_UPDATE_ERROR: 'CART_UPDATE_ERROR',\n  CART_REMOVE_ERROR: 'CART_REMOVE_ERROR',\n  CART_CLEAR_ERROR: 'CART_CLEAR_ERROR',\n  CART_MERGE_ERROR: 'CART_MERGE_ERROR',\n  CART_FETCH_ERROR: 'CART_FETCH_ERROR',\n  ITEM_NOT_FOUND: 'ITEM_NOT_FOUND',\n  MAX_QUANTITY_EXCEEDED: 'MAX_QUANTITY_EXCEEDED',\n  INVALID_QUANTITY: 'INVALID_QUANTITY',\n  MISSING_PRODUCT_ID: 'MISSING_PRODUCT_ID',\n  \n  // Order errors\n  ORDER_NOT_FOUND: 'ORDER_NOT_FOUND',\n  ORDER_CREATE_ERROR: 'ORDER_CREATE_ERROR',\n  ORDER_UPDATE_ERROR: 'ORDER_UPDATE_ERROR',\n  ORDER_CANCEL_ERROR: 'ORDER_CANCEL_ERROR',\n  INVALID_ORDER_STATUS: 'INVALID_ORDER_STATUS',\n  EMPTY_CART: 'EMPTY_CART',\n  \n  // Payment errors\n  PAYMENT_FAILED: 'PAYMENT_FAILED',\n  PAYMENT_METHOD_INVALID: 'PAYMENT_METHOD_INVALID',\n  INSUFFICIENT_FUNDS: 'INSUFFICIENT_FUNDS',\n  PAYMENT_REQUIRED: 'PAYMENT_REQUIRED',\n  PAYMENT_CREATE_ERROR: 'PAYMENT_CREATE_ERROR',\n  PAYMENT_STATUS_ERROR: 'PAYMENT_STATUS_ERROR',\n  \n  // Integration errors\n  MOLLIE_ERROR: 'MOLLIE_ERROR',\n  WHOLESALER_ERROR: 'WHOLESALER_ERROR',\n  EMAIL_ERROR: 'EMAIL_ERROR'\n};\n\n/**\n * Format error response in standardized format\n * @param {string} code - Error code from ErrorCodes\n * @param {string} message - Default error message (used if i18n key not found)\n * @param {string} field - Optional field name for validation errors\n * @param {object} additionalData - Additional data to include in error\n * @param {function} i18n - Optional i18n function for translation\n * @returns {object} Formatted error response\n */\nfunction formatError(code, message, field = null, additionalData = null, i18n = null) {\n  const error = {\n    code,\n    message\n  };\n\n  // Try to use i18n if available\n  if (i18n && typeof i18n === 'function') {\n    const translatedMessage = i18n(`errors.${code}`);\n    // Only use translated message if it's not the key itself\n    if (translatedMessage && translatedMessage !== `errors.${code}`) {\n      error.message = translatedMessage;\n    }\n  }\n\n  if (field) {\n    error.field = field;\n  }\n\n  if (additionalData) {\n    Object.assign(error, additionalData);\n  }\n\n  return {\n    success: false,\n    error\n  };\n}\n\n/**\n * Create validation error from express-validator result\n * @param {object} validationResult - Express validator result object\n * @returns {object} Formatted validation error\n */\nfunction createValidationError(validationResult) {\n  const errors = validationResult.array();\n  \n  return {\n    success: false,\n    error: {\n      code: ErrorCodes.VALIDATION_ERROR,\n      message: 'Invalid input data',\n      details: errors.map(err => ({\n        field: err.param,\n        message: err.msg,\n        location: err.location\n      }))\n    }\n  };\n}\n\n/**\n * Express middleware to add error response helpers\n * Adds methods to res object for consistent error responses\n */\nfunction errorResponse(req, res, next) {\n  // Get i18n function if available (will be added when we implement backend i18n)\n  const i18n = req.i18n || null;\n\n  /**\n   * Send standardized error response\n   * @param {number} statusCode - HTTP status code\n   * @param {string} errorCode - Error code from ErrorCodes\n   * @param {string} message - Error message\n   * @param {string} field - Optional field name\n   * @param {object} additionalData - Additional error data\n   */\n  res.error = function(statusCode, errorCode, message, field = null, additionalData = null) {\n    const errorData = formatError(errorCode, message, field, additionalData, req.i18n);\n    return this.status(statusCode).json(errorData);\n  };\n\n  /**\n   * Send validation error response\n   * @param {object} validationErrors - Express validator errors\n   */\n  res.validationError = function(validationErrors) {\n    const errorData = createValidationError(validationErrors);\n    return this.status(400).json(errorData);\n  };\n\n  next();\n}\n\n/**\n * Special handler for webhook endpoints that need plain text responses\n * @param {object} res - Express response object\n * @param {number} statusCode - HTTP status code\n * @param {string} message - Error message\n */\nfunction webhookError(res, statusCode, message) {\n  return res.status(statusCode).send(message);\n}\n\nmodule.exports = {\n  ErrorCodes,\n  formatError,\n  createValidationError,\n  errorResponse,\n  webhookError\n};"],"mappings":"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","ignoreList":[]}
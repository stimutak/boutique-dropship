5bac314ddafd80273285cf7b3303d812
const request = require('supertest');
const mongoose = require('mongoose');
const app = require('../../server');
const Order = require('../../models/Order');
const Product = require('../../models/Product');
const User = require('../../models/User');
const jwt = require('jsonwebtoken');
describe('Order Currency Support', () => {
  let authToken;
  let testUser;
  let testProduct;
  beforeAll(async () => {
    // Wait for mongoose connection to be ready
    if (mongoose.connection.readyState !== 1) {
      await new Promise(resolve => {
        mongoose.connection.once('connected', resolve);
      });
    }
  });
  afterAll(async () => {
    // Clean up any remaining data
    await User.deleteMany({});
    await Product.deleteMany({});
    await Order.deleteMany({});
  });
  beforeEach(async () => {
    // Create test user
    testUser = await User.create({
      email: 'test@example.com',
      password: 'Password123!',
      firstName: 'Test',
      lastName: 'User'
    });
    authToken = jwt.sign({
      userId: testUser._id
    }, process.env.JWT_SECRET || 'test-secret');

    // Create test product with multiple currency prices
    testProduct = await Product.create({
      name: 'Test Crystal',
      slug: 'test-crystal',
      description: 'Test description',
      shortDescription: 'Test short description',
      price: 100,
      // USD base price
      prices: {
        USD: 100,
        EUR: 85,
        JPY: 11000,
        CNY: 645
      },
      category: 'crystals',
      isActive: true
    });
  });
  afterEach(async () => {
    await User.deleteMany({});
    await Product.deleteMany({});
    await Order.deleteMany({});
  });
  describe('Guest Checkout', () => {
    it('should capture EUR currency from locale header', async () => {
      const response = await request(app).post('/api/orders/guest').set('x-locale', 'fr') // French locale = EUR
      .send({
        guestInfo: {
          email: 'guest@example.com',
          firstName: 'Guest',
          lastName: 'User',
          phone: '1234567890'
        },
        items: [{
          productId: testProduct._id,
          quantity: 1
        }],
        shippingAddress: {
          firstName: 'Guest',
          lastName: 'User',
          street: '123 Test St',
          city: 'Paris',
          state: 'IDF',
          zipCode: '75001',
          country: 'FR'
        },
        billingAddress: {
          firstName: 'Guest',
          lastName: 'User',
          street: '123 Test St',
          city: 'Paris',
          state: 'IDF',
          zipCode: '75001',
          country: 'FR'
        }
      });
      expect(response.status).toBe(201);
      expect(response.body.order.currency).toBe('EUR');
      expect(response.body.order.exchangeRate).toBe(0.85);
      expect(response.body.order.total).toBeCloseTo(85 * 1.08 + 5.99); // EUR price + tax + shipping
    });
    it('should default to USD when no locale header', async () => {
      const response = await request(app).post('/api/orders/guest').send({
        guestInfo: {
          email: 'guest@example.com',
          firstName: 'Guest',
          lastName: 'User'
        },
        items: [{
          productId: testProduct._id,
          quantity: 1
        }],
        shippingAddress: {
          firstName: 'Guest',
          lastName: 'User',
          street: '123 Test St',
          city: 'New York',
          state: 'NY',
          zipCode: '10001',
          country: 'US'
        },
        billingAddress: {
          firstName: 'Guest',
          lastName: 'User',
          street: '123 Test St',
          city: 'New York',
          state: 'NY',
          zipCode: '10001',
          country: 'US'
        }
      });
      expect(response.status).toBe(201);
      expect(response.body.order.currency).toBe('USD');
      expect(response.body.order.exchangeRate).toBe(1);
    });
  });
  describe('Authenticated Checkout', () => {
    it('should capture JPY currency from locale header', async () => {
      const response = await request(app).post('/api/orders').set('Authorization', `Bearer ${authToken}`).set('x-locale', 'ja') // Japanese locale = JPY
      .send({
        items: [{
          productId: testProduct._id,
          quantity: 2
        }],
        shippingAddress: {
          firstName: 'Test',
          lastName: 'User',
          street: '123 Test St',
          city: 'Tokyo',
          state: 'Tokyo',
          zipCode: '100-0001',
          country: 'JP'
        }
      });
      expect(response.status).toBe(201);
      expect(response.body.order.currency).toBe('JPY');
      expect(response.body.order.exchangeRate).toBe(110);
      // JPY doesn't use decimals, shipping might be different
      expect(response.body.order.total).toBeGreaterThan(20000); // Rough estimate
    });
  });
  describe('Payment Processing', () => {
    it('should send correct currency to payment processor', async () => {
      const order = await Order.create({
        orderNumber: 'TEST-123',
        guestInfo: {
          email: 'test@example.com',
          firstName: 'Test',
          lastName: 'User'
        },
        items: [{
          product: testProduct._id,
          quantity: 1,
          price: 85 // EUR price
        }],
        currency: 'EUR',
        exchangeRate: 0.85,
        subtotal: 85,
        tax: 6.8,
        shipping: 5.99,
        total: 97.79,
        shippingAddress: {
          firstName: 'Test',
          lastName: 'User',
          street: '123 Test St',
          city: 'Paris',
          state: 'IDF',
          zipCode: '75001',
          country: 'FR'
        },
        billingAddress: {
          firstName: 'Test',
          lastName: 'User',
          street: '123 Test St',
          city: 'Paris',
          state: 'IDF',
          zipCode: '75001',
          country: 'FR'
        }
      });

      // Test payment endpoint would use order currency
      // This is a placeholder for the actual payment test
      expect(order.currency).toBe('EUR');
      expect(order.total).toBeCloseTo(97.79);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsIm1vbmdvb3NlIiwiYXBwIiwiT3JkZXIiLCJQcm9kdWN0IiwiVXNlciIsImp3dCIsImRlc2NyaWJlIiwiYXV0aFRva2VuIiwidGVzdFVzZXIiLCJ0ZXN0UHJvZHVjdCIsImJlZm9yZUFsbCIsImNvbm5lY3Rpb24iLCJyZWFkeVN0YXRlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJvbmNlIiwiYWZ0ZXJBbGwiLCJkZWxldGVNYW55IiwiYmVmb3JlRWFjaCIsImNyZWF0ZSIsImVtYWlsIiwicGFzc3dvcmQiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsInNpZ24iLCJ1c2VySWQiLCJfaWQiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsIm5hbWUiLCJzbHVnIiwiZGVzY3JpcHRpb24iLCJzaG9ydERlc2NyaXB0aW9uIiwicHJpY2UiLCJwcmljZXMiLCJVU0QiLCJFVVIiLCJKUFkiLCJDTlkiLCJjYXRlZ29yeSIsImlzQWN0aXZlIiwiYWZ0ZXJFYWNoIiwiaXQiLCJyZXNwb25zZSIsInBvc3QiLCJzZXQiLCJzZW5kIiwiZ3Vlc3RJbmZvIiwicGhvbmUiLCJpdGVtcyIsInByb2R1Y3RJZCIsInF1YW50aXR5Iiwic2hpcHBpbmdBZGRyZXNzIiwic3RyZWV0IiwiY2l0eSIsInN0YXRlIiwiemlwQ29kZSIsImNvdW50cnkiLCJiaWxsaW5nQWRkcmVzcyIsImV4cGVjdCIsInN0YXR1cyIsInRvQmUiLCJib2R5Iiwib3JkZXIiLCJjdXJyZW5jeSIsImV4Y2hhbmdlUmF0ZSIsInRvdGFsIiwidG9CZUNsb3NlVG8iLCJ0b0JlR3JlYXRlclRoYW4iLCJvcmRlck51bWJlciIsInByb2R1Y3QiLCJzdWJ0b3RhbCIsInRheCIsInNoaXBwaW5nIl0sInNvdXJjZXMiOlsib3JkZXJzLWN1cnJlbmN5LnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoJ3N1cGVydGVzdCcpO1xuY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuY29uc3QgYXBwID0gcmVxdWlyZSgnLi4vLi4vc2VydmVyJyk7XG5jb25zdCBPcmRlciA9IHJlcXVpcmUoJy4uLy4uL21vZGVscy9PcmRlcicpO1xuY29uc3QgUHJvZHVjdCA9IHJlcXVpcmUoJy4uLy4uL21vZGVscy9Qcm9kdWN0Jyk7XG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vLi4vbW9kZWxzL1VzZXInKTtcbmNvbnN0IGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpO1xuXG5kZXNjcmliZSgnT3JkZXIgQ3VycmVuY3kgU3VwcG9ydCcsICgpID0+IHtcbiAgbGV0IGF1dGhUb2tlbjtcbiAgbGV0IHRlc3RVc2VyO1xuICBsZXQgdGVzdFByb2R1Y3Q7XG5cbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBXYWl0IGZvciBtb25nb29zZSBjb25uZWN0aW9uIHRvIGJlIHJlYWR5XG4gICAgaWYgKG1vbmdvb3NlLmNvbm5lY3Rpb24ucmVhZHlTdGF0ZSAhPT0gMSkge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIG1vbmdvb3NlLmNvbm5lY3Rpb24ub25jZSgnY29ubmVjdGVkJywgcmVzb2x2ZSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiB1cCBhbnkgcmVtYWluaW5nIGRhdGFcbiAgICBhd2FpdCBVc2VyLmRlbGV0ZU1hbnkoe30pO1xuICAgIGF3YWl0IFByb2R1Y3QuZGVsZXRlTWFueSh7fSk7XG4gICAgYXdhaXQgT3JkZXIuZGVsZXRlTWFueSh7fSk7XG4gIH0pO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIENyZWF0ZSB0ZXN0IHVzZXJcbiAgICB0ZXN0VXNlciA9IGF3YWl0IFVzZXIuY3JlYXRlKHtcbiAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICBwYXNzd29yZDogJ1Bhc3N3b3JkMTIzIScsXG4gICAgICBmaXJzdE5hbWU6ICdUZXN0JyxcbiAgICAgIGxhc3ROYW1lOiAnVXNlcidcbiAgICB9KTtcbiAgICBhdXRoVG9rZW4gPSBqd3Quc2lnbih7IHVzZXJJZDogdGVzdFVzZXIuX2lkIH0sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3Rlc3Qtc2VjcmV0Jyk7XG5cbiAgICAvLyBDcmVhdGUgdGVzdCBwcm9kdWN0IHdpdGggbXVsdGlwbGUgY3VycmVuY3kgcHJpY2VzXG4gICAgdGVzdFByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmNyZWF0ZSh7XG4gICAgICBuYW1lOiAnVGVzdCBDcnlzdGFsJyxcbiAgICAgIHNsdWc6ICd0ZXN0LWNyeXN0YWwnLFxuICAgICAgZGVzY3JpcHRpb246ICdUZXN0IGRlc2NyaXB0aW9uJyxcbiAgICAgIHNob3J0RGVzY3JpcHRpb246ICdUZXN0IHNob3J0IGRlc2NyaXB0aW9uJyxcbiAgICAgIHByaWNlOiAxMDAsIC8vIFVTRCBiYXNlIHByaWNlXG4gICAgICBwcmljZXM6IHtcbiAgICAgICAgVVNEOiAxMDAsXG4gICAgICAgIEVVUjogODUsXG4gICAgICAgIEpQWTogMTEwMDAsXG4gICAgICAgIENOWTogNjQ1XG4gICAgICB9LFxuICAgICAgY2F0ZWdvcnk6ICdjcnlzdGFscycsXG4gICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgIH0pO1xuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IFVzZXIuZGVsZXRlTWFueSh7fSk7XG4gICAgYXdhaXQgUHJvZHVjdC5kZWxldGVNYW55KHt9KTtcbiAgICBhd2FpdCBPcmRlci5kZWxldGVNYW55KHt9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0d1ZXN0IENoZWNrb3V0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FwdHVyZSBFVVIgY3VycmVuY3kgZnJvbSBsb2NhbGUgaGVhZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvb3JkZXJzL2d1ZXN0JylcbiAgICAgICAgLnNldCgneC1sb2NhbGUnLCAnZnInKSAvLyBGcmVuY2ggbG9jYWxlID0gRVVSXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICBndWVzdEluZm86IHtcbiAgICAgICAgICAgIGVtYWlsOiAnZ3Vlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiAnR3Vlc3QnLFxuICAgICAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgICAgICAgIHBob25lOiAnMTIzNDU2Nzg5MCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIGl0ZW1zOiBbe1xuICAgICAgICAgICAgcHJvZHVjdElkOiB0ZXN0UHJvZHVjdC5faWQsXG4gICAgICAgICAgICBxdWFudGl0eTogMVxuICAgICAgICAgIH1dLFxuICAgICAgICAgIHNoaXBwaW5nQWRkcmVzczoge1xuICAgICAgICAgICAgZmlyc3ROYW1lOiAnR3Vlc3QnLFxuICAgICAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgICAgICAgIHN0cmVldDogJzEyMyBUZXN0IFN0JyxcbiAgICAgICAgICAgIGNpdHk6ICdQYXJpcycsXG4gICAgICAgICAgICBzdGF0ZTogJ0lERicsXG4gICAgICAgICAgICB6aXBDb2RlOiAnNzUwMDEnLFxuICAgICAgICAgICAgY291bnRyeTogJ0ZSJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYmlsbGluZ0FkZHJlc3M6IHtcbiAgICAgICAgICAgIGZpcnN0TmFtZTogJ0d1ZXN0JyxcbiAgICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgICBzdHJlZXQ6ICcxMjMgVGVzdCBTdCcsXG4gICAgICAgICAgICBjaXR5OiAnUGFyaXMnLFxuICAgICAgICAgICAgc3RhdGU6ICdJREYnLFxuICAgICAgICAgICAgemlwQ29kZTogJzc1MDAxJyxcbiAgICAgICAgICAgIGNvdW50cnk6ICdGUidcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5vcmRlci5jdXJyZW5jeSkudG9CZSgnRVVSJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5vcmRlci5leGNoYW5nZVJhdGUpLnRvQmUoMC44NSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5vcmRlci50b3RhbCkudG9CZUNsb3NlVG8oODUgKiAxLjA4ICsgNS45OSk7IC8vIEVVUiBwcmljZSArIHRheCArIHNoaXBwaW5nXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlZmF1bHQgdG8gVVNEIHdoZW4gbm8gbG9jYWxlIGhlYWRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL29yZGVycy9ndWVzdCcpXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICBndWVzdEluZm86IHtcbiAgICAgICAgICAgIGVtYWlsOiAnZ3Vlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiAnR3Vlc3QnLFxuICAgICAgICAgICAgbGFzdE5hbWU6ICdVc2VyJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaXRlbXM6IFt7XG4gICAgICAgICAgICBwcm9kdWN0SWQ6IHRlc3RQcm9kdWN0Ll9pZCxcbiAgICAgICAgICAgIHF1YW50aXR5OiAxXG4gICAgICAgICAgfV0sXG4gICAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiB7XG4gICAgICAgICAgICBmaXJzdE5hbWU6ICdHdWVzdCcsXG4gICAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgICAgc3RyZWV0OiAnMTIzIFRlc3QgU3QnLFxuICAgICAgICAgICAgY2l0eTogJ05ldyBZb3JrJyxcbiAgICAgICAgICAgIHN0YXRlOiAnTlknLFxuICAgICAgICAgICAgemlwQ29kZTogJzEwMDAxJyxcbiAgICAgICAgICAgIGNvdW50cnk6ICdVUydcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJpbGxpbmdBZGRyZXNzOiB7XG4gICAgICAgICAgICBmaXJzdE5hbWU6ICdHdWVzdCcsXG4gICAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgICAgc3RyZWV0OiAnMTIzIFRlc3QgU3QnLFxuICAgICAgICAgICAgY2l0eTogJ05ldyBZb3JrJyxcbiAgICAgICAgICAgIHN0YXRlOiAnTlknLFxuICAgICAgICAgICAgemlwQ29kZTogJzEwMDAxJyxcbiAgICAgICAgICAgIGNvdW50cnk6ICdVUydcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5vcmRlci5jdXJyZW5jeSkudG9CZSgnVVNEJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5vcmRlci5leGNoYW5nZVJhdGUpLnRvQmUoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBdXRoZW50aWNhdGVkIENoZWNrb3V0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FwdHVyZSBKUFkgY3VycmVuY3kgZnJvbSBsb2NhbGUgaGVhZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvb3JkZXJzJylcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHthdXRoVG9rZW59YClcbiAgICAgICAgLnNldCgneC1sb2NhbGUnLCAnamEnKSAvLyBKYXBhbmVzZSBsb2NhbGUgPSBKUFlcbiAgICAgICAgLnNlbmQoe1xuICAgICAgICAgIGl0ZW1zOiBbe1xuICAgICAgICAgICAgcHJvZHVjdElkOiB0ZXN0UHJvZHVjdC5faWQsXG4gICAgICAgICAgICBxdWFudGl0eTogMlxuICAgICAgICAgIH1dLFxuICAgICAgICAgIHNoaXBwaW5nQWRkcmVzczoge1xuICAgICAgICAgICAgZmlyc3ROYW1lOiAnVGVzdCcsXG4gICAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgICAgc3RyZWV0OiAnMTIzIFRlc3QgU3QnLFxuICAgICAgICAgICAgY2l0eTogJ1Rva3lvJyxcbiAgICAgICAgICAgIHN0YXRlOiAnVG9reW8nLFxuICAgICAgICAgICAgemlwQ29kZTogJzEwMC0wMDAxJyxcbiAgICAgICAgICAgIGNvdW50cnk6ICdKUCdcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5vcmRlci5jdXJyZW5jeSkudG9CZSgnSlBZJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5vcmRlci5leGNoYW5nZVJhdGUpLnRvQmUoMTEwKTtcbiAgICAgIC8vIEpQWSBkb2Vzbid0IHVzZSBkZWNpbWFscywgc2hpcHBpbmcgbWlnaHQgYmUgZGlmZmVyZW50XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5vcmRlci50b3RhbCkudG9CZUdyZWF0ZXJUaGFuKDIwMDAwKTsgLy8gUm91Z2ggZXN0aW1hdGVcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BheW1lbnQgUHJvY2Vzc2luZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNlbmQgY29ycmVjdCBjdXJyZW5jeSB0byBwYXltZW50IHByb2Nlc3NvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuY3JlYXRlKHtcbiAgICAgICAgb3JkZXJOdW1iZXI6ICdURVNULTEyMycsXG4gICAgICAgIGd1ZXN0SW5mbzoge1xuICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnVGVzdCcsXG4gICAgICAgICAgbGFzdE5hbWU6ICdVc2VyJ1xuICAgICAgICB9LFxuICAgICAgICBpdGVtczogW3tcbiAgICAgICAgICBwcm9kdWN0OiB0ZXN0UHJvZHVjdC5faWQsXG4gICAgICAgICAgcXVhbnRpdHk6IDEsXG4gICAgICAgICAgcHJpY2U6IDg1IC8vIEVVUiBwcmljZVxuICAgICAgICB9XSxcbiAgICAgICAgY3VycmVuY3k6ICdFVVInLFxuICAgICAgICBleGNoYW5nZVJhdGU6IDAuODUsXG4gICAgICAgIHN1YnRvdGFsOiA4NSxcbiAgICAgICAgdGF4OiA2LjgsXG4gICAgICAgIHNoaXBwaW5nOiA1Ljk5LFxuICAgICAgICB0b3RhbDogOTcuNzksXG4gICAgICAgIHNoaXBwaW5nQWRkcmVzczoge1xuICAgICAgICAgIGZpcnN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgc3RyZWV0OiAnMTIzIFRlc3QgU3QnLFxuICAgICAgICAgIGNpdHk6ICdQYXJpcycsXG4gICAgICAgICAgc3RhdGU6ICdJREYnLFxuICAgICAgICAgIHppcENvZGU6ICc3NTAwMScsXG4gICAgICAgICAgY291bnRyeTogJ0ZSJ1xuICAgICAgICB9LFxuICAgICAgICBiaWxsaW5nQWRkcmVzczoge1xuICAgICAgICAgIGZpcnN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgc3RyZWV0OiAnMTIzIFRlc3QgU3QnLFxuICAgICAgICAgIGNpdHk6ICdQYXJpcycsXG4gICAgICAgICAgc3RhdGU6ICdJREYnLFxuICAgICAgICAgIHppcENvZGU6ICc3NTAwMScsXG4gICAgICAgICAgY291bnRyeTogJ0ZSJ1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gVGVzdCBwYXltZW50IGVuZHBvaW50IHdvdWxkIHVzZSBvcmRlciBjdXJyZW5jeVxuICAgICAgLy8gVGhpcyBpcyBhIHBsYWNlaG9sZGVyIGZvciB0aGUgYWN0dWFsIHBheW1lbnQgdGVzdFxuICAgICAgZXhwZWN0KG9yZGVyLmN1cnJlbmN5KS50b0JlKCdFVVInKTtcbiAgICAgIGV4cGVjdChvcmRlci50b3RhbCkudG9CZUNsb3NlVG8oOTcuNzkpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsV0FBVyxDQUFDO0FBQ3BDLE1BQU1DLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUNwQyxNQUFNRSxHQUFHLEdBQUdGLE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDbkMsTUFBTUcsS0FBSyxHQUFHSCxPQUFPLENBQUMsb0JBQW9CLENBQUM7QUFDM0MsTUFBTUksT0FBTyxHQUFHSixPQUFPLENBQUMsc0JBQXNCLENBQUM7QUFDL0MsTUFBTUssSUFBSSxHQUFHTCxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDekMsTUFBTU0sR0FBRyxHQUFHTixPQUFPLENBQUMsY0FBYyxDQUFDO0FBRW5DTyxRQUFRLENBQUMsd0JBQXdCLEVBQUUsTUFBTTtFQUN2QyxJQUFJQyxTQUFTO0VBQ2IsSUFBSUMsUUFBUTtFQUNaLElBQUlDLFdBQVc7RUFFZkMsU0FBUyxDQUFDLFlBQVk7SUFDcEI7SUFDQSxJQUFJVixRQUFRLENBQUNXLFVBQVUsQ0FBQ0MsVUFBVSxLQUFLLENBQUMsRUFBRTtNQUN4QyxNQUFNLElBQUlDLE9BQU8sQ0FBQ0MsT0FBTyxJQUFJO1FBQzNCZCxRQUFRLENBQUNXLFVBQVUsQ0FBQ0ksSUFBSSxDQUFDLFdBQVcsRUFBRUQsT0FBTyxDQUFDO01BQ2hELENBQUMsQ0FBQztJQUNKO0VBQ0YsQ0FBQyxDQUFDO0VBRUZFLFFBQVEsQ0FBQyxZQUFZO0lBQ25CO0lBQ0EsTUFBTVosSUFBSSxDQUFDYSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekIsTUFBTWQsT0FBTyxDQUFDYyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUIsTUFBTWYsS0FBSyxDQUFDZSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7RUFDNUIsQ0FBQyxDQUFDO0VBRUZDLFVBQVUsQ0FBQyxZQUFZO0lBQ3JCO0lBQ0FWLFFBQVEsR0FBRyxNQUFNSixJQUFJLENBQUNlLE1BQU0sQ0FBQztNQUMzQkMsS0FBSyxFQUFFLGtCQUFrQjtNQUN6QkMsUUFBUSxFQUFFLGNBQWM7TUFDeEJDLFNBQVMsRUFBRSxNQUFNO01BQ2pCQyxRQUFRLEVBQUU7SUFDWixDQUFDLENBQUM7SUFDRmhCLFNBQVMsR0FBR0YsR0FBRyxDQUFDbUIsSUFBSSxDQUFDO01BQUVDLE1BQU0sRUFBRWpCLFFBQVEsQ0FBQ2tCO0lBQUksQ0FBQyxFQUFFQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsVUFBVSxJQUFJLGFBQWEsQ0FBQzs7SUFFdkY7SUFDQXBCLFdBQVcsR0FBRyxNQUFNTixPQUFPLENBQUNnQixNQUFNLENBQUM7TUFDakNXLElBQUksRUFBRSxjQUFjO01BQ3BCQyxJQUFJLEVBQUUsY0FBYztNQUNwQkMsV0FBVyxFQUFFLGtCQUFrQjtNQUMvQkMsZ0JBQWdCLEVBQUUsd0JBQXdCO01BQzFDQyxLQUFLLEVBQUUsR0FBRztNQUFFO01BQ1pDLE1BQU0sRUFBRTtRQUNOQyxHQUFHLEVBQUUsR0FBRztRQUNSQyxHQUFHLEVBQUUsRUFBRTtRQUNQQyxHQUFHLEVBQUUsS0FBSztRQUNWQyxHQUFHLEVBQUU7TUFDUCxDQUFDO01BQ0RDLFFBQVEsRUFBRSxVQUFVO01BQ3BCQyxRQUFRLEVBQUU7SUFDWixDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7RUFFRkMsU0FBUyxDQUFDLFlBQVk7SUFDcEIsTUFBTXRDLElBQUksQ0FBQ2EsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pCLE1BQU1kLE9BQU8sQ0FBQ2MsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVCLE1BQU1mLEtBQUssQ0FBQ2UsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0VBQzVCLENBQUMsQ0FBQztFQUVGWCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsTUFBTTtJQUMvQnFDLEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxZQUFZO01BQy9ELE1BQU1DLFFBQVEsR0FBRyxNQUFNOUMsT0FBTyxDQUFDRyxHQUFHLENBQUMsQ0FDaEM0QyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FDekJDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7TUFBQSxDQUN0QkMsSUFBSSxDQUFDO1FBQ0pDLFNBQVMsRUFBRTtVQUNUNUIsS0FBSyxFQUFFLG1CQUFtQjtVQUMxQkUsU0FBUyxFQUFFLE9BQU87VUFDbEJDLFFBQVEsRUFBRSxNQUFNO1VBQ2hCMEIsS0FBSyxFQUFFO1FBQ1QsQ0FBQztRQUNEQyxLQUFLLEVBQUUsQ0FBQztVQUNOQyxTQUFTLEVBQUUxQyxXQUFXLENBQUNpQixHQUFHO1VBQzFCMEIsUUFBUSxFQUFFO1FBQ1osQ0FBQyxDQUFDO1FBQ0ZDLGVBQWUsRUFBRTtVQUNmL0IsU0FBUyxFQUFFLE9BQU87VUFDbEJDLFFBQVEsRUFBRSxNQUFNO1VBQ2hCK0IsTUFBTSxFQUFFLGFBQWE7VUFDckJDLElBQUksRUFBRSxPQUFPO1VBQ2JDLEtBQUssRUFBRSxLQUFLO1VBQ1pDLE9BQU8sRUFBRSxPQUFPO1VBQ2hCQyxPQUFPLEVBQUU7UUFDWCxDQUFDO1FBQ0RDLGNBQWMsRUFBRTtVQUNkckMsU0FBUyxFQUFFLE9BQU87VUFDbEJDLFFBQVEsRUFBRSxNQUFNO1VBQ2hCK0IsTUFBTSxFQUFFLGFBQWE7VUFDckJDLElBQUksRUFBRSxPQUFPO1VBQ2JDLEtBQUssRUFBRSxLQUFLO1VBQ1pDLE9BQU8sRUFBRSxPQUFPO1VBQ2hCQyxPQUFPLEVBQUU7UUFDWDtNQUNGLENBQUMsQ0FBQztNQUVKRSxNQUFNLENBQUNoQixRQUFRLENBQUNpQixNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLEdBQUcsQ0FBQztNQUNqQ0YsTUFBTSxDQUFDaEIsUUFBUSxDQUFDbUIsSUFBSSxDQUFDQyxLQUFLLENBQUNDLFFBQVEsQ0FBQyxDQUFDSCxJQUFJLENBQUMsS0FBSyxDQUFDO01BQ2hERixNQUFNLENBQUNoQixRQUFRLENBQUNtQixJQUFJLENBQUNDLEtBQUssQ0FBQ0UsWUFBWSxDQUFDLENBQUNKLElBQUksQ0FBQyxJQUFJLENBQUM7TUFDbkRGLE1BQU0sQ0FBQ2hCLFFBQVEsQ0FBQ21CLElBQUksQ0FBQ0MsS0FBSyxDQUFDRyxLQUFLLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLEVBQUUsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNuRSxDQUFDLENBQUM7SUFFRnpCLEVBQUUsQ0FBQyw2Q0FBNkMsRUFBRSxZQUFZO01BQzVELE1BQU1DLFFBQVEsR0FBRyxNQUFNOUMsT0FBTyxDQUFDRyxHQUFHLENBQUMsQ0FDaEM0QyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FDekJFLElBQUksQ0FBQztRQUNKQyxTQUFTLEVBQUU7VUFDVDVCLEtBQUssRUFBRSxtQkFBbUI7VUFDMUJFLFNBQVMsRUFBRSxPQUFPO1VBQ2xCQyxRQUFRLEVBQUU7UUFDWixDQUFDO1FBQ0QyQixLQUFLLEVBQUUsQ0FBQztVQUNOQyxTQUFTLEVBQUUxQyxXQUFXLENBQUNpQixHQUFHO1VBQzFCMEIsUUFBUSxFQUFFO1FBQ1osQ0FBQyxDQUFDO1FBQ0ZDLGVBQWUsRUFBRTtVQUNmL0IsU0FBUyxFQUFFLE9BQU87VUFDbEJDLFFBQVEsRUFBRSxNQUFNO1VBQ2hCK0IsTUFBTSxFQUFFLGFBQWE7VUFDckJDLElBQUksRUFBRSxVQUFVO1VBQ2hCQyxLQUFLLEVBQUUsSUFBSTtVQUNYQyxPQUFPLEVBQUUsT0FBTztVQUNoQkMsT0FBTyxFQUFFO1FBQ1gsQ0FBQztRQUNEQyxjQUFjLEVBQUU7VUFDZHJDLFNBQVMsRUFBRSxPQUFPO1VBQ2xCQyxRQUFRLEVBQUUsTUFBTTtVQUNoQitCLE1BQU0sRUFBRSxhQUFhO1VBQ3JCQyxJQUFJLEVBQUUsVUFBVTtVQUNoQkMsS0FBSyxFQUFFLElBQUk7VUFDWEMsT0FBTyxFQUFFLE9BQU87VUFDaEJDLE9BQU8sRUFBRTtRQUNYO01BQ0YsQ0FBQyxDQUFDO01BRUpFLE1BQU0sQ0FBQ2hCLFFBQVEsQ0FBQ2lCLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsR0FBRyxDQUFDO01BQ2pDRixNQUFNLENBQUNoQixRQUFRLENBQUNtQixJQUFJLENBQUNDLEtBQUssQ0FBQ0MsUUFBUSxDQUFDLENBQUNILElBQUksQ0FBQyxLQUFLLENBQUM7TUFDaERGLE1BQU0sQ0FBQ2hCLFFBQVEsQ0FBQ21CLElBQUksQ0FBQ0MsS0FBSyxDQUFDRSxZQUFZLENBQUMsQ0FBQ0osSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNsRCxDQUFDLENBQUM7RUFDSixDQUFDLENBQUM7RUFFRnhELFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxNQUFNO0lBQ3ZDcUMsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLFlBQVk7TUFDL0QsTUFBTUMsUUFBUSxHQUFHLE1BQU05QyxPQUFPLENBQUNHLEdBQUcsQ0FBQyxDQUNoQzRDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FDbkJDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsVUFBVXZDLFNBQVMsRUFBRSxDQUFDLENBQzNDdUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztNQUFBLENBQ3RCQyxJQUFJLENBQUM7UUFDSkcsS0FBSyxFQUFFLENBQUM7VUFDTkMsU0FBUyxFQUFFMUMsV0FBVyxDQUFDaUIsR0FBRztVQUMxQjBCLFFBQVEsRUFBRTtRQUNaLENBQUMsQ0FBQztRQUNGQyxlQUFlLEVBQUU7VUFDZi9CLFNBQVMsRUFBRSxNQUFNO1VBQ2pCQyxRQUFRLEVBQUUsTUFBTTtVQUNoQitCLE1BQU0sRUFBRSxhQUFhO1VBQ3JCQyxJQUFJLEVBQUUsT0FBTztVQUNiQyxLQUFLLEVBQUUsT0FBTztVQUNkQyxPQUFPLEVBQUUsVUFBVTtVQUNuQkMsT0FBTyxFQUFFO1FBQ1g7TUFDRixDQUFDLENBQUM7TUFFSkUsTUFBTSxDQUFDaEIsUUFBUSxDQUFDaUIsTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7TUFDakNGLE1BQU0sQ0FBQ2hCLFFBQVEsQ0FBQ21CLElBQUksQ0FBQ0MsS0FBSyxDQUFDQyxRQUFRLENBQUMsQ0FBQ0gsSUFBSSxDQUFDLEtBQUssQ0FBQztNQUNoREYsTUFBTSxDQUFDaEIsUUFBUSxDQUFDbUIsSUFBSSxDQUFDQyxLQUFLLENBQUNFLFlBQVksQ0FBQyxDQUFDSixJQUFJLENBQUMsR0FBRyxDQUFDO01BQ2xEO01BQ0FGLE1BQU0sQ0FBQ2hCLFFBQVEsQ0FBQ21CLElBQUksQ0FBQ0MsS0FBSyxDQUFDRyxLQUFLLENBQUMsQ0FBQ0UsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDNUQsQ0FBQyxDQUFDO0VBQ0osQ0FBQyxDQUFDO0VBRUYvRCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsTUFBTTtJQUNuQ3FDLEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxZQUFZO01BQ2xFLE1BQU1xQixLQUFLLEdBQUcsTUFBTTlELEtBQUssQ0FBQ2lCLE1BQU0sQ0FBQztRQUMvQm1ELFdBQVcsRUFBRSxVQUFVO1FBQ3ZCdEIsU0FBUyxFQUFFO1VBQ1Q1QixLQUFLLEVBQUUsa0JBQWtCO1VBQ3pCRSxTQUFTLEVBQUUsTUFBTTtVQUNqQkMsUUFBUSxFQUFFO1FBQ1osQ0FBQztRQUNEMkIsS0FBSyxFQUFFLENBQUM7VUFDTnFCLE9BQU8sRUFBRTlELFdBQVcsQ0FBQ2lCLEdBQUc7VUFDeEIwQixRQUFRLEVBQUUsQ0FBQztVQUNYbEIsS0FBSyxFQUFFLEVBQUUsQ0FBQztRQUNaLENBQUMsQ0FBQztRQUNGK0IsUUFBUSxFQUFFLEtBQUs7UUFDZkMsWUFBWSxFQUFFLElBQUk7UUFDbEJNLFFBQVEsRUFBRSxFQUFFO1FBQ1pDLEdBQUcsRUFBRSxHQUFHO1FBQ1JDLFFBQVEsRUFBRSxJQUFJO1FBQ2RQLEtBQUssRUFBRSxLQUFLO1FBQ1pkLGVBQWUsRUFBRTtVQUNmL0IsU0FBUyxFQUFFLE1BQU07VUFDakJDLFFBQVEsRUFBRSxNQUFNO1VBQ2hCK0IsTUFBTSxFQUFFLGFBQWE7VUFDckJDLElBQUksRUFBRSxPQUFPO1VBQ2JDLEtBQUssRUFBRSxLQUFLO1VBQ1pDLE9BQU8sRUFBRSxPQUFPO1VBQ2hCQyxPQUFPLEVBQUU7UUFDWCxDQUFDO1FBQ0RDLGNBQWMsRUFBRTtVQUNkckMsU0FBUyxFQUFFLE1BQU07VUFDakJDLFFBQVEsRUFBRSxNQUFNO1VBQ2hCK0IsTUFBTSxFQUFFLGFBQWE7VUFDckJDLElBQUksRUFBRSxPQUFPO1VBQ2JDLEtBQUssRUFBRSxLQUFLO1VBQ1pDLE9BQU8sRUFBRSxPQUFPO1VBQ2hCQyxPQUFPLEVBQUU7UUFDWDtNQUNGLENBQUMsQ0FBQzs7TUFFRjtNQUNBO01BQ0FFLE1BQU0sQ0FBQ0ksS0FBSyxDQUFDQyxRQUFRLENBQUMsQ0FBQ0gsSUFBSSxDQUFDLEtBQUssQ0FBQztNQUNsQ0YsTUFBTSxDQUFDSSxLQUFLLENBQUNHLEtBQUssQ0FBQyxDQUFDQyxXQUFXLENBQUMsS0FBSyxDQUFDO0lBQ3hDLENBQUMsQ0FBQztFQUNKLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==
dc3822644739841f1a96b67eb4812a49
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const helmet = require('helmet');
const rateLimit = require('express-rate-limit');
const session = require('express-session');
const MongoStore = require('connect-mongo');
const path = require('path');
require('dotenv').config();

// Debug: Log environment variables
console.log('Environment variables loaded:');
console.log('NODE_ENV:', process.env.NODE_ENV);
console.log('PORT:', process.env.PORT);
console.log('JWT_SECRET exists:', !!process.env.JWT_SECRET);
console.log('JWT_SECRET length:', process.env.JWT_SECRET ? process.env.JWT_SECRET.length : 0);

// Validate critical environment variables at startup
if (!process.env.JWT_SECRET && process.env.NODE_ENV !== 'test') {
  console.error('FATAL ERROR: JWT_SECRET environment variable is not set. This is required for secure token generation.');
  process.exit(1);
}
if (!process.env.JWT_SECRET || process.env.JWT_SECRET.length < 32) {
  if (process.env.NODE_ENV !== 'test') {
    console.error('FATAL ERROR: JWT_SECRET must be at least 32 characters long for security.');
    console.error('Current JWT_SECRET length:', process.env.JWT_SECRET ? process.env.JWT_SECRET.length : 0);
    process.exit(1);
  }
}

// Import logging and error handling
const {
  logger
} = require('./utils/logger');
const {
  globalErrorHandler
} = require('./middleware/errorHandler');
const {
  rateLimits,
  speedLimiter,
  sanitizeInput,
  securityHeaders
} = require('./middleware/security');
const app = express();

// Security middleware
app.use(helmet());
app.use(securityHeaders);
app.use(cors({
  origin: process.env.ALLOWED_ORIGINS?.split(',') || ['http://localhost:3000', 'http://localhost:3001', 'http://localhost:3003', 'http://localhost:5173'],
  credentials: true
}));

// Input sanitization
app.use(sanitizeInput);

// General rate limiting
app.use(rateLimits.general);

// Speed limiting for brute force protection
app.use(speedLimiter);

// Import unified session/CSRF management
const {
  createSessionConfig,
  generateCSRFToken,
  validateCSRFToken,
  enhanceGuestSession,
  cleanupGuestSession
} = require('./middleware/sessionCSRF');

// Session middleware with unified config
const mongoUrl = process.env.MONGODB_URI || 'mongodb://localhost:27017/holistic-store';
app.use(session(createSessionConfig(mongoUrl)));

// Session enhancement middleware
app.use(generateCSRFToken);
app.use(enhanceGuestSession);
app.use(cleanupGuestSession);

// Body parsing middleware
app.use(express.json({
  limit: '10mb'
}));
app.use(express.urlencoded({
  extended: true
}));

// Static files
app.use('/uploads', express.static('uploads'));
app.use(express.static('public'));

// Database connection
mongoose.connect(process.env.MONGODB_URI || 'mongodb://localhost:27017/holistic-store', {
  useNewUrlParser: true,
  useUnifiedTopology: true
}).then(() => {
  console.log('Connected to MongoDB');
}).catch(error => {
  console.warn('MongoDB connection failed:', error.message);
  console.warn('Running in development mode without database');
});

// Handle MongoDB connection events
mongoose.connection.on('error', error => {
  console.warn('MongoDB connection error:', error.message);
});
mongoose.connection.on('disconnected', () => {
  console.warn('MongoDB disconnected');
});

// Routes with specific rate limiting
app.use('/api/auth', rateLimits.auth, require('./routes/auth'));
app.use('/api/products', require('./routes/products'));
app.use('/api/cart', require('./routes/cart'));
app.use('/api/orders', require('./routes/orders'));
app.use('/api/payments', rateLimits.payment, require('./routes/payments'));
app.use('/api/wholesalers', require('./routes/wholesalers'));
app.use('/api/integration', rateLimits.integration, require('./routes/integration'));
app.use('/api/admin', rateLimits.admin, require('./routes/admin'));
app.use('/api/monitoring', require('./routes/monitoring'));

// Health check
app.get('/health', (req, res) => {
  res.json({
    status: 'OK',
    timestamp: new Date().toISOString()
  });
});

// CSRF token endpoint
app.get('/api/csrf-token', (req, res) => {
  res.json({
    success: true,
    csrfToken: req.session.csrfToken,
    sessionInfo: {
      isGuest: !req.user && !!req.session.guestId,
      hasCart: !!req.session.cart && !!req.session.cart.items && req.session.cart.items.length > 0
    }
  });
});

// Root route for API info
app.get('/', (req, res) => {
  res.json({
    message: 'Holistic Dropship Store API',
    version: '1.0.0',
    endpoints: {
      health: '/health',
      auth: '/api/auth',
      products: '/api/products',
      cart: '/api/cart',
      orders: '/api/orders',
      payments: '/api/payments'
    },
    frontend: process.env.FRONTEND_URL || 'http://localhost:3000'
  });
});

// Global error handling middleware (must be last)
app.use(globalErrorHandler);

// Serve React app in production
if (process.env.NODE_ENV === 'production') {
  app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, 'build', 'index.html'));
  });
}
const PORT = process.env.PORT || 5001;

// Only start server if not in test mode
if (process.env.NODE_ENV !== 'test') {
  app.listen(PORT, () => {
    logger.info(`Server running on port ${PORT}`);
  });
}

// Export app for testing
module.exports = app;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsIm1vbmdvb3NlIiwiY29ycyIsImhlbG1ldCIsInJhdGVMaW1pdCIsInNlc3Npb24iLCJNb25nb1N0b3JlIiwicGF0aCIsImNvbmZpZyIsImNvbnNvbGUiLCJsb2ciLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJQT1JUIiwiSldUX1NFQ1JFVCIsImxlbmd0aCIsImVycm9yIiwiZXhpdCIsImxvZ2dlciIsImdsb2JhbEVycm9ySGFuZGxlciIsInJhdGVMaW1pdHMiLCJzcGVlZExpbWl0ZXIiLCJzYW5pdGl6ZUlucHV0Iiwic2VjdXJpdHlIZWFkZXJzIiwiYXBwIiwidXNlIiwib3JpZ2luIiwiQUxMT1dFRF9PUklHSU5TIiwic3BsaXQiLCJjcmVkZW50aWFscyIsImdlbmVyYWwiLCJjcmVhdGVTZXNzaW9uQ29uZmlnIiwiZ2VuZXJhdGVDU1JGVG9rZW4iLCJ2YWxpZGF0ZUNTUkZUb2tlbiIsImVuaGFuY2VHdWVzdFNlc3Npb24iLCJjbGVhbnVwR3Vlc3RTZXNzaW9uIiwibW9uZ29VcmwiLCJNT05HT0RCX1VSSSIsImpzb24iLCJsaW1pdCIsInVybGVuY29kZWQiLCJleHRlbmRlZCIsInN0YXRpYyIsImNvbm5lY3QiLCJ1c2VOZXdVcmxQYXJzZXIiLCJ1c2VVbmlmaWVkVG9wb2xvZ3kiLCJ0aGVuIiwiY2F0Y2giLCJ3YXJuIiwibWVzc2FnZSIsImNvbm5lY3Rpb24iLCJvbiIsImF1dGgiLCJwYXltZW50IiwiaW50ZWdyYXRpb24iLCJhZG1pbiIsImdldCIsInJlcSIsInJlcyIsInN0YXR1cyIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInN1Y2Nlc3MiLCJjc3JmVG9rZW4iLCJzZXNzaW9uSW5mbyIsImlzR3Vlc3QiLCJ1c2VyIiwiZ3Vlc3RJZCIsImhhc0NhcnQiLCJjYXJ0IiwiaXRlbXMiLCJ2ZXJzaW9uIiwiZW5kcG9pbnRzIiwiaGVhbHRoIiwicHJvZHVjdHMiLCJvcmRlcnMiLCJwYXltZW50cyIsImZyb250ZW5kIiwiRlJPTlRFTkRfVVJMIiwic2VuZEZpbGUiLCJqb2luIiwiX19kaXJuYW1lIiwibGlzdGVuIiwiaW5mbyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJzZXJ2ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcbmNvbnN0IGNvcnMgPSByZXF1aXJlKCdjb3JzJyk7XG5jb25zdCBoZWxtZXQgPSByZXF1aXJlKCdoZWxtZXQnKTtcbmNvbnN0IHJhdGVMaW1pdCA9IHJlcXVpcmUoJ2V4cHJlc3MtcmF0ZS1saW1pdCcpO1xuY29uc3Qgc2Vzc2lvbiA9IHJlcXVpcmUoJ2V4cHJlc3Mtc2Vzc2lvbicpO1xuY29uc3QgTW9uZ29TdG9yZSA9IHJlcXVpcmUoJ2Nvbm5lY3QtbW9uZ28nKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5yZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKTtcblxuLy8gRGVidWc6IExvZyBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbmNvbnNvbGUubG9nKCdFbnZpcm9ubWVudCB2YXJpYWJsZXMgbG9hZGVkOicpO1xuY29uc29sZS5sb2coJ05PREVfRU5WOicsIHByb2Nlc3MuZW52Lk5PREVfRU5WKTtcbmNvbnNvbGUubG9nKCdQT1JUOicsIHByb2Nlc3MuZW52LlBPUlQpO1xuY29uc29sZS5sb2coJ0pXVF9TRUNSRVQgZXhpc3RzOicsICEhcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XG5jb25zb2xlLmxvZygnSldUX1NFQ1JFVCBsZW5ndGg6JywgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCA/IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQubGVuZ3RoIDogMCk7XG5cbi8vIFZhbGlkYXRlIGNyaXRpY2FsIGVudmlyb25tZW50IHZhcmlhYmxlcyBhdCBzdGFydHVwXG5pZiAoIXByb2Nlc3MuZW52LkpXVF9TRUNSRVQgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0Jykge1xuICBjb25zb2xlLmVycm9yKCdGQVRBTCBFUlJPUjogSldUX1NFQ1JFVCBlbnZpcm9ubWVudCB2YXJpYWJsZSBpcyBub3Qgc2V0LiBUaGlzIGlzIHJlcXVpcmVkIGZvciBzZWN1cmUgdG9rZW4gZ2VuZXJhdGlvbi4nKTtcbiAgcHJvY2Vzcy5leGl0KDEpO1xufVxuXG5pZiAoIXByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVC5sZW5ndGggPCAzMikge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0Jykge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0ZBVEFMIEVSUk9SOiBKV1RfU0VDUkVUIG11c3QgYmUgYXQgbGVhc3QgMzIgY2hhcmFjdGVycyBsb25nIGZvciBzZWN1cml0eS4nKTtcbiAgICBjb25zb2xlLmVycm9yKCdDdXJyZW50IEpXVF9TRUNSRVQgbGVuZ3RoOicsIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgPyBwcm9jZXNzLmVudi5KV1RfU0VDUkVULmxlbmd0aCA6IDApO1xuICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgfVxufVxuXG4vLyBJbXBvcnQgbG9nZ2luZyBhbmQgZXJyb3IgaGFuZGxpbmdcbmNvbnN0IHsgbG9nZ2VyIH0gPSByZXF1aXJlKCcuL3V0aWxzL2xvZ2dlcicpO1xuY29uc3QgeyBnbG9iYWxFcnJvckhhbmRsZXIgfSA9IHJlcXVpcmUoJy4vbWlkZGxld2FyZS9lcnJvckhhbmRsZXInKTtcbmNvbnN0IHsgXG4gIHJhdGVMaW1pdHMsIFxuICBzcGVlZExpbWl0ZXIsIFxuICBzYW5pdGl6ZUlucHV0LCBcbiAgc2VjdXJpdHlIZWFkZXJzIFxufSA9IHJlcXVpcmUoJy4vbWlkZGxld2FyZS9zZWN1cml0eScpO1xuXG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG5cbi8vIFNlY3VyaXR5IG1pZGRsZXdhcmVcbmFwcC51c2UoaGVsbWV0KCkpO1xuYXBwLnVzZShzZWN1cml0eUhlYWRlcnMpO1xuYXBwLnVzZShjb3JzKHtcbiAgb3JpZ2luOiBwcm9jZXNzLmVudi5BTExPV0VEX09SSUdJTlM/LnNwbGl0KCcsJykgfHwgWydodHRwOi8vbG9jYWxob3N0OjMwMDAnLCAnaHR0cDovL2xvY2FsaG9zdDozMDAxJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMycsICdodHRwOi8vbG9jYWxob3N0OjUxNzMnXSxcbiAgY3JlZGVudGlhbHM6IHRydWVcbn0pKTtcblxuLy8gSW5wdXQgc2FuaXRpemF0aW9uXG5hcHAudXNlKHNhbml0aXplSW5wdXQpO1xuXG4vLyBHZW5lcmFsIHJhdGUgbGltaXRpbmdcbmFwcC51c2UocmF0ZUxpbWl0cy5nZW5lcmFsKTtcblxuLy8gU3BlZWQgbGltaXRpbmcgZm9yIGJydXRlIGZvcmNlIHByb3RlY3Rpb25cbmFwcC51c2Uoc3BlZWRMaW1pdGVyKTtcblxuLy8gSW1wb3J0IHVuaWZpZWQgc2Vzc2lvbi9DU1JGIG1hbmFnZW1lbnRcbmNvbnN0IHsgXG4gIGNyZWF0ZVNlc3Npb25Db25maWcsIFxuICBnZW5lcmF0ZUNTUkZUb2tlbixcbiAgdmFsaWRhdGVDU1JGVG9rZW4sXG4gIGVuaGFuY2VHdWVzdFNlc3Npb24sXG4gIGNsZWFudXBHdWVzdFNlc3Npb24gXG59ID0gcmVxdWlyZSgnLi9taWRkbGV3YXJlL3Nlc3Npb25DU1JGJyk7XG5cbi8vIFNlc3Npb24gbWlkZGxld2FyZSB3aXRoIHVuaWZpZWQgY29uZmlnXG5jb25zdCBtb25nb1VybCA9IHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJIHx8ICdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3L2hvbGlzdGljLXN0b3JlJztcbmFwcC51c2Uoc2Vzc2lvbihjcmVhdGVTZXNzaW9uQ29uZmlnKG1vbmdvVXJsKSkpO1xuXG4vLyBTZXNzaW9uIGVuaGFuY2VtZW50IG1pZGRsZXdhcmVcbmFwcC51c2UoZ2VuZXJhdGVDU1JGVG9rZW4pO1xuYXBwLnVzZShlbmhhbmNlR3Vlc3RTZXNzaW9uKTtcbmFwcC51c2UoY2xlYW51cEd1ZXN0U2Vzc2lvbik7XG5cbi8vIEJvZHkgcGFyc2luZyBtaWRkbGV3YXJlXG5hcHAudXNlKGV4cHJlc3MuanNvbih7IGxpbWl0OiAnMTBtYicgfSkpO1xuYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogdHJ1ZSB9KSk7XG5cbi8vIFN0YXRpYyBmaWxlc1xuYXBwLnVzZSgnL3VwbG9hZHMnLCBleHByZXNzLnN0YXRpYygndXBsb2FkcycpKTtcbmFwcC51c2UoZXhwcmVzcy5zdGF0aWMoJ3B1YmxpYycpKTtcblxuLy8gRGF0YWJhc2UgY29ubmVjdGlvblxubW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSB8fCAnbW9uZ29kYjovL2xvY2FsaG9zdDoyNzAxNy9ob2xpc3RpYy1zdG9yZScsIHtcbiAgdXNlTmV3VXJsUGFyc2VyOiB0cnVlLFxuICB1c2VVbmlmaWVkVG9wb2xvZ3k6IHRydWVcbn0pLnRoZW4oKCkgPT4ge1xuICBjb25zb2xlLmxvZygnQ29ubmVjdGVkIHRvIE1vbmdvREInKTtcbn0pLmNhdGNoKChlcnJvcikgPT4ge1xuICBjb25zb2xlLndhcm4oJ01vbmdvREIgY29ubmVjdGlvbiBmYWlsZWQ6JywgZXJyb3IubWVzc2FnZSk7XG4gIGNvbnNvbGUud2FybignUnVubmluZyBpbiBkZXZlbG9wbWVudCBtb2RlIHdpdGhvdXQgZGF0YWJhc2UnKTtcbn0pO1xuXG4vLyBIYW5kbGUgTW9uZ29EQiBjb25uZWN0aW9uIGV2ZW50c1xubW9uZ29vc2UuY29ubmVjdGlvbi5vbignZXJyb3InLCAoZXJyb3IpID0+IHtcbiAgY29uc29sZS53YXJuKCdNb25nb0RCIGNvbm5lY3Rpb24gZXJyb3I6JywgZXJyb3IubWVzc2FnZSk7XG59KTtcblxubW9uZ29vc2UuY29ubmVjdGlvbi5vbignZGlzY29ubmVjdGVkJywgKCkgPT4ge1xuICBjb25zb2xlLndhcm4oJ01vbmdvREIgZGlzY29ubmVjdGVkJyk7XG59KTtcblxuLy8gUm91dGVzIHdpdGggc3BlY2lmaWMgcmF0ZSBsaW1pdGluZ1xuYXBwLnVzZSgnL2FwaS9hdXRoJywgcmF0ZUxpbWl0cy5hdXRoLCByZXF1aXJlKCcuL3JvdXRlcy9hdXRoJykpO1xuYXBwLnVzZSgnL2FwaS9wcm9kdWN0cycsIHJlcXVpcmUoJy4vcm91dGVzL3Byb2R1Y3RzJykpO1xuYXBwLnVzZSgnL2FwaS9jYXJ0JywgcmVxdWlyZSgnLi9yb3V0ZXMvY2FydCcpKTtcbmFwcC51c2UoJy9hcGkvb3JkZXJzJywgcmVxdWlyZSgnLi9yb3V0ZXMvb3JkZXJzJykpO1xuYXBwLnVzZSgnL2FwaS9wYXltZW50cycsIHJhdGVMaW1pdHMucGF5bWVudCwgcmVxdWlyZSgnLi9yb3V0ZXMvcGF5bWVudHMnKSk7XG5hcHAudXNlKCcvYXBpL3dob2xlc2FsZXJzJywgcmVxdWlyZSgnLi9yb3V0ZXMvd2hvbGVzYWxlcnMnKSk7XG5hcHAudXNlKCcvYXBpL2ludGVncmF0aW9uJywgcmF0ZUxpbWl0cy5pbnRlZ3JhdGlvbiwgcmVxdWlyZSgnLi9yb3V0ZXMvaW50ZWdyYXRpb24nKSk7XG5hcHAudXNlKCcvYXBpL2FkbWluJywgcmF0ZUxpbWl0cy5hZG1pbiwgcmVxdWlyZSgnLi9yb3V0ZXMvYWRtaW4nKSk7XG5hcHAudXNlKCcvYXBpL21vbml0b3JpbmcnLCByZXF1aXJlKCcuL3JvdXRlcy9tb25pdG9yaW5nJykpO1xuXG4vLyBIZWFsdGggY2hlY2tcbmFwcC5nZXQoJy9oZWFsdGgnLCAocmVxLCByZXMpID0+IHtcbiAgcmVzLmpzb24oeyBzdGF0dXM6ICdPSycsIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0pO1xufSk7XG5cbi8vIENTUkYgdG9rZW4gZW5kcG9pbnRcbmFwcC5nZXQoJy9hcGkvY3NyZi10b2tlbicsIChyZXEsIHJlcykgPT4ge1xuICByZXMuanNvbih7IFxuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgY3NyZlRva2VuOiByZXEuc2Vzc2lvbi5jc3JmVG9rZW4sXG4gICAgc2Vzc2lvbkluZm86IHtcbiAgICAgIGlzR3Vlc3Q6ICFyZXEudXNlciAmJiAhIXJlcS5zZXNzaW9uLmd1ZXN0SWQsXG4gICAgICBoYXNDYXJ0OiAhIXJlcS5zZXNzaW9uLmNhcnQgJiYgISFyZXEuc2Vzc2lvbi5jYXJ0Lml0ZW1zICYmIHJlcS5zZXNzaW9uLmNhcnQuaXRlbXMubGVuZ3RoID4gMFxuICAgIH1cbiAgfSk7XG59KTtcblxuLy8gUm9vdCByb3V0ZSBmb3IgQVBJIGluZm9cbmFwcC5nZXQoJy8nLCAocmVxLCByZXMpID0+IHtcbiAgcmVzLmpzb24oe1xuICAgIG1lc3NhZ2U6ICdIb2xpc3RpYyBEcm9wc2hpcCBTdG9yZSBBUEknLFxuICAgIHZlcnNpb246ICcxLjAuMCcsXG4gICAgZW5kcG9pbnRzOiB7XG4gICAgICBoZWFsdGg6ICcvaGVhbHRoJyxcbiAgICAgIGF1dGg6ICcvYXBpL2F1dGgnLFxuICAgICAgcHJvZHVjdHM6ICcvYXBpL3Byb2R1Y3RzJyxcbiAgICAgIGNhcnQ6ICcvYXBpL2NhcnQnLFxuICAgICAgb3JkZXJzOiAnL2FwaS9vcmRlcnMnLFxuICAgICAgcGF5bWVudHM6ICcvYXBpL3BheW1lbnRzJ1xuICAgIH0sXG4gICAgZnJvbnRlbmQ6IHByb2Nlc3MuZW52LkZST05URU5EX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJ1xuICB9KTtcbn0pO1xuXG4vLyBHbG9iYWwgZXJyb3IgaGFuZGxpbmcgbWlkZGxld2FyZSAobXVzdCBiZSBsYXN0KVxuYXBwLnVzZShnbG9iYWxFcnJvckhhbmRsZXIpO1xuXG4vLyBTZXJ2ZSBSZWFjdCBhcHAgaW4gcHJvZHVjdGlvblxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgYXBwLmdldCgnKicsIChyZXEsIHJlcykgPT4ge1xuICAgIHJlcy5zZW5kRmlsZShwYXRoLmpvaW4oX19kaXJuYW1lLCAnYnVpbGQnLCAnaW5kZXguaHRtbCcpKTtcbiAgfSk7XG59XG5cbmNvbnN0IFBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDUwMDE7XG5cbi8vIE9ubHkgc3RhcnQgc2VydmVyIGlmIG5vdCBpbiB0ZXN0IG1vZGVcbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Rlc3QnKSB7XG4gIGFwcC5saXN0ZW4oUE9SVCwgKCkgPT4ge1xuICAgIGxvZ2dlci5pbmZvKGBTZXJ2ZXIgcnVubmluZyBvbiBwb3J0ICR7UE9SVH1gKTtcbiAgfSk7XG59XG5cbi8vIEV4cG9ydCBhcHAgZm9yIHRlc3Rpbmdcbm1vZHVsZS5leHBvcnRzID0gYXBwOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUNwQyxNQUFNRSxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFDNUIsTUFBTUcsTUFBTSxHQUFHSCxPQUFPLENBQUMsUUFBUSxDQUFDO0FBQ2hDLE1BQU1JLFNBQVMsR0FBR0osT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBQy9DLE1BQU1LLE9BQU8sR0FBR0wsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0FBQzFDLE1BQU1NLFVBQVUsR0FBR04sT0FBTyxDQUFDLGVBQWUsQ0FBQztBQUMzQyxNQUFNTyxJQUFJLEdBQUdQLE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFDNUJBLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQ1EsTUFBTSxDQUFDLENBQUM7O0FBRTFCO0FBQ0FDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLCtCQUErQixDQUFDO0FBQzVDRCxPQUFPLENBQUNDLEdBQUcsQ0FBQyxXQUFXLEVBQUVDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxRQUFRLENBQUM7QUFDOUNKLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLE9BQU8sRUFBRUMsT0FBTyxDQUFDQyxHQUFHLENBQUNFLElBQUksQ0FBQztBQUN0Q0wsT0FBTyxDQUFDQyxHQUFHLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0csVUFBVSxDQUFDO0FB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
da7b7efddd9fc9b7c3a5216cd45d321b
const express = require('express');
const router = express.Router();
const {
  body,
  validationResult
} = require('express-validator');
const Order = require('../models/Order');
const Product = require('../models/Product');
const User = require('../models/User');
const {
  authenticateToken,
  requireAuth
} = require('../middleware/auth');
const {
  validateCSRFToken
} = require('../middleware/sessionCSRF');

// Validation middleware for guest checkout
const validateGuestCheckout = [body('guestInfo.email').isEmail().normalizeEmail().withMessage('Valid email is required'), body('guestInfo.firstName').trim().isLength({
  min: 1,
  max: 50
}).withMessage('First name is required and must be less than 50 characters'), body('guestInfo.lastName').trim().isLength({
  min: 1,
  max: 50
}).withMessage('Last name is required and must be less than 50 characters'), body('guestInfo.phone').optional().isString().isLength({
  min: 7,
  max: 30
}).withMessage('Phone number must be between 7 and 30 characters'), body('shippingAddress.firstName').trim().isLength({
  min: 1,
  max: 50
}).withMessage('Shipping first name is required'), body('shippingAddress.lastName').trim().isLength({
  min: 1,
  max: 50
}).withMessage('Shipping last name is required'), body('shippingAddress.street').trim().isLength({
  min: 1,
  max: 100
}).withMessage('Shipping street address is required'), body('shippingAddress.city').trim().isLength({
  min: 1,
  max: 50
}).withMessage('Shipping city is required'), body('shippingAddress.state').trim().isLength({
  min: 2,
  max: 50
}).withMessage('Shipping state is required'), body('shippingAddress.zipCode').trim().isLength({
  min: 5,
  max: 10
}).withMessage('Valid shipping zip code is required'), body('shippingAddress.country').trim().isLength({
  min: 2,
  max: 50
}).withMessage('Valid country code is required'), body('billingAddress.firstName').trim().isLength({
  min: 1,
  max: 50
}).withMessage('Billing first name is required'), body('billingAddress.lastName').trim().isLength({
  min: 1,
  max: 50
}).withMessage('Billing last name is required'), body('billingAddress.street').trim().isLength({
  min: 1,
  max: 100
}).withMessage('Billing street address is required'), body('billingAddress.city').trim().isLength({
  min: 1,
  max: 50
}).withMessage('Billing city is required'), body('billingAddress.state').trim().isLength({
  min: 2,
  max: 50
}).withMessage('Billing state is required'), body('billingAddress.zipCode').trim().isLength({
  min: 5,
  max: 10
}).withMessage('Valid billing zip code is required'), body('billingAddress.country').trim().isLength({
  min: 2,
  max: 50
}).withMessage('Valid country code is required'), body('items').isArray({
  min: 1
}).withMessage('At least one item is required'), body('items.*.productId').isMongoId().withMessage('Valid product ID is required'), body('items.*.quantity').isInt({
  min: 1,
  max: 99
}).withMessage('Quantity must be between 1 and 99'), body('referralSource').optional().trim().isLength({
  max: 100
}).withMessage('Referral source must be less than 100 characters')];

// Create order (both guest and authenticated)
router.post('/', authenticateToken, validateGuestCheckout, validateCSRFToken, async (req, res) => {
  try {
    // Check validation errors
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'VALIDATION_ERROR',
          message: 'Invalid input data',
          details: errors.array()
        }
      });
    }
    const {
      guestInfo,
      shippingAddress,
      billingAddress,
      items: requestItems,
      notes,
      referralSource
    } = req.body;

    // Validate and process cart items - FIXED N+1 QUERY
    const orderItems = [];
    let subtotal = 0;

    // Batch fetch all products at once to avoid N+1 queries
    const productIds = requestItems.map(item => item.productId);
    const products = await Product.find({
      _id: {
        $in: productIds
      }
    });
    const productMap = new Map(products.map(p => [p._id.toString(), p]));
    for (const item of requestItems) {
      const product = productMap.get(item.productId);
      if (!product || !product.isActive) {
        return res.status(400).json({
          success: false,
          error: {
            code: 'INVALID_PRODUCT',
            message: `Product ${item.productId} not found or unavailable`
          }
        });
      }
      const itemTotal = product.price * item.quantity;
      subtotal += itemTotal;
      orderItems.push({
        product: product._id,
        quantity: item.quantity,
        price: product.price,
        wholesaler: {
          name: product.wholesaler.name,
          email: product.wholesaler.email,
          productCode: product.wholesaler.productCode,
          notified: false
        }
      });
    }

    // Calculate totals (simplified - you may want to add tax calculation)
    const tax = Math.round(subtotal * 0.08 * 100) / 100; // 8% tax rate
    const shipping = subtotal > 50 ? 0 : 5.99; // Free shipping over $50
    const total = Math.round((subtotal + tax + shipping) * 100) / 100;

    // Create order
    const orderData = {
      items: orderItems,
      shippingAddress,
      billingAddress,
      subtotal: Math.round(subtotal * 100) / 100,
      tax,
      shipping,
      total,
      payment: {
        method: 'other',
        // Will be updated when payment is processed
        status: 'pending'
      },
      status: 'pending',
      notes,
      referralSource
    };

    // Add customer ID if user is authenticated
    if (req.user) {
      orderData.customer = req.user._id;
      // For registered users, populate guest info from their profile
      orderData.guestInfo = {
        firstName: req.user.firstName,
        lastName: req.user.lastName,
        email: req.user.email,
        phone: req.user.phone || guestInfo?.phone
      };
    } else {
      // For guest checkout, use provided guest info
      orderData.guestInfo = guestInfo;
    }
    const order = await Order.create(orderData);

    // Populate product details for email
    await order.populate('items.product', 'name slug images');

    // Send order confirmation email
    try {
      const {
        sendOrderConfirmation
      } = require('../utils/emailService');
      const emailData = {
        orderNumber: order.orderNumber,
        customerName: `${order.guestInfo.firstName} ${order.guestInfo.lastName}`,
        items: order.items.map(item => ({
          productName: item.product.name,
          quantity: item.quantity,
          price: item.price
        })),
        total: order.total,
        shippingAddress: order.shippingAddress
      };
      const emailResult = await sendOrderConfirmation(order.guestInfo.email, emailData);
      if (!emailResult.success) {
        console.error('Failed to send order confirmation email:', emailResult.error);
      }
    } catch (emailError) {
      console.error('Error sending order confirmation email:', emailError);
    }

    // Note: Cart will be cleared after successful payment, not here
    // This allows users to retry payment if it fails

    res.status(201).json({
      success: true,
      message: 'Order created successfully',
      order: {
        _id: order._id,
        orderNumber: order.orderNumber,
        total: order.total,
        status: order.status,
        createdAt: order.createdAt
      }
    });
  } catch (error) {
    console.error('Error creating order:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'ORDER_CREATION_ERROR',
        message: 'Failed to create order'
      }
    });
  }
});

// Create order (guest checkout) - explicit guest route
router.post('/guest', validateGuestCheckout, async (req, res) => {
  try {
    // Check validation errors
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'VALIDATION_ERROR',
          message: 'Invalid input data',
          details: errors.array()
        }
      });
    }
    const {
      guestInfo,
      shippingAddress,
      billingAddress,
      items: requestItems,
      notes,
      referralSource
    } = req.body;

    // Validate and process cart items - FIXED N+1 QUERY
    const orderItems = [];
    let subtotal = 0;

    // Batch fetch all products at once to avoid N+1 queries
    const productIds = requestItems.map(item => item.productId);
    const products = await Product.find({
      _id: {
        $in: productIds
      }
    });
    const productMap = new Map(products.map(p => [p._id.toString(), p]));
    for (const item of requestItems) {
      const product = productMap.get(item.productId);
      if (!product || !product.isActive) {
        return res.status(400).json({
          success: false,
          error: {
            code: 'INVALID_PRODUCT',
            message: `Product ${item.productId} not found or unavailable`
          }
        });
      }
      const itemTotal = product.price * item.quantity;
      subtotal += itemTotal;
      orderItems.push({
        product: product._id,
        quantity: item.quantity,
        price: product.price,
        wholesaler: {
          name: product.wholesaler.name,
          email: product.wholesaler.email,
          productCode: product.wholesaler.productCode,
          notified: false,
          notificationAttempts: 0
        }
      });
    }

    // Calculate totals
    const tax = subtotal * 0.08; // 8% tax rate
    const shipping = subtotal > 50 ? 0 : 9.99; // Free shipping over $50
    const total = subtotal + tax + shipping;

    // Create order
    const orderData = {
      guestInfo,
      items: orderItems,
      shippingAddress,
      billingAddress: billingAddress || shippingAddress,
      subtotal,
      tax,
      shipping,
      total,
      payment: {
        method: 'card',
        status: 'pending'
      },
      status: 'pending',
      notes,
      referralSource
    };
    const order = await Order.create(orderData);
    res.status(201).json({
      success: true,
      message: 'Guest order created successfully',
      data: {
        order: {
          _id: order._id,
          orderNumber: order.orderNumber,
          guestInfo: order.guestInfo,
          items: order.items,
          shippingAddress: order.shippingAddress,
          billingAddress: order.billingAddress,
          subtotal: order.subtotal,
          tax: order.tax,
          shipping: order.shipping,
          total: order.total,
          status: order.status,
          createdAt: order.createdAt
        }
      }
    });
  } catch (error) {
    console.error('Error creating guest order:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'ORDER_CREATION_ERROR',
        message: 'Failed to create guest order'
      }
    });
  }
});

// Create order for registered user
router.post('/registered', authenticateToken, validateCSRFToken, async (req, res) => {
  try {
    // Ensure user is authenticated
    if (!req.user) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'AUTHENTICATION_REQUIRED',
          message: 'You must be logged in to place an order'
        }
      });
    }
    const {
      shippingAddress,
      billingAddress,
      items: requestItems,
      notes,
      referralSource,
      useDefaultAddresses = false
    } = req.body;

    // Use default addresses if requested and available
    let finalShippingAddress = shippingAddress;
    let finalBillingAddress = billingAddress;
    if (useDefaultAddresses) {
      const defaultShipping = req.user.getDefaultShippingAddress();
      const defaultBilling = req.user.getDefaultBillingAddress();
      if (defaultShipping) {
        finalShippingAddress = defaultShipping.toObject();
        delete finalShippingAddress._id;
        delete finalShippingAddress.type;
        delete finalShippingAddress.isDefault;
      }
      if (defaultBilling) {
        finalBillingAddress = defaultBilling.toObject();
        delete finalBillingAddress._id;
        delete finalBillingAddress.type;
        delete finalBillingAddress.isDefault;
      }
    }

    // Validate required addresses
    if (!finalShippingAddress || !finalBillingAddress) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'MISSING_ADDRESSES',
          message: 'Shipping and billing addresses are required'
        }
      });
    }

    // Get items from user's cart if not provided
    let itemsToProcess = requestItems;
    if (!itemsToProcess || itemsToProcess.length === 0) {
      // Fetch from user's cart
      const user = await User.findById(req.user._id);
      if (!user.cart || !user.cart.items || user.cart.items.length === 0) {
        return res.status(400).json({
          success: false,
          error: {
            code: 'EMPTY_CART',
            message: 'Your cart is empty'
          }
        });
      }
      itemsToProcess = user.cart.items.map(item => ({
        productId: item.product,
        quantity: item.quantity
      }));
    }

    // Validate and process cart items (same logic as guest checkout)
    const orderItems = [];
    let subtotal = 0;
    for (const item of itemsToProcess) {
      const product = await Product.findById(item.productId);
      if (!product || !product.isActive) {
        return res.status(400).json({
          success: false,
          error: {
            code: 'INVALID_PRODUCT',
            message: `Product ${item.productId} not found or unavailable`
          }
        });
      }
      const itemTotal = product.price * item.quantity;
      subtotal += itemTotal;
      orderItems.push({
        product: product._id,
        quantity: item.quantity,
        price: product.price,
        wholesaler: {
          name: product.wholesaler.name,
          email: product.wholesaler.email,
          productCode: product.wholesaler.productCode,
          notified: false
        }
      });
    }

    // Calculate totals
    const tax = Math.round(subtotal * 0.08 * 100) / 100;
    const shipping = subtotal > 50 ? 0 : 5.99;
    const total = Math.round((subtotal + tax + shipping) * 100) / 100;

    // Create order for registered user
    const orderData = {
      customer: req.user._id,
      items: orderItems,
      shippingAddress: finalShippingAddress,
      billingAddress: finalBillingAddress,
      subtotal: Math.round(subtotal * 100) / 100,
      tax,
      shipping,
      total,
      payment: {
        method: 'other',
        status: 'pending'
      },
      status: 'pending',
      notes,
      referralSource
    };
    const order = await Order.create(orderData);

    // Populate product details for email
    await order.populate('items.product', 'name slug images');

    // Send order confirmation email for registered user
    try {
      if (req.user.wantsEmail('orderConfirmations')) {
        const {
          sendOrderConfirmation
        } = require('../utils/emailService');
        const emailData = {
          orderNumber: order.orderNumber,
          customerName: `${req.user.firstName} ${req.user.lastName}`,
          items: order.items.map(item => ({
            productName: item.product.name,
            quantity: item.quantity,
            price: item.price
          })),
          total: order.total,
          shippingAddress: order.shippingAddress
        };
        const emailResult = await sendOrderConfirmation(req.user.email, emailData);
        if (!emailResult.success) {
          console.error('Failed to send order confirmation email:', emailResult.error);
        }
      }
    } catch (emailError) {
      console.error('Error sending order confirmation email:', emailError);
    }

    // Clear user's cart
    const user = await User.findById(req.user._id);
    user.cart = {
      items: [],
      updatedAt: new Date()
    };
    await user.save();

    // Clear cart session
    if (req.session && req.session.cart) {
      req.session.cart = [];
    }
    res.status(201).json({
      success: true,
      message: 'Order created successfully',
      order: {
        _id: order._id,
        orderNumber: order.orderNumber,
        total: order.total,
        status: order.status,
        createdAt: order.createdAt
      }
    });
  } catch (error) {
    console.error('Error creating registered user order:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'ORDER_CREATION_ERROR',
        message: 'Failed to create order'
      }
    });
  }
});

// Get order by ID (supports both authenticated and guest orders)
router.get('/:id', authenticateToken, async (req, res) => {
  try {
    const order = await Order.findById(req.params.id).populate('items.product', '-wholesaler').populate('customer', 'firstName lastName email');
    if (!order) {
      return res.status(404).json({
        success: false,
        error: {
          code: 'ORDER_NOT_FOUND',
          message: 'Order not found'
        }
      });
    }

    // For guest orders, allow access without authentication
    // For authenticated users, check ownership (unless admin)
    if (req.user) {
      if (!req.user.isAdmin && order.customer && order.customer._id.toString() !== req.user._id.toString()) {
        return res.status(403).json({
          success: false,
          error: {
            code: 'ACCESS_DENIED',
            message: 'You can only access your own orders'
          }
        });
      }
    }
    // Guest orders (no customer field) are accessible without auth

    // Return public order data (excludes sensitive wholesaler info)
    res.json({
      success: true,
      data: {
        order: order.toPublicJSON()
      }
    });
  } catch (error) {
    console.error('Error fetching order:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'ORDER_FETCH_ERROR',
        message: 'Failed to fetch order'
      }
    });
  }
});

// Get order history for registered user
router.get('/', authenticateToken, async (req, res) => {
  try {
    // Ensure user is authenticated
    if (!req.user) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'AUTHENTICATION_REQUIRED',
          message: 'You must be logged in to view orders'
        }
      });
    }
    const page = parseInt(req.query.page) || 1;
    const limit = parseInt(req.query.limit) || 10;
    const skip = (page - 1) * limit;
    const orders = await Order.find({
      customer: req.user._id
    }).populate('items.product', 'name slug images price').sort({
      createdAt: -1
    }).skip(skip).limit(limit);
    const totalOrders = await Order.countDocuments({
      customer: req.user._id
    });
    const totalPages = Math.ceil(totalOrders / limit);

    // Return public order data
    const publicOrders = orders.map(order => order.toPublicJSON());
    res.json({
      success: true,
      data: {
        orders: publicOrders,
        pagination: {
          currentPage: page,
          totalPages,
          totalOrders,
          hasNextPage: page < totalPages,
          hasPrevPage: page > 1
        }
      }
    });
  } catch (error) {
    console.error('Error fetching order history:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'ORDER_HISTORY_ERROR',
        message: 'Failed to fetch order history'
      }
    });
  }
});

// Associate order with authenticated user
router.post('/:id/associate', requireAuth, async (req, res) => {
  try {
    const {
      id
    } = req.params;

    // Find the order
    const order = await Order.findById(id);
    if (!order) {
      return res.status(404).json({
        success: false,
        error: {
          code: 'ORDER_NOT_FOUND',
          message: 'Order not found'
        }
      });
    }

    // Check if order is already associated with a user
    if (order.customer) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'ORDER_ALREADY_ASSOCIATED',
          message: 'Order is already associated with a user'
        }
      });
    }

    // Associate order with the authenticated user
    order.customer = req.user._id;
    await order.save();
    res.json({
      success: true,
      message: 'Order successfully associated with your account'
    });
  } catch (error) {
    console.error('Error associating order:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'ORDER_ASSOCIATION_ERROR',
        message: 'Failed to associate order with account'
      }
    });
  }
});

// Update order status (admin only - placeholder for now)
router.put('/:id/status', async (req, res) => {
  try {
    const {
      status,
      trackingNumber
    } = req.body;
    const validStatuses = ['pending', 'processing', 'shipped', 'delivered', 'cancelled'];
    if (!validStatuses.includes(status)) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'INVALID_STATUS',
          message: 'Invalid order status'
        }
      });
    }
    const updateData = {
      status
    };
    if (trackingNumber) {
      updateData.trackingNumber = trackingNumber;
    }
    const order = await Order.findByIdAndUpdate(req.params.id, updateData, {
      new: true
    }).populate('customer', 'firstName lastName email preferences');
    if (!order) {
      return res.status(404).json({
        success: false,
        error: {
          code: 'ORDER_NOT_FOUND',
          message: 'Order not found'
        }
      });
    }

    // Send status update email
    try {
      const {
        sendOrderStatusUpdate
      } = require('../utils/emailService');
      let customerEmail,
        customerName,
        shouldSendEmail = true;
      if (order.customer) {
        // Registered user
        customerEmail = order.customer.email;
        customerName = `${order.customer.firstName} ${order.customer.lastName}`;
        shouldSendEmail = order.customer.preferences?.emailPreferences?.orderUpdates !== false;
      } else {
        // Guest user
        customerEmail = order.guestInfo.email;
        customerName = `${order.guestInfo.firstName} ${order.guestInfo.lastName}`;
      }
      if (shouldSendEmail && ['processing', 'shipped', 'delivered'].includes(status)) {
        const statusData = {
          orderNumber: order.orderNumber,
          customerName,
          status,
          trackingNumber
        };
        const emailResult = await sendOrderStatusUpdate(customerEmail, statusData);
        if (!emailResult.success) {
          console.error('Failed to send order status update email:', emailResult.error);
        }
      }
    } catch (emailError) {
      console.error('Error sending order status update email:', emailError);
    }
    res.json({
      success: true,
      message: 'Order status updated',
      order: {
        _id: order._id,
        orderNumber: order.orderNumber,
        status: order.status,
        trackingNumber: order.trackingNumber,
        updatedAt: order.updatedAt
      }
    });
  } catch (error) {
    console.error('Error updating order status:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'ORDER_UPDATE_ERROR',
        message: 'Failed to update order status'
      }
    });
  }
});
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsImJvZHkiLCJ2YWxpZGF0aW9uUmVzdWx0IiwiT3JkZXIiLCJQcm9kdWN0IiwiVXNlciIsImF1dGhlbnRpY2F0ZVRva2VuIiwicmVxdWlyZUF1dGgiLCJ2YWxpZGF0ZUNTUkZUb2tlbiIsInZhbGlkYXRlR3Vlc3RDaGVja291dCIsImlzRW1haWwiLCJub3JtYWxpemVFbWFpbCIsIndpdGhNZXNzYWdlIiwidHJpbSIsImlzTGVuZ3RoIiwibWluIiwibWF4Iiwib3B0aW9uYWwiLCJpc1N0cmluZyIsImlzQXJyYXkiLCJpc01vbmdvSWQiLCJpc0ludCIsInBvc3QiLCJyZXEiLCJyZXMiLCJlcnJvcnMiLCJpc0VtcHR5Iiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsImNvZGUiLCJtZXNzYWdlIiwiZGV0YWlscyIsImFycmF5IiwiZ3Vlc3RJbmZvIiwic2hpcHBpbmdBZGRyZXNzIiwiYmlsbGluZ0FkZHJlc3MiLCJpdGVtcyIsInJlcXVlc3RJdGVtcyIsIm5vdGVzIiwicmVmZXJyYWxTb3VyY2UiLCJvcmRlckl0ZW1zIiwic3VidG90YWwiLCJwcm9kdWN0SWRzIiwibWFwIiwiaXRlbSIsInByb2R1Y3RJZCIsInByb2R1Y3RzIiwiZmluZCIsIl9pZCIsIiRpbiIsInByb2R1Y3RNYXAiLCJNYXAiLCJwIiwidG9TdHJpbmciLCJwcm9kdWN0IiwiZ2V0IiwiaXNBY3RpdmUiLCJpdGVtVG90YWwiLCJwcmljZSIsInF1YW50aXR5IiwicHVzaCIsIndob2xlc2FsZXIiLCJuYW1lIiwiZW1haWwiLCJwcm9kdWN0Q29kZSIsIm5vdGlmaWVkIiwidGF4IiwiTWF0aCIsInJvdW5kIiwic2hpcHBpbmciLCJ0b3RhbCIsIm9yZGVyRGF0YSIsInBheW1lbnQiLCJtZXRob2QiLCJ1c2VyIiwiY3VzdG9tZXIiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsInBob25lIiwib3JkZXIiLCJjcmVhdGUiLCJwb3B1bGF0ZSIsInNlbmRPcmRlckNvbmZpcm1hdGlvbiIsImVtYWlsRGF0YSIsIm9yZGVyTnVtYmVyIiwiY3VzdG9tZXJOYW1lIiwicHJvZHVjdE5hbWUiLCJlbWFpbFJlc3VsdCIsImNvbnNvbGUiLCJlbWFpbEVycm9yIiwiY3JlYXRlZEF0Iiwibm90aWZpY2F0aW9uQXR0ZW1wdHMiLCJkYXRhIiwidXNlRGVmYXVsdEFkZHJlc3NlcyIsImZpbmFsU2hpcHBpbmdBZGRyZXNzIiwiZmluYWxCaWxsaW5nQWRkcmVzcyIsImRlZmF1bHRTaGlwcGluZyIsImdldERlZmF1bHRTaGlwcGluZ0FkZHJlc3MiLCJkZWZhdWx0QmlsbGluZyIsImdldERlZmF1bHRCaWxsaW5nQWRkcmVzcyIsInRvT2JqZWN0IiwidHlwZSIsImlzRGVmYXVsdCIsIml0ZW1zVG9Qcm9jZXNzIiwibGVuZ3RoIiwiZmluZEJ5SWQiLCJjYXJ0Iiwid2FudHNFbWFpbCIsInVwZGF0ZWRBdCIsIkRhdGUiLCJzYXZlIiwic2Vzc2lvbiIsInBhcmFtcyIsImlkIiwiaXNBZG1pbiIsInRvUHVibGljSlNPTiIsInBhZ2UiLCJwYXJzZUludCIsInF1ZXJ5IiwibGltaXQiLCJza2lwIiwib3JkZXJzIiwic29ydCIsInRvdGFsT3JkZXJzIiwiY291bnREb2N1bWVudHMiLCJ0b3RhbFBhZ2VzIiwiY2VpbCIsInB1YmxpY09yZGVycyIsInBhZ2luYXRpb24iLCJjdXJyZW50UGFnZSIsImhhc05leHRQYWdlIiwiaGFzUHJldlBhZ2UiLCJwdXQiLCJ0cmFja2luZ051bWJlciIsInZhbGlkU3RhdHVzZXMiLCJpbmNsdWRlcyIsInVwZGF0ZURhdGEiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIm5ldyIsInNlbmRPcmRlclN0YXR1c1VwZGF0ZSIsImN1c3RvbWVyRW1haWwiLCJzaG91bGRTZW5kRW1haWwiLCJwcmVmZXJlbmNlcyIsImVtYWlsUHJlZmVyZW5jZXMiLCJvcmRlclVwZGF0ZXMiLCJzdGF0dXNEYXRhIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIm9yZGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbmNvbnN0IHsgYm9keSwgdmFsaWRhdGlvblJlc3VsdCB9ID0gcmVxdWlyZSgnZXhwcmVzcy12YWxpZGF0b3InKTtcbmNvbnN0IE9yZGVyID0gcmVxdWlyZSgnLi4vbW9kZWxzL09yZGVyJyk7XG5jb25zdCBQcm9kdWN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL1Byb2R1Y3QnKTtcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xuY29uc3QgeyBhdXRoZW50aWNhdGVUb2tlbiwgcmVxdWlyZUF1dGggfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmUvYXV0aCcpO1xuY29uc3QgeyB2YWxpZGF0ZUNTUkZUb2tlbiB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZS9zZXNzaW9uQ1NSRicpO1xuXG4vLyBWYWxpZGF0aW9uIG1pZGRsZXdhcmUgZm9yIGd1ZXN0IGNoZWNrb3V0XG5jb25zdCB2YWxpZGF0ZUd1ZXN0Q2hlY2tvdXQgPSBbXG4gIGJvZHkoJ2d1ZXN0SW5mby5lbWFpbCcpXG4gICAgLmlzRW1haWwoKVxuICAgIC5ub3JtYWxpemVFbWFpbCgpXG4gICAgLndpdGhNZXNzYWdlKCdWYWxpZCBlbWFpbCBpcyByZXF1aXJlZCcpLFxuICBib2R5KCdndWVzdEluZm8uZmlyc3ROYW1lJylcbiAgICAudHJpbSgpXG4gICAgLmlzTGVuZ3RoKHsgbWluOiAxLCBtYXg6IDUwIH0pXG4gICAgLndpdGhNZXNzYWdlKCdGaXJzdCBuYW1lIGlzIHJlcXVpcmVkIGFuZCBtdXN0IGJlIGxlc3MgdGhhbiA1MCBjaGFyYWN0ZXJzJyksXG4gIGJvZHkoJ2d1ZXN0SW5mby5sYXN0TmFtZScpXG4gICAgLnRyaW0oKVxuICAgIC5pc0xlbmd0aCh7IG1pbjogMSwgbWF4OiA1MCB9KVxuICAgIC53aXRoTWVzc2FnZSgnTGFzdCBuYW1lIGlzIHJlcXVpcmVkIGFuZCBtdXN0IGJlIGxlc3MgdGhhbiA1MCBjaGFyYWN0ZXJzJyksXG4gIGJvZHkoJ2d1ZXN0SW5mby5waG9uZScpXG4gICAgLm9wdGlvbmFsKClcbiAgICAuaXNTdHJpbmcoKVxuICAgIC5pc0xlbmd0aCh7IG1pbjogNywgbWF4OiAzMCB9KVxuICAgIC53aXRoTWVzc2FnZSgnUGhvbmUgbnVtYmVyIG11c3QgYmUgYmV0d2VlbiA3IGFuZCAzMCBjaGFyYWN0ZXJzJyksXG4gIGJvZHkoJ3NoaXBwaW5nQWRkcmVzcy5maXJzdE5hbWUnKVxuICAgIC50cmltKClcbiAgICAuaXNMZW5ndGgoeyBtaW46IDEsIG1heDogNTAgfSlcbiAgICAud2l0aE1lc3NhZ2UoJ1NoaXBwaW5nIGZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnKSxcbiAgYm9keSgnc2hpcHBpbmdBZGRyZXNzLmxhc3ROYW1lJylcbiAgICAudHJpbSgpXG4gICAgLmlzTGVuZ3RoKHsgbWluOiAxLCBtYXg6IDUwIH0pXG4gICAgLndpdGhNZXNzYWdlKCdTaGlwcGluZyBsYXN0IG5hbWUgaXMgcmVxdWlyZWQnKSxcbiAgYm9keSgnc2hpcHBpbmdBZGRyZXNzLnN0cmVldCcpXG4gICAgLnRyaW0oKVxuICAgIC5pc0xlbmd0aCh7IG1pbjogMSwgbWF4OiAxMDAgfSlcbiAgICAud2l0aE1lc3NhZ2UoJ1NoaXBwaW5nIHN0cmVldCBhZGRyZXNzIGlzIHJlcXVpcmVkJyksXG4gIGJvZHkoJ3NoaXBwaW5nQWRkcmVzcy5jaXR5JylcbiAgICAudHJpbSgpXG4gICAgLmlzTGVuZ3RoKHsgbWluOiAxLCBtYXg6IDUwIH0pXG4gICAgLndpdGhNZXNzYWdlKCdTaGlwcGluZyBjaXR5IGlzIHJlcXVpcmVkJyksXG4gIGJvZHkoJ3NoaXBwaW5nQWRkcmVzcy5zdGF0ZScpXG4gICAgLnRyaW0oKVxuICAgIC5pc0xlbmd0aCh7IG1pbjogMiwgbWF4OiA1MCB9KVxuICAgIC53aXRoTWVzc2FnZSgnU2hpcHBpbmcgc3RhdGUgaXMgcmVxdWlyZWQnKSxcbiAgYm9keSgnc2hpcHBpbmdBZGRyZXNzLnppcENvZGUnKVxuICAgIC50cmltKClcbiAgICAuaXNMZW5ndGgoeyBtaW46IDUsIG1heDogMTAgfSlcbiAgICAud2l0aE1lc3NhZ2UoJ1ZhbGlkIHNoaXBwaW5nIHppcCBjb2RlIGlzIHJlcXVpcmVkJyksXG4gIGJvZHkoJ3NoaXBwaW5nQWRkcmVzcy5jb3VudHJ5JylcbiAgICAudHJpbSgpXG4gICAgLmlzTGVuZ3RoKHsgbWluOiAyLCBtYXg6IDUwIH0pXG4gICAgLndpdGhNZXNzYWdlKCdWYWxpZCBjb3VudHJ5IGNvZGUgaXMgcmVxdWlyZWQnKSxcbiAgYm9keSgnYmlsbGluZ0FkZHJlc3MuZmlyc3ROYW1lJylcbiAgICAudHJpbSgpXG4gICAgLmlzTGVuZ3RoKHsgbWluOiAxLCBtYXg6IDUwIH0pXG4gICAgLndpdGhNZXNzYWdlKCdCaWxsaW5nIGZpcnN0IG5hbWUgaXMgcmVxdWlyZWQnKSxcbiAgYm9keSgnYmlsbGluZ0FkZHJlc3MubGFzdE5hbWUnKVxuICAgIC50cmltKClcbiAgICAuaXNMZW5ndGgoeyBtaW46IDEsIG1heDogNTAgfSlcbiAgICAud2l0aE1lc3NhZ2UoJ0JpbGxpbmcgbGFzdCBuYW1lIGlzIHJlcXVpcmVkJyksXG4gIGJvZHkoJ2JpbGxpbmdBZGRyZXNzLnN0cmVldCcpXG4gICAgLnRyaW0oKVxuICAgIC5pc0xlbmd0aCh7IG1pbjogMSwgbWF4OiAxMDAgfSlcbiAgICAud2l0aE1lc3NhZ2UoJ0JpbGxpbmcgc3RyZWV0IGFkZHJlc3MgaXMgcmVxdWlyZWQnKSxcbiAgYm9keSgnYmlsbGluZ0FkZHJlc3MuY2l0eScpXG4gICAgLnRyaW0oKVxuICAgIC5pc0xlbmd0aCh7IG1pbjogMSwgbWF4OiA1MCB9KVxuICAgIC53aXRoTWVzc2FnZSgnQmlsbGluZyBjaXR5IGlzIHJlcXVpcmVkJyksXG4gIGJvZHkoJ2JpbGxpbmdBZGRyZXNzLnN0YXRlJylcbiAgICAudHJpbSgpXG4gICAgLmlzTGVuZ3RoKHsgbWluOiAyLCBtYXg6IDUwIH0pXG4gICAgLndpdGhNZXNzYWdlKCdCaWxsaW5nIHN0YXRlIGlzIHJlcXVpcmVkJyksXG4gIGJvZHkoJ2JpbGxpbmdBZGRyZXNzLnppcENvZGUnKVxuICAgIC50cmltKClcbiAgICAuaXNMZW5ndGgoeyBtaW46IDUsIG1heDogMTAgfSlcbiAgICAud2l0aE1lc3NhZ2UoJ1ZhbGlkIGJpbGxpbmcgemlwIGNvZGUgaXMgcmVxdWlyZWQnKSxcbiAgYm9keSgnYmlsbGluZ0FkZHJlc3MuY291bnRyeScpXG4gICAgLnRyaW0oKVxuICAgIC5pc0xlbmd0aCh7IG1pbjogMiwgbWF4OiA1MCB9KVxuICAgIC53aXRoTWVzc2FnZSgnVmFsaWQgY291bnRyeSBjb2RlIGlzIHJlcXVpcmVkJyksXG4gIGJvZHkoJ2l0ZW1zJylcbiAgICAuaXNBcnJheSh7IG1pbjogMSB9KVxuICAgIC53aXRoTWVzc2FnZSgnQXQgbGVhc3Qgb25lIGl0ZW0gaXMgcmVxdWlyZWQnKSxcbiAgYm9keSgnaXRlbXMuKi5wcm9kdWN0SWQnKVxuICAgIC5pc01vbmdvSWQoKVxuICAgIC53aXRoTWVzc2FnZSgnVmFsaWQgcHJvZHVjdCBJRCBpcyByZXF1aXJlZCcpLFxuICBib2R5KCdpdGVtcy4qLnF1YW50aXR5JylcbiAgICAuaXNJbnQoeyBtaW46IDEsIG1heDogOTkgfSlcbiAgICAud2l0aE1lc3NhZ2UoJ1F1YW50aXR5IG11c3QgYmUgYmV0d2VlbiAxIGFuZCA5OScpLFxuICBib2R5KCdyZWZlcnJhbFNvdXJjZScpXG4gICAgLm9wdGlvbmFsKClcbiAgICAudHJpbSgpXG4gICAgLmlzTGVuZ3RoKHsgbWF4OiAxMDAgfSlcbiAgICAud2l0aE1lc3NhZ2UoJ1JlZmVycmFsIHNvdXJjZSBtdXN0IGJlIGxlc3MgdGhhbiAxMDAgY2hhcmFjdGVycycpXG5dO1xuXG4vLyBDcmVhdGUgb3JkZXIgKGJvdGggZ3Vlc3QgYW5kIGF1dGhlbnRpY2F0ZWQpXG5yb3V0ZXIucG9zdCgnLycsIGF1dGhlbnRpY2F0ZVRva2VuLCB2YWxpZGF0ZUd1ZXN0Q2hlY2tvdXQsIHZhbGlkYXRlQ1NSRlRva2VuLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICAvLyBDaGVjayB2YWxpZGF0aW9uIGVycm9yc1xuICAgIGNvbnN0IGVycm9ycyA9IHZhbGlkYXRpb25SZXN1bHQocmVxKTtcbiAgICBpZiAoIWVycm9ycy5pc0VtcHR5KCkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBpbnB1dCBkYXRhJyxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvcnMuYXJyYXkoKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICBndWVzdEluZm8sXG4gICAgICBzaGlwcGluZ0FkZHJlc3MsXG4gICAgICBiaWxsaW5nQWRkcmVzcyxcbiAgICAgIGl0ZW1zOiByZXF1ZXN0SXRlbXMsXG4gICAgICBub3RlcyxcbiAgICAgIHJlZmVycmFsU291cmNlXG4gICAgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gVmFsaWRhdGUgYW5kIHByb2Nlc3MgY2FydCBpdGVtcyAtIEZJWEVEIE4rMSBRVUVSWVxuICAgIGNvbnN0IG9yZGVySXRlbXMgPSBbXTtcbiAgICBsZXQgc3VidG90YWwgPSAwO1xuXG4gICAgLy8gQmF0Y2ggZmV0Y2ggYWxsIHByb2R1Y3RzIGF0IG9uY2UgdG8gYXZvaWQgTisxIHF1ZXJpZXNcbiAgICBjb25zdCBwcm9kdWN0SWRzID0gcmVxdWVzdEl0ZW1zLm1hcChpdGVtID0+IGl0ZW0ucHJvZHVjdElkKTtcbiAgICBjb25zdCBwcm9kdWN0cyA9IGF3YWl0IFByb2R1Y3QuZmluZCh7IF9pZDogeyAkaW46IHByb2R1Y3RJZHMgfSB9KTtcbiAgICBjb25zdCBwcm9kdWN0TWFwID0gbmV3IE1hcChwcm9kdWN0cy5tYXAocCA9PiBbcC5faWQudG9TdHJpbmcoKSwgcF0pKTtcblxuICAgIGZvciAoY29uc3QgaXRlbSBvZiByZXF1ZXN0SXRlbXMpIHtcbiAgICAgIGNvbnN0IHByb2R1Y3QgPSBwcm9kdWN0TWFwLmdldChpdGVtLnByb2R1Y3RJZCk7XG4gICAgICBcbiAgICAgIGlmICghcHJvZHVjdCB8fCAhcHJvZHVjdC5pc0FjdGl2ZSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9QUk9EVUNUJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6IGBQcm9kdWN0ICR7aXRlbS5wcm9kdWN0SWR9IG5vdCBmb3VuZCBvciB1bmF2YWlsYWJsZWBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpdGVtVG90YWwgPSBwcm9kdWN0LnByaWNlICogaXRlbS5xdWFudGl0eTtcbiAgICAgIHN1YnRvdGFsICs9IGl0ZW1Ub3RhbDtcblxuICAgICAgb3JkZXJJdGVtcy5wdXNoKHtcbiAgICAgICAgcHJvZHVjdDogcHJvZHVjdC5faWQsXG4gICAgICAgIHF1YW50aXR5OiBpdGVtLnF1YW50aXR5LFxuICAgICAgICBwcmljZTogcHJvZHVjdC5wcmljZSxcbiAgICAgICAgd2hvbGVzYWxlcjoge1xuICAgICAgICAgIG5hbWU6IHByb2R1Y3Qud2hvbGVzYWxlci5uYW1lLFxuICAgICAgICAgIGVtYWlsOiBwcm9kdWN0Lndob2xlc2FsZXIuZW1haWwsXG4gICAgICAgICAgcHJvZHVjdENvZGU6IHByb2R1Y3Qud2hvbGVzYWxlci5wcm9kdWN0Q29kZSxcbiAgICAgICAgICBub3RpZmllZDogZmFsc2VcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIHRvdGFscyAoc2ltcGxpZmllZCAtIHlvdSBtYXkgd2FudCB0byBhZGQgdGF4IGNhbGN1bGF0aW9uKVxuICAgIGNvbnN0IHRheCA9IE1hdGgucm91bmQoc3VidG90YWwgKiAwLjA4ICogMTAwKSAvIDEwMDsgLy8gOCUgdGF4IHJhdGVcbiAgICBjb25zdCBzaGlwcGluZyA9IHN1YnRvdGFsID4gNTAgPyAwIDogNS45OTsgLy8gRnJlZSBzaGlwcGluZyBvdmVyICQ1MFxuICAgIGNvbnN0IHRvdGFsID0gTWF0aC5yb3VuZCgoc3VidG90YWwgKyB0YXggKyBzaGlwcGluZykgKiAxMDApIC8gMTAwO1xuXG4gICAgLy8gQ3JlYXRlIG9yZGVyXG4gICAgY29uc3Qgb3JkZXJEYXRhID0ge1xuICAgICAgaXRlbXM6IG9yZGVySXRlbXMsXG4gICAgICBzaGlwcGluZ0FkZHJlc3MsXG4gICAgICBiaWxsaW5nQWRkcmVzcyxcbiAgICAgIHN1YnRvdGFsOiBNYXRoLnJvdW5kKHN1YnRvdGFsICogMTAwKSAvIDEwMCxcbiAgICAgIHRheCxcbiAgICAgIHNoaXBwaW5nLFxuICAgICAgdG90YWwsXG4gICAgICBwYXltZW50OiB7XG4gICAgICAgIG1ldGhvZDogJ290aGVyJywgLy8gV2lsbCBiZSB1cGRhdGVkIHdoZW4gcGF5bWVudCBpcyBwcm9jZXNzZWRcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZydcbiAgICAgIH0sXG4gICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgIG5vdGVzLFxuICAgICAgcmVmZXJyYWxTb3VyY2VcbiAgICB9O1xuXG4gICAgLy8gQWRkIGN1c3RvbWVyIElEIGlmIHVzZXIgaXMgYXV0aGVudGljYXRlZFxuICAgIGlmIChyZXEudXNlcikge1xuICAgICAgb3JkZXJEYXRhLmN1c3RvbWVyID0gcmVxLnVzZXIuX2lkO1xuICAgICAgLy8gRm9yIHJlZ2lzdGVyZWQgdXNlcnMsIHBvcHVsYXRlIGd1ZXN0IGluZm8gZnJvbSB0aGVpciBwcm9maWxlXG4gICAgICBvcmRlckRhdGEuZ3Vlc3RJbmZvID0ge1xuICAgICAgICBmaXJzdE5hbWU6IHJlcS51c2VyLmZpcnN0TmFtZSxcbiAgICAgICAgbGFzdE5hbWU6IHJlcS51c2VyLmxhc3ROYW1lLFxuICAgICAgICBlbWFpbDogcmVxLnVzZXIuZW1haWwsXG4gICAgICAgIHBob25lOiByZXEudXNlci5waG9uZSB8fCBndWVzdEluZm8/LnBob25lXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGb3IgZ3Vlc3QgY2hlY2tvdXQsIHVzZSBwcm92aWRlZCBndWVzdCBpbmZvXG4gICAgICBvcmRlckRhdGEuZ3Vlc3RJbmZvID0gZ3Vlc3RJbmZvO1xuICAgIH1cblxuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuY3JlYXRlKG9yZGVyRGF0YSk7XG4gICAgXG4gICAgLy8gUG9wdWxhdGUgcHJvZHVjdCBkZXRhaWxzIGZvciBlbWFpbFxuICAgIGF3YWl0IG9yZGVyLnBvcHVsYXRlKCdpdGVtcy5wcm9kdWN0JywgJ25hbWUgc2x1ZyBpbWFnZXMnKTtcblxuICAgIC8vIFNlbmQgb3JkZXIgY29uZmlybWF0aW9uIGVtYWlsXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgc2VuZE9yZGVyQ29uZmlybWF0aW9uIH0gPSByZXF1aXJlKCcuLi91dGlscy9lbWFpbFNlcnZpY2UnKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW1haWxEYXRhID0ge1xuICAgICAgICBvcmRlck51bWJlcjogb3JkZXIub3JkZXJOdW1iZXIsXG4gICAgICAgIGN1c3RvbWVyTmFtZTogYCR7b3JkZXIuZ3Vlc3RJbmZvLmZpcnN0TmFtZX0gJHtvcmRlci5ndWVzdEluZm8ubGFzdE5hbWV9YCxcbiAgICAgICAgaXRlbXM6IG9yZGVyLml0ZW1zLm1hcChpdGVtID0+ICh7XG4gICAgICAgICAgcHJvZHVjdE5hbWU6IGl0ZW0ucHJvZHVjdC5uYW1lLFxuICAgICAgICAgIHF1YW50aXR5OiBpdGVtLnF1YW50aXR5LFxuICAgICAgICAgIHByaWNlOiBpdGVtLnByaWNlXG4gICAgICAgIH0pKSxcbiAgICAgICAgdG90YWw6IG9yZGVyLnRvdGFsLFxuICAgICAgICBzaGlwcGluZ0FkZHJlc3M6IG9yZGVyLnNoaXBwaW5nQWRkcmVzc1xuICAgICAgfTtcblxuICAgICAgY29uc3QgZW1haWxSZXN1bHQgPSBhd2FpdCBzZW5kT3JkZXJDb25maXJtYXRpb24ob3JkZXIuZ3Vlc3RJbmZvLmVtYWlsLCBlbWFpbERhdGEpO1xuICAgICAgaWYgKCFlbWFpbFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIG9yZGVyIGNvbmZpcm1hdGlvbiBlbWFpbDonLCBlbWFpbFJlc3VsdC5lcnJvcik7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZW1haWxFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2VuZGluZyBvcmRlciBjb25maXJtYXRpb24gZW1haWw6JywgZW1haWxFcnJvcik7XG4gICAgfVxuXG4gICAgLy8gTm90ZTogQ2FydCB3aWxsIGJlIGNsZWFyZWQgYWZ0ZXIgc3VjY2Vzc2Z1bCBwYXltZW50LCBub3QgaGVyZVxuICAgIC8vIFRoaXMgYWxsb3dzIHVzZXJzIHRvIHJldHJ5IHBheW1lbnQgaWYgaXQgZmFpbHNcblxuICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnT3JkZXIgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgb3JkZXI6IHtcbiAgICAgICAgX2lkOiBvcmRlci5faWQsXG4gICAgICAgIG9yZGVyTnVtYmVyOiBvcmRlci5vcmRlck51bWJlcixcbiAgICAgICAgdG90YWw6IG9yZGVyLnRvdGFsLFxuICAgICAgICBzdGF0dXM6IG9yZGVyLnN0YXR1cyxcbiAgICAgICAgY3JlYXRlZEF0OiBvcmRlci5jcmVhdGVkQXRcbiAgICAgIH1cbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIG9yZGVyOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdPUkRFUl9DUkVBVElPTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIG9yZGVyJ1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59KTtcblxuLy8gQ3JlYXRlIG9yZGVyIChndWVzdCBjaGVja291dCkgLSBleHBsaWNpdCBndWVzdCByb3V0ZVxucm91dGVyLnBvc3QoJy9ndWVzdCcsIHZhbGlkYXRlR3Vlc3RDaGVja291dCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gQ2hlY2sgdmFsaWRhdGlvbiBlcnJvcnNcbiAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSk7XG4gICAgaWYgKCFlcnJvcnMuaXNFbXB0eSgpKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgaW5wdXQgZGF0YScsXG4gICAgICAgICAgZGV0YWlsczogZXJyb3JzLmFycmF5KClcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3Qge1xuICAgICAgZ3Vlc3RJbmZvLFxuICAgICAgc2hpcHBpbmdBZGRyZXNzLFxuICAgICAgYmlsbGluZ0FkZHJlc3MsXG4gICAgICBpdGVtczogcmVxdWVzdEl0ZW1zLFxuICAgICAgbm90ZXMsXG4gICAgICByZWZlcnJhbFNvdXJjZVxuICAgIH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRlIGFuZCBwcm9jZXNzIGNhcnQgaXRlbXMgLSBGSVhFRCBOKzEgUVVFUllcbiAgICBjb25zdCBvcmRlckl0ZW1zID0gW107XG4gICAgbGV0IHN1YnRvdGFsID0gMDtcblxuICAgIC8vIEJhdGNoIGZldGNoIGFsbCBwcm9kdWN0cyBhdCBvbmNlIHRvIGF2b2lkIE4rMSBxdWVyaWVzXG4gICAgY29uc3QgcHJvZHVjdElkcyA9IHJlcXVlc3RJdGVtcy5tYXAoaXRlbSA9PiBpdGVtLnByb2R1Y3RJZCk7XG4gICAgY29uc3QgcHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoeyBfaWQ6IHsgJGluOiBwcm9kdWN0SWRzIH0gfSk7XG4gICAgY29uc3QgcHJvZHVjdE1hcCA9IG5ldyBNYXAocHJvZHVjdHMubWFwKHAgPT4gW3AuX2lkLnRvU3RyaW5nKCksIHBdKSk7XG5cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgcmVxdWVzdEl0ZW1zKSB7XG4gICAgICBjb25zdCBwcm9kdWN0ID0gcHJvZHVjdE1hcC5nZXQoaXRlbS5wcm9kdWN0SWQpO1xuICAgICAgXG4gICAgICBpZiAoIXByb2R1Y3QgfHwgIXByb2R1Y3QuaXNBY3RpdmUpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgY29kZTogJ0lOVkFMSURfUFJPRFVDVCcsXG4gICAgICAgICAgICBtZXNzYWdlOiBgUHJvZHVjdCAke2l0ZW0ucHJvZHVjdElkfSBub3QgZm91bmQgb3IgdW5hdmFpbGFibGVgXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaXRlbVRvdGFsID0gcHJvZHVjdC5wcmljZSAqIGl0ZW0ucXVhbnRpdHk7XG4gICAgICBzdWJ0b3RhbCArPSBpdGVtVG90YWw7XG5cbiAgICAgIG9yZGVySXRlbXMucHVzaCh7XG4gICAgICAgIHByb2R1Y3Q6IHByb2R1Y3QuX2lkLFxuICAgICAgICBxdWFudGl0eTogaXRlbS5xdWFudGl0eSxcbiAgICAgICAgcHJpY2U6IHByb2R1Y3QucHJpY2UsXG4gICAgICAgIHdob2xlc2FsZXI6IHtcbiAgICAgICAgICBuYW1lOiBwcm9kdWN0Lndob2xlc2FsZXIubmFtZSxcbiAgICAgICAgICBlbWFpbDogcHJvZHVjdC53aG9sZXNhbGVyLmVtYWlsLFxuICAgICAgICAgIHByb2R1Y3RDb2RlOiBwcm9kdWN0Lndob2xlc2FsZXIucHJvZHVjdENvZGUsXG4gICAgICAgICAgbm90aWZpZWQ6IGZhbHNlLFxuICAgICAgICAgIG5vdGlmaWNhdGlvbkF0dGVtcHRzOiAwXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSB0b3RhbHNcbiAgICBjb25zdCB0YXggPSBzdWJ0b3RhbCAqIDAuMDg7IC8vIDglIHRheCByYXRlXG4gICAgY29uc3Qgc2hpcHBpbmcgPSBzdWJ0b3RhbCA+IDUwID8gMCA6IDkuOTk7IC8vIEZyZWUgc2hpcHBpbmcgb3ZlciAkNTBcbiAgICBjb25zdCB0b3RhbCA9IHN1YnRvdGFsICsgdGF4ICsgc2hpcHBpbmc7XG5cbiAgICAvLyBDcmVhdGUgb3JkZXJcbiAgICBjb25zdCBvcmRlckRhdGEgPSB7XG4gICAgICBndWVzdEluZm8sXG4gICAgICBpdGVtczogb3JkZXJJdGVtcyxcbiAgICAgIHNoaXBwaW5nQWRkcmVzcyxcbiAgICAgIGJpbGxpbmdBZGRyZXNzOiBiaWxsaW5nQWRkcmVzcyB8fCBzaGlwcGluZ0FkZHJlc3MsXG4gICAgICBzdWJ0b3RhbCxcbiAgICAgIHRheCxcbiAgICAgIHNoaXBwaW5nLFxuICAgICAgdG90YWwsXG4gICAgICBwYXltZW50OiB7XG4gICAgICAgIG1ldGhvZDogJ2NhcmQnLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJ1xuICAgICAgfSxcbiAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgbm90ZXMsXG4gICAgICByZWZlcnJhbFNvdXJjZVxuICAgIH07XG5cbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmNyZWF0ZShvcmRlckRhdGEpO1xuXG4gICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdHdWVzdCBvcmRlciBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG9yZGVyOiB7XG4gICAgICAgICAgX2lkOiBvcmRlci5faWQsXG4gICAgICAgICAgb3JkZXJOdW1iZXI6IG9yZGVyLm9yZGVyTnVtYmVyLFxuICAgICAgICAgIGd1ZXN0SW5mbzogb3JkZXIuZ3Vlc3RJbmZvLFxuICAgICAgICAgIGl0ZW1zOiBvcmRlci5pdGVtcyxcbiAgICAgICAgICBzaGlwcGluZ0FkZHJlc3M6IG9yZGVyLnNoaXBwaW5nQWRkcmVzcyxcbiAgICAgICAgICBiaWxsaW5nQWRkcmVzczogb3JkZXIuYmlsbGluZ0FkZHJlc3MsXG4gICAgICAgICAgc3VidG90YWw6IG9yZGVyLnN1YnRvdGFsLFxuICAgICAgICAgIHRheDogb3JkZXIudGF4LFxuICAgICAgICAgIHNoaXBwaW5nOiBvcmRlci5zaGlwcGluZyxcbiAgICAgICAgICB0b3RhbDogb3JkZXIudG90YWwsXG4gICAgICAgICAgc3RhdHVzOiBvcmRlci5zdGF0dXMsXG4gICAgICAgICAgY3JlYXRlZEF0OiBvcmRlci5jcmVhdGVkQXRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgZ3Vlc3Qgb3JkZXI6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ09SREVSX0NSRUFUSU9OX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgZ3Vlc3Qgb3JkZXInXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBDcmVhdGUgb3JkZXIgZm9yIHJlZ2lzdGVyZWQgdXNlclxucm91dGVyLnBvc3QoJy9yZWdpc3RlcmVkJywgYXV0aGVudGljYXRlVG9rZW4sIHZhbGlkYXRlQ1NSRlRva2VuLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICAvLyBFbnN1cmUgdXNlciBpcyBhdXRoZW50aWNhdGVkXG4gICAgaWYgKCFyZXEudXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0FVVEhFTlRJQ0FUSU9OX1JFUVVJUkVEJyxcbiAgICAgICAgICBtZXNzYWdlOiAnWW91IG11c3QgYmUgbG9nZ2VkIGluIHRvIHBsYWNlIGFuIG9yZGVyJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICBzaGlwcGluZ0FkZHJlc3MsXG4gICAgICBiaWxsaW5nQWRkcmVzcyxcbiAgICAgIGl0ZW1zOiByZXF1ZXN0SXRlbXMsXG4gICAgICBub3RlcyxcbiAgICAgIHJlZmVycmFsU291cmNlLFxuICAgICAgdXNlRGVmYXVsdEFkZHJlc3NlcyA9IGZhbHNlXG4gICAgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gVXNlIGRlZmF1bHQgYWRkcmVzc2VzIGlmIHJlcXVlc3RlZCBhbmQgYXZhaWxhYmxlXG4gICAgbGV0IGZpbmFsU2hpcHBpbmdBZGRyZXNzID0gc2hpcHBpbmdBZGRyZXNzO1xuICAgIGxldCBmaW5hbEJpbGxpbmdBZGRyZXNzID0gYmlsbGluZ0FkZHJlc3M7XG5cbiAgICBpZiAodXNlRGVmYXVsdEFkZHJlc3Nlcykge1xuICAgICAgY29uc3QgZGVmYXVsdFNoaXBwaW5nID0gcmVxLnVzZXIuZ2V0RGVmYXVsdFNoaXBwaW5nQWRkcmVzcygpO1xuICAgICAgY29uc3QgZGVmYXVsdEJpbGxpbmcgPSByZXEudXNlci5nZXREZWZhdWx0QmlsbGluZ0FkZHJlc3MoKTtcbiAgICAgIFxuICAgICAgaWYgKGRlZmF1bHRTaGlwcGluZykge1xuICAgICAgICBmaW5hbFNoaXBwaW5nQWRkcmVzcyA9IGRlZmF1bHRTaGlwcGluZy50b09iamVjdCgpO1xuICAgICAgICBkZWxldGUgZmluYWxTaGlwcGluZ0FkZHJlc3MuX2lkO1xuICAgICAgICBkZWxldGUgZmluYWxTaGlwcGluZ0FkZHJlc3MudHlwZTtcbiAgICAgICAgZGVsZXRlIGZpbmFsU2hpcHBpbmdBZGRyZXNzLmlzRGVmYXVsdDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGRlZmF1bHRCaWxsaW5nKSB7XG4gICAgICAgIGZpbmFsQmlsbGluZ0FkZHJlc3MgPSBkZWZhdWx0QmlsbGluZy50b09iamVjdCgpO1xuICAgICAgICBkZWxldGUgZmluYWxCaWxsaW5nQWRkcmVzcy5faWQ7XG4gICAgICAgIGRlbGV0ZSBmaW5hbEJpbGxpbmdBZGRyZXNzLnR5cGU7XG4gICAgICAgIGRlbGV0ZSBmaW5hbEJpbGxpbmdBZGRyZXNzLmlzRGVmYXVsdDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBhZGRyZXNzZXNcbiAgICBpZiAoIWZpbmFsU2hpcHBpbmdBZGRyZXNzIHx8ICFmaW5hbEJpbGxpbmdBZGRyZXNzKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnTUlTU0lOR19BRERSRVNTRVMnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdTaGlwcGluZyBhbmQgYmlsbGluZyBhZGRyZXNzZXMgYXJlIHJlcXVpcmVkJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBHZXQgaXRlbXMgZnJvbSB1c2VyJ3MgY2FydCBpZiBub3QgcHJvdmlkZWRcbiAgICBsZXQgaXRlbXNUb1Byb2Nlc3MgPSByZXF1ZXN0SXRlbXM7XG4gICAgaWYgKCFpdGVtc1RvUHJvY2VzcyB8fCBpdGVtc1RvUHJvY2Vzcy5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vIEZldGNoIGZyb20gdXNlcidzIGNhcnRcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHJlcS51c2VyLl9pZCk7XG4gICAgICBpZiAoIXVzZXIuY2FydCB8fCAhdXNlci5jYXJ0Lml0ZW1zIHx8IHVzZXIuY2FydC5pdGVtcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgY29kZTogJ0VNUFRZX0NBUlQnLFxuICAgICAgICAgICAgbWVzc2FnZTogJ1lvdXIgY2FydCBpcyBlbXB0eSdcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaXRlbXNUb1Byb2Nlc3MgPSB1c2VyLmNhcnQuaXRlbXMubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgcHJvZHVjdElkOiBpdGVtLnByb2R1Y3QsXG4gICAgICAgIHF1YW50aXR5OiBpdGVtLnF1YW50aXR5XG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgYW5kIHByb2Nlc3MgY2FydCBpdGVtcyAoc2FtZSBsb2dpYyBhcyBndWVzdCBjaGVja291dClcbiAgICBjb25zdCBvcmRlckl0ZW1zID0gW107XG4gICAgbGV0IHN1YnRvdGFsID0gMDtcblxuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtc1RvUHJvY2Vzcykge1xuICAgICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuZmluZEJ5SWQoaXRlbS5wcm9kdWN0SWQpO1xuICAgICAgXG4gICAgICBpZiAoIXByb2R1Y3QgfHwgIXByb2R1Y3QuaXNBY3RpdmUpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgY29kZTogJ0lOVkFMSURfUFJPRFVDVCcsXG4gICAgICAgICAgICBtZXNzYWdlOiBgUHJvZHVjdCAke2l0ZW0ucHJvZHVjdElkfSBub3QgZm91bmQgb3IgdW5hdmFpbGFibGVgXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaXRlbVRvdGFsID0gcHJvZHVjdC5wcmljZSAqIGl0ZW0ucXVhbnRpdHk7XG4gICAgICBzdWJ0b3RhbCArPSBpdGVtVG90YWw7XG5cbiAgICAgIG9yZGVySXRlbXMucHVzaCh7XG4gICAgICAgIHByb2R1Y3Q6IHByb2R1Y3QuX2lkLFxuICAgICAgICBxdWFudGl0eTogaXRlbS5xdWFudGl0eSxcbiAgICAgICAgcHJpY2U6IHByb2R1Y3QucHJpY2UsXG4gICAgICAgIHdob2xlc2FsZXI6IHtcbiAgICAgICAgICBuYW1lOiBwcm9kdWN0Lndob2xlc2FsZXIubmFtZSxcbiAgICAgICAgICBlbWFpbDogcHJvZHVjdC53aG9sZXNhbGVyLmVtYWlsLFxuICAgICAgICAgIHByb2R1Y3RDb2RlOiBwcm9kdWN0Lndob2xlc2FsZXIucHJvZHVjdENvZGUsXG4gICAgICAgICAgbm90aWZpZWQ6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSB0b3RhbHNcbiAgICBjb25zdCB0YXggPSBNYXRoLnJvdW5kKHN1YnRvdGFsICogMC4wOCAqIDEwMCkgLyAxMDA7XG4gICAgY29uc3Qgc2hpcHBpbmcgPSBzdWJ0b3RhbCA+IDUwID8gMCA6IDUuOTk7XG4gICAgY29uc3QgdG90YWwgPSBNYXRoLnJvdW5kKChzdWJ0b3RhbCArIHRheCArIHNoaXBwaW5nKSAqIDEwMCkgLyAxMDA7XG5cbiAgICAvLyBDcmVhdGUgb3JkZXIgZm9yIHJlZ2lzdGVyZWQgdXNlclxuICAgIGNvbnN0IG9yZGVyRGF0YSA9IHtcbiAgICAgIGN1c3RvbWVyOiByZXEudXNlci5faWQsXG4gICAgICBpdGVtczogb3JkZXJJdGVtcyxcbiAgICAgIHNoaXBwaW5nQWRkcmVzczogZmluYWxTaGlwcGluZ0FkZHJlc3MsXG4gICAgICBiaWxsaW5nQWRkcmVzczogZmluYWxCaWxsaW5nQWRkcmVzcyxcbiAgICAgIHN1YnRvdGFsOiBNYXRoLnJvdW5kKHN1YnRvdGFsICogMTAwKSAvIDEwMCxcbiAgICAgIHRheCxcbiAgICAgIHNoaXBwaW5nLFxuICAgICAgdG90YWwsXG4gICAgICBwYXltZW50OiB7XG4gICAgICAgIG1ldGhvZDogJ290aGVyJyxcbiAgICAgICAgc3RhdHVzOiAncGVuZGluZydcbiAgICAgIH0sXG4gICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgIG5vdGVzLFxuICAgICAgcmVmZXJyYWxTb3VyY2VcbiAgICB9O1xuXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlci5jcmVhdGUob3JkZXJEYXRhKTtcbiAgICBcbiAgICAvLyBQb3B1bGF0ZSBwcm9kdWN0IGRldGFpbHMgZm9yIGVtYWlsXG4gICAgYXdhaXQgb3JkZXIucG9wdWxhdGUoJ2l0ZW1zLnByb2R1Y3QnLCAnbmFtZSBzbHVnIGltYWdlcycpO1xuXG4gICAgLy8gU2VuZCBvcmRlciBjb25maXJtYXRpb24gZW1haWwgZm9yIHJlZ2lzdGVyZWQgdXNlclxuICAgIHRyeSB7XG4gICAgICBpZiAocmVxLnVzZXIud2FudHNFbWFpbCgnb3JkZXJDb25maXJtYXRpb25zJykpIHtcbiAgICAgICAgY29uc3QgeyBzZW5kT3JkZXJDb25maXJtYXRpb24gfSA9IHJlcXVpcmUoJy4uL3V0aWxzL2VtYWlsU2VydmljZScpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZW1haWxEYXRhID0ge1xuICAgICAgICAgIG9yZGVyTnVtYmVyOiBvcmRlci5vcmRlck51bWJlcixcbiAgICAgICAgICBjdXN0b21lck5hbWU6IGAke3JlcS51c2VyLmZpcnN0TmFtZX0gJHtyZXEudXNlci5sYXN0TmFtZX1gLFxuICAgICAgICAgIGl0ZW1zOiBvcmRlci5pdGVtcy5tYXAoaXRlbSA9PiAoe1xuICAgICAgICAgICAgcHJvZHVjdE5hbWU6IGl0ZW0ucHJvZHVjdC5uYW1lLFxuICAgICAgICAgICAgcXVhbnRpdHk6IGl0ZW0ucXVhbnRpdHksXG4gICAgICAgICAgICBwcmljZTogaXRlbS5wcmljZVxuICAgICAgICAgIH0pKSxcbiAgICAgICAgICB0b3RhbDogb3JkZXIudG90YWwsXG4gICAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiBvcmRlci5zaGlwcGluZ0FkZHJlc3NcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBlbWFpbFJlc3VsdCA9IGF3YWl0IHNlbmRPcmRlckNvbmZpcm1hdGlvbihyZXEudXNlci5lbWFpbCwgZW1haWxEYXRhKTtcbiAgICAgICAgaWYgKCFlbWFpbFJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNlbmQgb3JkZXIgY29uZmlybWF0aW9uIGVtYWlsOicsIGVtYWlsUmVzdWx0LmVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVtYWlsRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNlbmRpbmcgb3JkZXIgY29uZmlybWF0aW9uIGVtYWlsOicsIGVtYWlsRXJyb3IpO1xuICAgIH1cblxuICAgIC8vIENsZWFyIHVzZXIncyBjYXJ0XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQocmVxLnVzZXIuX2lkKTtcbiAgICB1c2VyLmNhcnQgPSB7IGl0ZW1zOiBbXSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH07XG4gICAgYXdhaXQgdXNlci5zYXZlKCk7XG4gICAgXG4gICAgLy8gQ2xlYXIgY2FydCBzZXNzaW9uXG4gICAgaWYgKHJlcS5zZXNzaW9uICYmIHJlcS5zZXNzaW9uLmNhcnQpIHtcbiAgICAgIHJlcS5zZXNzaW9uLmNhcnQgPSBbXTtcbiAgICB9XG5cbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ09yZGVyIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIG9yZGVyOiB7XG4gICAgICAgIF9pZDogb3JkZXIuX2lkLFxuICAgICAgICBvcmRlck51bWJlcjogb3JkZXIub3JkZXJOdW1iZXIsXG4gICAgICAgIHRvdGFsOiBvcmRlci50b3RhbCxcbiAgICAgICAgc3RhdHVzOiBvcmRlci5zdGF0dXMsXG4gICAgICAgIGNyZWF0ZWRBdDogb3JkZXIuY3JlYXRlZEF0XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZWdpc3RlcmVkIHVzZXIgb3JkZXI6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ09SREVSX0NSRUFUSU9OX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgb3JkZXInXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBHZXQgb3JkZXIgYnkgSUQgKHN1cHBvcnRzIGJvdGggYXV0aGVudGljYXRlZCBhbmQgZ3Vlc3Qgb3JkZXJzKVxucm91dGVyLmdldCgnLzppZCcsIGF1dGhlbnRpY2F0ZVRva2VuLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpXG4gICAgICAucG9wdWxhdGUoJ2l0ZW1zLnByb2R1Y3QnLCAnLXdob2xlc2FsZXInKVxuICAgICAgLnBvcHVsYXRlKCdjdXN0b21lcicsICdmaXJzdE5hbWUgbGFzdE5hbWUgZW1haWwnKTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdPUkRFUl9OT1RfRk9VTkQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEZvciBndWVzdCBvcmRlcnMsIGFsbG93IGFjY2VzcyB3aXRob3V0IGF1dGhlbnRpY2F0aW9uXG4gICAgLy8gRm9yIGF1dGhlbnRpY2F0ZWQgdXNlcnMsIGNoZWNrIG93bmVyc2hpcCAodW5sZXNzIGFkbWluKVxuICAgIGlmIChyZXEudXNlcikge1xuICAgICAgaWYgKCFyZXEudXNlci5pc0FkbWluICYmIG9yZGVyLmN1c3RvbWVyICYmIG9yZGVyLmN1c3RvbWVyLl9pZC50b1N0cmluZygpICE9PSByZXEudXNlci5faWQudG9TdHJpbmcoKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICBjb2RlOiAnQUNDRVNTX0RFTklFRCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnWW91IGNhbiBvbmx5IGFjY2VzcyB5b3VyIG93biBvcmRlcnMnXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gR3Vlc3Qgb3JkZXJzIChubyBjdXN0b21lciBmaWVsZCkgYXJlIGFjY2Vzc2libGUgd2l0aG91dCBhdXRoXG5cbiAgICAvLyBSZXR1cm4gcHVibGljIG9yZGVyIGRhdGEgKGV4Y2x1ZGVzIHNlbnNpdGl2ZSB3aG9sZXNhbGVyIGluZm8pXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgb3JkZXI6IG9yZGVyLnRvUHVibGljSlNPTigpXG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBvcmRlcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnT1JERVJfRkVUQ0hfRVJST1InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIG9yZGVyJ1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59KTtcblxuLy8gR2V0IG9yZGVyIGhpc3RvcnkgZm9yIHJlZ2lzdGVyZWQgdXNlclxucm91dGVyLmdldCgnLycsIGF1dGhlbnRpY2F0ZVRva2VuLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICAvLyBFbnN1cmUgdXNlciBpcyBhdXRoZW50aWNhdGVkXG4gICAgaWYgKCFyZXEudXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0FVVEhFTlRJQ0FUSU9OX1JFUVVJUkVEJyxcbiAgICAgICAgICBtZXNzYWdlOiAnWW91IG11c3QgYmUgbG9nZ2VkIGluIHRvIHZpZXcgb3JkZXJzJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQocmVxLnF1ZXJ5LnBhZ2UpIHx8IDE7XG4gICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDEwO1xuICAgIGNvbnN0IHNraXAgPSAocGFnZSAtIDEpICogbGltaXQ7XG5cbiAgICBcbiAgICBjb25zdCBvcmRlcnMgPSBhd2FpdCBPcmRlci5maW5kKHsgY3VzdG9tZXI6IHJlcS51c2VyLl9pZCB9KVxuICAgICAgLnBvcHVsYXRlKCdpdGVtcy5wcm9kdWN0JywgJ25hbWUgc2x1ZyBpbWFnZXMgcHJpY2UnKVxuICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pXG4gICAgICAuc2tpcChza2lwKVxuICAgICAgLmxpbWl0KGxpbWl0KTtcblxuICAgIGNvbnN0IHRvdGFsT3JkZXJzID0gYXdhaXQgT3JkZXIuY291bnREb2N1bWVudHMoeyBjdXN0b21lcjogcmVxLnVzZXIuX2lkIH0pO1xuICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWxPcmRlcnMgLyBsaW1pdCk7XG4gICAgXG4gICAgXG5cbiAgICAvLyBSZXR1cm4gcHVibGljIG9yZGVyIGRhdGFcbiAgICBjb25zdCBwdWJsaWNPcmRlcnMgPSBvcmRlcnMubWFwKG9yZGVyID0+IG9yZGVyLnRvUHVibGljSlNPTigpKTtcblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG9yZGVyczogcHVibGljT3JkZXJzLFxuICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgY3VycmVudFBhZ2U6IHBhZ2UsXG4gICAgICAgICAgdG90YWxQYWdlcyxcbiAgICAgICAgICB0b3RhbE9yZGVycyxcbiAgICAgICAgICBoYXNOZXh0UGFnZTogcGFnZSA8IHRvdGFsUGFnZXMsXG4gICAgICAgICAgaGFzUHJldlBhZ2U6IHBhZ2UgPiAxXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIG9yZGVyIGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ09SREVSX0hJU1RPUllfRVJST1InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIG9yZGVyIGhpc3RvcnknXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBBc3NvY2lhdGUgb3JkZXIgd2l0aCBhdXRoZW50aWNhdGVkIHVzZXJcbnJvdXRlci5wb3N0KCcvOmlkL2Fzc29jaWF0ZScsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgIFxuICAgIC8vIEZpbmQgdGhlIG9yZGVyXG4gICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlci5maW5kQnlJZChpZCk7XG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ09SREVSX05PVF9GT1VORCcsXG4gICAgICAgICAgbWVzc2FnZTogJ09yZGVyIG5vdCBmb3VuZCdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgb3JkZXIgaXMgYWxyZWFkeSBhc3NvY2lhdGVkIHdpdGggYSB1c2VyXG4gICAgaWYgKG9yZGVyLmN1c3RvbWVyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnT1JERVJfQUxSRUFEWV9BU1NPQ0lBVEVEJyxcbiAgICAgICAgICBtZXNzYWdlOiAnT3JkZXIgaXMgYWxyZWFkeSBhc3NvY2lhdGVkIHdpdGggYSB1c2VyJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBBc3NvY2lhdGUgb3JkZXIgd2l0aCB0aGUgYXV0aGVudGljYXRlZCB1c2VyXG4gICAgb3JkZXIuY3VzdG9tZXIgPSByZXEudXNlci5faWQ7XG4gICAgYXdhaXQgb3JkZXIuc2F2ZSgpO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdPcmRlciBzdWNjZXNzZnVsbHkgYXNzb2NpYXRlZCB3aXRoIHlvdXIgYWNjb3VudCdcbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFzc29jaWF0aW5nIG9yZGVyOicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdPUkRFUl9BU1NPQ0lBVElPTl9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gYXNzb2NpYXRlIG9yZGVyIHdpdGggYWNjb3VudCdcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIFVwZGF0ZSBvcmRlciBzdGF0dXMgKGFkbWluIG9ubHkgLSBwbGFjZWhvbGRlciBmb3Igbm93KVxucm91dGVyLnB1dCgnLzppZC9zdGF0dXMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHN0YXR1cywgdHJhY2tpbmdOdW1iZXIgfSA9IHJlcS5ib2R5O1xuICAgIFxuICAgIGNvbnN0IHZhbGlkU3RhdHVzZXMgPSBbJ3BlbmRpbmcnLCAncHJvY2Vzc2luZycsICdzaGlwcGVkJywgJ2RlbGl2ZXJlZCcsICdjYW5jZWxsZWQnXTtcbiAgICBpZiAoIXZhbGlkU3RhdHVzZXMuaW5jbHVkZXMoc3RhdHVzKSkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfU1RBVFVTJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBvcmRlciBzdGF0dXMnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7IHN0YXR1cyB9O1xuICAgIGlmICh0cmFja2luZ051bWJlcikge1xuICAgICAgdXBkYXRlRGF0YS50cmFja2luZ051bWJlciA9IHRyYWNraW5nTnVtYmVyO1xuICAgIH1cblxuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXIuZmluZEJ5SWRBbmRVcGRhdGUoXG4gICAgICByZXEucGFyYW1zLmlkLFxuICAgICAgdXBkYXRlRGF0YSxcbiAgICAgIHsgbmV3OiB0cnVlIH1cbiAgICApLnBvcHVsYXRlKCdjdXN0b21lcicsICdmaXJzdE5hbWUgbGFzdE5hbWUgZW1haWwgcHJlZmVyZW5jZXMnKTtcblxuICAgIGlmICghb3JkZXIpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdPUkRFUl9OT1RfRk9VTkQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdPcmRlciBub3QgZm91bmQnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFNlbmQgc3RhdHVzIHVwZGF0ZSBlbWFpbFxuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHNlbmRPcmRlclN0YXR1c1VwZGF0ZSB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvZW1haWxTZXJ2aWNlJyk7XG4gICAgICBcbiAgICAgIGxldCBjdXN0b21lckVtYWlsLCBjdXN0b21lck5hbWUsIHNob3VsZFNlbmRFbWFpbCA9IHRydWU7XG4gICAgICBcbiAgICAgIGlmIChvcmRlci5jdXN0b21lcikge1xuICAgICAgICAvLyBSZWdpc3RlcmVkIHVzZXJcbiAgICAgICAgY3VzdG9tZXJFbWFpbCA9IG9yZGVyLmN1c3RvbWVyLmVtYWlsO1xuICAgICAgICBjdXN0b21lck5hbWUgPSBgJHtvcmRlci5jdXN0b21lci5maXJzdE5hbWV9ICR7b3JkZXIuY3VzdG9tZXIubGFzdE5hbWV9YDtcbiAgICAgICAgc2hvdWxkU2VuZEVtYWlsID0gb3JkZXIuY3VzdG9tZXIucHJlZmVyZW5jZXM/LmVtYWlsUHJlZmVyZW5jZXM/Lm9yZGVyVXBkYXRlcyAhPT0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBHdWVzdCB1c2VyXG4gICAgICAgIGN1c3RvbWVyRW1haWwgPSBvcmRlci5ndWVzdEluZm8uZW1haWw7XG4gICAgICAgIGN1c3RvbWVyTmFtZSA9IGAke29yZGVyLmd1ZXN0SW5mby5maXJzdE5hbWV9ICR7b3JkZXIuZ3Vlc3RJbmZvLmxhc3ROYW1lfWA7XG4gICAgICB9XG5cbiAgICAgIGlmIChzaG91bGRTZW5kRW1haWwgJiYgWydwcm9jZXNzaW5nJywgJ3NoaXBwZWQnLCAnZGVsaXZlcmVkJ10uaW5jbHVkZXMoc3RhdHVzKSkge1xuICAgICAgICBjb25zdCBzdGF0dXNEYXRhID0ge1xuICAgICAgICAgIG9yZGVyTnVtYmVyOiBvcmRlci5vcmRlck51bWJlcixcbiAgICAgICAgICBjdXN0b21lck5hbWUsXG4gICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgIHRyYWNraW5nTnVtYmVyXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZW1haWxSZXN1bHQgPSBhd2FpdCBzZW5kT3JkZXJTdGF0dXNVcGRhdGUoY3VzdG9tZXJFbWFpbCwgc3RhdHVzRGF0YSk7XG4gICAgICAgIGlmICghZW1haWxSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIG9yZGVyIHN0YXR1cyB1cGRhdGUgZW1haWw6JywgZW1haWxSZXN1bHQuZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZW1haWxFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2VuZGluZyBvcmRlciBzdGF0dXMgdXBkYXRlIGVtYWlsOicsIGVtYWlsRXJyb3IpO1xuICAgIH1cblxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnT3JkZXIgc3RhdHVzIHVwZGF0ZWQnLFxuICAgICAgb3JkZXI6IHtcbiAgICAgICAgX2lkOiBvcmRlci5faWQsXG4gICAgICAgIG9yZGVyTnVtYmVyOiBvcmRlci5vcmRlck51bWJlcixcbiAgICAgICAgc3RhdHVzOiBvcmRlci5zdGF0dXMsXG4gICAgICAgIHRyYWNraW5nTnVtYmVyOiBvcmRlci50cmFja2luZ051bWJlcixcbiAgICAgICAgdXBkYXRlZEF0OiBvcmRlci51cGRhdGVkQXRcbiAgICAgIH1cbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIG9yZGVyIHN0YXR1czonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnT1JERVJfVVBEQVRFX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgb3JkZXIgc3RhdHVzJ1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU07RUFBRUMsSUFBSTtFQUFFQztBQUFpQixDQUFDLEdBQUdKLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUMvRCxNQUFNSyxLQUFLLEdBQUdMLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztBQUN4QyxNQUFNTSxPQUFPLEdBQUdOLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUM1QyxNQUFNTyxJQUFJLEdBQUdQLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUN0QyxNQUFNO0VBQUVRLGlCQUFpQjtFQUFFQztBQUFZLENBQUMsR0FBR1QsT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBQ3hFLE1BQU07RUFBRVU7QUFBa0IsQ0FBQyxHQUFHVixPQUFPLENBQUMsMkJBQTJCLENBQUM7O0FBRWxFO0FBQ0EsTUFBTVcscUJBQXFCLEdBQUcsQ0FDNUJSLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUNwQlMsT0FB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QUMyQyxTQUFTLElBQUlHLEtBQUssQ0FBQzlDLFNBQVMsQ0FBQzRDLFFBQVEsRUFBRTtNQUMzRTtNQUVBLElBQUlnRSxlQUFlLElBQUksQ0FBQyxZQUFZLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDTixRQUFRLENBQUM5RyxNQUFNLENBQUMsRUFBRTtRQUM5RSxNQUFNd0gsVUFBVSxHQUFHO1VBQ2pCN0QsV0FBVyxFQUFFTCxLQUFLLENBQUNLLFdBQVc7VUFDOUJDLFlBQVk7VUFDWjVELE1BQU07VUFDTjRHO1FBQ0YsQ0FBQztRQUVELE1BQU05QyxXQUFXLEdBQUcsTUFBTW9ELHFCQUFxQixDQUFDQyxhQUFhLEVBQUVLLFVBQVUsQ0FBQztRQUMxRSxJQUFJLENBQUMxRCxXQUFXLENBQUM1RCxPQUFPLEVBQUU7VUFDeEI2RCxPQUFPLENBQUM1RCxLQUFLLENBQUMsMkNBQTJDLEVBQUUyRCxXQUFXLENBQUMzRCxLQUFLLENBQUM7UUFDL0U7TUFDRjtJQUNGLENBQUMsQ0FBQyxPQUFPNkQsVUFBVSxFQUFFO01BQ25CRCxPQUFPLENBQUM1RCxLQUFLLENBQUMsMENBQTBDLEVBQUU2RCxVQUFVLENBQUM7SUFDdkU7SUFFQW5FLEdBQUcsQ0FBQ0ksSUFBSSxDQUFDO01BQ1BDLE9BQU8sRUFBRSxJQUFJO01BQ2JHLE9BQU8sRUFBRSxzQkFBc0I7TUFDL0JpRCxLQUFLLEVBQUU7UUFDTC9CLEdBQUcsRUFBRStCLEtBQUssQ0FBQy9CLEdBQUc7UUFDZG9DLFdBQVcsRUFBRUwsS0FBSyxDQUFDSyxXQUFXO1FBQzlCM0QsTUFBTSxFQUFFc0QsS0FBSyxDQUFDdEQsTUFBTTtRQUNwQjRHLGNBQWMsRUFBRXRELEtBQUssQ0FBQ3NELGNBQWM7UUFDcEN6QixTQUFTLEVBQUU3QixLQUFLLENBQUM2QjtNQUNuQjtJQUNGLENBQUMsQ0FBQztFQUVKLENBQUMsQ0FBQyxPQUFPaEYsS0FBSyxFQUFFO0lBQ2Q0RCxPQUFPLENBQUM1RCxLQUFLLENBQUMsOEJBQThCLEVBQUVBLEtBQUssQ0FBQztJQUNwRE4sR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztNQUNuQkMsT0FBTyxFQUFFLEtBQUs7TUFDZEMsS0FBSyxFQUFFO1FBQ0xDLElBQUksRUFBRSxvQkFBb0I7UUFDMUJDLE9BQU8sRUFBRTtNQUNYO0lBQ0YsQ0FBQyxDQUFDO0VBQ0o7QUFDRixDQUFDLENBQUM7QUFFRm9ILE1BQU0sQ0FBQ0MsT0FBTyxHQUFHdEosTUFBTSIsImlnbm9yZUxpc3QiOltdfQ==
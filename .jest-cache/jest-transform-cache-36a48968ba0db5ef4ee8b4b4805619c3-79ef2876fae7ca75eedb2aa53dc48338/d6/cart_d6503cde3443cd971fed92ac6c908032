57ef674cba3950835767e1a90134dd03
const express = require('express');
const router = express.Router();
const Product = require('../models/Product');
const User = require('../models/User');
const Cart = require('../models/Cart');
const {
  authenticateToken
} = require('../middleware/auth');
const {
  validateCSRFToken
} = require('../middleware/sessionCSRF');
const cartService = require('../services/cartService');

// Cleanup invalid cart sessions on startup
const cleanupInvalidCarts = async () => {
  try {
    const result = await Cart.deleteMany({
      sessionId: {
        $not: /^guest_/
      }
    });
    if (result.deletedCount > 0) {
      console.log(`Cleaned up ${result.deletedCount} invalid cart sessions`);
    }
  } catch (error) {
    console.error('Error cleaning up invalid carts:', error);
  }
};

// Run cleanup on startup
cleanupInvalidCarts();

// Helper function to get or create cart
const getOrCreateCart = async req => {
  if (req.user) {
    // For authenticated users, use user's cart
    const user = await User.findById(req.user._id);
    if (!user.cart) {
      user.cart = {
        items: [],
        updatedAt: new Date()
      };
      await user.save();
    }
    return {
      type: 'user',
      cart: user.cart,
      user
    };
  } else {
    // For guests, use ONLY frontend-provided session IDs
    let sessionId = req.headers['x-guest-session-id'];

    // STRICT: Must have valid frontend session ID
    if (!sessionId || !sessionId.startsWith('guest_')) {
      return {
        type: 'error',
        error: 'Invalid or missing guest session ID',
        code: 'INVALID_SESSION'
      };
    }

    // Find or create cart with the frontend session ID
    let cart = await Cart.findOne({
      sessionId
    });
    if (!cart) {
      cart = new Cart({
        sessionId,
        items: []
      });
      await cart.save();
    }
    return {
      type: 'guest',
      cart,
      sessionId
    };
  }
};

// Get cart contents with performance optimization
router.get('/', authenticateToken, async (req, res) => {
  try {
    const cartData = await getOrCreateCart(req);

    // Handle session errors
    if (cartData.type === 'error') {
      return res.status(400).json({
        success: false,
        error: {
          code: cartData.code,
          message: cartData.error
        }
      });
    }
    const {
      type,
      cart,
      user
    } = cartData;

    // Populate product details for cart items
    const populatedCart = await Promise.all(cart.items.map(async item => {
      try {
        const product = await Product.findById(item.product).select('-wholesaler');
        if (!product || !product.isActive) {
          return null; // Filter out inactive products
        }
        return {
          _id: item.product,
          product: product.toPublicJSON(),
          quantity: item.quantity,
          price: item.price,
          subtotal: item.price * item.quantity
        };
      } catch (error) {
        console.error('Error populating cart item:', error);
        return null;
      }
    }));

    // Filter out null items (inactive products)
    const validCartItems = populatedCart.filter(item => item !== null);

    // Calculate totals
    const itemCount = validCartItems.reduce((total, item) => total + item.quantity, 0);
    const subtotal = validCartItems.reduce((total, item) => total + item.subtotal, 0);
    res.json({
      success: true,
      data: {
        cart: {
          items: validCartItems,
          itemCount,
          subtotal: Math.round(subtotal * 100) / 100,
          total: Math.round(subtotal * 100) / 100,
          isEmpty: validCartItems.length === 0
        }
      }
    });
  } catch (error) {
    console.error('Error fetching cart:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'CART_FETCH_ERROR',
        message: 'Failed to fetch cart'
      }
    });
  }
});

// Add item to cart with optimistic updates
router.post('/add', authenticateToken, validateCSRFToken, async (req, res) => {
  try {
    const {
      productId,
      quantity = 1
    } = req.body;

    // Validation
    if (!productId) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'MISSING_PRODUCT_ID',
          message: 'Product ID is required'
        }
      });
    }
    if (!Number.isInteger(quantity) || quantity < 1 || quantity > 99) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'INVALID_QUANTITY',
          message: 'Quantity must be between 1 and 99'
        }
      });
    }

    // Validate product ID format
    if (!productId.match(/^[0-9a-fA-F]{24}$/)) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'INVALID_PRODUCT_ID',
          message: 'Invalid product ID format'
        }
      });
    }

    // Check if product exists and is active
    const product = await Product.findById(productId);
    if (!product) {
      return res.status(404).json({
        success: false,
        error: {
          code: 'PRODUCT_NOT_FOUND',
          message: 'Product not found'
        }
      });
    }
    if (!product.isActive) {
      return res.status(404).json({
        success: false,
        error: {
          code: 'PRODUCT_NOT_FOUND',
          message: 'Product not found or inactive'
        }
      });
    }

    // Check for existing item and validate maximum quantity
    const {
      type,
      cart,
      user
    } = await getOrCreateCart(req);
    if (type === 'user') {
      const existingItemIndex = user.cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (existingItemIndex >= 0) {
        const currentQuantity = user.cart.items[existingItemIndex].quantity;
        if (currentQuantity + quantity > 99) {
          return res.status(400).json({
            success: false,
            error: {
              code: 'MAX_QUANTITY_EXCEEDED',
              message: 'Cannot exceed maximum quantity of 99'
            }
          });
        }
      }
    } else {
      const existingItemIndex = cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (existingItemIndex >= 0) {
        const currentQuantity = cart.items[existingItemIndex].quantity;
        if (currentQuantity + quantity > 99) {
          return res.status(400).json({
            success: false,
            error: {
              code: 'MAX_QUANTITY_EXCEEDED',
              message: 'Cannot exceed maximum quantity of 99'
            }
          });
        }
      }
    }

    // Use optimistic cart service with fallback
    let result;
    try {
      result = await cartService.updateCartOptimistically(req, 'add', {
        productId,
        quantity
      });
    } catch (serviceError) {
      console.warn('Cart service failed, using fallback:', serviceError.message);
      // Fallback to original logic - need to re-fetch cart since service failed
      const fallbackCart = await getOrCreateCart(req);
      if (fallbackCart.type === 'user') {
        // Add to user's cart
        const existingItemIndex = fallbackCart.user.cart.items.findIndex(item => item.product.toString() === productId.toString());
        if (existingItemIndex >= 0) {
          fallbackCart.user.cart.items[existingItemIndex].quantity += quantity;
          fallbackCart.user.cart.items[existingItemIndex].addedAt = new Date();
        } else {
          fallbackCart.user.cart.items.push({
            product: productId,
            quantity,
            price: product.price,
            addedAt: new Date()
          });
        }
        fallbackCart.user.cart.updatedAt = new Date();
        await fallbackCart.user.save();
      } else {
        // Add to guest cart - use the Cart model method
        if (fallbackCart.cart.addItem && typeof fallbackCart.cart.addItem === 'function') {
          fallbackCart.cart.addItem(productId, quantity, product.price);
        } else {
          // Fallback: manually add item
          const existingItemIndex = fallbackCart.cart.items.findIndex(item => item.product.toString() === productId.toString());
          if (existingItemIndex >= 0) {
            fallbackCart.cart.items[existingItemIndex].quantity += quantity;
            fallbackCart.cart.items[existingItemIndex].addedAt = new Date();
          } else {
            fallbackCart.cart.items.push({
              product: productId,
              quantity,
              price: product.price,
              addedAt: new Date()
            });
          }
        }
        await fallbackCart.cart.save();
      }
      result = {
        duration: 0,
        performance: 'fallback'
      };
    }

    // Return updated cart with performance metrics
    let updatedCartData;
    try {
      updatedCartData = await cartService.getCartWithPerformanceOptimization(req);
    } catch (serviceError) {
      console.warn('Cart service failed after add, using fallback:', serviceError.message);
      updatedCartData = await getOrCreateCart(req);
    }
    const populatedCart = await Promise.all(updatedCartData.cart.items.map(async item => {
      const prod = await Product.findById(item.product).select('-wholesaler');
      if (!prod) {
        return null; // Filter out missing products
      }
      return {
        _id: item.product,
        product: prod.toPublicJSON(),
        quantity: item.quantity,
        price: item.price,
        subtotal: item.price * item.quantity
      };
    })).then(items => items.filter(item => item !== null));
    const itemCount = populatedCart.reduce((total, item) => total + item.quantity, 0);
    const subtotal = populatedCart.reduce((total, item) => total + item.subtotal, 0);
    res.json({
      success: true,
      message: 'Item added to cart',
      data: {
        cart: {
          items: populatedCart,
          itemCount,
          subtotal: Math.round(subtotal * 100) / 100,
          total: Math.round(subtotal * 100) / 100
        },
        performance: {
          duration: result.duration,
          status: result.performance
        }
      }
    });
  } catch (error) {
    console.error('Error adding to cart:', error);
    console.error('Full stack:', error.stack);
    res.status(500).json({
      success: false,
      error: {
        code: 'CART_ADD_ERROR',
        message: 'Failed to add item to cart',
        details: process.env.NODE_ENV === 'development' ? error.message : undefined,
        stack: process.env.NODE_ENV === 'development' ? error.stack : undefined
      }
    });
  }
});

// Update cart item quantity
router.put('/update', authenticateToken, validateCSRFToken, async (req, res) => {
  try {
    const {
      productId,
      quantity
    } = req.body;

    // Validation
    if (!productId) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'MISSING_PRODUCT_ID',
          message: 'Product ID is required'
        }
      });
    }
    if (!Number.isInteger(quantity) || quantity < 0 || quantity > 99) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'INVALID_QUANTITY',
          message: 'Quantity must be between 0 and 99'
        }
      });
    }
    const {
      type,
      cart,
      user
    } = await getOrCreateCart(req);
    if (type === 'user') {
      // Update user's cart
      const itemIndex = user.cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (itemIndex >= 0) {
        if (quantity === 0) {
          user.cart.items.splice(itemIndex, 1);
        } else {
          user.cart.items[itemIndex].quantity = quantity;
          user.cart.items[itemIndex].addedAt = new Date();
        }
        user.cart.updatedAt = new Date();
        await user.save();
      } else {
        return res.status(404).json({
          success: false,
          error: {
            code: 'ITEM_NOT_FOUND',
            message: 'Item not found in cart'
          }
        });
      }
    } else {
      // Update guest cart
      const itemIndex = cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (itemIndex >= 0) {
        if (cart.updateItem && typeof cart.updateItem === 'function') {
          cart.updateItem(productId, quantity);
        } else {
          // Manual update
          if (quantity === 0) {
            cart.items.splice(itemIndex, 1);
          } else {
            cart.items[itemIndex].quantity = quantity;
            cart.items[itemIndex].addedAt = new Date();
          }
          cart.updatedAt = new Date();
        }
        if (cart.save && typeof cart.save === 'function') {
          await cart.save();
        } else {
          // Use findByIdAndUpdate for lean objects
          await Cart.findByIdAndUpdate(cart._id, {
            items: cart.items,
            updatedAt: cart.updatedAt
          }, {
            new: true
          });
        }
      } else {
        return res.status(404).json({
          success: false,
          error: {
            code: 'ITEM_NOT_FOUND',
            message: 'Item not found in cart'
          }
        });
      }
    }

    // Return updated cart
    const updatedCartData = await getOrCreateCart(req);
    const populatedCart = await Promise.all(updatedCartData.cart.items.map(async item => {
      const product = await Product.findById(item.product).select('-wholesaler');
      if (!product || !product.isActive) return null;
      return {
        _id: item.product,
        product: product.toPublicJSON(),
        quantity: item.quantity,
        price: item.price,
        subtotal: item.price * item.quantity
      };
    }));
    const validCartItems = populatedCart.filter(item => item !== null);
    const itemCount = validCartItems.reduce((total, item) => total + item.quantity, 0);
    const subtotal = validCartItems.reduce((total, item) => total + item.subtotal, 0);

    // Check if item was removed (quantity was 0)
    const wasRemoved = quantity === 0;
    res.json({
      success: true,
      message: wasRemoved ? 'Item removed from cart' : 'Cart updated',
      data: {
        cart: {
          items: validCartItems,
          itemCount,
          subtotal: Math.round(subtotal * 100) / 100,
          total: Math.round(subtotal * 100) / 100
        }
      },
      cartItemCount: itemCount
    });
  } catch (error) {
    console.error('Error updating cart:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'CART_UPDATE_ERROR',
        message: 'Failed to update cart'
      }
    });
  }
});

// Remove item from cart
router.delete('/remove', authenticateToken, validateCSRFToken, async (req, res) => {
  try {
    const {
      productId
    } = req.body;
    if (!productId) {
      return res.status(400).json({
        success: false,
        error: {
          code: 'MISSING_PRODUCT_ID',
          message: 'Product ID is required'
        }
      });
    }
    const {
      type,
      cart,
      user
    } = await getOrCreateCart(req);
    if (type === 'user') {
      // Remove from user's cart
      const itemIndex = user.cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (itemIndex >= 0) {
        user.cart.items.splice(itemIndex, 1);
        user.cart.updatedAt = new Date();
        await user.save();
      } else {
        return res.status(404).json({
          success: false,
          error: {
            code: 'ITEM_NOT_FOUND',
            message: 'Item not found in cart'
          }
        });
      }
    } else {
      // Remove from guest cart
      const itemIndex = cart.items.findIndex(item => item.product.toString() === productId.toString());
      if (itemIndex >= 0) {
        if (cart.removeItem && typeof cart.removeItem === 'function') {
          cart.removeItem(productId);
        } else {
          // Manual removal
          cart.items.splice(itemIndex, 1);
          cart.updatedAt = new Date();
        }
        if (cart.save && typeof cart.save === 'function') {
          await cart.save();
        } else {
          // Use findByIdAndUpdate for lean objects
          await Cart.findByIdAndUpdate(cart._id, {
            items: cart.items,
            updatedAt: cart.updatedAt
          }, {
            new: true
          });
        }
      } else {
        return res.status(404).json({
          success: false,
          error: {
            code: 'ITEM_NOT_FOUND',
            message: 'Item not found in cart'
          }
        });
      }
    }

    // Return updated cart
    const updatedCartData = await getOrCreateCart(req);
    const populatedCart = await Promise.all(updatedCartData.cart.items.map(async item => {
      const product = await Product.findById(item.product).select('-wholesaler');
      if (!product || !product.isActive) return null;
      return {
        _id: item.product,
        product: product.toPublicJSON(),
        quantity: item.quantity,
        price: item.price,
        subtotal: item.price * item.quantity
      };
    }));
    const validCartItems = populatedCart.filter(item => item !== null);
    const itemCount = validCartItems.reduce((total, item) => total + item.quantity, 0);
    const subtotal = validCartItems.reduce((total, item) => total + item.subtotal, 0);
    res.json({
      success: true,
      message: 'Item removed from cart',
      data: {
        cart: {
          items: validCartItems,
          itemCount,
          subtotal: Math.round(subtotal * 100) / 100,
          total: Math.round(subtotal * 100) / 100
        }
      },
      cartItemCount: itemCount
    });
  } catch (error) {
    console.error('Error removing from cart:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'CART_REMOVE_ERROR',
        message: 'Failed to remove item from cart'
      }
    });
  }
});

// Clear cart
router.delete('/clear', authenticateToken, validateCSRFToken, async (req, res) => {
  try {
    const {
      type,
      cart,
      user
    } = await getOrCreateCart(req);
    if (type === 'user') {
      // Clear user's cart
      user.cart.items = [];
      user.cart.updatedAt = new Date();
      await user.save();
      console.log('Cleared user cart for user:', user._id);
    } else {
      // Clear guest cart - be more aggressive
      console.log('Clearing guest cart for session:', cart.sessionId);

      // Delete the entire cart record and create a new one
      await Cart.deleteOne({
        sessionId: cart.sessionId
      });

      // Create a fresh cart
      const newCart = new Cart({
        sessionId: cart.sessionId,
        items: []
      });
      await newCart.save();
      console.log('Created fresh guest cart for session:', cart.sessionId);
    }
    res.json({
      success: true,
      message: 'Cart cleared',
      data: {
        cart: {
          items: [],
          itemCount: 0,
          subtotal: 0,
          total: 0,
          isEmpty: true
        }
      },
      cartItemCount: 0
    });
  } catch (error) {
    console.error('Error clearing cart:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'CART_CLEAR_ERROR',
        message: 'Failed to clear cart'
      }
    });
  }
});

// Merge guest cart with user cart with conflict resolution
router.post('/merge', authenticateToken, async (req, res) => {
  try {
    if (!req.user) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'AUTHENTICATION_REQUIRED',
          message: 'User must be authenticated to merge cart'
        }
      });
    }
    const {
      guestCartItems,
      sessionId
    } = req.body;
    console.log('Cart merge request:', {
      userId: req.user._id,
      sessionId,
      guestItemCount: guestCartItems?.length || 0
    });

    // Use enhanced cart service for merging with conflict resolution
    let mergeResult;
    try {
      mergeResult = await cartService.mergeCartsWithConflictResolution(req.user._id, guestCartItems, sessionId);
    } catch (serviceError) {
      console.warn('Cart service merge failed, using fallback:', serviceError.message);
      // Fallback to original merge logic
      const user = await User.findById(req.user._id);
      if (!user.cart) {
        user.cart = {
          items: [],
          updatedAt: new Date()
        };
      }
      let mergedItems = 0;

      // Process guest cart items
      if (guestCartItems && Array.isArray(guestCartItems) && guestCartItems.length > 0) {
        for (const guestItem of guestCartItems) {
          const product = await Product.findById(guestItem.productId || guestItem.product);
          if (!product || !product.isActive) {
            continue;
          }
          const productId = guestItem.productId || guestItem.product;
          const quantity = guestItem.quantity || 1;
          const existingItemIndex = user.cart.items.findIndex(item => item.product.toString() === productId.toString());
          if (existingItemIndex >= 0) {
            user.cart.items[existingItemIndex].quantity += quantity;
            user.cart.items[existingItemIndex].addedAt = new Date();
          } else {
            user.cart.items.push({
              product: productId,
              quantity,
              price: product.price,
              addedAt: new Date()
            });
          }
          mergedItems++;
        }
      }

      // Process session-based cart
      if (sessionId) {
        const guestCart = await Cart.findOne({
          sessionId
        });
        if (guestCart && guestCart.items.length > 0) {
          console.log('Found guest cart with', guestCart.items.length, 'items for session:', sessionId);
          for (const guestItem of guestCart.items) {
            const product = await Product.findById(guestItem.product);
            if (!product || !product.isActive) {
              continue;
            }
            const existingItemIndex = user.cart.items.findIndex(item => item.product.toString() === guestItem.product.toString());
            if (existingItemIndex >= 0) {
              user.cart.items[existingItemIndex].quantity += guestItem.quantity;
              user.cart.items[existingItemIndex].addedAt = new Date();
            } else {
              user.cart.items.push({
                product: guestItem.product,
                quantity: guestItem.quantity,
                price: guestItem.price,
                addedAt: new Date()
              });
            }
            mergedItems++;
          }

          // Clean up the guest cart after merge
          await Cart.deleteOne({
            sessionId
          });
          console.log('Deleted guest cart for session:', sessionId);
        } else {
          console.log('No guest cart found for session:', sessionId);
        }
      }
      user.cart.updatedAt = new Date();
      await user.save();
      mergeResult = {
        mergedItems,
        conflicts: [],
        duration: 0
      };
    }

    // Get updated cart data with fallback
    let updatedCartData;
    try {
      updatedCartData = await cartService.getCartWithPerformanceOptimization(req);
    } catch (serviceError) {
      console.warn('Cart service failed in merge, using fallback:', serviceError.message);
      updatedCartData = await getOrCreateCart(req);
    }

    // Return updated user cart
    const populatedCart = await Promise.all(updatedCartData.cart.items.map(async item => {
      try {
        const product = await Product.findById(item.product).select('-wholesaler');
        if (!product || !product.isActive) {
          return null; // Filter out inactive products
        }
        return {
          _id: item.product,
          product: product.toPublicJSON(),
          quantity: item.quantity,
          price: item.price,
          subtotal: item.price * item.quantity
        };
      } catch (error) {
        console.error('Error populating cart item:', error);
        return null;
      }
    }));

    // Filter out null items (inactive products)
    const validCartItems = populatedCart.filter(item => item !== null);
    const itemCount = validCartItems.reduce((total, item) => total + item.quantity, 0);
    const subtotal = validCartItems.reduce((total, item) => total + item.subtotal, 0);
    res.json({
      success: true,
      message: `Successfully merged ${mergeResult.mergedItems} items into your cart`,
      data: {
        cart: {
          items: validCartItems,
          itemCount,
          subtotal: Math.round(subtotal * 100) / 100,
          total: Math.round(subtotal * 100) / 100,
          isEmpty: validCartItems.length === 0
        },
        merge: {
          mergedItems: mergeResult.mergedItems,
          conflicts: mergeResult.conflicts,
          duration: mergeResult.duration
        }
      }
    });
  } catch (error) {
    console.error('Error merging guest cart:', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'CART_MERGE_ERROR',
        message: 'Failed to merge guest cart',
        details: process.env.NODE_ENV === 'development' ? error.message : undefined
      }
    });
  }
});

// Debug endpoint to see all guest carts (development only)
if (process.env.NODE_ENV === 'development') {
  router.get('/debug', async (req, res) => {
    try {
      const guestCarts = await Cart.find({}).select('sessionId items createdAt updatedAt');
      const userCarts = await User.find({
        'cart.items.0': {
          $exists: true
        }
      }).select('email cart.items cart.updatedAt');
      console.log('Debug request - Headers:', {
        guestSessionId: req.headers['x-guest-session-id'],
        serverSessionId: req.sessionID,
        cartId: req.session?.cartId
      });
      res.json({
        success: true,
        data: {
          guestCarts: guestCarts.map(cart => ({
            sessionId: cart.sessionId,
            itemCount: cart.items.length,
            items: cart.items,
            createdAt: cart.createdAt,
            updatedAt: cart.updatedAt
          })),
          userCarts: userCarts.map(user => ({
            email: user.email,
            itemCount: user.cart?.items?.length || 0,
            items: user.cart?.items || [],
            updatedAt: user.cart?.updatedAt
          })),
          currentSession: {
            frontendSessionId: req.headers['x-guest-session-id'],
            serverSessionId: req.sessionID,
            storedCartId: req.session?.cartId
          }
        }
      });
    } catch (error) {
      res.status(500).json({
        success: false,
        error: error.message
      });
    }
  });
}
module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIlByb2R1Y3QiLCJVc2VyIiwiQ2FydCIsImF1dGhlbnRpY2F0ZVRva2VuIiwidmFsaWRhdGVDU1JGVG9rZW4iLCJjYXJ0U2VydmljZSIsImNsZWFudXBJbnZhbGlkQ2FydHMiLCJyZXN1bHQiLCJkZWxldGVNYW55Iiwic2Vzc2lvbklkIiwiJG5vdCIsImRlbGV0ZWRDb3VudCIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsImdldE9yQ3JlYXRlQ2FydCIsInJlcSIsInVzZXIiLCJmaW5kQnlJZCIsIl9pZCIsImNhcnQiLCJpdGVtcyIsInVwZGF0ZWRBdCIsIkRhdGUiLCJzYXZlIiwidHlwZSIsImhlYWRlcnMiLCJzdGFydHNXaXRoIiwiY29kZSIsImZpbmRPbmUiLCJnZXQiLCJyZXMiLCJjYXJ0RGF0YSIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwibWVzc2FnZSIsInBvcHVsYXRlZENhcnQiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiaXRlbSIsInByb2R1Y3QiLCJzZWxlY3QiLCJpc0FjdGl2ZSIsInRvUHVibGljSlNPTiIsInF1YW50aXR5IiwicHJpY2UiLCJzdWJ0b3RhbCIsInZhbGlkQ2FydEl0ZW1zIiwiZmlsdGVyIiwiaXRlbUNvdW50IiwicmVkdWNlIiwidG90YWwiLCJkYXRhIiwiTWF0aCIsInJvdW5kIiwiaXNFbXB0eSIsImxlbmd0aCIsInBvc3QiLCJwcm9kdWN0SWQiLCJib2R5IiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwibWF0Y2giLCJleGlzdGluZ0l0ZW1JbmRleCIsImZpbmRJbmRleCIsInRvU3RyaW5nIiwiY3VycmVudFF1YW50aXR5IiwidXBkYXRlQ2FydE9wdGltaXN0aWNhbGx5Iiwic2VydmljZUVycm9yIiwid2FybiIsImZhbGxiYWNrQ2FydCIsImFkZGVkQXQiLCJwdXNoIiwiYWRkSXRlbSIsImR1cmF0aW9uIiwicGVyZm9ybWFuY2UiLCJ1cGRhdGVkQ2FydERhdGEiLCJnZXRDYXJ0V2l0aFBlcmZvcm1hbmNlT3B0aW1pemF0aW9uIiwicHJvZCIsInRoZW4iLCJzdGFjayIsImRldGFpbHMiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJ1bmRlZmluZWQiLCJwdXQiLCJpdGVtSW5kZXgiLCJzcGxpY2UiLCJ1cGRhdGVJdGVtIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJuZXciLCJ3YXNSZW1vdmVkIiwiY2FydEl0ZW1Db3VudCIsImRlbGV0ZSIsInJlbW92ZUl0ZW0iLCJkZWxldGVPbmUiLCJuZXdDYXJ0IiwiZ3Vlc3RDYXJ0SXRlbXMiLCJ1c2VySWQiLCJndWVzdEl0ZW1Db3VudCIsIm1lcmdlUmVzdWx0IiwibWVyZ2VDYXJ0c1dpdGhDb25mbGljdFJlc29sdXRpb24iLCJtZXJnZWRJdGVtcyIsIkFycmF5IiwiaXNBcnJheSIsImd1ZXN0SXRlbSIsImd1ZXN0Q2FydCIsImNvbmZsaWN0cyIsIm1lcmdlIiwiZ3Vlc3RDYXJ0cyIsImZpbmQiLCJ1c2VyQ2FydHMiLCIkZXhpc3RzIiwiZ3Vlc3RTZXNzaW9uSWQiLCJzZXJ2ZXJTZXNzaW9uSWQiLCJzZXNzaW9uSUQiLCJjYXJ0SWQiLCJzZXNzaW9uIiwiY3JlYXRlZEF0IiwiZW1haWwiLCJjdXJyZW50U2Vzc2lvbiIsImZyb250ZW5kU2Vzc2lvbklkIiwic3RvcmVkQ2FydElkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImNhcnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCBQcm9kdWN0ID0gcmVxdWlyZSgnLi4vbW9kZWxzL1Byb2R1Y3QnKTtcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xuY29uc3QgQ2FydCA9IHJlcXVpcmUoJy4uL21vZGVscy9DYXJ0Jyk7XG5jb25zdCB7IGF1dGhlbnRpY2F0ZVRva2VuIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlL2F1dGgnKTtcbmNvbnN0IHsgdmFsaWRhdGVDU1JGVG9rZW4gfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmUvc2Vzc2lvbkNTUkYnKTtcbmNvbnN0IGNhcnRTZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2VydmljZXMvY2FydFNlcnZpY2UnKTtcblxuLy8gQ2xlYW51cCBpbnZhbGlkIGNhcnQgc2Vzc2lvbnMgb24gc3RhcnR1cFxuY29uc3QgY2xlYW51cEludmFsaWRDYXJ0cyA9IGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBDYXJ0LmRlbGV0ZU1hbnkoe1xuICAgICAgc2Vzc2lvbklkOiB7ICRub3Q6IC9eZ3Vlc3RfLyB9XG4gICAgfSk7XG4gICAgaWYgKHJlc3VsdC5kZWxldGVkQ291bnQgPiAwKSB7XG4gICAgICBjb25zb2xlLmxvZyhgQ2xlYW5lZCB1cCAke3Jlc3VsdC5kZWxldGVkQ291bnR9IGludmFsaWQgY2FydCBzZXNzaW9uc2ApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjbGVhbmluZyB1cCBpbnZhbGlkIGNhcnRzOicsIGVycm9yKTtcbiAgfVxufTtcblxuLy8gUnVuIGNsZWFudXAgb24gc3RhcnR1cFxuY2xlYW51cEludmFsaWRDYXJ0cygpO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IG9yIGNyZWF0ZSBjYXJ0XG5jb25zdCBnZXRPckNyZWF0ZUNhcnQgPSBhc3luYyAocmVxKSA9PiB7XG4gIGlmIChyZXEudXNlcikge1xuICAgIC8vIEZvciBhdXRoZW50aWNhdGVkIHVzZXJzLCB1c2UgdXNlcidzIGNhcnRcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpO1xuICAgIGlmICghdXNlci5jYXJ0KSB7XG4gICAgICB1c2VyLmNhcnQgPSB7IGl0ZW1zOiBbXSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH07XG4gICAgICBhd2FpdCB1c2VyLnNhdmUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHsgdHlwZTogJ3VzZXInLCBjYXJ0OiB1c2VyLmNhcnQsIHVzZXIgfTtcbiAgfSBlbHNlIHtcbiAgICAvLyBGb3IgZ3Vlc3RzLCB1c2UgT05MWSBmcm9udGVuZC1wcm92aWRlZCBzZXNzaW9uIElEc1xuICAgIGxldCBzZXNzaW9uSWQgPSByZXEuaGVhZGVyc1sneC1ndWVzdC1zZXNzaW9uLWlkJ107XG4gICAgXG4gICAgLy8gU1RSSUNUOiBNdXN0IGhhdmUgdmFsaWQgZnJvbnRlbmQgc2Vzc2lvbiBJRFxuICAgIGlmICghc2Vzc2lvbklkIHx8ICFzZXNzaW9uSWQuc3RhcnRzV2l0aCgnZ3Vlc3RfJykpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgIGVycm9yOiAnSW52YWxpZCBvciBtaXNzaW5nIGd1ZXN0IHNlc3Npb24gSUQnLFxuICAgICAgICBjb2RlOiAnSU5WQUxJRF9TRVNTSU9OJ1xuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgLy8gRmluZCBvciBjcmVhdGUgY2FydCB3aXRoIHRoZSBmcm9udGVuZCBzZXNzaW9uIElEXG4gICAgbGV0IGNhcnQgPSBhd2FpdCBDYXJ0LmZpbmRPbmUoeyBzZXNzaW9uSWQgfSk7XG4gICAgXG4gICAgaWYgKCFjYXJ0KSB7XG4gICAgICBjYXJ0ID0gbmV3IENhcnQoeyBzZXNzaW9uSWQsIGl0ZW1zOiBbXSB9KTtcbiAgICAgIGF3YWl0IGNhcnQuc2F2ZSgpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4geyB0eXBlOiAnZ3Vlc3QnLCBjYXJ0LCBzZXNzaW9uSWQgfTtcbiAgfVxufTtcblxuLy8gR2V0IGNhcnQgY29udGVudHMgd2l0aCBwZXJmb3JtYW5jZSBvcHRpbWl6YXRpb25cbnJvdXRlci5nZXQoJy8nLCBhdXRoZW50aWNhdGVUb2tlbiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2FydERhdGEgPSBhd2FpdCBnZXRPckNyZWF0ZUNhcnQocmVxKTtcbiAgICBcbiAgICAvLyBIYW5kbGUgc2Vzc2lvbiBlcnJvcnNcbiAgICBpZiAoY2FydERhdGEudHlwZSA9PT0gJ2Vycm9yJykge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogY2FydERhdGEuY29kZSxcbiAgICAgICAgICBtZXNzYWdlOiBjYXJ0RGF0YS5lcnJvclxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgeyB0eXBlLCBjYXJ0LCB1c2VyIH0gPSBjYXJ0RGF0YTtcbiAgICBcbiAgICAvLyBQb3B1bGF0ZSBwcm9kdWN0IGRldGFpbHMgZm9yIGNhcnQgaXRlbXNcbiAgICBjb25zdCBwb3B1bGF0ZWRDYXJ0ID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBjYXJ0Lml0ZW1zLm1hcChhc3luYyAoaXRlbSkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKGl0ZW0ucHJvZHVjdCkuc2VsZWN0KCctd2hvbGVzYWxlcicpO1xuICAgICAgICAgIGlmICghcHJvZHVjdCB8fCAhcHJvZHVjdC5pc0FjdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7IC8vIEZpbHRlciBvdXQgaW5hY3RpdmUgcHJvZHVjdHNcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIF9pZDogaXRlbS5wcm9kdWN0LFxuICAgICAgICAgICAgcHJvZHVjdDogcHJvZHVjdC50b1B1YmxpY0pTT04oKSxcbiAgICAgICAgICAgIHF1YW50aXR5OiBpdGVtLnF1YW50aXR5LFxuICAgICAgICAgICAgcHJpY2U6IGl0ZW0ucHJpY2UsXG4gICAgICAgICAgICBzdWJ0b3RhbDogaXRlbS5wcmljZSAqIGl0ZW0ucXVhbnRpdHlcbiAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBvcHVsYXRpbmcgY2FydCBpdGVtOicsIGVycm9yKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuXG4gICAgLy8gRmlsdGVyIG91dCBudWxsIGl0ZW1zIChpbmFjdGl2ZSBwcm9kdWN0cylcbiAgICBjb25zdCB2YWxpZENhcnRJdGVtcyA9IHBvcHVsYXRlZENhcnQuZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gbnVsbCk7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIHRvdGFsc1xuICAgIGNvbnN0IGl0ZW1Db3VudCA9IHZhbGlkQ2FydEl0ZW1zLnJlZHVjZSgodG90YWwsIGl0ZW0pID0+IHRvdGFsICsgaXRlbS5xdWFudGl0eSwgMCk7XG4gICAgY29uc3Qgc3VidG90YWwgPSB2YWxpZENhcnRJdGVtcy5yZWR1Y2UoKHRvdGFsLCBpdGVtKSA9PiB0b3RhbCArIGl0ZW0uc3VidG90YWwsIDApO1xuICAgIFxuICAgIHJlcy5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGNhcnQ6IHtcbiAgICAgICAgICBpdGVtczogdmFsaWRDYXJ0SXRlbXMsXG4gICAgICAgICAgaXRlbUNvdW50LFxuICAgICAgICAgIHN1YnRvdGFsOiBNYXRoLnJvdW5kKHN1YnRvdGFsICogMTAwKSAvIDEwMCxcbiAgICAgICAgICB0b3RhbDogTWF0aC5yb3VuZChzdWJ0b3RhbCAqIDEwMCkgLyAxMDAsXG4gICAgICAgICAgaXNFbXB0eTogdmFsaWRDYXJ0SXRlbXMubGVuZ3RoID09PSAwXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGNhcnQ6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ0NBUlRfRkVUQ0hfRVJST1InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGNhcnQnXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBBZGQgaXRlbSB0byBjYXJ0IHdpdGggb3B0aW1pc3RpYyB1cGRhdGVzXG5yb3V0ZXIucG9zdCgnL2FkZCcsIGF1dGhlbnRpY2F0ZVRva2VuLCB2YWxpZGF0ZUNTUkZUb2tlbiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBwcm9kdWN0SWQsIHF1YW50aXR5ID0gMSB9ID0gcmVxLmJvZHk7XG5cbiAgICAvLyBWYWxpZGF0aW9uXG4gICAgaWYgKCFwcm9kdWN0SWQpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdNSVNTSU5HX1BST0RVQ1RfSUQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IElEIGlzIHJlcXVpcmVkJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIocXVhbnRpdHkpIHx8IHF1YW50aXR5IDwgMSB8fCBxdWFudGl0eSA+IDk5KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9RVUFOVElUWScsXG4gICAgICAgICAgbWVzc2FnZTogJ1F1YW50aXR5IG11c3QgYmUgYmV0d2VlbiAxIGFuZCA5OSdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgICAgIC8vIFZhbGlkYXRlIHByb2R1Y3QgSUQgZm9ybWF0XG4gICAgaWYgKCFwcm9kdWN0SWQubWF0Y2goL15bMC05YS1mQS1GXXsyNH0kLykpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1BST0RVQ1RfSUQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHByb2R1Y3QgSUQgZm9ybWF0J1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBwcm9kdWN0IGV4aXN0cyBhbmQgaXMgYWN0aXZlXG4gICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuZmluZEJ5SWQocHJvZHVjdElkKTtcbiAgICBpZiAoIXByb2R1Y3QpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdQUk9EVUNUX05PVF9GT1VORCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1Byb2R1Y3Qgbm90IGZvdW5kJ1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgaWYgKCFwcm9kdWN0LmlzQWN0aXZlKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnUFJPRFVDVF9OT1RfRk9VTkQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IG5vdCBmb3VuZCBvciBpbmFjdGl2ZSdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIGl0ZW0gYW5kIHZhbGlkYXRlIG1heGltdW0gcXVhbnRpdHlcbiAgICBjb25zdCB7IHR5cGUsIGNhcnQsIHVzZXIgfSA9IGF3YWl0IGdldE9yQ3JlYXRlQ2FydChyZXEpO1xuICAgIFxuICAgIGlmICh0eXBlID09PSAndXNlcicpIHtcbiAgICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdXNlci5jYXJ0Lml0ZW1zLmZpbmRJbmRleChpdGVtID0+IFxuICAgICAgICBpdGVtLnByb2R1Y3QudG9TdHJpbmcoKSA9PT0gcHJvZHVjdElkLnRvU3RyaW5nKClcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRRdWFudGl0eSA9IHVzZXIuY2FydC5pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0ucXVhbnRpdHk7XG4gICAgICAgIGlmIChjdXJyZW50UXVhbnRpdHkgKyBxdWFudGl0eSA+IDk5KSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgICAgY29kZTogJ01BWF9RVUFOVElUWV9FWENFRURFRCcsXG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdDYW5ub3QgZXhjZWVkIG1heGltdW0gcXVhbnRpdHkgb2YgOTknXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSBjYXJ0Lml0ZW1zLmZpbmRJbmRleChpdGVtID0+IFxuICAgICAgICBpdGVtLnByb2R1Y3QudG9TdHJpbmcoKSA9PT0gcHJvZHVjdElkLnRvU3RyaW5nKClcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRRdWFudGl0eSA9IGNhcnQuaXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLnF1YW50aXR5O1xuICAgICAgICBpZiAoY3VycmVudFF1YW50aXR5ICsgcXVhbnRpdHkgPiA5OSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgICAgIGNvZGU6ICdNQVhfUVVBTlRJVFlfRVhDRUVERUQnLFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnQ2Fubm90IGV4Y2VlZCBtYXhpbXVtIHF1YW50aXR5IG9mIDk5J1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVXNlIG9wdGltaXN0aWMgY2FydCBzZXJ2aWNlIHdpdGggZmFsbGJhY2tcbiAgICBsZXQgcmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICByZXN1bHQgPSBhd2FpdCBjYXJ0U2VydmljZS51cGRhdGVDYXJ0T3B0aW1pc3RpY2FsbHkocmVxLCAnYWRkJywge1xuICAgICAgICBwcm9kdWN0SWQsXG4gICAgICAgIHF1YW50aXR5XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChzZXJ2aWNlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ2FydCBzZXJ2aWNlIGZhaWxlZCwgdXNpbmcgZmFsbGJhY2s6Jywgc2VydmljZUVycm9yLm1lc3NhZ2UpO1xuICAgICAgLy8gRmFsbGJhY2sgdG8gb3JpZ2luYWwgbG9naWMgLSBuZWVkIHRvIHJlLWZldGNoIGNhcnQgc2luY2Ugc2VydmljZSBmYWlsZWRcbiAgICAgIGNvbnN0IGZhbGxiYWNrQ2FydCA9IGF3YWl0IGdldE9yQ3JlYXRlQ2FydChyZXEpO1xuICAgICAgXG4gICAgICBpZiAoZmFsbGJhY2tDYXJ0LnR5cGUgPT09ICd1c2VyJykge1xuICAgICAgICAvLyBBZGQgdG8gdXNlcidzIGNhcnRcbiAgICAgICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSBmYWxsYmFja0NhcnQudXNlci5jYXJ0Lml0ZW1zLmZpbmRJbmRleChpdGVtID0+IFxuICAgICAgICAgIGl0ZW0ucHJvZHVjdC50b1N0cmluZygpID09PSBwcm9kdWN0SWQudG9TdHJpbmcoKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgICAgZmFsbGJhY2tDYXJ0LnVzZXIuY2FydC5pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0ucXVhbnRpdHkgKz0gcXVhbnRpdHk7XG4gICAgICAgICAgZmFsbGJhY2tDYXJ0LnVzZXIuY2FydC5pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0uYWRkZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZmFsbGJhY2tDYXJ0LnVzZXIuY2FydC5pdGVtcy5wdXNoKHtcbiAgICAgICAgICAgIHByb2R1Y3Q6IHByb2R1Y3RJZCxcbiAgICAgICAgICAgIHF1YW50aXR5LFxuICAgICAgICAgICAgcHJpY2U6IHByb2R1Y3QucHJpY2UsXG4gICAgICAgICAgICBhZGRlZEF0OiBuZXcgRGF0ZSgpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZhbGxiYWNrQ2FydC51c2VyLmNhcnQudXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcbiAgICAgICAgYXdhaXQgZmFsbGJhY2tDYXJ0LnVzZXIuc2F2ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQWRkIHRvIGd1ZXN0IGNhcnQgLSB1c2UgdGhlIENhcnQgbW9kZWwgbWV0aG9kXG4gICAgICAgIGlmIChmYWxsYmFja0NhcnQuY2FydC5hZGRJdGVtICYmIHR5cGVvZiBmYWxsYmFja0NhcnQuY2FydC5hZGRJdGVtID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgZmFsbGJhY2tDYXJ0LmNhcnQuYWRkSXRlbShwcm9kdWN0SWQsIHF1YW50aXR5LCBwcm9kdWN0LnByaWNlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGYWxsYmFjazogbWFudWFsbHkgYWRkIGl0ZW1cbiAgICAgICAgICBjb25zdCBleGlzdGluZ0l0ZW1JbmRleCA9IGZhbGxiYWNrQ2FydC5jYXJ0Lml0ZW1zLmZpbmRJbmRleChpdGVtID0+IFxuICAgICAgICAgICAgaXRlbS5wcm9kdWN0LnRvU3RyaW5nKCkgPT09IHByb2R1Y3RJZC50b1N0cmluZygpXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgICAgICBmYWxsYmFja0NhcnQuY2FydC5pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0ucXVhbnRpdHkgKz0gcXVhbnRpdHk7XG4gICAgICAgICAgICBmYWxsYmFja0NhcnQuY2FydC5pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0uYWRkZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZhbGxiYWNrQ2FydC5jYXJ0Lml0ZW1zLnB1c2goe1xuICAgICAgICAgICAgICBwcm9kdWN0OiBwcm9kdWN0SWQsXG4gICAgICAgICAgICAgIHF1YW50aXR5LFxuICAgICAgICAgICAgICBwcmljZTogcHJvZHVjdC5wcmljZSxcbiAgICAgICAgICAgICAgYWRkZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGF3YWl0IGZhbGxiYWNrQ2FydC5jYXJ0LnNhdmUoKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmVzdWx0ID0geyBkdXJhdGlvbjogMCwgcGVyZm9ybWFuY2U6ICdmYWxsYmFjaycgfTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdXBkYXRlZCBjYXJ0IHdpdGggcGVyZm9ybWFuY2UgbWV0cmljc1xuICAgIGxldCB1cGRhdGVkQ2FydERhdGE7XG4gICAgdHJ5IHtcbiAgICAgIHVwZGF0ZWRDYXJ0RGF0YSA9IGF3YWl0IGNhcnRTZXJ2aWNlLmdldENhcnRXaXRoUGVyZm9ybWFuY2VPcHRpbWl6YXRpb24ocmVxKTtcbiAgICB9IGNhdGNoIChzZXJ2aWNlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ2FydCBzZXJ2aWNlIGZhaWxlZCBhZnRlciBhZGQsIHVzaW5nIGZhbGxiYWNrOicsIHNlcnZpY2VFcnJvci5tZXNzYWdlKTtcbiAgICAgIHVwZGF0ZWRDYXJ0RGF0YSA9IGF3YWl0IGdldE9yQ3JlYXRlQ2FydChyZXEpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBwb3B1bGF0ZWRDYXJ0ID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICB1cGRhdGVkQ2FydERhdGEuY2FydC5pdGVtcy5tYXAoYXN5bmMgKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgcHJvZCA9IGF3YWl0IFByb2R1Y3QuZmluZEJ5SWQoaXRlbS5wcm9kdWN0KS5zZWxlY3QoJy13aG9sZXNhbGVyJyk7XG4gICAgICAgIGlmICghcHJvZCkge1xuICAgICAgICAgIHJldHVybiBudWxsOyAvLyBGaWx0ZXIgb3V0IG1pc3NpbmcgcHJvZHVjdHNcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIF9pZDogaXRlbS5wcm9kdWN0LFxuICAgICAgICAgIHByb2R1Y3Q6IHByb2QudG9QdWJsaWNKU09OKCksXG4gICAgICAgICAgcXVhbnRpdHk6IGl0ZW0ucXVhbnRpdHksXG4gICAgICAgICAgcHJpY2U6IGl0ZW0ucHJpY2UsXG4gICAgICAgICAgc3VidG90YWw6IGl0ZW0ucHJpY2UgKiBpdGVtLnF1YW50aXR5XG4gICAgICAgIH07XG4gICAgICB9KVxuICAgICkudGhlbihpdGVtcyA9PiBpdGVtcy5maWx0ZXIoaXRlbSA9PiBpdGVtICE9PSBudWxsKSk7XG5cbiAgICBjb25zdCBpdGVtQ291bnQgPSBwb3B1bGF0ZWRDYXJ0LnJlZHVjZSgodG90YWwsIGl0ZW0pID0+IHRvdGFsICsgaXRlbS5xdWFudGl0eSwgMCk7XG4gICAgY29uc3Qgc3VidG90YWwgPSBwb3B1bGF0ZWRDYXJ0LnJlZHVjZSgodG90YWwsIGl0ZW0pID0+IHRvdGFsICsgaXRlbS5zdWJ0b3RhbCwgMCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0l0ZW0gYWRkZWQgdG8gY2FydCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGNhcnQ6IHtcbiAgICAgICAgICBpdGVtczogcG9wdWxhdGVkQ2FydCxcbiAgICAgICAgICBpdGVtQ291bnQsXG4gICAgICAgICAgc3VidG90YWw6IE1hdGgucm91bmQoc3VidG90YWwgKiAxMDApIC8gMTAwLFxuICAgICAgICAgIHRvdGFsOiBNYXRoLnJvdW5kKHN1YnRvdGFsICogMTAwKSAvIDEwMFxuICAgICAgICB9LFxuICAgICAgICBwZXJmb3JtYW5jZToge1xuICAgICAgICAgIGR1cmF0aW9uOiByZXN1bHQuZHVyYXRpb24sXG4gICAgICAgICAgc3RhdHVzOiByZXN1bHQucGVyZm9ybWFuY2VcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgYWRkaW5nIHRvIGNhcnQ6JywgZXJyb3IpO1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Z1bGwgc3RhY2s6JywgZXJyb3Iuc3RhY2spO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ0NBUlRfQUREX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBhZGQgaXRlbSB0byBjYXJ0JyxcbiAgICAgICAgZGV0YWlsczogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogdW5kZWZpbmVkLFxuICAgICAgICBzdGFjazogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5zdGFjayA6IHVuZGVmaW5lZFxuICAgICAgfVxuICAgIH0pO1xuICB9XG59KTtcblxuLy8gVXBkYXRlIGNhcnQgaXRlbSBxdWFudGl0eVxucm91dGVyLnB1dCgnL3VwZGF0ZScsIGF1dGhlbnRpY2F0ZVRva2VuLCB2YWxpZGF0ZUNTUkZUb2tlbiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBwcm9kdWN0SWQsIHF1YW50aXR5IH0gPSByZXEuYm9keTtcblxuICAgIC8vIFZhbGlkYXRpb25cbiAgICBpZiAoIXByb2R1Y3RJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgY29kZTogJ01JU1NJTkdfUFJPRFVDVF9JRCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1Byb2R1Y3QgSUQgaXMgcmVxdWlyZWQnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihxdWFudGl0eSkgfHwgcXVhbnRpdHkgPCAwIHx8IHF1YW50aXR5ID4gOTkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1FVQU5USVRZJyxcbiAgICAgICAgICBtZXNzYWdlOiAnUXVhbnRpdHkgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDk5J1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB7IHR5cGUsIGNhcnQsIHVzZXIgfSA9IGF3YWl0IGdldE9yQ3JlYXRlQ2FydChyZXEpO1xuXG4gICAgaWYgKHR5cGUgPT09ICd1c2VyJykge1xuICAgICAgLy8gVXBkYXRlIHVzZXIncyBjYXJ0XG4gICAgICBjb25zdCBpdGVtSW5kZXggPSB1c2VyLmNhcnQuaXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gXG4gICAgICAgIGl0ZW0ucHJvZHVjdC50b1N0cmluZygpID09PSBwcm9kdWN0SWQudG9TdHJpbmcoKVxuICAgICAgKTtcblxuICAgICAgaWYgKGl0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgIGlmIChxdWFudGl0eSA9PT0gMCkge1xuICAgICAgICAgIHVzZXIuY2FydC5pdGVtcy5zcGxpY2UoaXRlbUluZGV4LCAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB1c2VyLmNhcnQuaXRlbXNbaXRlbUluZGV4XS5xdWFudGl0eSA9IHF1YW50aXR5O1xuICAgICAgICAgIHVzZXIuY2FydC5pdGVtc1tpdGVtSW5kZXhdLmFkZGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHVzZXIuY2FydC51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBhd2FpdCB1c2VyLnNhdmUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdJVEVNX05PVF9GT1VORCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnSXRlbSBub3QgZm91bmQgaW4gY2FydCdcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBVcGRhdGUgZ3Vlc3QgY2FydFxuICAgICAgY29uc3QgaXRlbUluZGV4ID0gY2FydC5pdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBcbiAgICAgICAgaXRlbS5wcm9kdWN0LnRvU3RyaW5nKCkgPT09IHByb2R1Y3RJZC50b1N0cmluZygpXG4gICAgICApO1xuICAgICAgXG4gICAgICBpZiAoaXRlbUluZGV4ID49IDApIHtcbiAgICAgICAgaWYgKGNhcnQudXBkYXRlSXRlbSAmJiB0eXBlb2YgY2FydC51cGRhdGVJdGVtID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgY2FydC51cGRhdGVJdGVtKHByb2R1Y3RJZCwgcXVhbnRpdHkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE1hbnVhbCB1cGRhdGVcbiAgICAgICAgICBpZiAocXVhbnRpdHkgPT09IDApIHtcbiAgICAgICAgICAgIGNhcnQuaXRlbXMuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhcnQuaXRlbXNbaXRlbUluZGV4XS5xdWFudGl0eSA9IHF1YW50aXR5O1xuICAgICAgICAgICAgY2FydC5pdGVtc1tpdGVtSW5kZXhdLmFkZGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChjYXJ0LnNhdmUgJiYgdHlwZW9mIGNhcnQuc2F2ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGF3YWl0IGNhcnQuc2F2ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFVzZSBmaW5kQnlJZEFuZFVwZGF0ZSBmb3IgbGVhbiBvYmplY3RzXG4gICAgICAgICAgYXdhaXQgQ2FydC5maW5kQnlJZEFuZFVwZGF0ZShcbiAgICAgICAgICAgIGNhcnQuX2lkLFxuICAgICAgICAgICAgeyBpdGVtczogY2FydC5pdGVtcywgdXBkYXRlZEF0OiBjYXJ0LnVwZGF0ZWRBdCB9LFxuICAgICAgICAgICAgeyBuZXc6IHRydWUgfVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdJVEVNX05PVF9GT1VORCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnSXRlbSBub3QgZm91bmQgaW4gY2FydCdcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJldHVybiB1cGRhdGVkIGNhcnRcbiAgICBjb25zdCB1cGRhdGVkQ2FydERhdGEgPSBhd2FpdCBnZXRPckNyZWF0ZUNhcnQocmVxKTtcbiAgICBjb25zdCBwb3B1bGF0ZWRDYXJ0ID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICB1cGRhdGVkQ2FydERhdGEuY2FydC5pdGVtcy5tYXAoYXN5bmMgKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuZmluZEJ5SWQoaXRlbS5wcm9kdWN0KS5zZWxlY3QoJy13aG9sZXNhbGVyJyk7XG4gICAgICAgIGlmICghcHJvZHVjdCB8fCAhcHJvZHVjdC5pc0FjdGl2ZSkgcmV0dXJuIG51bGw7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIF9pZDogaXRlbS5wcm9kdWN0LFxuICAgICAgICAgIHByb2R1Y3Q6IHByb2R1Y3QudG9QdWJsaWNKU09OKCksXG4gICAgICAgICAgcXVhbnRpdHk6IGl0ZW0ucXVhbnRpdHksXG4gICAgICAgICAgcHJpY2U6IGl0ZW0ucHJpY2UsXG4gICAgICAgICAgc3VidG90YWw6IGl0ZW0ucHJpY2UgKiBpdGVtLnF1YW50aXR5XG4gICAgICAgIH07XG4gICAgICB9KVxuICAgICk7XG5cbiAgICBjb25zdCB2YWxpZENhcnRJdGVtcyA9IHBvcHVsYXRlZENhcnQuZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gbnVsbCk7XG4gICAgY29uc3QgaXRlbUNvdW50ID0gdmFsaWRDYXJ0SXRlbXMucmVkdWNlKCh0b3RhbCwgaXRlbSkgPT4gdG90YWwgKyBpdGVtLnF1YW50aXR5LCAwKTtcbiAgICBjb25zdCBzdWJ0b3RhbCA9IHZhbGlkQ2FydEl0ZW1zLnJlZHVjZSgodG90YWwsIGl0ZW0pID0+IHRvdGFsICsgaXRlbS5zdWJ0b3RhbCwgMCk7XG5cbiAgICAvLyBDaGVjayBpZiBpdGVtIHdhcyByZW1vdmVkIChxdWFudGl0eSB3YXMgMClcbiAgICBjb25zdCB3YXNSZW1vdmVkID0gcXVhbnRpdHkgPT09IDA7XG4gICAgXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6IHdhc1JlbW92ZWQgPyAnSXRlbSByZW1vdmVkIGZyb20gY2FydCcgOiAnQ2FydCB1cGRhdGVkJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY2FydDoge1xuICAgICAgICAgIGl0ZW1zOiB2YWxpZENhcnRJdGVtcyxcbiAgICAgICAgICBpdGVtQ291bnQsXG4gICAgICAgICAgc3VidG90YWw6IE1hdGgucm91bmQoc3VidG90YWwgKiAxMDApIC8gMTAwLFxuICAgICAgICAgIHRvdGFsOiBNYXRoLnJvdW5kKHN1YnRvdGFsICogMTAwKSAvIDEwMFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgY2FydEl0ZW1Db3VudDogaXRlbUNvdW50XG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBjYXJ0OicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdDQVJUX1VQREFURV9FUlJPUicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBkYXRlIGNhcnQnXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBSZW1vdmUgaXRlbSBmcm9tIGNhcnRcbnJvdXRlci5kZWxldGUoJy9yZW1vdmUnLCBhdXRoZW50aWNhdGVUb2tlbiwgdmFsaWRhdGVDU1JGVG9rZW4sIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgcHJvZHVjdElkIH0gPSByZXEuYm9keTtcblxuICAgIGlmICghcHJvZHVjdElkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnTUlTU0lOR19QUk9EVUNUX0lEJyxcbiAgICAgICAgICBtZXNzYWdlOiAnUHJvZHVjdCBJRCBpcyByZXF1aXJlZCdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyB0eXBlLCBjYXJ0LCB1c2VyIH0gPSBhd2FpdCBnZXRPckNyZWF0ZUNhcnQocmVxKTtcblxuICAgIGlmICh0eXBlID09PSAndXNlcicpIHtcbiAgICAgIC8vIFJlbW92ZSBmcm9tIHVzZXIncyBjYXJ0XG4gICAgICBjb25zdCBpdGVtSW5kZXggPSB1c2VyLmNhcnQuaXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gXG4gICAgICAgIGl0ZW0ucHJvZHVjdC50b1N0cmluZygpID09PSBwcm9kdWN0SWQudG9TdHJpbmcoKVxuICAgICAgKTtcblxuICAgICAgaWYgKGl0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgIHVzZXIuY2FydC5pdGVtcy5zcGxpY2UoaXRlbUluZGV4LCAxKTtcbiAgICAgICAgdXNlci5jYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGF3YWl0IHVzZXIuc2F2ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBlcnJvcjoge1xuICAgICAgICAgICAgY29kZTogJ0lURU1fTk9UX0ZPVU5EJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJdGVtIG5vdCBmb3VuZCBpbiBjYXJ0J1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJlbW92ZSBmcm9tIGd1ZXN0IGNhcnRcbiAgICAgIGNvbnN0IGl0ZW1JbmRleCA9IGNhcnQuaXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gXG4gICAgICAgIGl0ZW0ucHJvZHVjdC50b1N0cmluZygpID09PSBwcm9kdWN0SWQudG9TdHJpbmcoKVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgaWYgKGl0ZW1JbmRleCA+PSAwKSB7XG4gICAgICAgIGlmIChjYXJ0LnJlbW92ZUl0ZW0gJiYgdHlwZW9mIGNhcnQucmVtb3ZlSXRlbSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGNhcnQucmVtb3ZlSXRlbShwcm9kdWN0SWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE1hbnVhbCByZW1vdmFsXG4gICAgICAgICAgY2FydC5pdGVtcy5zcGxpY2UoaXRlbUluZGV4LCAxKTtcbiAgICAgICAgICBjYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmIChjYXJ0LnNhdmUgJiYgdHlwZW9mIGNhcnQuc2F2ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGF3YWl0IGNhcnQuc2F2ZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFVzZSBmaW5kQnlJZEFuZFVwZGF0ZSBmb3IgbGVhbiBvYmplY3RzXG4gICAgICAgICAgYXdhaXQgQ2FydC5maW5kQnlJZEFuZFVwZGF0ZShcbiAgICAgICAgICAgIGNhcnQuX2lkLFxuICAgICAgICAgICAgeyBpdGVtczogY2FydC5pdGVtcywgdXBkYXRlZEF0OiBjYXJ0LnVwZGF0ZWRBdCB9LFxuICAgICAgICAgICAgeyBuZXc6IHRydWUgfVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICAgIGNvZGU6ICdJVEVNX05PVF9GT1VORCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnSXRlbSBub3QgZm91bmQgaW4gY2FydCdcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJldHVybiB1cGRhdGVkIGNhcnRcbiAgICBjb25zdCB1cGRhdGVkQ2FydERhdGEgPSBhd2FpdCBnZXRPckNyZWF0ZUNhcnQocmVxKTtcbiAgICBjb25zdCBwb3B1bGF0ZWRDYXJ0ID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICB1cGRhdGVkQ2FydERhdGEuY2FydC5pdGVtcy5tYXAoYXN5bmMgKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuZmluZEJ5SWQoaXRlbS5wcm9kdWN0KS5zZWxlY3QoJy13aG9sZXNhbGVyJyk7XG4gICAgICAgIGlmICghcHJvZHVjdCB8fCAhcHJvZHVjdC5pc0FjdGl2ZSkgcmV0dXJuIG51bGw7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIF9pZDogaXRlbS5wcm9kdWN0LFxuICAgICAgICAgIHByb2R1Y3Q6IHByb2R1Y3QudG9QdWJsaWNKU09OKCksXG4gICAgICAgICAgcXVhbnRpdHk6IGl0ZW0ucXVhbnRpdHksXG4gICAgICAgICAgcHJpY2U6IGl0ZW0ucHJpY2UsXG4gICAgICAgICAgc3VidG90YWw6IGl0ZW0ucHJpY2UgKiBpdGVtLnF1YW50aXR5XG4gICAgICAgIH07XG4gICAgICB9KVxuICAgICk7XG5cbiAgICBjb25zdCB2YWxpZENhcnRJdGVtcyA9IHBvcHVsYXRlZENhcnQuZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gbnVsbCk7XG4gICAgY29uc3QgaXRlbUNvdW50ID0gdmFsaWRDYXJ0SXRlbXMucmVkdWNlKCh0b3RhbCwgaXRlbSkgPT4gdG90YWwgKyBpdGVtLnF1YW50aXR5LCAwKTtcbiAgICBjb25zdCBzdWJ0b3RhbCA9IHZhbGlkQ2FydEl0ZW1zLnJlZHVjZSgodG90YWwsIGl0ZW0pID0+IHRvdGFsICsgaXRlbS5zdWJ0b3RhbCwgMCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0l0ZW0gcmVtb3ZlZCBmcm9tIGNhcnQnLFxuICAgICAgZGF0YToge1xuICAgICAgICBjYXJ0OiB7XG4gICAgICAgICAgaXRlbXM6IHZhbGlkQ2FydEl0ZW1zLFxuICAgICAgICAgIGl0ZW1Db3VudCxcbiAgICAgICAgICBzdWJ0b3RhbDogTWF0aC5yb3VuZChzdWJ0b3RhbCAqIDEwMCkgLyAxMDAsXG4gICAgICAgICAgdG90YWw6IE1hdGgucm91bmQoc3VidG90YWwgKiAxMDApIC8gMTAwXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjYXJ0SXRlbUNvdW50OiBpdGVtQ291bnRcbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlbW92aW5nIGZyb20gY2FydDonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjoge1xuICAgICAgICBjb2RlOiAnQ0FSVF9SRU1PVkVfRVJST1InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHJlbW92ZSBpdGVtIGZyb20gY2FydCdcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSk7XG5cbi8vIENsZWFyIGNhcnRcbnJvdXRlci5kZWxldGUoJy9jbGVhcicsIGF1dGhlbnRpY2F0ZVRva2VuLCB2YWxpZGF0ZUNTUkZUb2tlbiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyB0eXBlLCBjYXJ0LCB1c2VyIH0gPSBhd2FpdCBnZXRPckNyZWF0ZUNhcnQocmVxKTtcblxuICAgIGlmICh0eXBlID09PSAndXNlcicpIHtcbiAgICAgIC8vIENsZWFyIHVzZXIncyBjYXJ0XG4gICAgICB1c2VyLmNhcnQuaXRlbXMgPSBbXTtcbiAgICAgIHVzZXIuY2FydC51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgYXdhaXQgdXNlci5zYXZlKCk7XG4gICAgICBjb25zb2xlLmxvZygnQ2xlYXJlZCB1c2VyIGNhcnQgZm9yIHVzZXI6JywgdXNlci5faWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDbGVhciBndWVzdCBjYXJ0IC0gYmUgbW9yZSBhZ2dyZXNzaXZlXG4gICAgICBjb25zb2xlLmxvZygnQ2xlYXJpbmcgZ3Vlc3QgY2FydCBmb3Igc2Vzc2lvbjonLCBjYXJ0LnNlc3Npb25JZCk7XG4gICAgICBcbiAgICAgIC8vIERlbGV0ZSB0aGUgZW50aXJlIGNhcnQgcmVjb3JkIGFuZCBjcmVhdGUgYSBuZXcgb25lXG4gICAgICBhd2FpdCBDYXJ0LmRlbGV0ZU9uZSh7IHNlc3Npb25JZDogY2FydC5zZXNzaW9uSWQgfSk7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBhIGZyZXNoIGNhcnRcbiAgICAgIGNvbnN0IG5ld0NhcnQgPSBuZXcgQ2FydCh7IHNlc3Npb25JZDogY2FydC5zZXNzaW9uSWQsIGl0ZW1zOiBbXSB9KTtcbiAgICAgIGF3YWl0IG5ld0NhcnQuc2F2ZSgpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnQ3JlYXRlZCBmcmVzaCBndWVzdCBjYXJ0IGZvciBzZXNzaW9uOicsIGNhcnQuc2Vzc2lvbklkKTtcbiAgICB9XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0NhcnQgY2xlYXJlZCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGNhcnQ6IHtcbiAgICAgICAgICBpdGVtczogW10sXG4gICAgICAgICAgaXRlbUNvdW50OiAwLFxuICAgICAgICAgIHN1YnRvdGFsOiAwLFxuICAgICAgICAgIHRvdGFsOiAwLFxuICAgICAgICAgIGlzRW1wdHk6IHRydWVcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGNhcnRJdGVtQ291bnQ6IDBcbiAgICB9KTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNsZWFyaW5nIGNhcnQ6JywgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgY29kZTogJ0NBUlRfQ0xFQVJfRVJST1InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNsZWFyIGNhcnQnXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBNZXJnZSBndWVzdCBjYXJ0IHdpdGggdXNlciBjYXJ0IHdpdGggY29uZmxpY3QgcmVzb2x1dGlvblxucm91dGVyLnBvc3QoJy9tZXJnZScsIGF1dGhlbnRpY2F0ZVRva2VuLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBpZiAoIXJlcS51c2VyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBjb2RlOiAnQVVUSEVOVElDQVRJT05fUkVRVUlSRUQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG11c3QgYmUgYXV0aGVudGljYXRlZCB0byBtZXJnZSBjYXJ0J1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGd1ZXN0Q2FydEl0ZW1zLCBzZXNzaW9uSWQgfSA9IHJlcS5ib2R5O1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdDYXJ0IG1lcmdlIHJlcXVlc3Q6JywgeyBcbiAgICAgIHVzZXJJZDogcmVxLnVzZXIuX2lkLCBcbiAgICAgIHNlc3Npb25JZCwgXG4gICAgICBndWVzdEl0ZW1Db3VudDogZ3Vlc3RDYXJ0SXRlbXM/Lmxlbmd0aCB8fCAwIFxuICAgIH0pO1xuICAgIFxuICAgIC8vIFVzZSBlbmhhbmNlZCBjYXJ0IHNlcnZpY2UgZm9yIG1lcmdpbmcgd2l0aCBjb25mbGljdCByZXNvbHV0aW9uXG4gICAgbGV0IG1lcmdlUmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICBtZXJnZVJlc3VsdCA9IGF3YWl0IGNhcnRTZXJ2aWNlLm1lcmdlQ2FydHNXaXRoQ29uZmxpY3RSZXNvbHV0aW9uKFxuICAgICAgICByZXEudXNlci5faWQsXG4gICAgICAgIGd1ZXN0Q2FydEl0ZW1zLFxuICAgICAgICBzZXNzaW9uSWRcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoc2VydmljZUVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NhcnQgc2VydmljZSBtZXJnZSBmYWlsZWQsIHVzaW5nIGZhbGxiYWNrOicsIHNlcnZpY2VFcnJvci5tZXNzYWdlKTtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIG9yaWdpbmFsIG1lcmdlIGxvZ2ljXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpO1xuICAgICAgaWYgKCF1c2VyLmNhcnQpIHtcbiAgICAgICAgdXNlci5jYXJ0ID0geyBpdGVtczogW10sIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9O1xuICAgICAgfVxuXG4gICAgICBsZXQgbWVyZ2VkSXRlbXMgPSAwO1xuXG4gICAgICAvLyBQcm9jZXNzIGd1ZXN0IGNhcnQgaXRlbXNcbiAgICAgIGlmIChndWVzdENhcnRJdGVtcyAmJiBBcnJheS5pc0FycmF5KGd1ZXN0Q2FydEl0ZW1zKSAmJiBndWVzdENhcnRJdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgZ3Vlc3RJdGVtIG9mIGd1ZXN0Q2FydEl0ZW1zKSB7XG4gICAgICAgICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IFByb2R1Y3QuZmluZEJ5SWQoZ3Vlc3RJdGVtLnByb2R1Y3RJZCB8fCBndWVzdEl0ZW0ucHJvZHVjdCk7XG4gICAgICAgICAgaWYgKCFwcm9kdWN0IHx8ICFwcm9kdWN0LmlzQWN0aXZlKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBwcm9kdWN0SWQgPSBndWVzdEl0ZW0ucHJvZHVjdElkIHx8IGd1ZXN0SXRlbS5wcm9kdWN0O1xuICAgICAgICAgIGNvbnN0IHF1YW50aXR5ID0gZ3Vlc3RJdGVtLnF1YW50aXR5IHx8IDE7XG5cbiAgICAgICAgICBjb25zdCBleGlzdGluZ0l0ZW1JbmRleCA9IHVzZXIuY2FydC5pdGVtcy5maW5kSW5kZXgoaXRlbSA9PiBcbiAgICAgICAgICAgIGl0ZW0ucHJvZHVjdC50b1N0cmluZygpID09PSBwcm9kdWN0SWQudG9TdHJpbmcoKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAoZXhpc3RpbmdJdGVtSW5kZXggPj0gMCkge1xuICAgICAgICAgICAgdXNlci5jYXJ0Lml0ZW1zW2V4aXN0aW5nSXRlbUluZGV4XS5xdWFudGl0eSArPSBxdWFudGl0eTtcbiAgICAgICAgICAgIHVzZXIuY2FydC5pdGVtc1tleGlzdGluZ0l0ZW1JbmRleF0uYWRkZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHVzZXIuY2FydC5pdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgcHJvZHVjdDogcHJvZHVjdElkLFxuICAgICAgICAgICAgICBxdWFudGl0eSxcbiAgICAgICAgICAgICAgcHJpY2U6IHByb2R1Y3QucHJpY2UsXG4gICAgICAgICAgICAgIGFkZGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtZXJnZWRJdGVtcysrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFByb2Nlc3Mgc2Vzc2lvbi1iYXNlZCBjYXJ0XG4gICAgICBpZiAoc2Vzc2lvbklkKSB7XG4gICAgICAgIGNvbnN0IGd1ZXN0Q2FydCA9IGF3YWl0IENhcnQuZmluZE9uZSh7IHNlc3Npb25JZCB9KTtcbiAgICAgICAgaWYgKGd1ZXN0Q2FydCAmJiBndWVzdENhcnQuaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdGb3VuZCBndWVzdCBjYXJ0IHdpdGgnLCBndWVzdENhcnQuaXRlbXMubGVuZ3RoLCAnaXRlbXMgZm9yIHNlc3Npb246Jywgc2Vzc2lvbklkKTtcbiAgICAgICAgICBcbiAgICAgICAgICBmb3IgKGNvbnN0IGd1ZXN0SXRlbSBvZiBndWVzdENhcnQuaXRlbXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKGd1ZXN0SXRlbS5wcm9kdWN0KTtcbiAgICAgICAgICAgIGlmICghcHJvZHVjdCB8fCAhcHJvZHVjdC5pc0FjdGl2ZSkge1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSB1c2VyLmNhcnQuaXRlbXMuZmluZEluZGV4KGl0ZW0gPT4gXG4gICAgICAgICAgICAgIGl0ZW0ucHJvZHVjdC50b1N0cmluZygpID09PSBndWVzdEl0ZW0ucHJvZHVjdC50b1N0cmluZygpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdJdGVtSW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICB1c2VyLmNhcnQuaXRlbXNbZXhpc3RpbmdJdGVtSW5kZXhdLnF1YW50aXR5ICs9IGd1ZXN0SXRlbS5xdWFudGl0eTtcbiAgICAgICAgICAgICAgdXNlci5jYXJ0Lml0ZW1zW2V4aXN0aW5nSXRlbUluZGV4XS5hZGRlZEF0ID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHVzZXIuY2FydC5pdGVtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBwcm9kdWN0OiBndWVzdEl0ZW0ucHJvZHVjdCxcbiAgICAgICAgICAgICAgICBxdWFudGl0eTogZ3Vlc3RJdGVtLnF1YW50aXR5LFxuICAgICAgICAgICAgICAgIHByaWNlOiBndWVzdEl0ZW0ucHJpY2UsXG4gICAgICAgICAgICAgICAgYWRkZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1lcmdlZEl0ZW1zKys7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIENsZWFuIHVwIHRoZSBndWVzdCBjYXJ0IGFmdGVyIG1lcmdlXG4gICAgICAgICAgYXdhaXQgQ2FydC5kZWxldGVPbmUoeyBzZXNzaW9uSWQgfSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0RlbGV0ZWQgZ3Vlc3QgY2FydCBmb3Igc2Vzc2lvbjonLCBzZXNzaW9uSWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdObyBndWVzdCBjYXJ0IGZvdW5kIGZvciBzZXNzaW9uOicsIHNlc3Npb25JZCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdXNlci5jYXJ0LnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICBhd2FpdCB1c2VyLnNhdmUoKTtcbiAgICAgIFxuICAgICAgbWVyZ2VSZXN1bHQgPSB7XG4gICAgICAgIG1lcmdlZEl0ZW1zLFxuICAgICAgICBjb25mbGljdHM6IFtdLFxuICAgICAgICBkdXJhdGlvbjogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBHZXQgdXBkYXRlZCBjYXJ0IGRhdGEgd2l0aCBmYWxsYmFja1xuICAgIGxldCB1cGRhdGVkQ2FydERhdGE7XG4gICAgdHJ5IHtcbiAgICAgIHVwZGF0ZWRDYXJ0RGF0YSA9IGF3YWl0IGNhcnRTZXJ2aWNlLmdldENhcnRXaXRoUGVyZm9ybWFuY2VPcHRpbWl6YXRpb24ocmVxKTtcbiAgICB9IGNhdGNoIChzZXJ2aWNlRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ2FydCBzZXJ2aWNlIGZhaWxlZCBpbiBtZXJnZSwgdXNpbmcgZmFsbGJhY2s6Jywgc2VydmljZUVycm9yLm1lc3NhZ2UpO1xuICAgICAgdXBkYXRlZENhcnREYXRhID0gYXdhaXQgZ2V0T3JDcmVhdGVDYXJ0KHJlcSk7XG4gICAgfVxuICAgIFxuICAgIC8vIFJldHVybiB1cGRhdGVkIHVzZXIgY2FydFxuICAgIGNvbnN0IHBvcHVsYXRlZENhcnQgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgIHVwZGF0ZWRDYXJ0RGF0YS5jYXJ0Lml0ZW1zLm1hcChhc3luYyAoaXRlbSkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHByb2R1Y3QgPSBhd2FpdCBQcm9kdWN0LmZpbmRCeUlkKGl0ZW0ucHJvZHVjdCkuc2VsZWN0KCctd2hvbGVzYWxlcicpO1xuICAgICAgICAgIGlmICghcHJvZHVjdCB8fCAhcHJvZHVjdC5pc0FjdGl2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7IC8vIEZpbHRlciBvdXQgaW5hY3RpdmUgcHJvZHVjdHNcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIF9pZDogaXRlbS5wcm9kdWN0LFxuICAgICAgICAgICAgcHJvZHVjdDogcHJvZHVjdC50b1B1YmxpY0pTT04oKSxcbiAgICAgICAgICAgIHF1YW50aXR5OiBpdGVtLnF1YW50aXR5LFxuICAgICAgICAgICAgcHJpY2U6IGl0ZW0ucHJpY2UsXG4gICAgICAgICAgICBzdWJ0b3RhbDogaXRlbS5wcmljZSAqIGl0ZW0ucXVhbnRpdHlcbiAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBvcHVsYXRpbmcgY2FydCBpdGVtOicsIGVycm9yKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICApO1xuXG4gICAgLy8gRmlsdGVyIG91dCBudWxsIGl0ZW1zIChpbmFjdGl2ZSBwcm9kdWN0cylcbiAgICBjb25zdCB2YWxpZENhcnRJdGVtcyA9IHBvcHVsYXRlZENhcnQuZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gbnVsbCk7XG4gICAgY29uc3QgaXRlbUNvdW50ID0gdmFsaWRDYXJ0SXRlbXMucmVkdWNlKCh0b3RhbCwgaXRlbSkgPT4gdG90YWwgKyBpdGVtLnF1YW50aXR5LCAwKTtcbiAgICBjb25zdCBzdWJ0b3RhbCA9IHZhbGlkQ2FydEl0ZW1zLnJlZHVjZSgodG90YWwsIGl0ZW0pID0+IHRvdGFsICsgaXRlbS5zdWJ0b3RhbCwgMCk7XG5cbiAgICByZXMuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogYFN1Y2Nlc3NmdWxseSBtZXJnZWQgJHttZXJnZVJlc3VsdC5tZXJnZWRJdGVtc30gaXRlbXMgaW50byB5b3VyIGNhcnRgLFxuICAgICAgZGF0YToge1xuICAgICAgICBjYXJ0OiB7XG4gICAgICAgICAgaXRlbXM6IHZhbGlkQ2FydEl0ZW1zLFxuICAgICAgICAgIGl0ZW1Db3VudCxcbiAgICAgICAgICBzdWJ0b3RhbDogTWF0aC5yb3VuZChzdWJ0b3RhbCAqIDEwMCkgLyAxMDAsXG4gICAgICAgICAgdG90YWw6IE1hdGgucm91bmQoc3VidG90YWwgKiAxMDApIC8gMTAwLFxuICAgICAgICAgIGlzRW1wdHk6IHZhbGlkQ2FydEl0ZW1zLmxlbmd0aCA9PT0gMFxuICAgICAgICB9LFxuICAgICAgICBtZXJnZToge1xuICAgICAgICAgIG1lcmdlZEl0ZW1zOiBtZXJnZVJlc3VsdC5tZXJnZWRJdGVtcyxcbiAgICAgICAgICBjb25mbGljdHM6IG1lcmdlUmVzdWx0LmNvbmZsaWN0cyxcbiAgICAgICAgICBkdXJhdGlvbjogbWVyZ2VSZXN1bHQuZHVyYXRpb25cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbWVyZ2luZyBndWVzdCBjYXJ0OicsIGVycm9yKTtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIGNvZGU6ICdDQVJUX01FUkdFX0VSUk9SJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBtZXJnZSBndWVzdCBjYXJ0JyxcbiAgICAgICAgZGV0YWlsczogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogdW5kZWZpbmVkXG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG4vLyBEZWJ1ZyBlbmRwb2ludCB0byBzZWUgYWxsIGd1ZXN0IGNhcnRzIChkZXZlbG9wbWVudCBvbmx5KVxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gIHJvdXRlci5nZXQoJy9kZWJ1ZycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBndWVzdENhcnRzID0gYXdhaXQgQ2FydC5maW5kKHt9KS5zZWxlY3QoJ3Nlc3Npb25JZCBpdGVtcyBjcmVhdGVkQXQgdXBkYXRlZEF0Jyk7XG4gICAgICBjb25zdCB1c2VyQ2FydHMgPSBhd2FpdCBVc2VyLmZpbmQoeyAnY2FydC5pdGVtcy4wJzogeyAkZXhpc3RzOiB0cnVlIH0gfSlcbiAgICAgICAgLnNlbGVjdCgnZW1haWwgY2FydC5pdGVtcyBjYXJ0LnVwZGF0ZWRBdCcpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygnRGVidWcgcmVxdWVzdCAtIEhlYWRlcnM6Jywge1xuICAgICAgICBndWVzdFNlc3Npb25JZDogcmVxLmhlYWRlcnNbJ3gtZ3Vlc3Qtc2Vzc2lvbi1pZCddLFxuICAgICAgICBzZXJ2ZXJTZXNzaW9uSWQ6IHJlcS5zZXNzaW9uSUQsXG4gICAgICAgIGNhcnRJZDogcmVxLnNlc3Npb24/LmNhcnRJZFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGd1ZXN0Q2FydHM6IGd1ZXN0Q2FydHMubWFwKGNhcnQgPT4gKHtcbiAgICAgICAgICAgIHNlc3Npb25JZDogY2FydC5zZXNzaW9uSWQsXG4gICAgICAgICAgICBpdGVtQ291bnQ6IGNhcnQuaXRlbXMubGVuZ3RoLFxuICAgICAgICAgICAgaXRlbXM6IGNhcnQuaXRlbXMsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IGNhcnQuY3JlYXRlZEF0LFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBjYXJ0LnVwZGF0ZWRBdFxuICAgICAgICAgIH0pKSxcbiAgICAgICAgICB1c2VyQ2FydHM6IHVzZXJDYXJ0cy5tYXAodXNlciA9PiAoe1xuICAgICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgICAgICBpdGVtQ291bnQ6IHVzZXIuY2FydD8uaXRlbXM/Lmxlbmd0aCB8fCAwLFxuICAgICAgICAgICAgaXRlbXM6IHVzZXIuY2FydD8uaXRlbXMgfHwgW10sXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IHVzZXIuY2FydD8udXBkYXRlZEF0XG4gICAgICAgICAgfSkpLFxuICAgICAgICAgIGN1cnJlbnRTZXNzaW9uOiB7XG4gICAgICAgICAgICBmcm9udGVuZFNlc3Npb25JZDogcmVxLmhlYWRlcnNbJ3gtZ3Vlc3Qtc2Vzc2lvbi1pZCddLFxuICAgICAgICAgICAgc2VydmVyU2Vzc2lvbklkOiByZXEuc2Vzc2lvbklELFxuICAgICAgICAgICAgc3RvcmVkQ2FydElkOiByZXEuc2Vzc2lvbj8uY2FydElkXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgfVxuICB9KTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU1DLE9BQU8sR0FBR0gsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzVDLE1BQU1JLElBQUksR0FBR0osT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RDLE1BQU1LLElBQUksR0FBR0wsT0FB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
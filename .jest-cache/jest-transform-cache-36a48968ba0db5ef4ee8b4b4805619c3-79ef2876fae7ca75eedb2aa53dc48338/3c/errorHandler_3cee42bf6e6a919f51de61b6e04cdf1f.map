{"version":3,"names":["ErrorCodes","VALIDATION_ERROR","NOT_FOUND","UNAUTHORIZED","FORBIDDEN","INTERNAL_ERROR","BAD_REQUEST","INVALID_CREDENTIALS","USER_EXISTS","USER_NOT_FOUND","TOKEN_INVALID","TOKEN_EXPIRED","AUTHENTICATION_REQUIRED","REGISTRATION_ERROR","INSUFFICIENT_PERMISSIONS","ACCOUNT_DISABLED","LOGIN_ERROR","FORGOT_PASSWORD_ERROR","RESET_PASSWORD_ERROR","INVALID_RESET_TOKEN","VERIFICATION_ERROR","PROFILE_FETCH_ERROR","PROFILE_UPDATE_ERROR","EMAIL_EXISTS","EMAIL_IN_USE","DUPLICATE_EMAIL","INVALID_PASSWORD","PASSWORD_CHANGE_ERROR","LOGOUT_ERROR","ADDRESS_ADD_ERROR","ADDRESS_UPDATE_ERROR","ADDRESS_DELETE_ERROR","ADDRESS_NOT_FOUND","ADDRESS_DEFAULT_ERROR","MISSING_TOKEN","TOKEN_REFRESH_ERROR","PRODUCT_NOT_FOUND","INVALID_PRODUCT_ID","PRODUCTS_FETCH_ERROR","PRODUCT_CREATION_ERROR","PRODUCT_UPDATE_ERROR","PRODUCT_DELETE_ERROR","SEARCH_ERROR","CATEGORIES_ERROR","FILTERS_ERROR","RECOMMENDATIONS_ERROR","MISSING_QUERY","CART_ADD_ERROR","CART_UPDATE_ERROR","CART_REMOVE_ERROR","CART_CLEAR_ERROR","CART_MERGE_ERROR","CART_FETCH_ERROR","ITEM_NOT_FOUND","MAX_QUANTITY_EXCEEDED","INVALID_QUANTITY","MISSING_PRODUCT_ID","NOT_GUEST_USER","RESET_SESSION_ERROR","ORDER_NOT_FOUND","ORDER_CREATE_ERROR","ORDER_UPDATE_ERROR","ORDER_CANCEL_ERROR","INVALID_ORDER_STATUS","EMPTY_CART","PAYMENT_FAILED","PAYMENT_METHOD_INVALID","INSUFFICIENT_FUNDS","PAYMENT_REQUIRED","PAYMENT_CREATE_ERROR","PAYMENT_STATUS_ERROR","MOLLIE_ERROR","WHOLESALER_ERROR","EMAIL_ERROR","formatError","code","message","field","additionalData","i18n","error","translatedMessage","Object","assign","success","createValidationError","validationResult","errors","array","details","map","err","param","path","msg","location","errorResponse","req","res","next","statusCode","errorCode","errorData","status","json","validationError","validationErrors","webhookError","send","module","exports"],"sources":["errorHandler.js"],"sourcesContent":["/**\n * Standardized error handling utilities for the Holistic Boutique API\n * Following CLAUDE.md constraints:\n * - Keep it simple - no event emitters or complex patterns\n * - Support internationalization for all error messages\n * - Use existing patterns from the codebase\n */\n\n// Standard error codes used across the application\nconst ErrorCodes = {\n  // Common errors\n  VALIDATION_ERROR: 'VALIDATION_ERROR',\n  NOT_FOUND: 'NOT_FOUND',\n  UNAUTHORIZED: 'UNAUTHORIZED',\n  FORBIDDEN: 'FORBIDDEN',\n  INTERNAL_ERROR: 'INTERNAL_ERROR',\n  BAD_REQUEST: 'BAD_REQUEST',\n  \n  // Authentication errors\n  INVALID_CREDENTIALS: 'INVALID_CREDENTIALS',\n  USER_EXISTS: 'USER_EXISTS',\n  USER_NOT_FOUND: 'USER_NOT_FOUND',\n  TOKEN_INVALID: 'TOKEN_INVALID',\n  TOKEN_EXPIRED: 'TOKEN_EXPIRED',\n  AUTHENTICATION_REQUIRED: 'AUTHENTICATION_REQUIRED',\n  REGISTRATION_ERROR: 'REGISTRATION_ERROR',\n  INSUFFICIENT_PERMISSIONS: 'INSUFFICIENT_PERMISSIONS',\n  ACCOUNT_DISABLED: 'ACCOUNT_DISABLED',\n  LOGIN_ERROR: 'LOGIN_ERROR',\n  FORGOT_PASSWORD_ERROR: 'FORGOT_PASSWORD_ERROR',\n  RESET_PASSWORD_ERROR: 'RESET_PASSWORD_ERROR',\n  INVALID_RESET_TOKEN: 'INVALID_RESET_TOKEN',\n  VERIFICATION_ERROR: 'VERIFICATION_ERROR',\n  PROFILE_FETCH_ERROR: 'PROFILE_FETCH_ERROR',\n  PROFILE_UPDATE_ERROR: 'PROFILE_UPDATE_ERROR',\n  EMAIL_EXISTS: 'EMAIL_EXISTS',\n  EMAIL_IN_USE: 'EMAIL_IN_USE',\n  DUPLICATE_EMAIL: 'DUPLICATE_EMAIL',\n  INVALID_PASSWORD: 'INVALID_PASSWORD',\n  PASSWORD_CHANGE_ERROR: 'PASSWORD_CHANGE_ERROR',\n  LOGOUT_ERROR: 'LOGOUT_ERROR',\n  ADDRESS_ADD_ERROR: 'ADDRESS_ADD_ERROR',\n  ADDRESS_UPDATE_ERROR: 'ADDRESS_UPDATE_ERROR',\n  ADDRESS_DELETE_ERROR: 'ADDRESS_DELETE_ERROR',\n  ADDRESS_NOT_FOUND: 'ADDRESS_NOT_FOUND',\n  ADDRESS_DEFAULT_ERROR: 'ADDRESS_DEFAULT_ERROR',\n  MISSING_TOKEN: 'MISSING_TOKEN',\n  TOKEN_REFRESH_ERROR: 'TOKEN_REFRESH_ERROR',\n  \n  // Product errors\n  PRODUCT_NOT_FOUND: 'PRODUCT_NOT_FOUND',\n  INVALID_PRODUCT_ID: 'INVALID_PRODUCT_ID',\n  PRODUCTS_FETCH_ERROR: 'PRODUCTS_FETCH_ERROR',\n  PRODUCT_CREATION_ERROR: 'PRODUCT_CREATION_ERROR',\n  PRODUCT_UPDATE_ERROR: 'PRODUCT_UPDATE_ERROR',\n  PRODUCT_DELETE_ERROR: 'PRODUCT_DELETE_ERROR',\n  SEARCH_ERROR: 'SEARCH_ERROR',\n  CATEGORIES_ERROR: 'CATEGORIES_ERROR',\n  FILTERS_ERROR: 'FILTERS_ERROR',\n  RECOMMENDATIONS_ERROR: 'RECOMMENDATIONS_ERROR',\n  MISSING_QUERY: 'MISSING_QUERY',\n  \n  // Cart errors\n  CART_ADD_ERROR: 'CART_ADD_ERROR',\n  CART_UPDATE_ERROR: 'CART_UPDATE_ERROR',\n  CART_REMOVE_ERROR: 'CART_REMOVE_ERROR',\n  CART_CLEAR_ERROR: 'CART_CLEAR_ERROR',\n  CART_MERGE_ERROR: 'CART_MERGE_ERROR',\n  CART_FETCH_ERROR: 'CART_FETCH_ERROR',\n  ITEM_NOT_FOUND: 'ITEM_NOT_FOUND',\n  MAX_QUANTITY_EXCEEDED: 'MAX_QUANTITY_EXCEEDED',\n  INVALID_QUANTITY: 'INVALID_QUANTITY',\n  MISSING_PRODUCT_ID: 'MISSING_PRODUCT_ID',\n  NOT_GUEST_USER: 'NOT_GUEST_USER',\n  RESET_SESSION_ERROR: 'RESET_SESSION_ERROR',\n  \n  // Order errors\n  ORDER_NOT_FOUND: 'ORDER_NOT_FOUND',\n  ORDER_CREATE_ERROR: 'ORDER_CREATE_ERROR',\n  ORDER_UPDATE_ERROR: 'ORDER_UPDATE_ERROR',\n  ORDER_CANCEL_ERROR: 'ORDER_CANCEL_ERROR',\n  INVALID_ORDER_STATUS: 'INVALID_ORDER_STATUS',\n  EMPTY_CART: 'EMPTY_CART',\n  \n  // Payment errors\n  PAYMENT_FAILED: 'PAYMENT_FAILED',\n  PAYMENT_METHOD_INVALID: 'PAYMENT_METHOD_INVALID',\n  INSUFFICIENT_FUNDS: 'INSUFFICIENT_FUNDS',\n  PAYMENT_REQUIRED: 'PAYMENT_REQUIRED',\n  PAYMENT_CREATE_ERROR: 'PAYMENT_CREATE_ERROR',\n  PAYMENT_STATUS_ERROR: 'PAYMENT_STATUS_ERROR',\n  \n  // Integration errors\n  MOLLIE_ERROR: 'MOLLIE_ERROR',\n  WHOLESALER_ERROR: 'WHOLESALER_ERROR',\n  EMAIL_ERROR: 'EMAIL_ERROR'\n};\n\n/**\n * Format error response in standardized format\n * @param {string} code - Error code from ErrorCodes\n * @param {string} message - Default error message (used if i18n key not found)\n * @param {string} field - Optional field name for validation errors\n * @param {object} additionalData - Additional data to include in error\n * @param {function} i18n - Optional i18n function for translation\n * @returns {object} Formatted error response\n */\nfunction formatError(code, message, field = null, additionalData = null, i18n = null) {\n  const error = {\n    code,\n    message\n  };\n\n  // Try to use i18n if available\n  if (i18n && typeof i18n === 'function') {\n    // The i18n function already handles the error code lookup\n    const translatedMessage = i18n(code, message);\n    error.message = translatedMessage;\n  }\n\n  if (field) {\n    error.field = field;\n  }\n\n  if (additionalData) {\n    Object.assign(error, additionalData);\n  }\n\n  return {\n    success: false,\n    error\n  };\n}\n\n/**\n * Create validation error from express-validator result\n * @param {object} validationResult - Express validator result object\n * @returns {object} Formatted validation error\n */\nfunction createValidationError(validationResult) {\n  const errors = validationResult.array();\n  \n  return {\n    success: false,\n    error: {\n      code: ErrorCodes.VALIDATION_ERROR,\n      message: 'Invalid input data',\n      details: errors.map(err => ({\n        field: err.param || err.path,\n        message: err.msg,\n        location: err.location\n      }))\n    }\n  };\n}\n\n/**\n * Express middleware to add error response helpers\n * Adds methods to res object for consistent error responses\n */\nfunction errorResponse(req, res, next) {\n  // Get i18n function if available (will be added when we implement backend i18n)\n  const i18n = req.i18n || null;\n\n  /**\n   * Send standardized error response\n   * @param {number} statusCode - HTTP status code\n   * @param {string} errorCode - Error code from ErrorCodes\n   * @param {string} message - Error message\n   * @param {string} field - Optional field name\n   * @param {object} additionalData - Additional error data\n   */\n  res.error = function(statusCode, errorCode, message, field = null, additionalData = null) {\n    const errorData = formatError(errorCode, message, field, additionalData, req.i18n);\n    return this.status(statusCode).json(errorData);\n  };\n\n  /**\n   * Send validation error response\n   * @param {object} validationErrors - Express validator errors\n   */\n  res.validationError = function(validationErrors) {\n    const errorData = createValidationError(validationErrors);\n    // Apply i18n to the validation error message\n    if (req.i18n && errorData.error) {\n      errorData.error.message = req.i18n(ErrorCodes.VALIDATION_ERROR, errorData.error.message);\n    }\n    return this.status(400).json(errorData);\n  };\n\n  next();\n}\n\n/**\n * Special handler for webhook endpoints that need plain text responses\n * @param {object} res - Express response object\n * @param {number} statusCode - HTTP status code\n * @param {string} message - Error message\n */\nfunction webhookError(res, statusCode, message) {\n  return res.status(statusCode).send(message);\n}\n\nmodule.exports = {\n  ErrorCodes,\n  formatError,\n  createValidationError,\n  errorResponse,\n  webhookError\n};"],"mappings":"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","ignoreList":[]}
6c777b076ddc1c1efb29f122903ebec2
const request = require('supertest');
const app = require('../server');
describe('Docker Environment Issues - Bug Reproduction', () => {
  // These tests focus on API communication issues, not database operations

  beforeAll(async () => {
    // Wait for server to be ready
    await new Promise(resolve => setTimeout(resolve, 1000));
  });
  afterAll(async () => {
    // Clean up without closing mongoose (handled by test setup)
  });
  describe('Issue #1: Products not displaying on frontend', () => {
    test('GET /api/products should return products list', async () => {
      const response = await request(app).get('/api/products').expect(200);
      expect(response.body.success).toBe(true);
      expect(response.body.data.products).toBeInstanceOf(Array);
      expect(response.body.data.products.length).toBeGreaterThan(0);
      expect(response.body.data.products[0]).toHaveProperty('name');
      expect(response.body.data.products[0]).toHaveProperty('price');
    });
    test('Frontend API calls should work with proxy configuration', async () => {
      // This test simulates the frontend making an API call
      // In Docker, the frontend nginx needs to proxy /api calls to backend
      const response = await request(app).get('/api/products').set('Origin', 'http://localhost:3001').set('Referer', 'http://localhost:3001/products').expect(200);

      // Check CORS headers are set correctly
      expect(response.headers['access-control-allow-origin']).toBe('http://localhost:3001');
      expect(response.headers['access-control-allow-credentials']).toBe('true');
    });
  });
  describe('Issue #2: User login not working', () => {
    const testUser = {
      email: 'docker-test@example.com',
      password: 'Password123!',
      firstName: 'Docker',
      lastName: 'Test'
    };
    test('POST /api/auth/register should create user and set httpOnly cookie', async () => {
      const response = await request(app).post('/api/auth/register').send(testUser).expect(201);
      expect(response.body.success).toBe(true);
      expect(response.body.data.user).toHaveProperty('email', testUser.email);

      // Check for httpOnly cookie
      const cookies = response.headers['set-cookie'];
      expect(cookies).toBeDefined();
      const tokenCookie = cookies.find(cookie => cookie.startsWith('token='));
      expect(tokenCookie).toBeDefined();
      expect(tokenCookie).toContain('HttpOnly');
      expect(tokenCookie).toContain('Path=/');
    });
    test('POST /api/auth/login should authenticate user and set httpOnly cookie', async () => {
      // First register the user
      await request(app).post('/api/auth/register').send(testUser);
      const response = await request(app).post('/api/auth/login').send({
        email: testUser.email,
        password: testUser.password
      }).expect(200);
      expect(response.body.success).toBe(true);
      expect(response.body.data.user).toHaveProperty('email', testUser.email);

      // Check for httpOnly cookie
      const cookies = response.headers['set-cookie'];
      expect(cookies).toBeDefined();
      const tokenCookie = cookies.find(cookie => cookie.startsWith('token='));
      expect(tokenCookie).toBeDefined();
      expect(tokenCookie).toContain('HttpOnly');
    });
    test('Protected routes should work with httpOnly cookie authentication', async () => {
      // Register and login to get cookie
      const loginResponse = await request(app).post('/api/auth/register').send(testUser);
      const cookies = loginResponse.headers['set-cookie'];

      // Try to access protected route with cookie
      const profileResponse = await request(app).get('/api/auth/profile').set('Cookie', cookies).expect(200);
      expect(profileResponse.body.success).toBe(true);
      expect(profileResponse.body.data.user.email).toBe(testUser.email);
    });
  });
  describe('Issue #3: Frontend-Backend communication in Docker', () => {
    test('CORS should allow frontend origin', async () => {
      const response = await request(app).options('/api/products').set('Origin', 'http://localhost:3001').set('Access-Control-Request-Method', 'GET').expect(204);
      expect(response.headers['access-control-allow-origin']).toBe('http://localhost:3001');
      expect(response.headers['access-control-allow-credentials']).toBe('true');
    });
    test('API should handle requests without VITE_API_URL', async () => {
      // When frontend uses relative URLs, they should work
      const response = await request(app).get('/api/products').set('Host', 'localhost:5001').expect(200);
      expect(response.body.success).toBe(true);
    });
    test('CSRF token endpoint should work', async () => {
      const response = await request(app).get('/api/csrf-token').expect(200);
      expect(response.body.success).toBe(true);
      expect(response.body).toHaveProperty('csrfToken');
    });
  });
  describe('Docker nginx proxy configuration issues', () => {
    test('API endpoints should be accessible through correct paths', async () => {
      const endpoints = ['/api/products', '/api/csrf-token', '/health'];
      for (const endpoint of endpoints) {
        const response = await request(app).get(endpoint).expect(200);
        expect(response.body).toBeDefined();
      }
    });
    test('Static image paths should be configured correctly', async () => {
      // In Docker, /images should be served by backend
      const response = await request(app).get('/images/test.jpg').expect(res => {
        // Should either return 200 (if exists) or 404 (if not exists)
        // but not 500 or other errors
        expect([200, 404]).toContain(res.status);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsImFwcCIsImRlc2NyaWJlIiwiYmVmb3JlQWxsIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwiYWZ0ZXJBbGwiLCJ0ZXN0IiwicmVzcG9uc2UiLCJnZXQiLCJleHBlY3QiLCJib2R5Iiwic3VjY2VzcyIsInRvQmUiLCJkYXRhIiwicHJvZHVjdHMiLCJ0b0JlSW5zdGFuY2VPZiIsIkFycmF5IiwibGVuZ3RoIiwidG9CZUdyZWF0ZXJUaGFuIiwidG9IYXZlUHJvcGVydHkiLCJzZXQiLCJoZWFkZXJzIiwidGVzdFVzZXIiLCJlbWFpbCIsInBhc3N3b3JkIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJwb3N0Iiwic2VuZCIsInVzZXIiLCJjb29raWVzIiwidG9CZURlZmluZWQiLCJ0b2tlbkNvb2tpZSIsImZpbmQiLCJjb29raWUiLCJzdGFydHNXaXRoIiwidG9Db250YWluIiwibG9naW5SZXNwb25zZSIsInByb2ZpbGVSZXNwb25zZSIsIm9wdGlvbnMiLCJlbmRwb2ludHMiLCJlbmRwb2ludCIsInJlcyIsInN0YXR1cyJdLCJzb3VyY2VzIjpbImRvY2tlci1pc3N1ZXMudGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZXF1ZXN0ID0gcmVxdWlyZSgnc3VwZXJ0ZXN0Jyk7XG5jb25zdCBhcHAgPSByZXF1aXJlKCcuLi9zZXJ2ZXInKTtcblxuZGVzY3JpYmUoJ0RvY2tlciBFbnZpcm9ubWVudCBJc3N1ZXMgLSBCdWcgUmVwcm9kdWN0aW9uJywgKCkgPT4ge1xuICAvLyBUaGVzZSB0ZXN0cyBmb2N1cyBvbiBBUEkgY29tbXVuaWNhdGlvbiBpc3N1ZXMsIG5vdCBkYXRhYmFzZSBvcGVyYXRpb25zXG4gIFxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIC8vIFdhaXQgZm9yIHNlcnZlciB0byBiZSByZWFkeVxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiB1cCB3aXRob3V0IGNsb3NpbmcgbW9uZ29vc2UgKGhhbmRsZWQgYnkgdGVzdCBzZXR1cClcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0lzc3VlICMxOiBQcm9kdWN0cyBub3QgZGlzcGxheWluZyBvbiBmcm9udGVuZCcsICgpID0+IHtcbiAgICB0ZXN0KCdHRVQgL2FwaS9wcm9kdWN0cyBzaG91bGQgcmV0dXJuIHByb2R1Y3RzIGxpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL3Byb2R1Y3RzJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YS5wcm9kdWN0cykudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YS5wcm9kdWN0cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEucHJvZHVjdHNbMF0pLnRvSGF2ZVByb3BlcnR5KCduYW1lJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhLnByb2R1Y3RzWzBdKS50b0hhdmVQcm9wZXJ0eSgncHJpY2UnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ0Zyb250ZW5kIEFQSSBjYWxscyBzaG91bGQgd29yayB3aXRoIHByb3h5IGNvbmZpZ3VyYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUaGlzIHRlc3Qgc2ltdWxhdGVzIHRoZSBmcm9udGVuZCBtYWtpbmcgYW4gQVBJIGNhbGxcbiAgICAgIC8vIEluIERvY2tlciwgdGhlIGZyb250ZW5kIG5naW54IG5lZWRzIHRvIHByb3h5IC9hcGkgY2FsbHMgdG8gYmFja2VuZFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9wcm9kdWN0cycpXG4gICAgICAgIC5zZXQoJ09yaWdpbicsICdodHRwOi8vbG9jYWxob3N0OjMwMDEnKVxuICAgICAgICAuc2V0KCdSZWZlcmVyJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMS9wcm9kdWN0cycpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gQ2hlY2sgQ09SUyBoZWFkZXJzIGFyZSBzZXQgY29ycmVjdGx5XG4gICAgICBleHBlY3QocmVzcG9uc2UuaGVhZGVyc1snYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luJ10pLnRvQmUoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMScpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlcnNbJ2FjY2Vzcy1jb250cm9sLWFsbG93LWNyZWRlbnRpYWxzJ10pLnRvQmUoJ3RydWUnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0lzc3VlICMyOiBVc2VyIGxvZ2luIG5vdCB3b3JraW5nJywgKCkgPT4ge1xuICAgIGNvbnN0IHRlc3RVc2VyID0ge1xuICAgICAgZW1haWw6ICdkb2NrZXItdGVzdEBleGFtcGxlLmNvbScsXG4gICAgICBwYXNzd29yZDogJ1Bhc3N3b3JkMTIzIScsXG4gICAgICBmaXJzdE5hbWU6ICdEb2NrZXInLFxuICAgICAgbGFzdE5hbWU6ICdUZXN0J1xuICAgIH07XG5cbiAgICB0ZXN0KCdQT1NUIC9hcGkvYXV0aC9yZWdpc3RlciBzaG91bGQgY3JlYXRlIHVzZXIgYW5kIHNldCBodHRwT25seSBjb29raWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9hdXRoL3JlZ2lzdGVyJylcbiAgICAgICAgLnNlbmQodGVzdFVzZXIpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEudXNlcikudG9IYXZlUHJvcGVydHkoJ2VtYWlsJywgdGVzdFVzZXIuZW1haWwpO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBmb3IgaHR0cE9ubHkgY29va2llXG4gICAgICBjb25zdCBjb29raWVzID0gcmVzcG9uc2UuaGVhZGVyc1snc2V0LWNvb2tpZSddO1xuICAgICAgZXhwZWN0KGNvb2tpZXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBjb25zdCB0b2tlbkNvb2tpZSA9IGNvb2tpZXMuZmluZChjb29raWUgPT4gY29va2llLnN0YXJ0c1dpdGgoJ3Rva2VuPScpKTtcbiAgICAgIGV4cGVjdCh0b2tlbkNvb2tpZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0b2tlbkNvb2tpZSkudG9Db250YWluKCdIdHRwT25seScpO1xuICAgICAgZXhwZWN0KHRva2VuQ29va2llKS50b0NvbnRhaW4oJ1BhdGg9LycpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnUE9TVCAvYXBpL2F1dGgvbG9naW4gc2hvdWxkIGF1dGhlbnRpY2F0ZSB1c2VyIGFuZCBzZXQgaHR0cE9ubHkgY29va2llJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRmlyc3QgcmVnaXN0ZXIgdGhlIHVzZXJcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9hdXRoL3JlZ2lzdGVyJylcbiAgICAgICAgLnNlbmQodGVzdFVzZXIpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9hdXRoL2xvZ2luJylcbiAgICAgICAgLnNlbmQoe1xuICAgICAgICAgIGVtYWlsOiB0ZXN0VXNlci5lbWFpbCxcbiAgICAgICAgICBwYXNzd29yZDogdGVzdFVzZXIucGFzc3dvcmRcbiAgICAgICAgfSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YS51c2VyKS50b0hhdmVQcm9wZXJ0eSgnZW1haWwnLCB0ZXN0VXNlci5lbWFpbCk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGZvciBodHRwT25seSBjb29raWVcbiAgICAgIGNvbnN0IGNvb2tpZXMgPSByZXNwb25zZS5oZWFkZXJzWydzZXQtY29va2llJ107XG4gICAgICBleHBlY3QoY29va2llcykudG9CZURlZmluZWQoKTtcbiAgICAgIGNvbnN0IHRva2VuQ29va2llID0gY29va2llcy5maW5kKGNvb2tpZSA9PiBjb29raWUuc3RhcnRzV2l0aCgndG9rZW49JykpO1xuICAgICAgZXhwZWN0KHRva2VuQ29va2llKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRva2VuQ29va2llKS50b0NvbnRhaW4oJ0h0dHBPbmx5Jyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdQcm90ZWN0ZWQgcm91dGVzIHNob3VsZCB3b3JrIHdpdGggaHR0cE9ubHkgY29va2llIGF1dGhlbnRpY2F0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gUmVnaXN0ZXIgYW5kIGxvZ2luIHRvIGdldCBjb29raWVcbiAgICAgIGNvbnN0IGxvZ2luUmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvYXV0aC9yZWdpc3RlcicpXG4gICAgICAgIC5zZW5kKHRlc3RVc2VyKTtcblxuICAgICAgY29uc3QgY29va2llcyA9IGxvZ2luUmVzcG9uc2UuaGVhZGVyc1snc2V0LWNvb2tpZSddO1xuICAgICAgXG4gICAgICAvLyBUcnkgdG8gYWNjZXNzIHByb3RlY3RlZCByb3V0ZSB3aXRoIGNvb2tpZVxuICAgICAgY29uc3QgcHJvZmlsZVJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvYXV0aC9wcm9maWxlJylcbiAgICAgICAgLnNldCgnQ29va2llJywgY29va2llcylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocHJvZmlsZVJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChwcm9maWxlUmVzcG9uc2UuYm9keS5kYXRhLnVzZXIuZW1haWwpLnRvQmUodGVzdFVzZXIuZW1haWwpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSXNzdWUgIzM6IEZyb250ZW5kLUJhY2tlbmQgY29tbXVuaWNhdGlvbiBpbiBEb2NrZXInLCAoKSA9PiB7XG4gICAgdGVzdCgnQ09SUyBzaG91bGQgYWxsb3cgZnJvbnRlbmQgb3JpZ2luJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLm9wdGlvbnMoJy9hcGkvcHJvZHVjdHMnKVxuICAgICAgICAuc2V0KCdPcmlnaW4nLCAnaHR0cDovL2xvY2FsaG9zdDozMDAxJylcbiAgICAgICAgLnNldCgnQWNjZXNzLUNvbnRyb2wtUmVxdWVzdC1NZXRob2QnLCAnR0VUJylcbiAgICAgICAgLmV4cGVjdCgyMDQpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuaGVhZGVyc1snYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luJ10pLnRvQmUoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMScpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlcnNbJ2FjY2Vzcy1jb250cm9sLWFsbG93LWNyZWRlbnRpYWxzJ10pLnRvQmUoJ3RydWUnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ0FQSSBzaG91bGQgaGFuZGxlIHJlcXVlc3RzIHdpdGhvdXQgVklURV9BUElfVVJMJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gV2hlbiBmcm9udGVuZCB1c2VzIHJlbGF0aXZlIFVSTHMsIHRoZXkgc2hvdWxkIHdvcmtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvcHJvZHVjdHMnKVxuICAgICAgICAuc2V0KCdIb3N0JywgJ2xvY2FsaG9zdDo1MDAxJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnQ1NSRiB0b2tlbiBlbmRwb2ludCBzaG91bGQgd29yaycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvY3NyZi10b2tlbicpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnY3NyZlRva2VuJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEb2NrZXIgbmdpbnggcHJveHkgY29uZmlndXJhdGlvbiBpc3N1ZXMnLCAoKSA9PiB7XG4gICAgdGVzdCgnQVBJIGVuZHBvaW50cyBzaG91bGQgYmUgYWNjZXNzaWJsZSB0aHJvdWdoIGNvcnJlY3QgcGF0aHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbmRwb2ludHMgPSBbXG4gICAgICAgICcvYXBpL3Byb2R1Y3RzJyxcbiAgICAgICAgJy9hcGkvY3NyZi10b2tlbicsXG4gICAgICAgICcvaGVhbHRoJ1xuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBlbmRwb2ludCBvZiBlbmRwb2ludHMpIHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgICAuZ2V0KGVuZHBvaW50KVxuICAgICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9CZURlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ1N0YXRpYyBpbWFnZSBwYXRocyBzaG91bGQgYmUgY29uZmlndXJlZCBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBJbiBEb2NrZXIsIC9pbWFnZXMgc2hvdWxkIGJlIHNlcnZlZCBieSBiYWNrZW5kXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvaW1hZ2VzL3Rlc3QuanBnJylcbiAgICAgICAgLmV4cGVjdCgocmVzKSA9PiB7XG4gICAgICAgICAgLy8gU2hvdWxkIGVpdGhlciByZXR1cm4gMjAwIChpZiBleGlzdHMpIG9yIDQwNCAoaWYgbm90IGV4aXN0cylcbiAgICAgICAgICAvLyBidXQgbm90IDUwMCBvciBvdGhlciBlcnJvcnNcbiAgICAgICAgICBleHBlY3QoWzIwMCwgNDA0XSkudG9Db250YWluKHJlcy5zdGF0dXMpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUNwQyxNQUFNQyxHQUFHLEdBQUdELE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFFaENFLFFBQVEsQ0FBQyw4Q0FBOEMsRUFBRSxNQUFNO0VBQzdEOztFQUVBQyxTQUFTLENBQUMsWUFBWTtJQUNwQjtJQUNBLE1BQU0sSUFBSUMsT0FBTyxDQUFDQyxPQUFPLElBQUlDLFVBQVUsQ0FBQ0QsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0VBQ3pELENBQUMsQ0FBQztFQUVGRSxRQUFRLENBQUMsWUFBWTtJQUNuQjtFQUFBLENBQ0QsQ0FBQztFQUVGTCxRQUFRLENBQUMsK0NBQStDLEVBQUUsTUFBTTtJQUM5RE0sSUFBSSxDQUFDLCtDQUErQyxFQUFFLFlBQVk7TUFDaEUsTUFBTUMsUUFBUSxHQUFHLE1BQU1WLE9BQU8sQ0FB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
{"version":3,"names":["express","require","router","Router","body","param","query","Product","Order","apiKeyAuth","handleValidationErrors","rateLimits","use","integration","get","isLength","min","max","matches","withMessage","optional","req","res","referenceKey","params","source","product","findOne","$or","slug","isActive","status","json","success","error","code","message","console","log","crossSiteData","getCrossSiteData","meta","referralSource","crossSiteEnabled","directUrl","embedUrl","isIn","format","theme","embedData","id","_id","name","shortDescription","price","compareAtPrice","primaryImage","images","find","img","isPrimary","category","properties","chakra","element","healing","seo","urls","addToCart","buyNow","htmlWidget","generateProductWidget","setHeader","send","embed","embedCode","protocol","isInt","contentId","limit","includes","chakraName","replace","$in","elementName","healingProperty","propertyFilters","JSON","parse","Object","keys","forEach","key","Array","isArray","e","products","parseInt","sort","isFeatured","createdAt","relatedProducts","map","count","length","filters","totalAvailable","countDocuments","post","isMongoId","isObject","productId","action","metadata","analyticsData","timestamp","Date","ip","userAgent","isISO8601","startDate","endDate","dateFilter","$gte","$lte","sourceFilter","orderAnalytics","aggregate","$match","$exists","$ne","$group","orderCount","$sum","totalRevenue","averageOrderValue","$avg","$sort","topProducts","$unwind","referralCount","revenue","$multiply","$lookup","from","localField","foreignField","as","$project","productName","productSlug","$limit","analytics","summary","totalReferralOrders","reduce","sum","item","totalReferralRevenue","averageReferralOrderValue","bySource","dateRange","generatedAt","escapeHtml","text","themeStyles","url","alt","toFixed","join","module","exports"],"sources":["integration.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst { body, param, query } = require('express-validator');\nconst Product = require('../models/Product');\nconst Order = require('../models/Order');\nconst { apiKeyAuth, handleValidationErrors, rateLimits } = require('../middleware/security');\n\n// Apply integration-specific rate limiting\nrouter.use(rateLimits.integration);\n\n// Get product by reference key for cross-site linking\nrouter.get('/products/link/:referenceKey', [\n  param('referenceKey').isLength({ min: 1, max: 100 }).matches(/^[a-zA-Z0-9-_]+$/).withMessage('Invalid reference key format'),\n  query('source').optional().isLength({ max: 100 }).withMessage('Source parameter too long'),\n  handleValidationErrors\n], async (req, res) => {\n  try {\n    const { referenceKey } = req.params;\n    const { source } = req.query; // Track referral source\n    \n    const product = await Product.findOne({\n      $or: [\n        { 'crossSiteIntegration.referenceKey': referenceKey },\n        { slug: referenceKey }\n      ],\n      isActive: true,\n      'crossSiteIntegration.enabled': true\n    });\n    \n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        error: {\n          code: 'PRODUCT_NOT_FOUND',\n          message: 'Product not found or not available for cross-site integration'\n        }\n      });\n    }\n    \n    // Track referral if source is provided\n    if (source) {\n      // Log referral for analytics (you might want to store this in a separate collection)\n      console.log(`Cross-site referral: ${source} -> ${product.slug}`);\n    }\n    \n    // Return cross-site optimized product data\n    const crossSiteData = product.getCrossSiteData();\n    \n    res.json({\n      success: true,\n      product: crossSiteData,\n      meta: {\n        referralSource: source,\n        crossSiteEnabled: true,\n        directUrl: `/products/${product.slug}`,\n        embedUrl: `/api/integration/products/embed/${product.slug}`\n      }\n    });\n    \n  } catch (error) {\n    console.error('Cross-site product link error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'INTEGRATION_ERROR',\n        message: 'Failed to fetch product for cross-site integration'\n      }\n    });\n  }\n});\n\n// Get embeddable product widget data\nrouter.get('/products/embed/:slug', [\n  param('slug').isLength({ min: 1, max: 100 }).matches(/^[a-zA-Z0-9-_]+$/).withMessage('Invalid slug format'),\n  query('format').optional().isIn(['json', 'html']).withMessage('Format must be json or html'),\n  query('theme').optional().isIn(['light', 'dark']).withMessage('Theme must be light or dark'),\n  handleValidationErrors\n], async (req, res) => {\n  try {\n    const { slug } = req.params;\n    const { format = 'json', theme = 'light' } = req.query;\n    \n    const product = await Product.findOne({\n      slug,\n      isActive: true,\n      'crossSiteIntegration.enabled': true\n    });\n    \n    if (!product) {\n      return res.status(404).json({\n        success: false,\n        error: {\n          code: 'PRODUCT_NOT_FOUND',\n          message: 'Product not found or not available for embedding'\n        }\n      });\n    }\n    \n    const embedData = {\n      id: product._id,\n      name: product.name,\n      slug: product.slug,\n      shortDescription: product.shortDescription,\n      price: product.price,\n      compareAtPrice: product.compareAtPrice,\n      primaryImage: product.images.find(img => img.isPrimary) || product.images[0],\n      category: product.category,\n      properties: {\n        chakra: product.properties.chakra,\n        element: product.properties.element,\n        healing: product.properties.healing\n      },\n      seo: product.seo,\n      urls: {\n        product: `/products/${product.slug}`,\n        addToCart: `/api/cart/add`,\n        buyNow: `/checkout?product=${product._id}`\n      }\n    };\n    \n    if (format === 'html') {\n      // Return HTML widget\n      const htmlWidget = generateProductWidget(embedData, theme);\n      res.setHeader('Content-Type', 'text/html');\n      res.send(htmlWidget);\n    } else {\n      // Return JSON data\n      res.json({\n        success: true,\n        embed: embedData,\n        meta: {\n          format,\n          theme,\n          embedCode: `<iframe src=\"${req.protocol}://${req.get('host')}/api/integration/products/embed/${slug}?format=html&theme=${theme}\" width=\"300\" height=\"400\" frameborder=\"0\"></iframe>`\n        }\n      });\n    }\n    \n  } catch (error) {\n    console.error('Product embed error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'EMBED_ERROR',\n        message: 'Failed to generate product embed'\n      }\n    });\n  }\n});\n\n// Get products related to content ID (for content-based recommendations)\nrouter.get('/products/related/:contentId', [\n  param('contentId').isLength({ min: 1, max: 100 }).matches(/^[a-zA-Z0-9-_]+$/).withMessage('Invalid content ID format'),\n  query('limit').optional().isInt({ min: 1, max: 50 }).withMessage('Limit must be between 1 and 50'),\n  query('category').optional().isLength({ max: 50 }).withMessage('Category parameter too long'),\n  handleValidationErrors\n], async (req, res) => {\n  try {\n    const { contentId } = req.params;\n    const { limit = 6, category, properties } = req.query;\n    \n    // Build query based on content relationship\n    let query = {\n      isActive: true,\n      'crossSiteIntegration.enabled': true\n    };\n    \n    // Add content-specific filters\n    if (contentId.includes('chakra')) {\n      const chakraName = contentId.replace('chakra-', '');\n      query['properties.chakra'] = { $in: [chakraName] };\n    } else if (contentId.includes('element')) {\n      const elementName = contentId.replace('element-', '');\n      query['properties.element'] = { $in: [elementName] };\n    } else if (contentId.includes('healing')) {\n      const healingProperty = contentId.replace('healing-', '');\n      query['properties.healing'] = { $in: [healingProperty] };\n    }\n    \n    // Add additional filters\n    if (category) {\n      query.category = category;\n    }\n    \n    if (properties) {\n      try {\n        const propertyFilters = JSON.parse(properties);\n        Object.keys(propertyFilters).forEach(key => {\n          if (propertyFilters[key]) {\n            query[`properties.${key}`] = { $in: Array.isArray(propertyFilters[key]) ? propertyFilters[key] : [propertyFilters[key]] };\n          }\n        });\n      } catch (e) {\n        // Ignore invalid JSON in properties filter\n      }\n    }\n    \n    const products = await Product.find(query)\n      .limit(parseInt(limit))\n      .sort({ isFeatured: -1, createdAt: -1 });\n    \n    const relatedProducts = products.map(product => product.getCrossSiteData());\n    \n    res.json({\n      success: true,\n      products: relatedProducts,\n      meta: {\n        contentId,\n        count: relatedProducts.length,\n        filters: { category, properties },\n        totalAvailable: await Product.countDocuments(query)\n      }\n    });\n    \n  } catch (error) {\n    console.error('Related products error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'RELATED_PRODUCTS_ERROR',\n        message: 'Failed to fetch related products'\n      }\n    });\n  }\n});\n\n// Track referral analytics (requires API key)\nrouter.post('/analytics/referral', [\n  apiKeyAuth,\n  body('source').isLength({ min: 1, max: 100 }).withMessage('Source is required and must be less than 100 characters'),\n  body('action').isIn(['view', 'click', 'add_to_cart', 'purchase']).withMessage('Action must be one of: view, click, add_to_cart, purchase'),\n  body('productId').optional().isMongoId().withMessage('Invalid product ID format'),\n  body('metadata').optional().isObject().withMessage('Metadata must be an object'),\n  handleValidationErrors\n], async (req, res) => {\n  try {\n    const { source, productId, action, metadata } = req.body;\n    \n    if (!source || !action) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'MISSING_REQUIRED_FIELDS',\n          message: 'Source and action are required'\n        }\n      });\n    }\n    \n    // Log referral analytics (in a real app, you'd store this in a dedicated analytics collection)\n    const analyticsData = {\n      timestamp: new Date(),\n      source,\n      productId,\n      action, // 'view', 'click', 'add_to_cart', 'purchase'\n      metadata,\n      ip: req.ip,\n      userAgent: req.get('User-Agent')\n    };\n    \n    console.log('Cross-site analytics:', analyticsData);\n    \n    // TODO: Store in analytics collection\n    // await Analytics.create(analyticsData);\n    \n    res.json({\n      success: true,\n      message: 'Referral tracked successfully'\n    });\n    \n  } catch (error) {\n    console.error('Analytics tracking error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'ANALYTICS_ERROR',\n        message: 'Failed to track referral'\n      }\n    });\n  }\n});\n\n// Get referral analytics summary (requires API key)\nrouter.get('/analytics/summary', [\n  apiKeyAuth,\n  query('startDate').optional().isISO8601().withMessage('Start date must be in ISO8601 format'),\n  query('endDate').optional().isISO8601().withMessage('End date must be in ISO8601 format'),\n  query('source').optional().isLength({ max: 100 }).withMessage('Source parameter too long'),\n  handleValidationErrors\n], async (req, res) => {\n  try {\n    const { startDate, endDate, source } = req.query;\n    \n    // Build date filter\n    let dateFilter = {};\n    if (startDate || endDate) {\n      dateFilter.createdAt = {};\n      if (startDate) dateFilter.createdAt.$gte = new Date(startDate);\n      if (endDate) dateFilter.createdAt.$lte = new Date(endDate);\n    }\n    \n    // Build source filter\n    let sourceFilter = {};\n    if (source) {\n      sourceFilter.referralSource = source;\n    }\n    \n    // Get order analytics with referral sources\n    const orderAnalytics = await Order.aggregate([\n      {\n        $match: {\n          ...dateFilter,\n          ...sourceFilter,\n          referralSource: { $exists: true, $ne: null }\n        }\n      },\n      {\n        $group: {\n          _id: '$referralSource',\n          orderCount: { $sum: 1 },\n          totalRevenue: { $sum: '$total' },\n          averageOrderValue: { $avg: '$total' }\n        }\n      },\n      {\n        $sort: { orderCount: -1 }\n      }\n    ]);\n    \n    // Get top referred products\n    const topProducts = await Order.aggregate([\n      {\n        $match: {\n          ...dateFilter,\n          referralSource: { $exists: true, $ne: null }\n        }\n      },\n      { $unwind: '$items' },\n      {\n        $group: {\n          _id: '$items.product',\n          referralCount: { $sum: '$items.quantity' },\n          revenue: { $sum: { $multiply: ['$items.price', '$items.quantity'] } }\n        }\n      },\n      {\n        $lookup: {\n          from: 'products',\n          localField: '_id',\n          foreignField: '_id',\n          as: 'product'\n        }\n      },\n      { $unwind: '$product' },\n      {\n        $project: {\n          productName: '$product.name',\n          productSlug: '$product.slug',\n          referralCount: 1,\n          revenue: 1\n        }\n      },\n      { $sort: { referralCount: -1 } },\n      { $limit: 10 }\n    ]);\n    \n    res.json({\n      success: true,\n      analytics: {\n        summary: {\n          totalReferralOrders: orderAnalytics.reduce((sum, item) => sum + item.orderCount, 0),\n          totalReferralRevenue: orderAnalytics.reduce((sum, item) => sum + item.totalRevenue, 0),\n          averageReferralOrderValue: orderAnalytics.length > 0 \n            ? orderAnalytics.reduce((sum, item) => sum + item.averageOrderValue, 0) / orderAnalytics.length \n            : 0\n        },\n        bySource: orderAnalytics,\n        topProducts\n      },\n      meta: {\n        dateRange: { startDate, endDate },\n        sourceFilter: source,\n        generatedAt: new Date()\n      }\n    });\n    \n  } catch (error) {\n    console.error('Analytics summary error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'ANALYTICS_SUMMARY_ERROR',\n        message: 'Failed to generate analytics summary'\n      }\n    });\n  }\n});\n\n// HTML escape function to prevent XSS\nfunction escapeHtml(text) {\n  if (!text) return '';\n  return text\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\n// Generate HTML widget for product embedding\nfunction generateProductWidget(product, theme = 'light') {\n  const themeStyles = theme === 'dark' \n    ? 'background: #2d3748; color: #e2e8f0; border: 1px solid #4a5568;'\n    : 'background: #ffffff; color: #2d3748; border: 1px solid #e2e8f0;';\n    \n  return `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"utf-8\">\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n      <title>${escapeHtml(product.name)} - Holistic Store</title>\n      <style>\n        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }\n        .product-widget {\n          ${themeStyles}\n          border-radius: 8px;\n          padding: 16px;\n          max-width: 300px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        }\n        .product-image {\n          width: 100%;\n          height: 200px;\n          object-fit: cover;\n          border-radius: 4px;\n          margin-bottom: 12px;\n        }\n        .product-name {\n          font-size: 18px;\n          font-weight: 600;\n          margin-bottom: 8px;\n          line-height: 1.3;\n        }\n        .product-description {\n          font-size: 14px;\n          margin-bottom: 12px;\n          opacity: 0.8;\n          line-height: 1.4;\n        }\n        .product-price {\n          font-size: 20px;\n          font-weight: 700;\n          margin-bottom: 16px;\n        }\n        .product-properties {\n          font-size: 12px;\n          margin-bottom: 16px;\n          opacity: 0.7;\n        }\n        .product-button {\n          background: #4299e1;\n          color: white;\n          border: none;\n          padding: 12px 24px;\n          border-radius: 4px;\n          font-size: 14px;\n          font-weight: 600;\n          cursor: pointer;\n          width: 100%;\n          text-decoration: none;\n          display: inline-block;\n          text-align: center;\n          transition: background 0.2s;\n        }\n        .product-button:hover {\n          background: #3182ce;\n        }\n      </style>\n    </head>\n    <body>\n      <div class=\"product-widget\">\n        ${product.primaryImage ? `<img src=\"${escapeHtml(product.primaryImage.url)}\" alt=\"${escapeHtml(product.primaryImage.alt || product.name)}\" class=\"product-image\">` : ''}\n        <div class=\"product-name\">${escapeHtml(product.name)}</div>\n        <div class=\"product-description\">${escapeHtml(product.shortDescription || '')}</div>\n        <div class=\"product-price\">\n          $${product.price.toFixed(2)}\n          ${product.compareAtPrice ? `<span style=\"text-decoration: line-through; opacity: 0.6; font-size: 16px; margin-left: 8px;\">$${product.compareAtPrice.toFixed(2)}</span>` : ''}\n        </div>\n        ${product.properties.chakra || product.properties.element ? `\n          <div class=\"product-properties\">\n            ${product.properties.chakra ? `Chakra: ${escapeHtml(product.properties.chakra.join(', '))} ` : ''}\n            ${product.properties.element ? `Element: ${escapeHtml(product.properties.element.join(', '))}` : ''}\n          </div>\n        ` : ''}\n        <a href=\"${escapeHtml(product.urls.product)}\" target=\"_parent\" class=\"product-button\">\n          View Product\n        </a>\n      </div>\n    </body>\n    </html>\n  `;\n}\n\nmodule.exports = router;"],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC,IAAI;EAAEC,KAAK;EAAEC;AAAM,CAAC,GAAGL,OAAO,CAAC,mBAAmB,CAAC;AAC3D,MAAMM,OAAO,GAAGN,OAAO,CAAC,mBAAmB,CAAC;AAC5C,MAAMO,KAAK,GAAGP,OAAO,CAAC,iBAAiB,CAAC;AACxC,MAAM;EAAEQ,UAAU;EAAEC,sBAAsB;EAAEC;AAAW,CAAC,GAAGV,OAAO,CAAC,wBAAwB,CAAC;;AAE5F;AACAC,MAAM,CAACU,GAAG,CAACD,UAAU,CAACE,WAAW,CAAC;;AAElC;AACAX,MAAM,CAACY,GAAG,CAAC,8BAA8B,EAAE,CACzCT,KAAK,CAAC,cAAc,CAAC,CAACU,QAAQ,CAAC;EAAEC,GAAG,EAAE,CAAC;EAAEC,GAAG,EAAE;AAAI,CAAC,CAAC,CAACC,OAAO,CAAC,kBAAkB,CAAC,CAACC,WAAW,CAAC,8BAA8B,CAAC,EAC5Hb,KAAK,CAAC,QAAQ,CAAC,CAACc,QAAQ,CAAC,CAAC,CAACL,QAAQ,CAAC;EAAEE,GAAG,EAAE;AAAI,CAAC,CAAC,CAACE,WAAW,CAAC,2BAA2B,CAAC,EAC1FT,sBAAsB,CACvB,EAAE,OAAOW,GAAG,EAAEC,GAAG,KAAK;EACrB,IAAI;IACF,MAAM;MAAEC;IAAa,CAAC,GAAGF,GAAG,CAACG,MAAM;IACnC,MAAM;MAAEC;IAAO,CAAC,GAAGJ,GAAG,CAACf,KAAK,CAAC,CAAC;;IAE9B,MAAMoB,OAAO,GAAG,MAAMnB,OAAO,CAACoB,OAAO,CAAC;MACpCC,GAAG,EAAE,CACH;QAAE,mCAAmC,EAAEL;MAAa,CAAC,EACrD;QAAEM,IAAI,EAAEN;MAAa,CAAC,CACvB;MACDO,QAAQ,EAAE,IAAI;MACd,8BAA8B,EAAE;IAClC,CAAC,CAAC;IAEF,IAAI,CAACJ,OAAO,EAAE;MACZ,OAAOJ,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACdC,KAAK,EAAE;UACLC,IAAI,EAAE,mBAAmB;UACzBC,OAAO,EAAE;QACX;MACF,CAAC,CAAC;IACJ;;IAEA;IACA,IAAIX,MAAM,EAAE;MACV;MACAY,OAAO,CAACC,GAAG,CAAC,wBAAwBb,MAAM,OAAOC,OAAO,CAACG,IAAI,EAAE,CAAC;IAClE;;IAEA;IACA,MAAMU,aAAa,GAAGb,OAAO,CAACc,gBAAgB,CAAC,CAAC;IAEhDlB,GAAG,CAACU,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACbP,OAAO,EAAEa,aAAa;MACtBE,IAAI,EAAE;QACJC,cAAc,EAAEjB,MAAM;QACtBkB,gBAAgB,EAAE,IAAI;QACtBC,SAAS,EAAE,aAAalB,OAAO,CAACG,IAAI,EAAE;QACtCgB,QAAQ,EAAE,mCAAmCnB,OAAO,CAACG,IAAI;MAC3D;IACF,CAAC,CAAC;EAEJ,CAAC,CAAC,OAAOK,KAAK,EAAE;IACdG,OAAO,CAACH,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;IACtDZ,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACdC,KAAK,EAAE;QACLC,IAAI,EAAE,mBAAmB;QACzBC,OAAO,EAAE;MACX;IACF,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACAlC,MAAM,CAACY,GAAG,CAAC,uBAAuB,EAAE,CAClCT,KAAK,CAAC,MAAM,CAAC,CAACU,QAAQ,CAAC;EAAEC,GAAG,EAAE,CAAC;EAAEC,GAAG,EAAE;AAAI,CAAC,CAAC,CAACC,OAAO,CAAC,kBAAkB,CAAC,CAACC,WAAW,CAAC,qBAAqB,CAAC,EAC3Gb,KAAK,CAAC,QAAQ,CAAC,CAACc,QAAQ,CAAC,CAAC,CAAC0B,IAAI,CAAC,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC3B,WAAW,CAAC,6BAA6B,CAAC,EAC5Fb,KAAK,CAAC,OAAO,CAAC,CAACc,QAAQ,CAAC,CAAC,CAAC0B,IAAI,CAAC,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC3B,WAAW,CAAC,6BAA6B,CAAC,EAC5FT,sBAAsB,CACvB,EAAE,OAAOW,GAAG,EAAEC,GAAG,KAAK;EACrB,IAAI;IACF,MAAM;MAAEO;IAAK,CAAC,GAAGR,GAAG,CAACG,MAAM;IAC3B,MAAM;MAAEuB,MAAM,GAAG,MAAM;MAAEC,KAAK,GAAG;IAAQ,CAAC,GAAG3B,GAAG,CAACf,KAAK;IAEtD,MAAMoB,OAAO,GAAG,MAAMnB,OAAO,CAACoB,OAAO,CAAC;MACpCE,IAAI;MACJC,QAAQ,EAAE,IAAI;MACd,8BAA8B,EAAE;IAClC,CAAC,CAAC;IAEF,IAAI,CAACJ,OAAO,EAAE;MACZ,OAAOJ,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACdC,KAAK,EAAE;UACLC,IAAI,EAAE,mBAAmB;UACzBC,OAAO,EAAE;QACX;MACF,CAAC,CAAC;IACJ;IAEA,MAAMa,SAAS,GAAG;MAChBC,EAAE,EAAExB,OAAO,CAACyB,GAAG;MACfC,IAAI,EAAE1B,OAAO,CAAC0B,IAAI;MAClBvB,IAAI,EAAEH,OAAO,CAACG,IAAI;MAClBwB,gBAAgB,EAAE3B,OAAO,CAAC2B,gBAAgB;MAC1CC,KAAK,EAAE5B,OAAO,CAAC4B,KAAK;MACpBC,cAAc,EAAE7B,OAAO,CAAC6B,cAAc;MACtCC,YAAY,EAAE9B,OAAO,CAAC+B,MAAM,CAACC,IAAI,CAACC,GAAG,IAAIA,GAAG,CAACC,SAAS,CAAC,IAAIlC,OAAO,CAAC+B,MAAM,CAAC,CAAC,CAAC;MAC5EI,QAAQ,EAAEnC,OAAO,CAACmC,QAAQ;MAC1BC,UAAU,EAAE;QACVC,MAAM,EAAErC,OAAO,CAACoC,UAAU,CAACC,MAAM;QACjCC,OAAO,EAAEtC,OAAO,CAACoC,UAAU,CAACE,OAAO;QACnCC,OAAO,EAAEvC,OAAO,CAACoC,UAAU,CAACG;MAC9B,CAAC;MACDC,GAAG,EAAExC,OAAO,CAACwC,GAAG;MAChBC,IAAI,EAAE;QACJzC,OAAO,EAAE,aAAaA,OAAO,CAACG,IAAI,EAAE;QACpCuC,SAAS,EAAE,eAAe;QAC1BC,MAAM,EAAE,qBAAqB3C,OAAO,CAACyB,GAAG;MAC1C;IACF,CAAC;IAED,IAAIJ,MAAM,KAAK,MAAM,EAAE;MACrB;MACA,MAAMuB,UAAU,GAAGC,qBAAqB,CAACtB,SAAS,EAAED,KAAK,CAAC;MAC1D1B,GAAG,CAACkD,SAAS,CAAC,cAAc,EAAE,WAAW,CAAC;MAC1ClD,GAAG,CAACmD,IAAI,CAACH,UAAU,CAAC;IACtB,CAAC,MAAM;MACL;MACAhD,GAAG,CAACU,IAAI,CAAC;QACPC,OAAO,EAAE,IAAI;QACbyC,KAAK,EAAEzB,SAAS;QAChBR,IAAI,EAAE;UACJM,MAAM;UACNC,KAAK;UACL2B,SAAS,EAAE,gBAAgBtD,GAAG,CAACuD,QAAQ,MAAMvD,GAAG,CAACP,GAAG,CAAC,MAAM,CAAC,mCAAmCe,IAAI,sBAAsBmB,KAAK;QAChI;MACF,CAAC,CAAC;IACJ;EAEF,CAAC,CAAC,OAAOd,KAAK,EAAE;IACdG,OAAO,CAACH,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;IAC5CZ,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACdC,KAAK,EAAE;QACLC,IAAI,EAAE,aAAa;QACnBC,OAAO,EAAE;MACX;IACF,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACAlC,MAAM,CAACY,GAAG,CAAC,8BAA8B,EAAE,CACzCT,KAAK,CAAC,WAAW,CAAC,CAACU,QAAQ,CAAC;EAAEC,GAAG,EAAE,CAAC;EAAEC,GAAG,EAAE;AAAI,CAAC,CAAC,CAACC,OAAO,CAAC,kBAAkB,CAAC,CAACC,WAAW,CAAC,2BAA2B,CAAC,EACtHb,KAAK,CAAC,OAAO,CAAC,CAACc,QAAQ,CAAC,CAAC,CAACyD,KAAK,CAAC;EAAE7D,GAAG,EAAE,CAAC;EAAEC,GAAG,EAAE;AAAG,CAAC,CAAC,CAACE,WAAW,CAAC,gCAAgC,CAAC,EAClGb,KAAK,CAAC,UAAU,CAAC,CAACc,QAAQ,CAAC,CAAC,CAACL,QAAQ,CAAC;EAAEE,GAAG,EAAE;AAAG,CAAC,CAAC,CAACE,WAAW,CAAC,6BAA6B,CAAC,EAC7FT,sBAAsB,CACvB,EAAE,OAAOW,GAAG,EAAEC,GAAG,KAAK;EACrB,IAAI;IACF,MAAM;MAAEwD;IAAU,CAAC,GAAGzD,GAAG,CAACG,MAAM;IAChC,MAAM;MAAEuD,KAAK,GAAG,CAAC;MAAElB,QAAQ;MAAEC;IAAW,CAAC,GAAGzC,GAAG,CAACf,KAAK;;IAErD;IACA,IAAIA,KAAK,GAAG;MACVwB,QAAQ,EAAE,IAAI;MACd,8BAA8B,EAAE;IAClC,CAAC;;IAED;IACA,IAAIgD,SAAS,CAACE,QAAQ,CAAC,QAAQ,CAAC,EAAE;MAChC,MAAMC,UAAU,GAAGH,SAAS,CAACI,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;MACnD5E,KAAK,CAAC,mBAAmB,CAAC,GAAG;QAAE6E,GAAG,EAAE,CAACF,UAAU;MAAE,CAAC;IACpD,CAAC,MAAM,IAAIH,SAAS,CAACE,QAAQ,CAAC,SAAS,CAAC,EAAE;MACxC,MAAMI,WAAW,GAAGN,SAAS,CAACI,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC;MACrD5E,KAAK,CAAC,oBAAoB,CAAC,GAAG;QAAE6E,GAAG,EAAE,CAACC,WAAW;MAAE,CAAC;IACtD,CAAC,MAAM,IAAIN,SAAS,CAACE,QAAQ,CAAC,SAAS,CAAC,EAAE;MACxC,MAAMK,eAAe,GAAGP,SAAS,CAACI,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC;MACzD5E,KAAK,CAAC,oBAAoB,CAAC,GAAG;QAAE6E,GAAG,EAAE,CAACE,eAAe;MAAE,CAAC;IAC1D;;IAEA;IACA,IAAIxB,QAAQ,EAAE;MACZvD,KAAK,CAACuD,QAAQ,GAAGA,QAAQ;IAC3B;IAEA,IAAIC,UAAU,EAAE;MACd,IAAI;QACF,MAAMwB,eAAe,GAAGC,IAAI,CAACC,KAAK,CAAC1B,UAAU,CAAC;QAC9C2B,MAAM,CAACC,IAAI,CAACJ,eAAe,CAAC,CAACK,OAAO,CAACC,GAAG,IAAI;UAC1C,IAAIN,eAAe,CAACM,GAAG,CAAC,EAAE;YACxBtF,KAAK,CAAC,cAAcsF,GAAG,EAAE,CAAC,GAAG;cAAET,GAAG,EAAEU,KAAK,CAACC,OAAO,CAACR,eAAe,CAACM,GAAG,CAAC,CAAC,GAAGN,eAAe,CAACM,GAAG,CAAC,GAAG,CAACN,eAAe,CAACM,GAAG,CAAC;YAAE,CAAC;UAC3H;QACF,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOG,CAAC,EAAE;QACV;MAAA;IAEJ;IAEA,MAAMC,QAAQ,GAAG,MAAMzF,OAAO,CAACmD,IAAI,CAACpD,KAAK,CAAC,CACvCyE,KAAK,CAACkB,QAAQ,CAAClB,KAAK,CAAC,CAAC,CACtBmB,IAAI,CAAC;MAAEC,UAAU,EAAE,CAAC,CAAC;MAAEC,SAAS,EAAE,CAAC;IAAE,CAAC,CAAC;IAE1C,MAAMC,eAAe,GAAGL,QAAQ,CAACM,GAAG,CAAC5E,OAAO,IAAIA,OAAO,CAACc,gBAAgB,CAAC,CAAC,CAAC;IAE3ElB,GAAG,CAACU,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACb+D,QAAQ,EAAEK,eAAe;MACzB5D,IAAI,EAAE;QACJqC,SAAS;QACTyB,KAAK,EAAEF,eAAe,CAACG,MAAM;QAC7BC,OAAO,EAAE;UAAE5C,QAAQ;UAAEC;QAAW,CAAC;QACjC4C,cAAc,EAAE,MAAMnG,OAAO,CAACoG,cAAc,CAACrG,KAAK;MACpD;IACF,CAAC,CAAC;EAEJ,CAAC,CAAC,OAAO4B,KAAK,EAAE;IACdG,OAAO,CAACH,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;IAC/CZ,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACdC,KAAK,EAAE;QACLC,IAAI,EAAE,wBAAwB;QAC9BC,OAAO,EAAE;MACX;IACF,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACAlC,MAAM,CAAC0G,IAAI,CAAC,qBAAqB,EAAE,CACjCnG,UAAU,EACVL,IAAI,CAAC,QAAQ,CAAC,CAACW,QAAQ,CAAC;EAAEC,GAAG,EAAE,CAAC;EAAEC,GAAG,EAAE;AAAI,CAAC,CAAC,CAACE,WAAW,CAAC,yDAAyD,CAAC,EACpHf,IAAI,CAAC,QAAQ,CAAC,CAAC0C,IAAI,CAAC,CAAC,MAAM,EAAE,OAAO,EAAE,aAAa,EAAE,UAAU,CAAC,CAAC,CAAC3B,WAAW,CAAC,2DAA2D,CAAC,EAC1If,IAAI,CAAC,WAAW,CAAC,CAACgB,QAAQ,CAAC,CAAC,CAACyF,SAAS,CAAC,CAAC,CAAC1F,WAAW,CAAC,2BAA2B,CAAC,EACjFf,IAAI,CAAC,UAAU,CAAC,CAACgB,QAAQ,CAAC,CAAC,CAAC0F,QAAQ,CAAC,CAAC,CAAC3F,WAAW,CAAC,4BAA4B,CAAC,EAChFT,sBAAsB,CACvB,EAAE,OAAOW,GAAG,EAAEC,GAAG,KAAK;EACrB,IAAI;IACF,MAAM;MAAEG,MAAM;MAAEsF,SAAS;MAAEC,MAAM;MAAEC;IAAS,CAAC,GAAG5F,GAAG,CAACjB,IAAI;IAExD,IAAI,CAACqB,MAAM,IAAI,CAACuF,MAAM,EAAE;MACtB,OAAO1F,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAC1BC,OAAO,EAAE,KAAK;QACdC,KAAK,EAAE;UACLC,IAAI,EAAE,yBAAyB;UAC/BC,OAAO,EAAE;QACX;MACF,CAAC,CAAC;IACJ;;IAEA;IACA,MAAM8E,aAAa,GAAG;MACpBC,SAAS,EAAE,IAAIC,IAAI,CAAC,CAAC;MACrB3F,MAAM;MACNsF,SAAS;MACTC,MAAM;MAAE;MACRC,QAAQ;MACRI,EAAE,EAAEhG,GAAG,CAACgG,EAAE;MACVC,SAAS,EAAEjG,GAAG,CAACP,GAAG,CAAC,YAAY;IACjC,CAAC;IAEDuB,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAE4E,aAAa,CAAC;;IAEnD;IACA;;IAEA5F,GAAG,CAACU,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACbG,OAAO,EAAE;IACX,CAAC,CAAC;EAEJ,CAAC,CAAC,OAAOF,KAAK,EAAE;IACdG,OAAO,CAACH,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;IACjDZ,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACdC,KAAK,EAAE;QACLC,IAAI,EAAE,iBAAiB;QACvBC,OAAO,EAAE;MACX;IACF,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACAlC,MAAM,CAACY,GAAG,CAAC,oBAAoB,EAAE,CAC/BL,UAAU,EACVH,KAAK,CAAC,WAAW,CAAC,CAACc,QAAQ,CAAC,CAAC,CAACmG,SAAS,CAAC,CAAC,CAACpG,WAAW,CAAC,sCAAsC,CAAC,EAC7Fb,KAAK,CAAC,SAAS,CAAC,CAACc,QAAQ,CAAC,CAAC,CAACmG,SAAS,CAAC,CAAC,CAACpG,WAAW,CAAC,oCAAoC,CAAC,EACzFb,KAAK,CAAC,QAAQ,CAAC,CAACc,QAAQ,CAAC,CAAC,CAACL,QAAQ,CAAC;EAAEE,GAAG,EAAE;AAAI,CAAC,CAAC,CAACE,WAAW,CAAC,2BAA2B,CAAC,EAC1FT,sBAAsB,CACvB,EAAE,OAAOW,GAAG,EAAEC,GAAG,KAAK;EACrB,IAAI;IACF,MAAM;MAAEkG,SAAS;MAAEC,OAAO;MAAEhG;IAAO,CAAC,GAAGJ,GAAG,CAACf,KAAK;;IAEhD;IACA,IAAIoH,UAAU,GAAG,CAAC,CAAC;IACnB,IAAIF,SAAS,IAAIC,OAAO,EAAE;MACxBC,UAAU,CAACtB,SAAS,GAAG,CAAC,CAAC;MACzB,IAAIoB,SAAS,EAAEE,UAAU,CAACtB,SAAS,CAACuB,IAAI,GAAG,IAAIP,IAAI,CAACI,SAAS,CAAC;MAC9D,IAAIC,OAAO,EAAEC,UAAU,CAACtB,SAAS,CAACwB,IAAI,GAAG,IAAIR,IAAI,CAACK,OAAO,CAAC;IAC5D;;IAEA;IACA,IAAII,YAAY,GAAG,CAAC,CAAC;IACrB,IAAIpG,MAAM,EAAE;MACVoG,YAAY,CAACnF,cAAc,GAAGjB,MAAM;IACtC;;IAEA;IACA,MAAMqG,cAAc,GAAG,MAAMtH,KAAK,CAACuH,SAAS,CAAC,CAC3C;MACEC,MAAM,EAAE;QACN,GAAGN,UAAU;QACb,GAAGG,YAAY;QACfnF,cAAc,EAAE;UAAEuF,OAAO,EAAE,IAAI;UAAEC,GAAG,EAAE;QAAK;MAC7C;IACF,CAAC,EACD;MACEC,MAAM,EAAE;QACNhF,GAAG,EAAE,iBAAiB;QACtBiF,UAAU,EAAE;UAAEC,IAAI,EAAE;QAAE,CAAC;QACvBC,YAAY,EAAE;UAAED,IAAI,EAAE;QAAS,CAAC;QAChCE,iBAAiB,EAAE;UAAEC,IAAI,EAAE;QAAS;MACtC;IACF,CAAC,EACD;MACEC,KAAK,EAAE;QAAEL,UAAU,EAAE,CAAC;MAAE;IAC1B,CAAC,CACF,CAAC;;IAEF;IACA,MAAMM,WAAW,GAAG,MAAMlI,KAAK,CAACuH,SAAS,CAAC,CACxC;MACEC,MAAM,EAAE;QACN,GAAGN,UAAU;QACbhF,cAAc,EAAE;UAAEuF,OAAO,EAAE,IAAI;UAAEC,GAAG,EAAE;QAAK;MAC7C;IACF,CAAC,EACD;MAAES,OAAO,EAAE;IAAS,CAAC,EACrB;MACER,MAAM,EAAE;QACNhF,GAAG,EAAE,gBAAgB;QACrByF,aAAa,EAAE;UAAEP,IAAI,EAAE;QAAkB,CAAC;QAC1CQ,OAAO,EAAE;UAAER,IAAI,EAAE;YAAES,SAAS,EAAE,CAAC,cAAc,EAAE,iBAAiB;UAAE;QAAE;MACtE;IACF,CAAC,EACD;MACEC,OAAO,EAAE;QACPC,IAAI,EAAE,UAAU;QAChBC,UAAU,EAAE,KAAK;QACjBC,YAAY,EAAE,KAAK;QACnBC,EAAE,EAAE;MACN;IACF,CAAC,EACD;MAAER,OAAO,EAAE;IAAW,CAAC,EACvB;MACES,QAAQ,EAAE;QACRC,WAAW,EAAE,eAAe;QAC5BC,WAAW,EAAE,eAAe;QAC5BV,aAAa,EAAE,CAAC;QAChBC,OAAO,EAAE;MACX;IACF,CAAC,EACD;MAAEJ,KAAK,EAAE;QAAEG,aAAa,EAAE,CAAC;MAAE;IAAE,CAAC,EAChC;MAAEW,MAAM,EAAE;IAAG,CAAC,CACf,CAAC;IAEFjI,GAAG,CAACU,IAAI,CAAC;MACPC,OAAO,EAAE,IAAI;MACbuH,SAAS,EAAE;QACTC,OAAO,EAAE;UACPC,mBAAmB,EAAE5B,cAAc,CAAC6B,MAAM,CAAC,CAACC,GAAG,EAAEC,IAAI,KAAKD,GAAG,GAAGC,IAAI,CAACzB,UAAU,EAAE,CAAC,CAAC;UACnF0B,oBAAoB,EAAEhC,cAAc,CAAC6B,MAAM,CAAC,CAACC,GAAG,EAAEC,IAAI,KAAKD,GAAG,GAAGC,IAAI,CAACvB,YAAY,EAAE,CAAC,CAAC;UACtFyB,yBAAyB,EAAEjC,cAAc,CAACtB,MAAM,GAAG,CAAC,GAChDsB,cAAc,CAAC6B,MAAM,CAAC,CAACC,GAAG,EAAEC,IAAI,KAAKD,GAAG,GAAGC,IAAI,CAACtB,iBAAiB,EAAE,CAAC,CAAC,GAAGT,cAAc,CAACtB,MAAM,GAC7F;QACN,CAAC;QACDwD,QAAQ,EAAElC,cAAc;QACxBY;MACF,CAAC;MACDjG,IAAI,EAAE;QACJwH,SAAS,EAAE;UAAEzC,SAAS;UAAEC;QAAQ,CAAC;QACjCI,YAAY,EAAEpG,MAAM;QACpByI,WAAW,EAAE,IAAI9C,IAAI,CAAC;MACxB;IACF,CAAC,CAAC;EAEJ,CAAC,CAAC,OAAOlF,KAAK,EAAE;IACdG,OAAO,CAACH,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAChDZ,GAAG,CAACS,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACnBC,OAAO,EAAE,KAAK;MACdC,KAAK,EAAE;QACLC,IAAI,EAAE,yBAAyB;QAC/BC,OAAO,EAAE;MACX;IACF,CAAC,CAAC;EACJ;AACF,CAAC,CAAC;;AAEF;AACA,SAAS+H,UAAUA,CAACC,IAAI,EAAE;EACxB,IAAI,CAACA,IAAI,EAAE,OAAO,EAAE;EACpB,OAAOA,IAAI,CACRlF,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC,CACtBA,OAAO,CAAC,IAAI,EAAE,MAAM,CAAC,CACrBA,OAAO,CAAC,IAAI,EAAE,MAAM,CAAC,CACrBA,OAAO,CAAC,IAAI,EAAE,QAAQ,CAAC,CACvBA,OAAO,CAAC,IAAI,EAAE,OAAO,CAAC;AAC3B;;AAEA;AACA,SAASX,qBAAqBA,CAAC7C,OAAO,EAAEsB,KAAK,GAAG,OAAO,EAAE;EACvD,MAAMqH,WAAW,GAAGrH,KAAK,KAAK,MAAM,GAChC,iEAAiE,GACjE,iEAAiE;EAErE,OAAO;AACT;AACA;AACA;AACA;AACA;AACA,eAAemH,UAAU,CAACzI,OAAO,CAAC0B,IAAI,CAAC;AACvC;AACA;AACA;AACA,YAAYiH,WAAW;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU3I,OAAO,CAAC8B,YAAY,GAAG,aAAa2G,UAAU,CAACzI,OAAO,CAAC8B,YAAY,CAAC8G,GAAG,CAAC,UAAUH,UAAU,CAACzI,OAAO,CAAC8B,YAAY,CAAC+G,GAAG,IAAI7I,OAAO,CAAC0B,IAAI,CAAC,0BAA0B,GAAG,EAAE;AAC/K,oCAAoC+G,UAAU,CAACzI,OAAO,CAAC0B,IAAI,CAAC;AAC5D,2CAA2C+G,UAAU,CAACzI,OAAO,CAAC2B,gBAAgB,IAAI,EAAE,CAAC;AACrF;AACA,aAAa3B,OAAO,CAAC4B,KAAK,CAACkH,OAAO,CAAC,CAAC,CAAC;AACrC,YAAY9I,OAAO,CAAC6B,cAAc,GAAG,kGAAkG7B,OAAO,CAAC6B,cAAc,CAACiH,OAAO,CAAC,CAAC,CAAC,SAAS,GAAG,EAAE;AACtL;AACA,UAAU9I,OAAO,CAACoC,UAAU,CAACC,MAAM,IAAIrC,OAAO,CAACoC,UAAU,CAACE,OAAO,GAAG;AACpE;AACA,cAActC,OAAO,CAACoC,UAAU,CAACC,MAAM,GAAG,WAAWoG,UAAU,CAACzI,OAAO,CAACoC,UAAU,CAACC,MAAM,CAAC0G,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,GAAG,EAAE;AAC7G,cAAc/I,OAAO,CAACoC,UAAU,CAACE,OAAO,GAAG,YAAYmG,UAAU,CAACzI,OAAO,CAACoC,UAAU,CAACE,OAAO,CAACyG,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,GAAG,EAAE;AAC/G;AACA,SAAS,GAAG,EAAE;AACd,mBAAmBN,UAAU,CAACzI,OAAO,CAACyC,IAAI,CAACzC,OAAO,CAAC;AACnD;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AAEAgJ,MAAM,CAACC,OAAO,GAAGzK,MAAM","ignoreList":[]}
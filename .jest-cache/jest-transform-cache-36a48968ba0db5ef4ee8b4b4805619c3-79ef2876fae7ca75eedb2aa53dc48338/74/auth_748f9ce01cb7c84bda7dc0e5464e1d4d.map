{"version":3,"names":["express","require","router","Router","jwt","crypto","body","validationResult","User","requireAuth","generateToken","userId","sign","process","env","JWT_SECRET","expiresIn","validateRegistration","isEmail","normalizeEmail","withMessage","isLength","min","trim","max","optional","isString","validateLogin","notEmpty","validateForgotPassword","validateResetPassword","post","req","res","errors","isEmpty","status","json","success","error","code","message","details","array","email","password","firstName","lastName","phone","preferences","existingUser","findOne","userData","user","create","token","_id","lastLogin","Date","save","wantsEmail","sendWelcomeEmail","welcomeData","emailResult","console","emailError","data","toPublicJSON","guestCartItems","isMatch","comparePassword","isActive","cartInfo","itemCount","mergedItems","cart","resetToken","resetTokenHash","randomBytes","toString","createHash","update","digest","passwordResetToken","passwordResetExpiry","now","sendPasswordResetEmail","resetUrl","FRONTEND_URL","log","Promise","resolve","setTimeout","Math","random","$gt","undefined","authToken","get","put","isBoolean","isObject","startTime","updateData","toObject","emailPreferences","auditContext","ip","userAgent","sessionId","sessionID","updateResult","authService","updateProfileOptimistically","includes","totalDuration","addresses","createdAt","updatedAt","performance","duration","target","notifyUserOfSensitiveChange","currentPassword","newPassword","findById","select","emit","timestamp","session","cartId","guestId","destroy","err","cartCleared","isIn","addressData","type","street","city","state","zipCode","country","isDefault","result","manageAddressOptimistically","addressId","params","forEach","field","delete","patch","decoded","verify","newToken","module","exports"],"sources":["auth.js"],"sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst jwt = require('jsonwebtoken');\nconst crypto = require('crypto');\nconst { body, validationResult } = require('express-validator');\nconst User = require('../models/User');\nconst { requireAuth } = require('../middleware/auth');\n\n// Generate JWT token\nconst generateToken = (userId) => {\n  return jwt.sign({ userId }, process.env.JWT_SECRET, { expiresIn: '7d' });\n};\n\n// Validation middleware for registration\nconst validateRegistration = [\n  body('email')\n    .isEmail()\n    .normalizeEmail()\n    .withMessage('Valid email is required'),\n  body('password')\n    .isLength({ min: 6 })\n    .withMessage('Password must be at least 6 characters long'),\n  body('firstName')\n    .trim()\n    .isLength({ min: 1, max: 50 })\n    .withMessage('First name is required and must be less than 50 characters'),\n  body('lastName')\n    .trim()\n    .isLength({ min: 1, max: 50 })\n    .withMessage('Last name is required and must be less than 50 characters'),\n  body('phone')\n    .optional()\n    .isString()\n    .isLength({ min: 7, max: 30 })\n    .withMessage('Phone number must be between 7 and 30 characters')\n];\n\n// Validation middleware for login\nconst validateLogin = [\n  body('email')\n    .isEmail()\n    .normalizeEmail()\n    .withMessage('Valid email is required'),\n  body('password')\n    .notEmpty()\n    .withMessage('Password is required')\n];\n\n// Validation for forgot password\nconst validateForgotPassword = [\n  body('email')\n    .isEmail()\n    .normalizeEmail()\n    .withMessage('Valid email is required')\n];\n\n// Validation for reset password\nconst validateResetPassword = [\n  body('token')\n    .notEmpty()\n    .withMessage('Reset token is required'),\n  body('password')\n    .isLength({ min: 6 })\n    .withMessage('Password must be at least 6 characters long')\n];\n\n// Register new user\nrouter.post('/register', validateRegistration, async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid input data',\n          details: errors.array()\n        }\n      });\n    }\n\n    const { email, password, firstName, lastName, phone, preferences } = req.body;\n\n    // Check if user already exists\n    const existingUser = await User.findOne({ email });\n    if (existingUser) {\n      return res.status(409).json({\n        success: false,\n        error: {\n          code: 'USER_EXISTS',\n          message: 'User with this email already exists'\n        }\n      });\n    }\n\n    // Create new user\n    const userData = {\n      email,\n      password,\n      firstName,\n      lastName,\n      phone,\n      preferences: preferences || {}\n    };\n\n    const user = await User.create(userData);\n    const token = generateToken(user._id);\n\n    // Update last login\n    user.lastLogin = new Date();\n    await user.save();\n\n    // Send welcome email\n    try {\n      if (user.wantsEmail('welcomeEmails')) {\n        const { sendWelcomeEmail } = require('../utils/emailService');\n        \n        const welcomeData = {\n          firstName: user.firstName,\n          email: user.email\n        };\n\n        const emailResult = await sendWelcomeEmail(user.email, welcomeData);\n        if (!emailResult.success) {\n          console.error('Failed to send welcome email:', emailResult.error);\n        }\n      }\n    } catch (emailError) {\n      console.error('Error sending welcome email:', emailError);\n    }\n\n    res.status(201).json({\n      success: true,\n      message: 'User registered successfully',\n      data: {\n        token,\n        user: user.toPublicJSON()\n      }\n    });\n\n  } catch (error) {\n    console.error('Registration error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'REGISTRATION_ERROR',\n        message: 'Failed to register user'\n      }\n    });\n  }\n});\n\n// Login user with enhanced cart merging\nrouter.post('/login', validateLogin, async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid input data',\n          details: errors.array()\n        }\n      });\n    }\n\n    const { email, password, guestCartItems } = req.body;\n\n    // Find user\n    const user = await User.findOne({ email });\n    if (!user) {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'INVALID_CREDENTIALS',\n          message: 'Invalid email or password'\n        }\n      });\n    }\n\n    // Check password\n    const isMatch = await user.comparePassword(password);\n    if (!isMatch) {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'INVALID_CREDENTIALS',\n          message: 'Invalid email or password'\n        }\n      });\n    }\n\n    // Check if user is active\n    if (!user.isActive) {\n      return res.status(403).json({\n        success: false,\n        error: {\n          code: 'ACCOUNT_DISABLED',\n          message: 'Your account has been disabled'\n        }\n      });\n    }\n\n    // Generate token\n    const token = generateToken(user._id);\n\n    // Update last login\n    user.lastLogin = new Date();\n    await user.save();\n\n    // Cart info (simplified after removing cartService)\n    let cartInfo = { itemCount: 0, mergedItems: 0 };\n    \n    // Guest cart merging would happen on the frontend after login\n\n    res.json({\n      success: true,\n      message: 'Login successful',\n      data: {\n        token,\n        user: user.toPublicJSON(),\n        cart: cartInfo\n      }\n    });\n\n  } catch (error) {\n    console.error('Login error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'LOGIN_ERROR',\n        message: 'Failed to login'\n      }\n    });\n  }\n});\n\n// Forgot password - Fixed timing attack vulnerability\nrouter.post('/forgot-password', validateForgotPassword, async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid input data',\n          details: errors.array()\n        }\n      });\n    }\n\n    const { email } = req.body;\n    \n    // Always execute the same operations to prevent timing attacks\n    let user, resetToken, resetTokenHash;\n    \n    // Find user\n    user = await User.findOne({ email });\n    \n    // Always generate a token (even if user doesn't exist) to normalize timing\n    resetToken = crypto.randomBytes(32).toString('hex');\n    resetTokenHash = crypto\n      .createHash('sha256')\n      .update(resetToken)\n      .digest('hex');\n\n    // If user exists, save the reset token and send email\n    if (user) {\n      // Save reset token and expiry\n      user.passwordResetToken = resetTokenHash;\n      user.passwordResetExpiry = Date.now() + 3600000; // 1 hour\n      await user.save();\n\n      // Send reset email\n      try {\n        const { sendPasswordResetEmail } = require('../utils/emailService');\n        const resetUrl = `${process.env.FRONTEND_URL || 'http://localhost:3000'}/reset-password?token=${resetToken}`;\n        \n        const emailResult = await sendPasswordResetEmail(user.email, {\n          firstName: user.firstName,\n          resetToken,\n          resetUrl\n        });\n        \n        if (!emailResult.success) {\n          console.error('Failed to send reset email:', emailResult.error);\n        }\n        \n        // Log reset URL for development when email is not configured\n        if (emailResult.message === 'Email skipped - not configured') {\n          console.log('\\n========================================');\n          console.log('PASSWORD RESET URL (Email not configured)');\n          console.log('========================================');\n          console.log(`User: ${user.email}`);\n          console.log(`Reset URL: ${resetUrl}`);\n          console.log('========================================\\n');\n        }\n      } catch (emailError) {\n        console.error('Error sending reset email:', emailError);\n      }\n    } else {\n      // If user doesn't exist, still perform the same cryptographic operations\n      // and simulate sending an email to normalize response time\n      await new Promise(resolve => setTimeout(resolve, Math.random() * 100 + 50));\n    }\n\n    // Always return the same response regardless of whether user exists\n    res.json({\n      success: true,\n      message: 'If an account exists with this email, a password reset link will be sent.'\n    });\n\n  } catch (error) {\n    console.error('Forgot password error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'FORGOT_PASSWORD_ERROR',\n        message: 'Failed to process password reset request'\n      }\n    });\n  }\n});\n\n// Reset password\nrouter.post('/reset-password', validateResetPassword, async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid input data',\n          details: errors.array()\n        }\n      });\n    }\n\n    const { token, password } = req.body;\n    \n    // Hash the token to match stored version\n    const resetTokenHash = crypto\n      .createHash('sha256')\n      .update(token)\n      .digest('hex');\n\n    // Find user with valid reset token\n    const user = await User.findOne({\n      passwordResetToken: resetTokenHash,\n      passwordResetExpiry: { $gt: Date.now() }\n    });\n\n    if (!user) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'INVALID_TOKEN',\n          message: 'Password reset token is invalid or has expired'\n        }\n      });\n    }\n\n    // Update password\n    user.password = password;\n    user.passwordResetToken = undefined;\n    user.passwordResetExpiry = undefined;\n    await user.save();\n\n    // Generate new auth token\n    const authToken = generateToken(user._id);\n\n    res.json({\n      success: true,\n      message: 'Password has been reset successfully',\n      token: authToken,\n      user: user.toPublicJSON()\n    });\n\n  } catch (error) {\n    console.error('Reset password error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'RESET_PASSWORD_ERROR',\n        message: 'Failed to reset password'\n      }\n    });\n  }\n});\n\n// Get user profile\nrouter.get('/profile', requireAuth, async (req, res) => {\n  try {\n    res.json({\n      success: true,\n      data: {\n        user: req.user.toPublicJSON()\n      }\n    });\n  } catch (error) {\n    console.error('Profile fetch error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'PROFILE_FETCH_ERROR',\n        message: 'Failed to fetch user profile'\n      }\n    });\n  }\n});\n\n// Update user profile with optimistic updates and performance optimization\nrouter.put('/profile', requireAuth, [\n  body('firstName').optional().trim().isLength({ min: 1, max: 50 }).withMessage('First name must be 1-50 characters'),\n  body('lastName').optional().trim().isLength({ min: 1, max: 50 }).withMessage('Last name must be 1-50 characters'),\n  body('phone').optional().isString().isLength({ min: 7, max: 30 }).withMessage('Phone must be 7-30 characters'),\n  body('email').optional().isEmail().normalizeEmail().withMessage('Valid email is required'),\n  body('preferences.notifications').optional().isBoolean().withMessage('Notifications must be boolean'),\n  body('preferences.newsletter').optional().isBoolean().withMessage('Newsletter must be boolean'),\n  body('preferences.emailPreferences').optional().isObject().withMessage('Email preferences must be an object')\n], async (req, res) => {\n  const startTime = Date.now();\n  \n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid input data',\n          details: errors.array()\n        }\n      });\n    }\n\n    const { firstName, lastName, phone, email, preferences } = req.body;\n    \n    // Build update data object\n    const updateData = {};\n    if (firstName !== undefined) updateData.firstName = firstName;\n    if (lastName !== undefined) updateData.lastName = lastName;\n    if (phone !== undefined) updateData.phone = phone;\n    if (email !== undefined) updateData.email = email;\n    \n    // Handle nested preferences updates\n    if (preferences !== undefined) {\n      updateData.preferences = { \n        ...req.user.preferences?.toObject?.() || req.user.preferences || {},\n        ...preferences\n      };\n      \n      // Handle nested emailPreferences\n      if (preferences.emailPreferences) {\n        updateData.preferences.emailPreferences = {\n          ...req.user.preferences?.emailPreferences || {},\n          ...preferences.emailPreferences\n        };\n      }\n    }\n\n    // Use optimistic update service with performance monitoring\n    const auditContext = {\n      ip: req.ip,\n      userAgent: req.get('User-Agent'),\n      sessionId: req.sessionID\n    };\n\n    const updateResult = await authService.updateProfileOptimistically(\n      req.user._id,\n      updateData,\n      auditContext\n    );\n\n    if (!updateResult.success) {\n      // Handle specific error cases\n      if (updateResult.error.includes('Rate limit exceeded')) {\n        return res.status(429).json({\n          success: false,\n          error: {\n            code: 'RATE_LIMIT_EXCEEDED',\n            message: updateResult.error\n          }\n        });\n      }\n      \n      if (updateResult.error.includes('Email already in use')) {\n        return res.status(409).json({\n          success: false,\n          error: {\n            code: 'EMAIL_EXISTS',\n            message: 'Email address is already in use'\n          }\n        });\n      }\n\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'PROFILE_UPDATE_ERROR',\n          message: updateResult.error\n        }\n      });\n    }\n\n    const totalDuration = Date.now() - startTime;\n\n    // Send success response with performance metrics\n    res.json({\n      success: true,\n      message: 'Profile updated successfully',\n      data: {\n        user: {\n          ...updateResult.user,\n          // Convert to public format if needed\n          _id: updateResult.user._id,\n          email: updateResult.user.email,\n          firstName: updateResult.user.firstName,\n          lastName: updateResult.user.lastName,\n          phone: updateResult.user.phone,\n          addresses: updateResult.user.addresses,\n          preferences: updateResult.user.preferences,\n          createdAt: updateResult.user.createdAt,\n          updatedAt: updateResult.user.updatedAt\n        }\n      },\n      performance: {\n        duration: totalDuration,\n        target: '200ms',\n        status: totalDuration <= 200 ? 'optimal' : 'needs_optimization'\n      }\n    });\n\n    // Send email notification for sensitive changes if configured\n    if (email && email !== req.user.email) {\n      authService.notifyUserOfSensitiveChange(req.user._id, 'email', auditContext);\n    }\n    if (phone && phone !== req.user.phone) {\n      authService.notifyUserOfSensitiveChange(req.user._id, 'phone', auditContext);\n    }\n\n  } catch (error) {\n    console.error('Profile update error:', error);\n    \n    // Handle specific MongoDB errors\n    if (error.code === 11000) {\n      return res.status(409).json({\n        success: false,\n        error: {\n          code: 'DUPLICATE_EMAIL',\n          message: 'Email address is already in use'\n        }\n      });\n    }\n\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'PROFILE_UPDATE_ERROR',\n        message: 'Failed to update profile'\n      }\n    });\n  }\n});\n\n// Change password\nrouter.post('/change-password', requireAuth, [\n  body('currentPassword').notEmpty().withMessage('Current password is required'),\n  body('newPassword').isLength({ min: 6 }).withMessage('New password must be at least 6 characters long')\n], async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid input data',\n          details: errors.array()\n        }\n      });\n    }\n\n    const { currentPassword, newPassword } = req.body;\n\n    // Get user with password field\n    const user = await User.findById(req.user._id).select('+password');\n\n    // Verify current password\n    const isMatch = await user.comparePassword(currentPassword);\n    if (!isMatch) {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'INVALID_PASSWORD',\n          message: 'Current password is incorrect'\n        }\n      });\n    }\n\n    // Update password\n    user.password = newPassword;\n    await user.save();\n\n    res.json({\n      success: true,\n      message: 'Password changed successfully'\n    });\n  } catch (error) {\n    console.error('Password change error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'PASSWORD_CHANGE_ERROR',\n        message: 'Failed to change password'\n      }\n    });\n  }\n});\n\n// Logout (optional - mainly for server-side session cleanup)\nrouter.post('/logout', requireAuth, async (req, res) => {\n  try {\n    const userId = req.user._id;\n    \n    // Emit logout event\n    authService.emit('userLogout', {\n      userId: userId,\n      timestamp: new Date()\n    });\n\n    // Clear any server-side sessions and cleanup cart state\n    if (req.session) {\n      // Clear any cart session IDs to prevent ghost carts\n      delete req.session.cartId;\n      delete req.session.guestId;\n      \n      // Clear the session\n      req.session.destroy((err) => {\n        if (err) {\n          console.error('Session destruction error:', err);\n        }\n      });\n    }\n\n    res.json({\n      success: true,\n      message: 'Logged out successfully',\n      cartCleared: true // Signal to frontend to clear cart state\n    });\n  } catch (error) {\n    console.error('Logout error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'LOGOUT_ERROR',\n        message: 'Failed to logout'\n      }\n    });\n  }\n});\n\n// Address management endpoints without authentication loss\n\n// Add new address\nrouter.post('/addresses', requireAuth, [\n  body('type').isIn(['shipping', 'billing']).withMessage('Address type must be shipping or billing'),\n  body('firstName').trim().isLength({ min: 1, max: 50 }).withMessage('First name is required'),\n  body('lastName').trim().isLength({ min: 1, max: 50 }).withMessage('Last name is required'),\n  body('street').trim().isLength({ min: 1, max: 100 }).withMessage('Street address is required'),\n  body('city').trim().isLength({ min: 1, max: 50 }).withMessage('City is required'),\n  body('state').trim().isLength({ min: 1, max: 50 }).withMessage('State is required'),\n  body('zipCode').trim().isLength({ min: 3, max: 20 }).withMessage('ZIP code is required'),\n  body('country').optional().trim().isLength({ min: 2, max: 3 }).withMessage('Country code must be 2-3 characters'),\n  body('phone').optional().isString().isLength({ min: 7, max: 30 }).withMessage('Phone must be 7-30 characters'),\n  body('isDefault').optional().isBoolean().withMessage('isDefault must be boolean')\n], async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid address data',\n          details: errors.array()\n        }\n      });\n    }\n\n    const addressData = {\n      type: req.body.type,\n      firstName: req.body.firstName,\n      lastName: req.body.lastName,\n      street: req.body.street,\n      city: req.body.city,\n      state: req.body.state,\n      zipCode: req.body.zipCode,\n      country: req.body.country || 'US',\n      phone: req.body.phone,\n      isDefault: req.body.isDefault || false\n    };\n\n    const result = await authService.manageAddressOptimistically(\n      req.user._id,\n      'add',\n      addressData\n    );\n\n    if (!result.success) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'ADDRESS_ADD_ERROR',\n          message: result.error\n        }\n      });\n    }\n\n    res.status(201).json({\n      success: true,\n      message: 'Address added successfully',\n      user: result.user.toPublicJSON(),\n      performance: {\n        duration: result.duration,\n        status: result.performance\n      }\n    });\n\n  } catch (error) {\n    console.error('Add address error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'ADDRESS_ADD_ERROR',\n        message: 'Failed to add address'\n      }\n    });\n  }\n});\n\n// Update existing address\nrouter.put('/addresses/:addressId', requireAuth, [\n  body('type').optional().isIn(['shipping', 'billing']).withMessage('Address type must be shipping or billing'),\n  body('firstName').optional().trim().isLength({ min: 1, max: 50 }).withMessage('First name must be 1-50 characters'),\n  body('lastName').optional().trim().isLength({ min: 1, max: 50 }).withMessage('Last name must be 1-50 characters'),\n  body('street').optional().trim().isLength({ min: 1, max: 100 }).withMessage('Street must be 1-100 characters'),\n  body('city').optional().trim().isLength({ min: 1, max: 50 }).withMessage('City must be 1-50 characters'),\n  body('state').optional().trim().isLength({ min: 1, max: 50 }).withMessage('State must be 1-50 characters'),\n  body('zipCode').optional().trim().isLength({ min: 3, max: 20 }).withMessage('ZIP code must be 3-20 characters'),\n  body('country').optional().trim().isLength({ min: 2, max: 3 }).withMessage('Country code must be 2-3 characters'),\n  body('phone').optional().isString().isLength({ min: 7, max: 30 }).withMessage('Phone must be 7-30 characters'),\n  body('isDefault').optional().isBoolean().withMessage('isDefault must be boolean')\n], async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'VALIDATION_ERROR',\n          message: 'Invalid address data',\n          details: errors.array()\n        }\n      });\n    }\n\n    const { addressId } = req.params;\n    const updateData = {};\n    \n    // Only include fields that are provided\n    ['type', 'firstName', 'lastName', 'street', 'city', 'state', 'zipCode', 'country', 'phone', 'isDefault']\n      .forEach(field => {\n        if (req.body[field] !== undefined) {\n          updateData[field] = req.body[field];\n        }\n      });\n\n    const result = await authService.manageAddressOptimistically(\n      req.user._id,\n      'update',\n      updateData,\n      addressId\n    );\n\n    if (!result.success) {\n      if (result.error.includes('not found')) {\n        return res.status(404).json({\n          success: false,\n          error: {\n            code: 'ADDRESS_NOT_FOUND',\n            message: 'Address not found'\n          }\n        });\n      }\n\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'ADDRESS_UPDATE_ERROR',\n          message: result.error\n        }\n      });\n    }\n\n    res.json({\n      success: true,\n      message: 'Address updated successfully',\n      user: result.user.toPublicJSON(),\n      performance: {\n        duration: result.duration,\n        status: result.performance\n      }\n    });\n\n  } catch (error) {\n    console.error('Update address error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'ADDRESS_UPDATE_ERROR',\n        message: 'Failed to update address'\n      }\n    });\n  }\n});\n\n// Delete address\nrouter.delete('/profile/addresses/:addressId', requireAuth, async (req, res) => {\n  try {\n    const { addressId } = req.params;\n\n    const result = await authService.manageAddressOptimistically(\n      req.user._id,\n      'delete',\n      {},\n      addressId\n    );\n\n    if (!result.success) {\n      if (result.error.includes('not found')) {\n        return res.status(404).json({\n          success: false,\n          error: {\n            code: 'ADDRESS_NOT_FOUND',\n            message: 'Address not found'\n          }\n        });\n      }\n\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'ADDRESS_DELETE_ERROR',\n          message: result.error\n        }\n      });\n    }\n\n    res.json({\n      success: true,\n      message: 'Address deleted successfully',\n      user: result.user.toPublicJSON(),\n      performance: {\n        duration: result.duration,\n        status: result.performance\n      }\n    });\n\n  } catch (error) {\n    console.error('Delete address error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'ADDRESS_DELETE_ERROR',\n        message: 'Failed to delete address'\n      }\n    });\n  }\n});\n\n// Set default address\nrouter.patch('/profile/addresses/:addressId/default', requireAuth, async (req, res) => {\n  try {\n    const { addressId } = req.params;\n\n    const result = await authService.manageAddressOptimistically(\n      req.user._id,\n      'setDefault',\n      {},\n      addressId\n    );\n\n    if (!result.success) {\n      if (result.error.includes('not found')) {\n        return res.status(404).json({\n          success: false,\n          error: {\n            code: 'ADDRESS_NOT_FOUND',\n            message: 'Address not found'\n          }\n        });\n      }\n\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'ADDRESS_DEFAULT_ERROR',\n          message: result.error\n        }\n      });\n    }\n\n    res.json({\n      success: true,\n      message: 'Default address updated successfully',\n      user: result.user.toPublicJSON(),\n      performance: {\n        duration: result.duration,\n        status: result.performance\n      }\n    });\n\n  } catch (error) {\n    console.error('Set default address error:', error);\n    res.status(500).json({\n      success: false,\n      error: {\n        code: 'ADDRESS_DEFAULT_ERROR',\n        message: 'Failed to set default address'\n      }\n    });\n  }\n});\n\n// Refresh token endpoint\nrouter.post('/refresh-token', async (req, res) => {\n  try {\n    const { token } = req.body;\n    \n    if (!token) {\n      return res.status(400).json({\n        success: false,\n        error: {\n          code: 'MISSING_TOKEN',\n          message: 'Token is required'\n        }\n      });\n    }\n\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n    const user = await User.findById(decoded.userId);\n    \n    if (!user || !user.isActive) {\n      return res.status(401).json({\n        success: false,\n        error: {\n          code: 'INVALID_TOKEN',\n          message: 'Invalid token'\n        }\n      });\n    }\n\n    const newToken = generateToken(user._id);\n    \n    res.json({\n      success: true,\n      token: newToken,\n      user: user.toPublicJSON()\n    });\n  } catch (error) {\n    console.error('Token refresh error:', error);\n    res.status(401).json({\n      success: false,\n      error: {\n        code: 'TOKEN_REFRESH_ERROR',\n        message: 'Failed to refresh token'\n      }\n    });\n  }\n});\n\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}